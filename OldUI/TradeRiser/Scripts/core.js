//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
define("Presentation/Scripts/TFS/TFS",["require","exports","Presentation/Scripts/TFS/Resources/TFS.Resources.TFSSeedFileResources"],function(E,a,s){var b=s,F=0,q=false,l=false,x=0;a.uiCulture;a.errorHandler;a.globalProgressIndicator;a.ServerException;var d;(function(a){a.ServerException="TFS.ServerException"})(d||(d={}));if(typeof _globalDebugFlag!=="undefined")q=_globalDebugFlag;if(typeof __uiCulture!=="undefined")a.uiCulture=__uiCulture;Error.serverError=function(a){var c=Error.create(a&&a.message||b.UnknownServerErrorMessage,$.extend(a||{},{name:d.ServerException}));c.popStackFrame();return c};Error.circularDependency=function(a,c){var d=Error.create(String.format(b.CircularDependencyErrorFormat,a,c),{moduleName:a,moduleReference:c});d.popStackFrame();return d};function m(i,m,l,n){var c={},g,d=0,k=0,a,h=false,j=false;function f(e,b,f){var a;if(e||b){a=k++;d++;c[a]=[e,b,f]}return a}g=f(m,l,n);function e(){var b,e,g=h?0:j?1:-1,f,l,k=false;if(g>=0){for(b in c)if(c.hasOwnProperty(b)){e=c[b];f=e[g];if(f){l=e[2];f.apply(i,(a||[]).concat([l]));k=true}}c={};d=0}return k}return{cookie:g,count:function(){return d},finish:function(){h=true;a=Array.prototype.slice.call(arguments,0);e()},error:function(){j=true;a=Array.prototype.slice.call(arguments,0);if(a.length===0)a=[Error.invalidOperation(b.UnknownServerErrorMessage)];!e()&&p(a[0],null,i)},register:function(c,b,d){var a=f(c,b,d);a&&e();return a},unregister:function(a){d--;delete c[a]}}}a.queueCallbacks=m;function A(f,d,c,b,g,h){var a=d[c],e;function i(a){d[c]=a;e.finish(a)}function j(a){d[c]=null;e.error(a)}if(h&&a===null||typeof a==="undefined"){e=m(f,b,g);d[c]=e.register;h.call(f,i,j)}else if($.isFunction(a))a(b,g);else $.isFunction(b)&&b.call(f,a)}a.queueRequest=A;function k(a){return a?typeof a==="string"?a:$.isFunction(a)?k(a()):a.message?a.message:a.toString():b.UnknownErrorMessage}a.getErrorMessage=k;var z=function(){function a(){this.$error=null;this.visible=false}a.prototype.initialize=function(){var a=this;this.$error=$(".error-section").bind("keydown",function(b){if(b.keyCode===27){a.hideError();return false}})};a.prototype.exists=function(){return this.$error.length>0};a.prototype.showError=function(d,e,c){var f=this,a,g;function h(b){var a="";if(e)a=e+": ";if(d)a=a+d;g=$("<li>").text(a).appendTo(b);c&&$("<pre>").text(c).appendTo(g)}if(!this.visible){this.visible=true;this.$error.empty();$("<div tabIndex=0 />").addClass("close").text(b.ErrorPaneCloseLink).appendTo(this.$error).click(function(){f.hideError()}).keydown(function(a){if(a.which===13){f.hideError();return false}});a=$("<div>").addClass("message").appendTo(this.$error);$("<h4>").text(b.ErrorPaneHeader).appendTo(a);$("<ul>").addClass("error-list").appendTo(a)}h($("ul.error-list",this.$error));this.$error.show().focus()};a.prototype.hideError=function(){$("p",this.$error).remove();this.$error.hide();this.visible=false};a.prototype.show=function(a){if(this.exists())this.showError(a.message,a.status,a.stack);else alert(a.message)};return a}();a.errorHandler=new z;function p(c,b,d){if($.isFunction(b))b.call(d,c);else a.errorHandler.show(c)}a.handleError=p;var t=function(){function a(){this._progressPendingActions=null;this._progressPendingActionsCount=0;this._progressPendingActionsNewId=0;this._pageProgressElements=null;this._pageProgressDelayShowTimeout=null;this._pageProgressMinShowTimeout=null;this._showingProgress=false;var a=this;this._progressPendingActions={};this._pageProgressElements=[];$(function(){var b=$(".pageProgressIndicator");b.length>0&&a._addProgressElement(b)})}a.prototype.getProgressElements=function(){return this._pageProgressElements};a.prototype.registerProgressElement=function(a){this._addProgressElement(a);if(this._showingProgress)a.show();else a.hide()};a.prototype.unRegisterProgressElement=function(b){if(this._pageProgressElements)for(var a=0,a=0;a<this._pageProgressElements.length;a++)if(this._pageProgressElements[a]===b){this._pageProgressElements.splice(a,1);break}};a.prototype._addProgressElement=function(a){this._pageProgressElements.push(a)};a.prototype._showProgressElements=function(){var a=this,b=this._pageProgressElements;if(this._progressPendingActionsCount===0)return;this._showingProgress=true;if(b.length===0)return;$.each(b,function(b,a){a.show()});if(!this._pageProgressMinShowTimeout)this._pageProgressMinShowTimeout=window.setTimeout(function(){a._pageProgressMinShowTimeout=null;a._progressPendingActionsCount===0&&a._hideProgressElements()},250)};a.prototype._hideProgressElements=function(){this._showingProgress=false;$.each(this._pageProgressElements,function(b,a){a.hide()})};a.prototype.actionStarted=function(d,c){var a,b=this;a=++this._progressPendingActionsNewId;this._progressPendingActions[a]=d;if(this._progressPendingActionsCount++===0)if(c===true){if(this._pageProgressDelayShowTimeout){window.clearTimeout(this._pageProgressDelayShowTimeout);this._pageProgressDelayShowTimeout=null}this._showProgressElements()}else if(!this._pageProgressDelayShowTimeout)this._pageProgressDelayShowTimeout=window.setTimeout(function(){b._pageProgressDelayShowTimeout=null;b._showProgressElements()},250);return a};a.prototype.actionCompleted=function(a){delete this._progressPendingActions[a];--this._progressPendingActionsCount===0&&!this._pageProgressMinShowTimeout&&this._hideProgressElements()};a.prototype.getPendingActions=function(){var a=[];$.each(this._progressPendingActions,function(c,b){a.push(c+": "+b)});return a};return a}();a.globalProgressIndicator=new t;$(window).bind("beforeunload",function(){l=true});$(function(){var b;b=a.globalProgressIndicator.actionStarted("Initial page load",true);a.errorHandler.initialize();a.globalProgressIndicator.actionCompleted(b)});function v(){return l}a.hasUnloadRequest=v;a.ServerException=d.ServerException;function o(d,b,c,a){return function(){var g=this.base,e=this.baseConstructor,f=this._base;this.base=c;this.baseConstructor=a;this._base=function(){return b.apply(this,Array.prototype.slice.call(arguments,0))};try{return d.apply(this,Array.prototype.slice.call(arguments,0))}finally{this.base=g;this.baseConstructor=e;this._base=f}}}function e(e,d,b,f){var a,c;for(a in d)if(a!=="__name"&&d.hasOwnProperty(a)){c=d[a];if(b&&typeof c==="function"&&typeof b[a]==="function")e[a]=o(c,b[a],b,f);else e[a]=c}return e}Function.prototype.inherit=function(a,f){var b,d,c;e(this,$.extend({},a,this),a,a);this.base=a;this._super=a.prototype;f=$.extend({},this.prototype,f);b=a.prototype;b.constructor=a;c=b.baseConstructor;function g(){}g.prototype=b;d=new g;e(d,f,b,c);this.prototype=d;this.prototype.constructor=this;if(c)this.prototype.baseConstructor=o(a,c,b,c);else this.prototype.baseConstructor=a};Function.prototype.extend=function(a){return e(this,a,this.base,this.baseConstructor)};function B(b,a){e(b,a,null,null)}a.classExtend=B;function C(a){var b,c;if(!a.__name){a.__name="_type_"+x++;if(q){b=a.name;if(!b){c=a.toString();b=c.substring(9,c.indexOf("("))}if(b)a.__name+="_"+b}}return a.__name}a.getTypeName=C;function u(d,b){var a,c;for(a in b)if(a!=="__name"&&b.hasOwnProperty(a)){c=b[a];d.prototype[a]=c}}a.initClassPrototype=u;var f={};typeof _bases!=="undefined"&&_bases.length>0&&$.each(_bases,function(b,a){f[a.namespace]=a.base});typeof _builtInBases!=="undefined"&&_builtInBases.length>0&&$.each(_builtInBases,function(b,a){f[a.namespace]=a.base});function i(a){var b,c;if(f){b=f[a];if(!b){c=a.lastIndexOf(".");if(c>0)return i(a.substring(0,c))}}return b||""}a.getModuleBase=i;function n(a){return i(a)+a}var c={},g={},D={},y={};function j(d,b){var a=c[d];D[b]=d;if(!a){a=[];c[d]=a}if(b.indexOf("/")<0)a.push(n(b));else a.push(b)}typeof _disabledPlugins!=="undefined"&&$.each(_disabledPlugins,function(b,a){g[a]=true});typeof _plugins!=="undefined"&&_plugins.length>0&&$.each(_plugins,function(b,a){!(a.namespace in g)&&j(a.loadAfter,a.namespace)});typeof _builtinPlugins!=="undefined"&&_builtinPlugins.length>0&&$.each(_builtinPlugins,function(b,a){!(a.namespace in g)&&j(a.loadAfter,a.namespace)});function r(b,a){E(b,a)}a.using=r;a.module=function(e,b,d){for(var c=[],a=0;a<b.length;a++)c.push(n(b[a]));define(c,function(){var a=d();h(e,a)})};function w(g,b){for(var e=g.split("."),f=window,a,c,d=0;d<e.length;d++){a=f[e[d]];if(!a){a={};f[e[d]]=a}f=a}if(a&&b)for(c in b)if(b.hasOwnProperty(c))a[c]=b[c];return a}function h(a,d){var b=c[a];y[a]=true;w(a,d);if(b){r(b,function(){});delete c[a]}}a.tfsModuleLoaded=h;h("TFS",a)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
define("Presentation/Scripts/TFS/Generated/TFS.Common.Constants",["require","exports","Presentation/Scripts/TFS/TFS"],function(f,a,b){var c=b;(function(a){a.TcmResult="TcmResult";a.TcmResultAttachment="TcmResultAttachment";a.Build="Build";a.VersionedItem="VersionedItem";a.LatestItemVersion="LatestItemVersion";a.Changeset="Changeset";a.Shelveset="Shelveset";a.WorkItem="WorkItem";a.Storyboard="Storyboard";a.Commit="Commit"})(a.ArtifactTypeNames||(a.ArtifactTypeNames={}));var d=a.ArtifactTypeNames;(function(a){a.VersionControl="VersionControl";a.WorkItemTracking="WorkItemTracking";a.TeamBuild="Build";a.TestManagement="TestManagement";a.Requirements="Requirements";a.Legacy="Legacy";a.CodeSense="CodeSense";a.Git="Git"})(a.ToolNames||(a.ToolNames={}));var e=a.ToolNames;a.TypeInfo={TeamFoundationIdentityReference:{fields:null},TeamProjectReference:{fields:null}};c.tfsModuleLoaded("TFS.Common.Constants",a)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
define("Presentation/Scripts/TFS/Generated/TFS.Server.WebAccess.Constants",["require","exports","Presentation/Scripts/TFS/TFS"],function(h,a,b){var c=b;(function(a){a.WebAccessServicePreviewBuild="WebAccess.Service.Preview.Build";a.WebAccessServicePreviewChat="WebAccess.Service.Preview.Chat";a.WebAccessServicePreviewTest="WebAccess.Service.Preview.Test";a.WebAccessPortfolioBacklogs="WebAccess.Agile.PortfolioBacklogs";a.WebAccessPortfolioBacklogsMapping="WebAccess.Agile.PortfolioBacklogs.Mapping";a.WebAccessServicePromotePaidVersion="WebAccess.Service.PromotePaidVersion";a.WebAccessTestManagementTestHub="WebAccess.TestManagement.TestHub";a.WebAccessExtensions="WebAccess.Extensions";a.WebAccessExtensionsDeployment="WebAccess.Extensions.Deployment";a.WebAccessExtensionsApplication="WebAccess.Extensions.Application";a.WebAccessExtensionsProjectCollection="WebAccess.Extensions.ProjectCollection";a.WebAccessExtensionsPersonal="WebAccess.Extensions.Personal";a.WebAccessAgileProductBacklogSearch="WebAccess.Agile.ProductBacklog.Search";a.WebAccessAgileSprintPlanningDragToProgressControl="WebAccess.Agile.SprintPlanning.DragToProgressControl";a.WebAccessTestManagementTestRun="WebAccess.TestManagement.TestRun";a.WebAccessServiceMetricsAnalytics="WebAccess.Service.MetricsAnalytics";a.SourceControlGit="SourceControl.Legacy";a.WebAccessVersionControlOpenInVS="WebAccess.VersionControl.OpenInVS";a.AppAnalytics="App.Analytics";a.WebAccessVersionControlCodeComments="WebAccess.VersionControl.CodeComments";a.WebAccessTestManagementBulkTestCaseAuthoring="WebAccess.TestManagement.BulkTestCaseAuthoring";a.WebAccessTestManagementRunTestInClient="WebAccess.TestManagement.RunTestInClient";a.WorkItemCharting="WorkItemTracking.Charting";a.ChatServiceDeleteRoom="ChatService.DeleteRoom"})(a.FeatureAvailabilityFlags||(a.FeatureAvailabilityFlags={}));var d=a.FeatureAvailabilityFlags;(function(a){a.ChartAuthoring="Charting.Authoring"})(a.FeatureLicenseFlags||(a.FeatureLicenseFlags={}));var e=a.FeatureLicenseFlags;(function(a){a.MruHubPath="/WebAccess/MRU/Hub"})(a.HubsConstants||(a.HubsConstants={}));var f=a.HubsConstants;(function(a){a.DismissNotificationRegistryPath="/notification/dismiss/"})(a.Messages||(a.Messages={}));var g=a.Messages;c.tfsModuleLoaded("TFS.Server.WebAccess.Constants",a)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
define("Presentation/Scripts/TFS/TFS.Diag",["require","exports","Presentation/Scripts/TFS/TFS"],function(hb,a,eb){var q=eb,d,e=[];a.perfCollector;a.logLevel;var o=false;a.debug=typeof _globalDebugFlag==="undefined"?false:_globalDebugFlag;var y=typeof _globalThrowOnAssertFailures==="undefined"?false:_globalThrowOnAssertFailures,h=typeof _globalProfileStartTracePoint==="undefined"?null:_globalProfileStartTracePoint,i=typeof _globalProfileEndTracePoint==="undefined"?null:_globalProfileEndTracePoint,l=0,j=false;(function(a){a._map=[];a.Off=0;a.Error=1;a.Warning=2;a.Info=3;a.Verbose=4})(a.LogVerbosity||(a.LogVerbosity={}));var f=a.LogVerbosity;a.logLevel=f.Warning;function c(a,b){return a+" is required and needs to be a "+b}function W(b){var a=function(b,c){var a=""+b;while(a.length<c)a="0"+a;return a};return a(b.getHours(),2)+":"+a(b.getMinutes(),2)+":"+a(b.getSeconds(),2)+"."+a(b.getMilliseconds(),3)}function g(e,c){var b,f;if(e<=a.logLevel){a.debug&&Sys.Debug.trace(c);if(d)for(b=0,f=d.length;b<f;b++)d[b](c,e)}}a.log=g;function ab(a){g(f.Error,a)}a.logError=ab;function Y(a){g(f.Warning,a)}a.logWarning=Y;function cb(a){g(f.Info,a)}a.logInfo=cb;function X(a){g(f.Verbose,a)}a.logVerbose=X;function gb(a){if(!d)d=[];d.push(a)}a.listen=gb;function bb(c){var a,b;if(d)for(a=0,b=d.length;a<b;a++)d[a]===c&&d.splice(a--,1)}a.unlisten=bb;function b(b){if(a.debug){if(y)throw Error.create("Assertion failure: "+b);Sys.Debug.assert(false,b,o)}}a.fail=b;function fb(c,d){a.debug&&!c&&b(d)}a.assert=fb;function O(c,d){a.debug&&(c===null||typeof c!=="object")&&b(d)}a.assertIsObject=O;function E(d,e,f){if(a.debug){var g=f&&(d===null||d===undefined)||d!==null&&typeof d==="object";!g&&b(c(e,"object"))}}a.assertParamIsObject=E;function Q(c,e,d){a.debug&&(!$.isArray(c)||d&&c.length===0)&&b(e)}a.assertIsArray=Q;function G(e,f,d){a.debug&&(!$.isArray(e)||d&&e.length===0)&&b(c(f,"array"+d?" (non-empty)":""))}a.assertParamIsArray=G;function S(d,c){a.debug&&typeof d!=="boolean"&&b(c)}a.assertIsBool=S;function H(e,d){a.debug&&typeof e!=="boolean"&&b(c(d,"boolean"))}a.assertParamIsBool=H;function N(b,c){a.debug&&(typeof b!=="number"||isNaN(b))&&this.fail(c)}a.assertIsNumber=N;function D(d,e){a.debug&&(typeof d!=="number"||isNaN(d))&&b(c(e,"number"))}a.assertParamIsNumber=D;function L(c,d){a.debug&&(typeof c!=="number"||isNaN(c)||Math.round(c)!==c)&&b(d)}a.assertIsInteger=L;function B(d,e){a.debug&&(typeof d!=="number"||isNaN(d)||Math.round(d)!==d)&&b(c(e,"integer"))}a.assertParamIsInteger=B;function P(d,c){a.debug&&typeof d!=="string"&&b(c)}a.assertIsString=P;function F(e,d){a.debug&&typeof e!=="string"&&b(c(d,"string"))}a.assertParamIsString=F;function w(c,d){a.debug&&(typeof c!=="string"||c==="")&&b(d)}a.assertIsStringNotEmpty=w;function r(d,e){a.debug&&(typeof d!=="string"||d==="")&&b(c(e,"non-empty string"))}a.assertParamIsStringNotEmpty=r;function n(d,c){a.debug&&typeof d!=="function"&&b(c)}a.assertIsFunction=n;function x(e,d){a.debug&&typeof e!=="function"&&b(c(d,"function"))}a.assertParamIsFunction=x;function T(d,c){a.debug&&!(d instanceof Date)&&b(c)}a.assertIsDate=T;function I(e,d){a.debug&&!(e instanceof Date)&&b(c(d,"date"))}a.assertParamIsDate=I;function M(c,d){a.debug&&(c===null||c===undefined)&&b(d)}a.assertIsNotNull=M;function C(e,d){a.debug&&e===null&&b(c(d,"not null and not undefined"))}a.assertParamIsNotNull=C;function A(d,c){a.debug&&d===undefined&&b(c)}a.assertIsNotUndefined=A;function t(e,d){a.debug&&e===undefined&&b(c(d,"not undefined"))}a.assertParamIsNotUndefined=t;function z(c,d){a.debug&&(c===null||typeof c!=="object"||typeof c.jquery!=="string")&&b(d)}a.assertIsJQueryObject=z;function s(d,e){a.debug&&(d===null||typeof d!=="object"||typeof d.jquery!=="string")&&b(c(e,"jQuery object"))}a.assertParamIsJQueryObject=s;function p(c,d,g,f){var e;if(a.debug){if(c===null||c===undefined&&d!=="undefined")e=f;else if(typeof d==="string")e=typeof c===d;else e=c instanceof d;!e&&b(g)}}a.assertIsType=p;function U(a){!a&&b("An assert to check a value's type was handed an invalid type to check for.");if(typeof a==="string")return a;n(a,"Expected to have a constructor function passed when checking a type");return a.toString().match(/^\s*function\s*([\w]*)\(/)[1]||"Unnamed type: ("+a.toString()+")"}function J(f,b,d,e){a.debug&&p(f,b,c(d,U(b)),e)}a.assertParamIsType=J;function db(a,b){if(j){g(f.Error,"There is a profile already in progress: "+l+": "+h+"->"+i);return}h=a;i=b;document.cookie="TFS-TRACEPOINT-START="+a+";";document.cookie="TFS-TRACEPOINT-END="+b+";"}a.profile=db;function Z(){if(j){j=false;console.profileEnd()}}a.profileEnd=Z;function R(b,d){if(h!=null&&i!==null)if(h===b){console.profile(l+": "+h+"->"+i);l++;j=true}else if(i===b){console.profileEnd();j=false}for(var c=0;c<e.length;c++){e[c].call(this,b,d);f.Verbose<=a.logLevel&&g(f.Verbose,"TRACEPOINT ["+W(new Date)+"]: "+b)}}a.logTracePoint=R;function m(b){for(var a=0;a<e.length;a++)if(b===e[a])return;e.push(b)}a.addTracePointCollector=m;function u(b){for(var a=0;a<e.length;a++)b===e[a]&&e.splice(a,1)}a.removeTracePointCollector=u;function V(b){a.logLevel=b}a.setLogLevel=V;function K(a){o=a}a.setDisplayCallers=K;var k=function(){function a(){this._moduleInitTime=+new Date;this._tracePoints=[];this._overallCounts={};this._activeCounts={}}a.prototype.register=function(){var a=this;m(function(c,b){a._handleTracePoint(c,b)})};a.prototype.getOverallCount=function(b){var a=this._overallCounts[b];return a?a:0};a.prototype.getActiveCount=function(b){var a=this._activeCounts[b];return a?a:0};a.prototype.getLastTracePoint=function(b){for(var a=this._tracePoints.length-1;a>=0;a--)if(this._tracePoints[a].name===b)return this._tracePoints[a];return null};a.prototype.getLastTracePointTime=function(b){var a=this.getLastTracePoint(b);return a?a.time:0};a.prototype.resetActiveCount=function(a){this._activeCounts[a]=0};a.prototype.resetActiveCounts=function(){this._activeCounts={};this._lastResetTime=+new Date;this._lastResetIndex=this._tracePoints.length};a.prototype.getModuleInitTime=function(){return this._moduleInitTime};a.prototype.getTracePoints=function(a){return a===true?this._tracePoints.slice(this._lastResetIndex):this._tracePoints};a.prototype.getTracePointCountData=function(c){var a,e,b,d="";for(a=0,e=c.length;a<e;a++){b=c[a];d+=this.getActiveCount(b)+";"+this.getOverallCount(b)+"\t"}return d};a.prototype.dumpTracePoints=function(g){var c,e,b,d,f,a;c="ModuleInitTime\t"+this._moduleInitTime+"\nLastReset\t"+Math.max(0,this._lastResetTime-this._moduleInitTime);e=this.getTracePoints(g);f=e.length;for(d=0;d<f;d++){b=e[d];c+="\n"+(b.time-this._moduleInitTime)+"\t"+b.name;a=b.data;if(a){if(a instanceof Error){a=a.message;if(a.stackTrace)a+=" @"+a.stackTrace}if($.isArray(a))a=a.join(";");c+=("\t"+a).replace(/[\n\r]/g," ")}}return c};a.prototype._updateCount=function(a,b){var c=a[b];if(c)a[b]=c+1;else a[b]=1};a.prototype._handleTracePoint=function(b,c){var a={};a.time=+new Date;a.name=b;a.data=c;this._tracePoints.push(a);this._updateCount(this._overallCounts,b);this._updateCount(this._activeCounts,b)};return a}();a.PerfTracePointCollector=k;q.initClassPrototype(k,{_tracePoints:null,_overallCounts:null,_activeCounts:null,_moduleInitTime:null,_lastResetTime:0,_lastResetIndex:0});function v(){if(typeof _globalTracePointCollectorFlag!=="undefined"&&_globalTracePointCollectorFlag===true){a.perfCollector=new k;a.perfCollector.register()}}v();q.tfsModuleLoaded("TFS.Diag",a)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
define("Presentation/Scripts/TFS/TFS.Core",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/Resources/TFS.Resources.Common","Presentation/Scripts/TFS/TFS.Diag"],function(U,a,L,E,K){var f=L,c=E,b=K,m,l;a.OperationCanceledException="TFS.Core.OperationCanceledException";var g,s,q,n;a.utcOffset=0;a.supportsDayLightSavingsTime=false;a.timeZoneMap=[];var e=Array.prototype.slice,J=/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007F-\u009F]/,H=/(^[\uD800-\uDFFF]$)|[^\uD800-\uDBFF](?=[\uDC00-\uDFFF])|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/;function F(){return Function.validateParameters.apply(null,e.call(arguments,0))}a.validateParameters=F;Error.canceled=function(){var b=Error.create("Operation Canceled.",{name:a.OperationCanceledException});b.popStackFrame();return b};function i(b,c,a){return function(){if(typeof a==="undefined")return c.apply(b,arguments);else{var d=e.call(arguments,0);if(a instanceof Array)d=d.concat(a);else d.push(a);return c.apply(b,d)}}}a.delegate=i;function M(c){for(var b=[],a=0;a<arguments.length-1;a++)b[a]=arguments[a+1];b=e.call(arguments,1);return function(){return c.apply(this,b.concat(e.call(arguments,0)))}}a.curry=M;function I(c,a,e){var d=null,b;if(typeof a!=="string"&&!$.isFunction(a))throw new Error.argument("messageOrTransform",a);if($.isFunction(c))d=function(d){if(typeof a==="string"){b=Error.create(a,e);b.innerException=d}else b=a(d);c(b)};return d}a.transformError=I;function N(c,d){var a=[];if(d)for(var b in c)a.push(b);else for(var b in c)c.hasOwnProperty(b)&&a.push(b);return a}a.keys=N;var h=function(){function a(a,e,d,b,c){this._interval=e;this._name=d;this._func=i(a,b,c)}a.prototype.start=function(){var a=this;if(!this._timeoutHandle){b.logTracePoint("Core.DelayedFunction.pending",this._name);this._timeoutHandle=window.setTimeout(function(){delete a._timeoutHandle;try{a._func.call(a)}finally{b.logTracePoint("Core.DelayedFunction.complete",[a._name,"complete"])}},this._interval)}};a.prototype.reset=function(){this.cancel();this.start()};a.prototype.cancel=function(){if(this._timeoutHandle){window.clearTimeout(this._timeoutHandle);delete this._timeoutHandle;b.logTracePoint("Core.DelayedFunction.complete",[this._name,"canceled"])}};a.prototype.invokeNow=function(){this.cancel();this._func()};a.prototype.setDelay=function(a){this._interval=a};a.prototype.setMethod=function(a,b,c){this._func=i(a,b,c)};a.prototype.isPending=function(){return this._timeoutHandle?true:false};return a}();a.DelayedFunction=h;f.initClassPrototype(h,{_interval:0,_func:null,_timeoutHandle:null,_name:null});function z(b,e,c,d){var a=new h(b,e,null,c,d);a.start();return a}a.delay=z;function G(b,e,c,d){var a=new h(b,e,"throttledDelegate",c,d);return i(a,a.reset)}a.throttledDelegate=G;function B(b,d,a){if(typeof a==="undefined"||a<0)a=0;var c=function(){var a=$.now();b(function(){B(b,d,Math.max(0,d-$.now()+a))})};if(a===0)c();else window.setTimeout(c,a)}a.poll=B;var x=function(){function a(a){this.context=a;this._callbacks=[]}a.prototype.perform=function(a){!this.canceled&&$.isFunction(a)&&a.call(this.context)};a.prototype.wrap=function(a){var b=this;return function(){if(!b.canceled&&$.isFunction(a))return a.apply(this,e.call(arguments,0))}};a.prototype.cancel=function(){var a=this;this.canceled=true;$.each(this._callbacks,function(c,b){b.call(a.context)})};a.prototype.register=function(a){if($.isFunction(a)){this._callbacks.push(a);this.canceled&&a.call(this.context)}};return a}();a.Cancelable=x;f.initClassPrototype(x,{canceled:false,context:null,_callbacks:null});var w=function(){function a(){}a.prototype.registerConstructor=function(c,a){b.assertParamIsType(c,"string","key");b.assertParamIsType(a,"function","ctor");if(!this._ctors)this._ctors={};this._ctors[c]=a};a.prototype.getConstructor=function(a){b.assertParamIsType(a,"string","key");return this._ctors&&this._ctors[a]};a.prototype.createInstance=function(d,e){b.assertParamIsType(d,"string","key");b.assertParamIsType(e,Array,"args",true);var a=this.getConstructor(d),c;function f(){}if(a){f.prototype=a.prototype;c=new f;a.apply(c,e)}else b.fail("The constructor wasn't registered: "+d);b.assertIsType(c,a,"Expected the new object to be an instance of "+a);return c};return a}();a.TypeFactory=w;f.initClassPrototype(w,{_ctors:null});function p(){if(!m)m=$("input[name=__RequestVerificationToken]").val();return m}a.getAntiForgeryTokenValue=p;function k(){if(!l)l=$("input[name=__RequestVerificationToken2]").val();return l}a.getAntiForgeryTokenValue2=k;function C(){var a,b;a=$("<input />").attr("type","hidden").attr("name","__RequestVerificationToken").val(p());b=k();b&&a.after($("<input />").attr("type","hidden").attr("name","__RequestVerificationToken2").val(k()));return a}function D(b){var a=$(b);if(a.find("input[name=__RequestVerificationToken]").length===0)return a.append(C())}a.setAntiForgeryToken=D;var u=function(){function a(){this._textBuilder=[]}a.prototype.append=function(a){if(typeof a==="string")this._textBuilder[this._textBuilder.length]=a};a.prototype.appendNewLine=function(){this.append(v.newLine)};a.prototype.toString=function(){return this._textBuilder.join("")};return a}();a.StringBuilder=u;f.initClassPrototype(u,{_textBuilder:null});var t=function(){function a(){this._operationQueue=[]}a.prototype.queueOperation=function(a){b.assertParamIsFunction(a,"operation");this._operationQueue.push(a);this._processQueue()};a.prototype._processQueue=function(){var a=this;if(!this._isProcessingOperation&&this._operationQueue.length>0){this._isProcessingOperation=true;z(this,0,function(){var d,c=false;function e(){b.assert(!c,"The operation has already invoked the completed callback.");if(!c){c=true;a._isProcessingOperation=false;a._processQueue()}}d=a._operationQueue.shift();d(e)})}};return a}();a.OperationQueue=t;f.initClassPrototype(t,{_operationQueue:null,_isProcessingOperation:false});if(typeof __utcOffset!=="undefined")a.utcOffset=__utcOffset||0;if(typeof __supportsDayLightSavingsTime!=="undefined")a.supportsDayLightSavingsTime=__supportsDayLightSavingsTime;if(typeof __timeZoneMap!=="undefined")a.timeZoneMap=__timeZoneMap;s=Date.parseLocale;n=Date.prototype.localeFormat;g=Date._expandFormat;Date._expandFormat=function(a,b){return b==="G"?g(a,"d")+" "+g(a,"T"):g(a,b)};Date._getEraYear=function(d,b,f,e){var a=d.getFullYear(),c=b.Calendar.convert;if(c)a=c.fromGregorian(d)[0];if(!e&&b.eras)a-=b.eras[f+3];return a};q=Sys.CultureInfo.prototype._getDateTimeFormats;Sys.CultureInfo.prototype._getDateTimeFormats=function(){if(!this._myDateFormats)this._myDateFormats=q.apply(this,e.call(arguments,0)).concat([this.dateTimeFormat.ShortDatePattern+" "+this.dateTimeFormat.LongTimePattern]);return this._myDateFormats};var j=6e4,A=j*60,o=A*24,O=o*7;(function(d){d.MILLISECONDS_IN_MINUTE=j;d.MILLISECONDS_IN_HOUR=A;d.MILLISECONDS_IN_DAY=o;d.MILLISECONDS_IN_WEEK=O;function y(a){var b=a.getTime()-a.getTimezoneOffset()*6e4;return b===-621355968e5}d.isMinDate=y;function C(b,a){return a instanceof Date?a.getTime()-b.getTime():-1}d.compare=C;function D(a,b){return a===null||a===undefined?a===b:a instanceof Date&&d.compare(a,b)===0}d.equals=D;function x(a){b.assertParamIsObject(a,"date");return new Date(a.getTime()+a.getTimezoneOffset()*j)}d.shiftToUTC=x;function u(a){b.assertParamIsObject(a,"date");return new Date(a.getTime()-a.getTimezoneOffset()*j)}d.shiftToLocal=u;function r(e,g,f){b.assertParamIsString(e,"dateString");b.assert(f===undefined||typeof f==="boolean","ignoreTimeZone");var a,c;a=d.parseLocale(e,g?[g]:null,f);if(!a)a=new Date(e);if(!(a instanceof Date)||isNaN(a))a=null;else{c=a.getFullYear();if(c>=1900&&c<2e3)e.indexOf(c)<0&&a.setFullYear(c%100+Math.floor((new Date).getFullYear()/100)*100)}return a}d.parseDateString=r;function l(a,c,d){b.assertParamIsDate(a,"startDate");b.assertParamIsDate(c,"endDate");a=new Date(a.getTime());a.setHours(0,0,0,0);c=new Date(c.getTime());c.setHours(0,0,0,0);return Math.round(Math.abs(c.getTime()-a.getTime())/o)+(d===true?0:1)}d.daysBetweenDates=l;function w(j,g,i){var c=[j],b,f,d,h,e;if(g)c=c.concat(g);b=s.apply(Date,c);if(i||!b)return b;else{f=b.getTime();d=b.getTimezoneOffset()*6e4;h=f-d-a.utcOffset;e=new Date(h);return e}}d.parseLocale=w;function t(c,b,e){var a;if(e)return n.call(c,b);else{a=d.convertClientTimeToUserTimeZone(c);return n.call(a,b)}}d.localeFormat=t;function f(b,c){if(typeof c==="undefined")c=false;var g,f,h;g=b.getTime();f=b.getTimezoneOffset()*6e4;var i=a.utcOffset;if(c&&a.supportsDayLightSavingsTime)i=d.getOffsetForDate(b,true);h=g+f+i;var e=new Date(h);if(c)if(d.getOffsetForDate(e,true)===d.getOffsetForDate(b,true))e=d.adjustOffsetForTimes(b,e);return e}d.convertClientTimeToUserTimeZone=f;function k(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())}d.stripTimeFromDate=k;function h(){return d.convertClientTimeToUserTimeZone(new Date)}d.getNowInUserTimeZone=h;function g(){return d.stripTimeFromDate(d.getNowInUserTimeZone())}d.getTodayInUserTimeZone=g;function E(b,a){return Date.prototype.format.call(b,a)}d.format=E;function F(o,h){var i,n,d,e=60,g=e*60,b=g*24,l=b*7,j=b*365/12,m=b*365,f,a,k;k=[{limit:e,format:c.AgoLessThanAMinute},{limit:e*1.5,format:c.AgoAMinute},{limit:g,format:c.AgoMinutes,arg:e},{limit:g*1.5,format:c.AgoAnHour},{limit:b,format:c.AgoHours,arg:g},{limit:b*1.5,format:c.AgoADay},{limit:l,format:c.AgoDays,arg:b},{limit:l*1.5,format:c.AgoAWeek},{limit:j,format:c.AgoWeeks,arg:l},{limit:j*1.5,format:c.AgoAMonth},{limit:m,format:c.AgoMonths,arg:j},{limit:m*1.5,format:c.AgoAYear},{limit:Number.POSITIVE_INFINITY,format:c.AgoYears,arg:m}];if(h===null||typeof h==="undefined")h=new Date;f=h.getTime()-o.getTime();f/=1e3;for(i=0,n=k.length;i<n;i++){a=k[i];if(f<a.limit){if(a.arg)d=v.format(a.format,Math.round(f/a.arg));else d=a.format;break}}if(!d)d=this.toString();return d}d.ago=F;function B(c,d,b){if(typeof b==="undefined")b=false;var a=new Date;a.setTime(c.getTime()+d*864e5);if(b)a=e(c,a);return a}d.addDays=B;function e(g,f,a){if(typeof a==="undefined")a=null;var b=f;if(a!==null)b=a;var e=g.getTimezoneOffset(),c=f.getTimezoneOffset();if(e!=c)b=d.addDays(b,(c-e)/1440);return b}d.adjustOffsetForTimes=e;function m(f,e){if(a.timeZoneMap===null)return e?a.utcOffset:null;for(var c=d.shiftToUTC(f),b=0;b<a.timeZoneMap.length;b++){if(b===a.timeZoneMap.length-1&&c===a.timeZoneMap[b].date)return a.timeZoneMap[b].offset;else if(b===a.timeZoneMap.length-1)break;if(c>=a.timeZoneMap[b].date&&c<a.timeZoneMap[b+1].date)return a.timeZoneMap[b].offset}return e?a.utcOffset:null}d.getOffsetForDate=m;function q(a){return d.daysBetweenDates(d.getTodayInUserTimeZone(),a,true)==0}d.isGivenDayToday=q;function p(c){var b=d.getTodayInUserTimeZone(),a=c.getTime()-b.getTime();return a<0}d.isGivenDayInPast=p;function i(c){var b=d.getTodayInUserTimeZone(),a=c.getTime()-b.getTime();return a>0}d.isGivenDayInFuture=i;function z(g,a){var e,j,b,k=86400,i,c,f,h;if(a===null||typeof a==="undefined")a=new Date;h=new Date(a.getFullYear(),a.getMonth(),a.getDate()-a.getDay()+Sys.CultureInfo.CurrentCulture.dateTimeFormat.FirstDayOfWeek);f=[{limit:k,format:function(b){return d.ago(b,a)}},{limit:(a-h)/1e3,format:function(a){return d.localeFormat(a,"dddd")}},{limit:Number.POSITIVE_INFINITY,format:function(a){return d.localeFormat(a,"d")}}];i=(a.getTime()-g.getTime())/1e3;for(e=0,j=f.length;e<j;e++){c=f[e];if(i<c.limit&&c.limit>0){b=c.format(g);break}}if(!b)b=g.toString();return b}d.friendly=z})(a.DateUtils||(a.DateUtils={}));var T=a.DateUtils;function r(a,b){return a==b?0:a>b?1:-1}(function(a){function b(b,e){var d={},a,c;if(e)for(a=0,c=b.length;a<c;a++)d[b[a].toLocaleUpperCase()]=a;else for(a=0,c=b.length;a<c;a++)d[b[a]]=a;return d}function k(c,d,b){var a,e;if(typeof d==="undefined")return false;b=b||r;for(a=0,e=c.length;a<e;a++)if(typeof c[a]!=="undefined"&&b(c[a],d)===0)return true;return false}a.contains=k;function h(b,d){var a,c;for(a=0,c=b.length;a<c;a++)if(d(b[a]))return a;return-1}a.findIndex=h;function i(d,e,h){var b,c,g,f;if(!e)return d;if(e.length===0)return[];b=[];for(c=0,g=d.length;c<g;c++){f=d[c];if(a.contains(e,f,h))b[b.length]=f}return b}a.intersect=i;function c(d,a,i){var g,e,c,h,f;if(!a)return d;if(!d)return a;if(a.length===0||d.length===0)return[];if(d.length<a.length)g=b(d,i);else{g=b(a,i);a=d}e=[];if(i)for(c=0,h=a.length;c<h;c++){f=a[c];if(g.hasOwnProperty(f.toLocaleUpperCase()))e[e.length]=f}else for(c=0,h=a.length;c<h;c++){f=a[c];if(g.hasOwnProperty(f))e[e.length]=f}return e}a.intersectPrimitives=c;function u(d,b,e){var c;if(!b||b.length===0)return d;c=d.concat(b);a.uniqueSort(c,e);return c}a.union=u;function g(a,c){var b,d;c=c||r;a.sort(c);for(b=1,d=a.length;b<d;b++)if(c(a[b],a[b-1])===0){a.splice(b--,1);d--}return a}a.uniqueSort=g;function q(d,c){var b=d.slice(0);a.uniqueSort(b,c);return b}a.unique=q;function m(d,e,h){var c,g,f,b;if(!e||e.length===0)return d;b=[];for(c=0,g=d.length;c<g;c++){f=d[c];if(!a.contains(e,f,h))b[b.length]=f}return b}a.subtract=m;function o(c,b,a,d){var e;if(a>b){if(a-b<d)throw Error.create("Array cannot be reordered if newIndex is within the items being moved");a-=d}e=c.splice(b,d);Array.prototype.splice.apply(c,[a,0].concat(e));return c}a.reorder=o;function f(c,b){var a=c;a.sorted=true;a.comparer=b}a.flagSorted=f;function e(d,c){var b=d,a=c;b.sorted=a.sorted;b.comparer=a.comparer}a.copySortFlag=e;function l(c,b){var a=c;return a.sorted&&a.comparer===b}a.isSorted=l;function d(c,b){if(!a.isSorted(c,b)){c.sort(b);a.flagSorted(c,b);return true}return false}a.sortIfNotSorted=d;function t(a){return Array.clone(a)}a.clone=t;function n(a,b){return Array.indexOf(a,b)}a.indexOf=n;function v(a,b){Array.add(a,b)}a.add=v;function j(a,b){Array.addRange(a,b)}a.addRange=j;function p(a,b){return Array.remove(a,b)}a.remove=p;function s(a){Array.clear(a)}a.clear=s})(a.ArrayUtils||(a.ArrayUtils={}));var R=a.ArrayUtils;function d(b,d,c){var a;if(b===null||b===undefined)return"";a=c?b.toLocaleString():b.toString();if(d)a=c?a.toLocaleUpperCase():a.toUpperCase();return a}(function(a){a.empty="";a.newLine="\r\n";a.tab="\t";function n(b){var a=document.createElement("div");a.appendChild(document.createTextNode(b));return a.innerHTML.replace(/"/g,"&quot;").replace(/'/g,"&#39;")}a.htmlEncode=n;function c(b){var a=document.createElement("div");a.appendChild(document.createTextNode(b));return a.innerHTML.replace(/"/g,"&quot;")}a.htmlEncodeJavascriptAttribute=c;function m(a){return $("<div/>").html(a).html()}a.htmlDecode=m;function r(b){return a.htmlEncode(b).replace(/(\r\n|\n|\r)/gm,"<br/>")}a.nl2br=r;function j(c,e){if(c===e)return 0;var a=d(c,false,false),b=d(e,false,false);return a===b?0:a>b?1:-1}a.defaultComparer=j;function i(c,e){if(c===e)return 0;var a=d(c,true,false),b=d(e,true,false);return a===b?0:a>b?1:-1}a.ignoreCaseComparer=i;function k(a,b){if(a===b)return 0;var c=d(a,false,true),e=d(b,false,true);return c.localeCompare(e)}a.localeComparer=k;function f(a,b){if(a===b)return 0;var c=d(a,true,true),e=d(b,true,true);return c.localeCompare(e)}a.localeIgnoreCaseComparer=f;function o(d,c,b){b=b||a.defaultComparer;return b(c,d.substr(0,c.length))===0}a.startsWith=o;function p(d,c,b){b=b||a.defaultComparer;return b(c,d.substr(d.length-c.length,c.length))===0}a.endsWith=p;function g(b,a){return b.toLowerCase().indexOf(a.toLowerCase())!==-1}a.caseInsensitiveContains=g;function q(){for(var b=[],a=0;a<arguments.length-1;a++)b[a]=arguments[a+1];return String.format.apply(String,e.call(arguments,0))}a.format=q;function l(){for(var b=[],a=0;a<arguments.length-1;a++)b[a]=arguments[a+1];return String.localeFormat.apply(String,e.call(arguments,0))}a.localeFormat=l;function h(a){return J.test(a)}a.containsControlChars=h;function b(a){return H.test(a)}a.containsMismatchedSurrogateChars=b})(a.StringUtils||(a.StringUtils={}));var v=a.StringUtils;function y(a,c,d){for(var b=a.length;b<c;b++)a=d?"0"+a:a+"0";return a}(function(a){function c(a,b){return a-b}a.defaultComparer=c;function b(n,m,l){var d,h,e,a=n.toString(),b="",j,k,g,i,c,f;if(l)h=l.numberFormat;else h=Sys.CultureInfo.CurrentCulture.numberFormat;e=a.split(/e/i);a=e[0];d=e.length>1?parseInt(e[1],10):0;e=a.split(".");a=e[0];b=e.length>1?e[1]:"";if(d>0){b=y(b,d,false);a+=b.slice(0,d);b=b.substr(d)}else if(d<0){d=-d;a=y(a,d+1,true);b=a.slice(-d,a.length)+b;a=a.slice(0,-d)}if(b.length>0)b=h.NumberDecimalSeparator+b;if(m===true){j=h.NumberGroupSizes;k=h.NumberGroupSeparator;g=j[0];i=1;c=a.length-1;f="";while(c>=0){if(g===0||g>c)return f.length>0?a.slice(0,c+1)+k+f+b:a.slice(0,c+1)+b;if(f.length>0)f=a.slice(c-g+1,c+1)+k+f;else f=a.slice(c-g+1,c+1);c-=g;if(i<j.length){g=j[i];i++}}return a.slice(0,c+1)+k+f+b}else return a+b}a.toDecimalLocaleString=b;function f(a){return Number.parseLocale(a)}a.parseLocale=f;function d(a){return Number.parseInvariant(a)}a.parseInvariant=d;function e(b,a){return Number.prototype.localeFormat.call(b,a)}a.localeFormat=e})(a.NumberUtils||(a.NumberUtils={}));var Q=a.NumberUtils;(function(a){function b(a){return Boolean.parse(a)}a.parse=b})(a.BoolUtils||(a.BoolUtils={}));var S=a.BoolUtils;(function(a){function c(){return b().toLowerCase().indexOf("windows nt")>=0}a.isWindowsClient=c;function b(){return window.navigator.userAgent}a.getUserAgent=b})(a.UserAgentUtils||(a.UserAgentUtils={}));var P=a.UserAgentUtils;f.tfsModuleLoaded("TFS.Core",a)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
define("Presentation/Scripts/TFS/TFS.Core.Utils",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.Diag"],function(y,a,w,u,v){var i=w,c=u,b=v;function x(h,i){var c,g,f,a,e,b=false,d=i||[];f=0;a=0;e=0;for(c=0;c<h.length;c++){a=h[c];if(a==="r")if(!b){b=true;continue}else{a=2;b=false}else if(!b){e=a;a=1}else b=false;for(g=0;g<a;g++){f+=e;d[d.length]=f}}return d}function m(a){return a.length===0?a:x(a)}a.unpackIntegerArray=m;function q(c){if(document.cookie.length>0){var a=document.cookie.indexOf(c+"=");if(a!==-1){a=a+c.length+1;var b=document.cookie.indexOf(";",a);if(b===-1)b=document.cookie.length;return decodeURIComponent(document.cookie.substring(a,b))}}return""}a.getCookie=q;function f(b,a){return Sys.Serialization.JavaScriptSerializer.deserialize(b,a)}a.parseMSJSON=f;function p(a){return Sys.Serialization.JavaScriptSerializer.serialize(a)}a.stringifyMSJSON=p;function o(g,c,d){b.assertParamIsJQueryObject(g,"$context");c!==undefined&&c!==null&&b.assertParamIsStringNotEmpty(c,"selectionFilter");d!==undefined&&b.assertParamIsBool(d,"remove");var a,e,h=null;a=g.find('script[type="application/json"]');if(c)a=a.filter(c);if(a.length>0){e=a.eq(0).html();if(e)h=f(e,false);d&&a.eq(0).remove()}return h}a.parseJsonIsland=o;function e(a,b,i,g){var j,f,h,d=null,l,k,m;if(a){h=this.children;if(h&&(m=h.length)>0){b=b||"/";do{j=a.indexOf(b);if(j>=0){f=a.substring(0,j);a=a.substring(j+b.length)}else{f=a;a=null}}while(a&&f===b);if(f){g=g||"text";i=i||c.StringUtils.localeIgnoreCaseComparer;for(k=0;k<m;k++){l=h[k];if(i(l[g],f)===0){d=l;break}}if(d)if(a)if(d.children)return e.call(d,a,b,i,g);else d=null}}}return d}a.findTreeNode=e;function d(f,e,a,c){var b=this.parent;c=c||"root";if(b&&!f&&b[c])b=null;a=a||"text";if(b){e=e||"/";return d.call(b,f,e,a,c)+e+this[a]}else return this[a]}a.calculateTreePath=d;function h(c){var b,e,a,d;if(c){c.call(this,this);a=this.children;if(a&&(e=a.length))for(b=0;b<e;b++){d=a[b];h.call(d,c)}}}a.walkTree=h;function n(a,b,e){var c,d;if(a&&a.length)if(e)$.each(a,function(c,a){if(a.end>=b){if(a.start>=b)a.start++;a.end++}});else{c=[];d={};$.each(a,function(f,a){var e;if(a.end>=b){if(a.start>b)a.start=Math.max(1,a.start-1);a.end=Math.max(1,a.end-1)}if(a.start!==a.end){e=a.start+"_"+a.end;if(!(e in d)){d[e]=true;c.push(a)}}});return c}return a}a.updateFilterGroups=n;function l(a){var c=0;function b(d,a){$.each(d,function(f,e){if(!a)b(d,e);else if(e!==a)if(a.start<=e.start&&a.end>=e.end){b(d,e);a.level=Math.max(a.level,e.level+1);c=Math.max(c,a.level)}})}if(a&&a.length){$.each(a,function(b,a){a.level=0});b(a,null)}return c}a.updateFilterGroupLevels=l;function k(a,b){return a!==null&&typeof a!=="undefined"?typeof a==="string"?a:a instanceof Date?c.DateUtils.localeFormat(a,b||"G"):typeof a==="number"?b?c.DateUtils.localeFormat(new Date(a),b):c.NumberUtils.toDecimalLocaleString(a):typeof a==="boolean"?a?"True":"False":a.toString():""}a.convertValueToDisplayString=k;function s(a){return typeof a==="string"}function j(c){var d=[],b,a;if(s(c)){b=c.split(",");$.each(b,function(c){a=b[c].split(";");$.each(a,function(b){d.push($.trim(a[b]))})})}return d}a.parseEmailAddressesStringToArray=j;function r(b){var a,c;a=window;if(!a.DOMParser)try{return b.xml}catch(e){}else try{c=new a.XMLSerializer;return c.serializeToString(b)}catch(d){}return null}a.domToXml=r;function t(a){return Sys.Net.XMLDOM(a)}a.parseXml=t;var g=function(){function a(c,d,a){switch(c){case Number:c="number";break;case String:c="string";break;case"number":case"string":break;default:throw Error.argument("key","Dictionary only supports keys of type string or number");}b.assertParamIsType(a,"object","options",true);this._TKey=c;this._TValue=d;this._items={};if(a&&a.allowNullKey===true)this._allowNullKey=true;if(a&&a.throwOnKeyMissing===true)this._throwOnKeyMissing=true}a.prototype.count=function(){return this._count};a.prototype.item=function(a,b){this._checkKey(a);if(arguments.length>1)this._set(a,b);else{if(this._throwOnKeyMissing&&!this._items.hasOwnProperty(a))throw Error.argument("key","KeyNotFound: "+a);return this._items[a]}};a.prototype.keys=function(){var a=this._items;return $.map(a,function(c,b){return a.hasOwnProperty(b)?b:null})};a.prototype.values=function(){var a=this._items;return $.map(a,function(a){return a})};a.prototype.add=function(a,b){this._checkKey(a);if(this._items.hasOwnProperty(a))throw Error.argument(a,"An element with the same key already exists in the dictionary");this._set(a,b)};a.prototype.clear=function(){this._items={};this._count=0};a.prototype.containsKey=function(a){this._checkKey(a);return this._items.hasOwnProperty(a)};a.prototype.get=function(a){return this.item(a)};a.prototype.remove=function(a){this._checkKey(a);if(this._items.hasOwnProperty(a))this._count-=1;delete this._items[a]};a.prototype.set=function(b,a){this.item(b,a)};a.prototype.tryGetValue=function(a,b){if(this.containsKey(a)){b.value=this.get(a);return true}else{b.value=undefined;return false}};a.prototype._checkKey=function(a){b.assertParamIsType(a,this._TKey,"key",this._allowNullKey);if((a===null||a===undefined)&&!this._allowNullKey)throw Error.argument("key","Null key not allowed");};a.prototype._set=function(c,a){b.assertParamIsType(a,this._TValue,"value",true);if(!this._items.hasOwnProperty(c))this._count+=1;this._items[c]=a};return a}();a.Dictionary=g;i.initClassPrototype(g,{_TKey:null,_TValue:null,_items:null,_allowNullKey:false,_throwOnKeyMissing:false,_count:0});i.tfsModuleLoaded("TFS.Core.Utils",a)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
define("Presentation/Scripts/TFS/TFS.Core.Ajax",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/Resources/TFS.Resources.Common","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.Diag"],function(J,a,I,w,D,G,z){var l=I,m=w,v=D,b=G,d=z,h=false,f=false,C=1,x=3e5,u=x,c=l.handleError,r=b.getAntiForgeryTokenValue,q=b.getAntiForgeryTokenValue2,k;a.startWait;a.endWait;var p,j={allowArrayResult:false,byPassAntiForgery:false};(function(a){a.AjaxException="TFS.Core.Ajax.AjaxException";a.AjaxTimeoutException="TFS.Core.Ajax.AjaxTimeoutException";a.NetworkException="TFS.Core.Ajax.NetworkException"})(a.Exceptions||(a.Exceptions={}));var o=a.Exceptions;if(typeof __ajaxConfig!=="undefined")j=__ajaxConfig;k={};Error.ajax=function(c,d){var a=Error.create(b.StringUtils.format(m.AjaxRequestFailedWithStatus,d),{name:o.AjaxException,response:c.responseText,xhr:c});a.popStackFrame();return a};Error.ajaxTimeout=function(b){var a=Error.create(m.AjaxRequestTimedOut,{name:o.AjaxTimeoutException,status:b.status,xhr:b});a.popStackFrame();return a};Error.network=function(b){var a=Error.create(m.NetworkConnectionUnavailable,{name:o.NetworkException,status:b.status,xhr:b});a.popStackFrame();return a};function n(n,j,h,m,b){var e,g,i,f;d.logTracePoint("Ajax.response-received",b.requestId);b.isComplete=true;delete k[b.requestId];b.options!==null&&b.options!==undefined&&b.options.wait!==null&&b.options.wait!==undefined&&a.endWait(b);if(j!=="timeout"&&h&&h.status===203){e=h.getResponseHeader("X-Tfs-Location");if(e){g=e.indexOf("reply_to=");if(g!==-1){i=e.indexOf("&",g);f=e.substring(0,g);if(i!==-1)f+=e.subString(i);while(f.charAt(f.length-1)==="&")f=f.substring(0,f.length-1);e=f+"&reply_to="+encodeURIComponent(window.location.href)}window.location.href=e;return}}if(m)try{m(n,j,h)}catch(o){d.logTracePoint("Ajax.callback-exception",o);c(o)}d.logTracePoint("Ajax.callback-complete",b.requestId);b.progressActionId&&l.globalProgressIndicator.actionCompleted(b.progressActionId);b.options&&b.options.tracePoint&&d.logTracePoint(b.options.tracePoint)}a.endRequest=n;function e(a,b){return function(d,c,e){n(d,c,e,b,a)}}function i(d,a){return function(e,g,i){n(null,g,e,function(){var d;if(g==="timeout")c(Error.ajaxTimeout(e),a);else if(e.status===0)!f&&!h&&b.delay(this,2e3,function(){!f&&!h&&c(Error.network(e),a)});else if(e.status>=12e3&&e.status<13e3)!f&&!h&&c(Error.network(e),a);else{if(h&&g==="abort")return;try{d=v.parseMSJSON(e.responseText,false)}catch(j){}if(d)c(Error.serverError(d),a);else c(Error.ajax(e,i||e.statusText||e.status),a)}},d)}}function g(f,g,c){var b,e;b={isComplete:false,requestId:C++,options:c};c&&c.wait&&a.startWait(b);e=f+" ("+b.requestId+")";d.logTracePoint("Ajax.request-started",e);if(!c||c.showGlobalProgressIndicator!==false)b.progressActionId=l.globalProgressIndicator.actionStarted(e);k[b.requestId]=b;return b}function t(b){var a=b.options.wait;if(!a.entireWindow){a.element.css("margin-top",-parseInt(a.target.css("padding-top"),10));a.element.css("margin-left",-parseInt(a.target.css("padding-left"),10));a.element.height(a.target.outerHeight());a.element.width(a.target.outerWidth())}if(a.msgElement){a.msgElement.css("top",a.element.position().top+(a.element.height()-a.msgElement.height())/2+parseInt(a.element.css("margin-top"),10));a.msgElement.css("left",a.element.position().left+(a.element.width()-a.msgElement.width())/2+parseInt(a.element.css("margin-left"),10))}}a.startWait=function(c){var a=c.options.wait;a.end=function(){if(a.element)if(c.isComplete&&!a.timeout){if(a.fade!==false){a.element.css("cursor","auto");a.element.fadeOut("fast",function(){a.element.remove();a.element=null});if(a.msgElement){a.msgElement.css("cursor","auto");a.msgElement.fadeOut("fast",function(){a.msgElement.remove();a.msgElement=null})}}else{a.element.css("cursor","auto");a.element.remove();a.element=null;if(a.msgElement){a.msgElement.css("cursor","auto");a.msgElement.remove();a.msgElement=null}}$(window).unbind("resize."+c.requestId)}};if(!a.showDelay)a.showDelay=250;if(!a.target){a.entireWindow=true;a.target=$("body")}a.target.children(".wait-element").hide();a.target.children(".wait-box").hide();if(a.showDelay!==0)c.showTimer=b.delay(this,a.showDelay,function(){delete c.showTimer;p(c)});else p(c)};a.endWait=function(a){a.options.wait.end();if(a.showTimer){a.showTimer.cancel();delete a.showTimer}};p=function(c){var d="",e="",a=c.options.wait;if(a.image)d+='<img class="wait-image" src="'+a.image+'" />';if(a.message)d+='<div class="wait-message">'+a.message+"</div>";if(d.length>0){a.target.prepend('<div class="wait-box">'+d+"</div>");a.msgElement=a.target.children(".wait-box").first()}if(a.backgroundcolor)e+="background-color: "+a.backgroundcolor+";";a.target.prepend('<div class="wait-element" style="'+e+'"></div>');a.element=a.target.children(".wait-element").first();t(c);$(window).bind("resize."+c.requestId,function(){t(c)});if(!a.minLifetime)a.minLifetime=100;a.timeout=b.delay(this,a.minLifetime,function(){delete a.timeout;a.end()})};function s(b){var a;if(typeof b==="string")b=b.replace(/\u2028/g,"\\u2028");a=v.parseMSJSON(b,false);d.assert(!$.isArray(a),"Received JSON data from the server which is an array.  Sending JSON arrays from the server leaves us open to JSON Hijacking attacks.  Ensure that the server code is making use of the SecureJsonResult class.");if(a.hasOwnProperty("__wrappedArray"))a=a.__wrappedArray;return a}function y(){f=true;b.delay(this,2e3,function(){f=false})}$(window).bind("beforeunload",y);$(window).bind("unload",function(){h=true;$.each(k,function(b,a){if(a.xhr)try{a.xhr.abort()}catch(c){}})});function B(f,d,k,h,c){var a=g(f,d,c),b={type:"GET",data:d,success:e(a,k),error:i(a,h),dataType:"json",traditional:true,timeout:u};if(!j.allowArrayResult)b.converters={"text json":s};a.xhr=jQuery.ajax(f,$.extend(b,c));return a}a.getMSJSON=B;function A(k,a,l,f,h){var d,b,c;if(!j.byPassAntiForgery){a=$.extend(a||{},{__RequestVerificationToken:r()});d=q();if(d)a=$.extend(a,{__RequestVerificationToken2:d})}b=g(k,a,h);c={type:"POST",data:a,success:e(b,l),error:i(b,f),dataType:"json",traditional:true,timeout:u};if(!j.allowArrayResult)c.converters={"text json":s};try{b.xhr=jQuery.ajax(k,$.extend(c,h))}catch(m){f(m)}return b}a.postMSJSON=A;function F(f,a,j,h,d){var c,b;a=$.extend(a,{__RequestVerificationToken:r()});c=q();if(c)a=$.extend(a,{__RequestVerificationToken2:c});b=g(f,a,d);b.xhr=jQuery.ajax(f,$.extend({type:"POST",data:a,ajaxHandler:this,success:e(b,j),error:i(b,h),dataType:"html",traditional:true,cache:false},d));return b}a.postHTML=F;function H(d,c,h,f,b){var a=g(d,c,b);a.xhr=jQuery.ajax(d,$.extend({type:"GET",data:c,success:e(a,h),error:i(a,f),dataType:"html",traditional:true,cache:false},b));return a}a.getHTML=H;function E(a){var b=g(a&&a.url,a&&a.data,a);b.xhr=jQuery.ajax(a&&a.url,$.extend({type:"GET",dataType:"jsonp",traditional:true,success:e(b,a&&a.callback)},a));return b}a.getJSONp=E;l.tfsModuleLoaded("TFS.Core.Ajax",a)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.Host",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/Resources/TFS.Resources.Common","Presentation/Scripts/TFS/TFS.Core.Ajax"],function(M,a,J,H,I,F,z,B){var b=J,e=H,c=I,w=F,i=z,r=B,h;a.notificationService;var t=b.handleError;a.history;var p;a.urlHelper;a.runningDocumentsTable;a.hostServiceManager;a.customerIntelligence;a.metricsService;var o;function A(){p=$.now()}a.setImageTimestamp=A;var q=function(){function a(a){this._options=a||{}}a.prototype.getRootPath=function(){return this._options.rootPath||"/"};a.prototype.getTheme=function(){return this._options.theme||"Default"};a.prototype.getResourcesPath=function(){return this._options.resourcesPath||this.getRootPath()+"_content/"};a.prototype.getResourcesFile=function(a){return this.getResourcesPath()+encodeURIComponent(a)};a.prototype.getTfsStaticRootPath=function(){return this._options.staticRootTfs||"/tfs/_static/tfs/12/"};a.prototype.get3rdPartyStaticRootPath=function(){return this._options.staticRoot3rdParty||"/tfs/_static/3rdParty/"};a.prototype.getThemedFile=function(a){return this.getTfsStaticRootPath()+"App_Themes/"+encodeURIComponent(this.getTheme())+"/"+encodeURIComponent(a)};a.prototype.getWebApiVersion=function(){return this._options.webApiVersion||"1"};a.prototype.getMailSettings=function(){return this._options.mailSettings};return a}();b.initClassPrototype(q,{_options:null});var j=function(){function a(){}a.getServiceName=function(a){if(!a)a=this;return a._serviceName||"HostService."+b.getTypeName(a)};a.prototype.getServiceName=function(){return a.getServiceName(this.constructor)};return a}();a.HostService=j;var n=function(){function a(){this.services={}}a.prototype.getService=function(c){var a,b;b=j.getServiceName(c);a=this.services[b];if(!a){a=new c;this.services[b]=a}return a};return a}();b.initClassPrototype(n,{services:null});a.hostServiceManager=new n;var G=function(){function a(){}a.prototype.save=function(){throw new Error("Not implemented");};a.prototype.getMoniker=function(){throw new Error("Not implemented");};return a}();a.Document=G;var C=function(c){__extends(b,c);function b(){c.call(this)}b.prototype.addDeleteListener=function(b){a.notificationService.attachEvent("tfs-document-delete",b)};b.prototype.removeDeleteListener=function(b){a.notificationService.detachEvent("tfs-document-delete",b)};b.prototype.addBuildPropertyChangedListener=function(b){a.notificationService.attachEvent("tfs-document-build-property-changed",b)};b.prototype.removeBuildPropertyChangedListener=function(b){a.notificationService.detachEvent("tfs-document-build-property-changed",b)};b.prototype.addBuildStoppedListener=function(b){a.notificationService.attachEvent("tfs-document-build-stopped",b)};b.prototype.removeBuildStoppedListener=function(b){a.notificationService.detachEvent("tfs-document-build-stopped",b)};b.prototype.addModifiedChangedListener=function(b){a.notificationService.attachEvent("tfs-document-modified-change",b)};b.prototype.removeModifiedChangedListener=function(b){a.notificationService.detachEvent("tfs-document-modified-change",b)};b.prototype.isModified=function(b){return a.runningDocumentsTable.isModified(b)};b.prototype.save=function(b,c){var d=this.getActiveDocument();if(d)d.save(b,c);else return a.runningDocumentsTable.beginSave(b,c)};b.prototype.getActiveDocument=function(){return o};b.prototype._setActiveDocument=function(a){o=a};return b}(j);a.DocumentService=C;(function(a){a._map=[];a.None=0;a.Deployment=1;a.Application=2;a.Collection=4;a.Project=8;a.Team=16;a.ApplicationAll=15;a.All=31})(a.NavigationContextLevels||(a.NavigationContextLevels={}));var K=a.NavigationContextLevels;(function(a){a._map=[];a.Parent=-1;a.Unknown=0;a.Deployment=1;a.Application=2;a.ProjectCollection=4})(a.TeamFoundationHostType||(a.TeamFoundationHostType={}));var x=a.TeamFoundationHostType,k=function(){function a(a){this.contextData=a;this.navigation=a.navigation;this.configuration=new q(a.configuration);this.currentUser=a.currentUser;this.currentIdentity=a.currentIdentity;this.currentTeam=a.currentTeam;this.currentUserHasTeamPermission=a.currentUserHasTeamPermission;this.standardAccessMode=a.standardAccessMode;this.isHosted=a.isHosted}a._DEFAULT_CONTROLLER_NAME="home";a._DEFAULT_ACTION_NAME="index";a._CLIENTHOST="clientHost";a._VERSION="__v";a._LANGUAGE="__loc";a._PERMALINK_PREFIX="_permalink";a.ControlExtensions={initializeEnhancementOptions:function(c,b){return $.extend({},b,{tfsContext:a.getContextOrDefault(c)})}};a.parseContext=function(c){var b=w.parseJsonIsland(c,".tfs-context");return b?new a(b):null};a.getDefault=function(){if(!h){var a=this.parseContext($(document));c.assert(a!==null&&typeof a!=="undefined","Default context information is mising.");h=a}return h};a.getContextOrDefault=function(b){var a;a=this.parseContext(b);return!a?this.getDefault():a};a.prototype.getHostUrl=function(){return this.navigation.publicAccessPoint.scheme+"://"+this.navigation.publicAccessPoint.authority};a.prototype.getPublicActionUrl=function(d,a,c){var b=this._constructActionUrl(d,a,c);return this.getHostUrl()+this.configuration.getRootPath()+b};a.prototype.getActionUrl=function(d,a,c){var b=this._constructActionUrl(d,a,c);return this.configuration.getRootPath()+b};a.prototype.getPermalinkUrl=function(d,b,c){var a=this._constructPermalinkUrl(d,b,c);return this.configuration.getRootPath()+a};a.prototype.getIdentityImageUrl=function(a,b){return this.getActionUrl("IdentityImage","common",$.extend({area:"api",project:"",id:a,t:p},b))};a.prototype.isEmbedded=function(){return this.contextData.clientHost!==null};a.prototype.getClientHost=function(){return this.contextData.clientHost};a.prototype._constructActionUrl=function(j,g,r){var h=this.navigation,d=[],f,k,m,e,l,c,i,n,o,q;o=h.areaPrefix||"";q=h.controllerPrefix||"";c=$.extend({},r);f=c.serviceHost;if(typeof f==="undefined")f=h.serviceHost;if(f){f.relVDir&&d.push(encodeURI(f.relVDir));if(f.hostType===x.ProjectCollection){k=c.project;if(typeof k==="undefined")k=h.project;if(k){d.push(encodeURIComponent(k));m=c.team;if(typeof m==="undefined")m=h.team;m&&d.push(encodeURIComponent(m))}}}delete c.serviceHost;delete c.project;delete c.team;e=c.area;if(typeof e==="undefined")e=h.area;delete c.area;if(e)if($.isArray(e)){l=e;l.length>0&&d.push(encodeURIComponent(o+l[0]));for(var p=1;p<l.length;p++)d.push(encodeURIComponent(l[p]))}else d.push(encodeURIComponent(o+e));if(!g)g=c.controller;delete c.controller;if(!j)j=c.action;delete c.action;i=c.parameters;delete c.parameters;if(i){if(!g)g=a._DEFAULT_CONTROLLER_NAME;if(!j)j=a._DEFAULT_ACTION_NAME}if(g){d.push(encodeURIComponent(q+g));if(j){d.push(encodeURIComponent(j));if(i)if($.isArray(i))d.push.apply(d,$.map(i,encodeURIComponent));else d.push(encodeURIComponent(i))}}if(c.includeVersion||e==="api")c[a._VERSION]=this.configuration.getWebApiVersion();if(c.includeLanguage&&b.uiCulture)c[a._LANGUAGE]=b.uiCulture;delete c.includeVersion;if(c.area!=="api"&&this.getClientHost())c[a._CLIENTHOST]=this.getClientHost();n=$.param(c);return d.join("/")+(n?"?"+n:"")};a.prototype._constructPermalinkUrl=function(l,i,k){var j=this.navigation,c=[],b=$.extend({},k),e,m,f=j.controllerPrefix||"",g=i||b.controller||a._DEFAULT_CONTROLLER_NAME,h=l||b.action||a._DEFAULT_ACTION_NAME,d=b.parameters;c.push(a._PERMALINK_PREFIX);c.push(encodeURIComponent(f+g));c.push(encodeURIComponent(h));delete b.controller;delete b.action;delete b.parameters;if(d)if($.isArray(d))c.push.apply(c,$.map(d,encodeURIComponent));else c.push(encodeURIComponent(d));e=$.param(b);return c.join("/")+(e?"?"+e:"")};return a}();a.TfsContext=k;b.initClassPrototype(k,{contextData:null,configuration:null,navigation:null,currentUser:null,currentIdentity:null,currentTeam:null,currentUserHasTeamPermission:false,standardAccessMode:null,isHosted:null});var s=function(){function a(){}a.prototype.fire=function(b,c,a){return this._fireEvent(b,c,a)};a.prototype._fireEvent=function(c,d,f){var b,a;if(this._events){a=this._events._getEvent(c);if(!a||a.length===0)return undefined;a=e.ArrayUtils.clone(a);for(b=a.length-1;b>=0;b--)if(a[b](d||this,f)===false)return false}};a.prototype.attachEvent=function(a,b){if(!this._events)this._events=new Sys.EventHandlerList;this._events.addHandler(a,b)};a.prototype.detachEvent=function(a,b){this._events&&this._events.removeHandler(a,b)};return a}();a.EventManager=s;a.notificationService=new s;function g(b,c){var a={};if(c){b=b||c._a||c.action;a=$.extend(a,c);delete a.action;delete a._a}if(b)a._a=b;return a}var v=function(){function a(){}a.prototype.getCurrentFragment=function(){return Sys.Application.get_stateString()};a.prototype.getCurrentState=function(){var a,b;this._currentHashString=this.getCurrentFragment();a=Sys.Application._deserializeState(this._currentHashString);b=a&&a._a;if(b){a.action=b;delete a._a}return a};a.prototype.checkCurrentState=function(){var a=this.getCurrentFragment();if(this._currentHashString!==a){this._currentHashString=a;return true}return false};a.prototype.replaceHistoryPoint=function(c,d,e,b){var a;a={};this._suppressNavigate=b===true;$.each(g(c,d),function(c,b){if(b)a[c]=b});window.location.replace("#"+Sys.Application._serializeState(a))};a.prototype.addHistoryPoint=function(c,d,b,a){this._suppressNavigate=a===true;Sys.Application.addHistoryPoint(g(c,d),b)};a.prototype.attachNavigate=function(a,c,d){var b;this._ensureInitialized();if($.isFunction(a))this._events.addHandler("*",a);else if(c&&a){this._events.addHandler(a.toString().toUpperCase(),c);if(d){b=this.getCurrentState();b.action&&a.toString().toUpperCase()===b.action.toUpperCase()&&c(this,b)}}};a.prototype.detachNavigate=function(a,b){if(this._initialized)if($.isFunction(a))this._events.removeHandler("*",a);else b&&a&&this._events.removeHandler(a.toString().toUpperCase(),b)};a.prototype._ensureInitialized=function(){var a=this;if(!this._initialized){this._initialized=true;this._events=new Sys.EventHandlerList;Sys.Application.add_navigate(function(){try{if(a.checkCurrentState())!a._suppressNavigate&&a._onNavigate()}finally{a._suppressNavigate=false}})}};a.prototype._onNavigate=function(){var a,b=this.getCurrentState();if(this._initialized){if(b.action){a=this._events.getHandler(b.action.toUpperCase());a&&a(this,b)}a=this._events.getHandler("*");a&&a(this,b)}};return a}();b.initClassPrototype(v,{_events:null,_suppressNavigate:false,_initialized:false,_currentHashString:null});a.history=new v;var y=function(){function a(){}a.prototype.publish=function(d,b,a,c){r.postMSJSON(this._getApiLocation("Publish"),{area:d,feature:b,property:a,value:c},null,function(){})};a.prototype.publishProperties=function(c,b,a){r.postMSJSON(this._getApiLocation("PublishProperties"),{area:c,feature:b,properties:w.stringifyMSJSON(a)},null,function(){})};a.prototype._getApiLocation=function(a,b){return k.getDefault().getActionUrl(a||"","CustomerIntelligence",$.extend({area:"api"},b))};return a}();a.customerIntelligence=new y;var D=function(){function a(){if(typeof __externalMetricsService==="function")this.service=__externalMetricsService;else this.service=function(){}}a.prototype.push=function(b,c,a){this.service(b,c,a)};return a}();a.metricsService=new D;var u=function(){function a(){this._urlTranslators=[]}a.SAFE_URI_SCHEME_LIST=["http","https","ftp","gopher","mailto","news","telnet","wais","vstfs","tfs","alm","mtm","mtms","mtr","mtrs","mfbclient","mfbclients","x-mvwit"];a.prototype.getFragmentActionLink=function(a,b){return"#"+Sys.Application._serializeState(g(a,b))};a.prototype.isSafeProtocol=function(i){var g=a.SAFE_URI_SCHEME_LIST,b,f,d,h;c.assert(typeof i==="string");f=i.trim();d=f.indexOf(":");if(d>=0){h=f.substr(0,d);for(b=0;b<g.length;b++)if(e.StringUtils.ignoreCaseComparer(h,g[b])===0)return true}return false};a.prototype.registerUrlTranslator=function(a,b){this._urlTranslators.push({translator:a,order:b||100});this._urlTranslators.sort(function(a,b){return a.order-b.order})};a.prototype.beginTranslateUrl=function(a,h,d,g){var c=this,f=0;function b(a){$.isFunction(d)&&d.call(c,a)}function i(a){t(a,g,c)}function e(){var d=c._urlTranslators[f++];if(d)d.translator.call(c,a,h,b,i,e);else b(a)}if(a)if(this.isSafeProtocol(a))e();else return b(null);else b(a)};return a}();b.initClassPrototype(u,{_urlTranslators:null});a.urlHelper=new u;var d,l=Math.pow(2,32);d={};var E=function(){function a(){}a.MaxOrder=l;a.registerActionWorker=function(e,f,a){c.assertParamIsStringNotEmpty(e,"action");c.assertParamIsFunction(f,"actionWorker");if(a!==undefined){c.assertParamIsNumber(a,"order");c.assert(a<=l,"order must not be greater than "+l)}var b=d[e];if(!b)d[e]=b=[];b.push({worker:f,order:a||(a===0?0:100)});b.sort(function(a,b){return a.order-b.order})};a.performAction=function(b,f){c.assertParamIsStringNotEmpty(b,"action");var a=d[b],g=0;function e(c){var b=a&&a[g++];if(b)return b.worker.call(this,c,e)}return e(f)};a.clearActionWorkers=function(){d={}};return a}();a.ActionManager=E;(function(a){a.ACTION_WINDOW_OPEN="window-open";a.ACTION_WINDOW_NAVIGATE="window-navigate";a.ACTION_WINDOW_RELOAD="window-reload";a.ACTION_WINDOW_UNLOAD="window-unload"})(a.CommonActions||(a.CommonActions={}));var L=a.CommonActions,f=function(){function a(b,a){this.document=a;this.moniker=b}return a}();a.RunningDocumentsTableEntry=f;b.initClassPrototype(f,{document:null,moniker:null});var m=function(){function a(){this.rdt=[]}a.prototype.add=function(d,a){var b=new f(d,a);c.assertIsFunction(a.isDirty,"RunningDocumentsTable.add() parameter document must have isDirty function");this.rdt.push(b);return b};a.prototype.remove=function(a){this.rdt=e.ArrayUtils.subtract(this.rdt,[a])};a.prototype.isModified=function(a){return a?this.rdt[a].isDirty():this._isAnyModified()};a.prototype.beginSave=function(c,f){var a=this,b=[],h=0;function g(b){t(b,f,a)}$.each(this.rdt,function(c,a){a.document.isDirty()&&$.isFunction(a.document.beginSave)&&b.push(a.document)});function d(){var f=b[h++];if(f)f.beginSave(function(){e.delay(a,0,d)},g);else $.isFunction(c)&&c.call(a)}d()};a.prototype.getUnsavedItemsMessage=function(){var e,h,d,f,a=[],b,c,g;for(e=0,h=this.rdt.length;e<h;e++){d=this.rdt[e];if(d.document.isDirty()&&$.isFunction(d.document.getDirtyDocumentTitles)){f=d.document.getDirtyDocumentTitles(6);for(c=0,g=f.length;c<g;c++){b=f[c];if(a.length===5){a.push(i.UnsavedChangesMore);break}if(b.length>55)b=b.substr(0,52)+"...";a.push(b)}if(a.length>5)break}}return a.length===0?i.UnsavedChanges:i.UnsavedChangesWithNames+"\n"+a.join("\n")};a.prototype._isAnyModified=function(){var a,c,b;for(a=0,c=this.rdt.length;a<c;a++){b=this.rdt[a];if(b.document.isDirty())return true}return false};return a}();b.initClassPrototype(m,{rdt:null});a.runningDocumentsTable=new m;b.tfsModuleLoaded("TFS.Host",a)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
define("Presentation/Scripts/TFS/TFS.UI",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/TFS.Core"],function(K,a,z,x,t,q){var B=z,c=x,d=t,f=q,A=c.log,e=d.ActionManager;e.registerActionWorker(d.CommonActions.ACTION_WINDOW_OPEN,function(a){c.assertParamIsObject(a,"actionArgs");c.assertParamIsNotNull(a.url,"actionArgs.url");if(typeof a.features!=="undefined")window.open(a.url,a.target||"_blank",a.features);else window.open(a.url,a.target||"_blank")});e.registerActionWorker(d.CommonActions.ACTION_WINDOW_NAVIGATE,function(a){c.assertParamIsObject(a,"actionArgs");c.assertParamIsNotNull(a.url,"actionArgs.url");window.location.href=a.url});e.registerActionWorker(d.CommonActions.ACTION_WINDOW_RELOAD,function(){window.location.reload()});function m(a){var b=0;if(a.wheelDelta)b=a.wheelDelta/120;else if(a.detail)b=-a.detail/3;else if(a.originalEvent&&a.originalEvent.wheelDelta)b=a.originalEvent.wheelDelta/120;return b}a.getWheelDelta=m;function k(a,b){if(b===true)$(a).removeAttr("disabled");else $(a).attr("disabled","disabled")}a.enableElement=k;function h(a){if($.browser.mozilla)a.style.MozUserFocus="ignore";else if($.browser.msie){a.unselectable="on";var c=0,b=a.all&&a.all[c++];while(b){switch(b.tagName){case"IFRAME":case"TEXTAREA":case"INPUT":case"SELECT":break;default:b.unselectable="on"}b=a.all[c++]}}}a.makeElementUnselectable=h;function w(a,d){var e=a instanceof jQuery?a:$(a);function b(){try{e.focus()}catch(a){A(c.LogVerbosity.Warning,"Failed to set focus to element: "+a)}}if(typeof d==="undefined")b();else f.delay(this,d,function(){b()})}a.tryFocus=w;function u(d,a){var b=$(d),c=b.outerWidth()-a;c!==0&&b.width(a-c)}a.alignWidth=u;function s(a){return $(a).parent().length>0}a.isInDomTree=s;function l(a,b){return!a.dataset?a.getAttribute("data-"+b):a.dataset[b]}a.getCustomData=l;(function(a){a._map=[];a.ALT=18;a.BACKSPACE=8;a.CAPS_LOCK=20;a.COMMA=188;a.CONTROL=17;a.DELETE=46;a.DOWN=40;a.END=35;a.ENTER=13;a.ESCAPE=27;a.HOME=36;a.INSERT=45;a.LEFT=37;a.PAGE_DOWN=34;a.PAGE_UP=33;a.PERIOD=190;a.RIGHT=39;a.SEMI_COLON=186;a.FIREFOX_SEMI_COLON=59;a.SHIFT=16;a.SPACE=32;a.TAB=9;a.UP=38;a.F1=112;a.F2=113;a.F10=121})(a.KeyCode||(a.KeyCode={}));var J=a.KeyCode;(function(b){function a(a){return a.ctrlKey&&!a.altKey&&!a.shiftKey}b.isExclusivelyCtrl=a})(a.KeyUtils||(a.KeyUtils={}));var I=a.KeyUtils,r=250;(function(a){a.HtmlNewLine="<BR>";a.BlurTimeout=r})(a.Constants||(a.Constants={}));var H=a.Constants;(function(a){a._PROBE_ID="tfs-measurement-probe";function e(c){var b=$("<div/>").attr("id",a._PROBE_ID).css("position","absolute").css("left","-50000px").css("top","-50000px").css("width","9em").css("height","18ex").css("overflow","auto").appendTo(c);$("<div></div>").css("width","3in").css("height","36ex").appendTo(b);return b}a._createProbe=e;function i(b){b=b||$(document.body);var c=b.children("#"+a._PROBE_ID);if(c.length===0)c=a._createProbe(b);return c}a._getProbe=i;function f(){return a._getProbe().width()/9}a.getUnitEm=f;function g(){return a._getProbe().height()/18}a.getUnitEx=g;function h(){return $("div",a._getProbe()).width()/3}a.getUnitIn=h;function c(c){var b=a._getProbe(c);return b.width()-b[0].clientWidth}a.getScrollbarWidth=c;function b(c){var b=a._getProbe(c);return b.height()-b[0].clientHeight}a.getScrollbarHeight=b;function d(b){b=b.toLowerCase();var c=parseInt(b,10);if(b.indexOf("px")>0)c=Math.round(parseFloat(b));else if(b.indexOf("em")>0)c=Math.round(parseFloat(b)*a.getUnitEm());else if(b.indexOf("ex")>0)c=Math.round(parseFloat(b)*a.getUnitEx());else if(b.indexOf("in")>0)c=Math.round(parseFloat(b)*a.getUnitIn());else if(b.indexOf("mm")>0)c=Math.round(parseFloat(b)*a.getUnitIn()/25.4);else if(b.indexOf("cm")>0)c=Math.round(parseFloat(b)*a.getUnitIn()/2.54);return c}a.getUnitAsPixel=d})(a.Measurement||(a.Measurement={}));var F=a.Measurement;function y(c,a){var b=document.createElement(c);if(a)b.className=a;return b}a.domElem=y;function g(a){return a.jquery?a:$(a)}function v(a){if(!a)return"";var b=a;if(typeof a!=="string")b=""+a;return b.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}a.htmlEncode=v;(function(a){(function(a){a._map=[];a.Default=0;a.Top=1;a.Middle=2;a.Bottom=3})(a.VerticalScrollBehavior||(a.VerticalScrollBehavior={}));var n=a.VerticalScrollBehavior;function l(a){return 0-a}a._topOverflow=l;function f(c){var a=$(window),b=a.height()+a.scrollTop();return c-b}a._bottomOverflow=f;function i(a,c){var b=$(window),d=a.left+c.elementMeasure-(b.width()+b.scrollLeft()),e=a.left-d;a.left=d>0?Math.max(0,e):Math.max(0,a.left);if(d>0&&e<0)c.adjustedWidth=Math.min(c.elementMeasure,b.width()+b.scrollLeft())}a._fitHorizontal=i;function h(b,a){var d=$(window),e=b.left+a.elementMeasure-(d.width()+d.scrollLeft()),c;c=a.elementAlign==="left"?-a.elementMeasure:a.elementMeasure;b.left+=b.left<0?c+a.baseMeasure:e>0?c-a.baseMeasure:0}a._flipHorizontal=h;function k(g,f){var b,e=0,d,c;b=g.top;d=a._topOverflow(b);if(d>0){b=0;c=a._bottomOverflow(b+f.elementMeasure);if(c>0)e=c}else{c=a._bottomOverflow(b+f.elementMeasure);if(c>0){b-=c;d=a._topOverflow(b);if(d>0){b=0;e=d}}}return{top:b,shrink:e}}a._fitVertical=k;function j(g,c){var b,f,h,i,e,d;b=g.top;h=c.elementAlign==="top"?-c.elementMeasure:c.elementMeasure;e=a._topOverflow(b);if(e>0){b+=h+c.baseMeasure;d=a._bottomOverflow(b+c.elementMeasure);if(d>0)if(d>=e){b=g.top;f=e}else f=d}else{d=a._bottomOverflow(b+c.elementMeasure);if(d>0){i=c.baseAlign==="top"?c.baseMeasure:-c.baseMeasure;b+=h+i;e=a._topOverflow(b);if(e>0)if(e>=d){b=g.top;f=d}else{b=0;f=e}}}return{top:b,shrink:f}}a._flipVertical=j;function m(c,l,b){b=$.extend({},b);var n=0,o=1,d,k,p,j,r,q,h,i,e,f,z,A,m,u,w,x,s,v,C,B,y,t;c=g(c);l=g(l);if(b.elementAlignmentMarker&&b.elementAlignmentMarker.length)e=b.elementAlignmentMarker;if(b.baseAlignmentMarker&&b.baseAlignmentMarker.length)f=b.baseAlignmentMarker;u=b.supportScroll===true;c.css("z-index",2e4);if(u)c[0].style.height="";k=c.outerWidth();p=c.outerHeight();j=l.offset();r=l.outerWidth();q=l.outerHeight();h=b.elementAlign||"left-top";i=b.baseAlign||"left-bottom";m=b.overflow||"fit-flip";if(b.alignToMarkerHorizontal&&f){j.left=f.offset().left;r=f.outerWidth()}if(b.alignToMarkerVertical&&f){j.top=f.offset().top;q=f.outerHeight()}i=i.split("-");if(i[n]==="right")j.left+=r;if(i[o]==="bottom")j.top+=q;d=$.extend({},j);if(b.alignToMarkerHorizontal&&e){z=c.offset().left-e.offset().left;d.left+=z;k=e.outerWidth()}if(b.alignToMarkerVertical&&e){A=c.offset().top-e.offset().top;d.top+=A;p=e.outerHeight()}h=h.split("-");if(h[n]==="right")d.left-=k;if(h[o]==="bottom")d.top-=p;d.left=Math.round(d.left);d.top=Math.round(d.top);m=m.split("-");x=a["_"+m[o].toLowerCase()+"Vertical"];if(x){s=x(d,{baseMeasure:q,baseAlign:i[o],elementMeasure:p,elementAlign:h[o]});d.top=s.top;if(u&&s.shrink>0){c.height(c.height()-s.shrink);k=c.outerWidth()}}w=a["_"+m[n].toLowerCase()+"Horizontal"];t={baseMeasure:r,baseAlign:i[n],elementMeasure:k,elementAlign:h[n],adjustedWidth:0};$.isFunction(w)&&w(d,t);v=c.offset();C=parseInt(jQuery.css(c[0],"top",true),10)||0;B=parseInt(jQuery.css(c[0],"left",true),10)||0;y={top:d.top-v.top+C,left:d.left-v.left+B};if(t.adjustedWidth>0)y.width=t.adjustedWidth;c.css(y)}a.position=m;function d(b){var a=b.parent();while(a.length&&!(a.css("overflow-y")==="auto"||a.css("overflow-y")==="scroll"))a=a.parent();if(!a.length)a=$(document);return a}a.getVerticalScrollContainer=d;function b(d,f,c,g,e){var b;switch(g){case a.VerticalScrollBehavior.Top:b=d;break;case a.VerticalScrollBehavior.Middle:b=d+(f-c.height())/2;break;case a.VerticalScrollBehavior.Bottom:b=d+f-c.height()}if(typeof b!=="undefined")if(e>0)c.animate({scrollTop:b},e);else c.scrollTop(b)}function c(f,b){var a=f[0],e=false,d=0;while(a){if(b&&a===b[0]){e=true;break}d+=a.offsetTop;a=a.offsetParent}if(b&&!e)d-=c(b,null);return d}function e(e,f,l,h){var d=a.getVerticalScrollContainer(e),g=c(e,d),k,i,j;i=d.scrollTop();if(g<i)b(g,e.outerHeight(),d,f?f:a.VerticalScrollBehavior.Top,h);else{k=g+e.outerHeight();j=i+d.height();if(k>j)b(g,e.outerHeight(),d,f?f:a.VerticalScrollBehavior.Bottom,h);else l&&b(g,e.outerHeight(),d,f?f:a.VerticalScrollBehavior.Middle,h)}}a.scrollIntoViewVertical=e})(a.Positioning||(a.Positioning={}));var G=a.Positioning,n=function(){function a(a,b){this.$element=a;this.handler=b}a.prototype.execute=function(b,a){this.handler&&this.handler(b,a)};a.prototype.isMyParent=function(c){var a=false,b=c.get(0);if(b===window)return true;this.$element.parents().each(function(){if(b===this){a=true;return false}});return a};a.prototype.owns=function(a){return this.$element.get(0)===a.get(0)};return a}(),i=function(){function a(){this.handlers=[];$(window).bind("resize.containerResizeManager",f.delegate(this,this.onResize))}a.prototype.onResize=function(d,f){var a,c,b,e=$(d.target);for(a=0,c=this.handlers.length;a<c;a++){b=this.handlers[a];b.isMyParent(e)&&b.execute(d,f)}};a.prototype.attach=function(a,b){this.handlers.push(new n(a,b))};a.prototype.detach=function(d){for(var b=this.handlers||[],c,a=b.length-1;a>=0;a--){c=b[a];c.owns(d)&&b.splice(a,1)}};a.prototype.dispose=function(){this.handlers=null;$(window).unbind("resize.containerResizeManager")};return a}(),b=null;function o(a,c){if(!b)b=new i;b.attach($(a),c)}a.attachResize=o;function p(a){b&&b.detach($(a))}a.detachResize=p;function j(){if(b){b.dispose();b=null}}a.clearResizeHandlers=j;(function(a){function b(){var a=window.navigator.userAgent.toLowerCase();return $.browser.mozilla&&a.indexOf("trident")===-1}a.isFirefox=b;function d(){var a=window.navigator.userAgent.toLowerCase();return $.browser.msie?Number($.browser.version):a.indexOf("trident")!==-1?11:0}a.isIE=d;function c(){return a.isIE()>0&&a.isIE()<=9}a.isIE9=c})(a.BrowserCheckUtils||(a.BrowserCheckUtils={}));var D=a.BrowserCheckUtils;(function(a){function b(){var b=null,a;if(window.getSelection){a=window.getSelection();if(a&&a.anchorNode&&a.focusNode&&(a.anchorNode!==a.focusNode||a.anchorOffset!==a.focusOffset))b={$startNode:$(a.anchorNode),$endNode:$(a.focusNode),startNodeOffset:a.anchorOffset,endNodeOffset:a.focusOffset}}return b}a.getSelection=b})(a.SelectionUtils||(a.SelectionUtils={}));var E=a.SelectionUtils;(function(a){function b(h,d){var c,a,b;if(!d){d=window;b=document}else b=d.document;if(d.getSelection){c=d.getSelection();if(c.getRangeAt&&c.rangeCount){a=c.getRangeAt(0);a.deleteContents();var j=b.createElement("div");j.innerHTML=h;var g=b.createDocumentFragment(),i,e,f=b.createTextNode($("<div>&nbsp;</div>").text());while(i=j.firstChild)e=g.appendChild(i);a.insertNode(g);if(e){a=a.cloneRange();a.setStartAfter(e);a.collapse(true);a.insertNode(f);a.selectNodeContents(f);c.removeAllRanges();c.addRange(a)}}}else b.selection&&b.selection.createRange().pasteHTML(h)}a.pasteHtmlAtCaret=b})(a.HtmlInsertionUtils||(a.HtmlInsertionUtils={}));var C=a.HtmlInsertionUtils;B.tfsModuleLoaded("TFS.UI",a)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.UI.Controls",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/TFS.UI"],function(D,b,C,A,B,z,y){var c=C,a=A,e=B,o=z,n=y,r=c.getErrorMessage,m=e.assert,d=a.delegate;b.getId;var g=n.domElem;b.getId=function(){var a=0;return function(){return++a}}();var h=[],j=function(){function f(a){if(this.getType()===f)throw new Error("You cannot instantiate an abstract type.");this.getTypeName();this.initializeOptions(a)}f.ENHANCEMENTS_DATA_KEY="tfs-enhancements";f.ENHANCEMENT_OPTIONS_KEY="tfs-enhancement-options";f.ENHANCEMENT_OPTIONPREFIX_KEY="optionsPrefix";f.optionsPrefix="";f.getType=function(){return this};f.getTypeName=function(a){var b;if(typeof a!=="function")a=this;b=a._typeName||"tfs.controls."+c.getTypeName(a);return b};f.getOptionPrefix=function(b){var a=b;while(a){if(a.hasOwnProperty(f.ENHANCEMENT_OPTIONPREFIX_KEY))return a[f.ENHANCEMENT_OPTIONPREFIX_KEY];a=a._base}return""};f.getEnhancementOptions=function(c,d){var b,g,e,j,a,h=[],i;if(typeof c!=="function"){d=c;c=this}g=f.getOptionPrefix(c)||"";b=d.data(g+"options");if(!b){e=d.children("."+g+"options");if(e.length>0){j=e.html();if(j)b=o.parseMSJSON(j,false)}}a=c;while(a){a.hasOwnProperty("initializeEnhancementOptions")&&h.push(a.initializeEnhancementOptions);a=a._base}while(h.length>0){i=h.pop();if($.isFunction(i))b=i.call(c,d,b)}return b};f.enhance=function(a,e,b){var d,c,h,g;if(typeof a!=="function"){b=e;e=a;a=this}if(e instanceof f)c=e.getElement();else c=$(e);g=c.data(f.ENHANCEMENTS_DATA_KEY);g&&$.each(g,function(c,b){if(b instanceof a||b._typeName===f.getTypeName(a)){d=b;return false}});if(!d){if($.isFunction(b))b=b.call(a,c);b=$.extend(f.getEnhancementOptions(a,c),b);d=new a(b);d.enhance(c)}return d};f.getInstance=function(a,d){var b,c;if(typeof a!=="function"){d=a;a=this}b=d.data(f.ENHANCEMENTS_DATA_KEY);b&&$.each(b,function(d,b){if(b instanceof a||b._typeName===f.getTypeName(a)){c=b;return false}});return c};f.getInstances=function(a,d){var b,e,c=[];if(typeof a!=="function"){d=a;a=this}b=d.data(f.ENHANCEMENTS_DATA_KEY);b&&$.each(b,function(d,b){(b instanceof a||b._typeName===f.getTypeName(a))&&c.push(b)});return c};f.registerEnhancement=function(g,b,j,i){var d;if(typeof g==="string"){i=j;j=b;b=g;g=this}d=f.getTypeName(g);function k(d){var c=[],a;if(d)a=$(d);if(!a||!a.is(b))a=$(b,a);a.each(function(){c[c.length]=f.enhance(g,$(this),j)});return c}$(function(){var f;try{k(document);e.logTracePoint("Enhancement.registered-complete",[b,d])}catch(g){f=Error.create(a.StringUtils.format("Enhancement failed for '{0}'. Details: {1}",d,r(g)),{name:"EnhancementFailed",innerException:g});e.logTracePoint("Enhancement.register-exception",f);if(i)c.handleError(f,i);else throw f;}});e.logTracePoint("Enhancement.registered-pending",[b,d]);h[h.length]={typeName:d,enhancement:k}};f.ensureEnhancements=function(b,l,j){var d,i,m,k=[],g;if(typeof b!=="function"){j=l;l=b;b=this}for(i=0,m=h.length;i<m;i++){d=h[i];if(b===f||d.typeName===f.getTypeName(b))try{k=k.concat(d.enhancement(l)||[])}catch(n){g=Error.create(a.StringUtils.format("Enhancement failed for '{0}'. Details: {1}",d.typeName,r(n)),{name:"EnhancementFailed",innerException:n});e.logTracePoint("Enhancement.ensure-exception",g);if(j)c.handleError(g,j);else throw g;}}return k};f.ensureEnhancement=function(a,b,c){if(typeof a!=="function"){c=b;b=a;a=this}return f.ensureEnhancements(a,b,c)[0]};f.registerJQueryWidget=function(b,a,d){var c;if(typeof b==="string"){d=a;a=b;b=this}if(!a){a=b._widgetName;if(!a){c=f.getTypeName(b);m(c?true:false,"_widgetName or _typeName needs to present in order to register this control as JQuery widget.");a=c.split(".");a=a[a.length-1]}}$.fn[a]=function(a){return this.each(function(){f.enhance(b,$(this),$.extend(d||{},a))})}};f.prototype._getUniqueId=function(){return b.getId()};f.prototype._getId=function(){!this._id&&this._setId(this._getUniqueId());return this._id};f.prototype._setId=function(a){this._id=a};f.prototype.getTypeName=function(){if(!this._typeName)this._typeName=f.getTypeName(this.getType());return this._typeName};f.prototype._getEventNameSpace=function(){if(!this._eventNamespace)this._eventNamespace=this.getTypeName().replace(/\./g,"_")+this._getId();return this._eventNamespace};f.prototype.getType=function(){return this.constructor};f.prototype.initializeOptions=function(a){this._options=$.extend({earlyInitialize:true,enabled:true},a)};f.prototype.initialize=function(){this._initialized=true};f.prototype._ensureInitialized=function(){if(!this._initialized){this.initialize();return true}return false};f.prototype._attemptInitialize=function(){this._options.earlyInitialize&&this.initialize()};f.prototype.enhance=function(a){this._enhance(a);this._attemptInitialize()};f.prototype._enhance=function(a){this._setElement(a)};f.prototype._setElement=function(c){var e=this.getType(),b;if(this._element!==c){this._cleanup();this._element=c;this._bind("remove.remove_"+this.getTypeName(),d(this,this._dispose));b=this._element.data(f.ENHANCEMENTS_DATA_KEY);if(!b){b=[];this._element.data(f.ENHANCEMENTS_DATA_KEY,b)}a.ArrayUtils.add(b,this);this._setStyles()}};f.prototype._setStyles=function(){this._options.coreCssClass&&this._element.addClass(this._options.coreCssClass);this._options.cssClass&&this._element.addClass(this._options.cssClass)};f.prototype.getElement=function(){return this._element};f.prototype._fire=function(a,b,c){if(typeof a==="string"){c=b;b=a;a=this._element}return a.trigger(b,c)};f.prototype._bind=function(b,c,d,f){var a,g=this,e;if(typeof b==="string"){f=d;d=c;c=b;b=this._element}a=$(b);if(a.length>0){e=this._getEventNameSpace();a.bind($.map(c.split(" "),function(a){return a+"."+e}).join(" "),d);f&&a.each(function(){this!==g._element[0]&&g._trackElement(this)})}return this};f.prototype._unbind=function(b,c,f,d){var a,g=this,e;if(typeof b==="string"){f=d;d=c;c=b;b=this._element}a=$(b);if(a.length>0){e=this._getEventNameSpace();a.unbind($.map(c.split(" "),function(a){return a+"."+e}).join(" "),f);d&&a.each(function(){this!==g._element[0]&&g._untrackElement(this)})}return this};f.prototype.delayExecute=function(c,d,f,e){var b;if(!c){a.delay(this,d,e);return}if(!this._delayedFunctions)this._delayedFunctions={};b=this._delayedFunctions[c];if(b){b.setDelay(d);b.setMethod(this,e)}else{b=new a.DelayedFunction(this,d,c,e);this._delayedFunctions[c]=b}if(f)b.reset();else b.start()};f.prototype.cancelDelayedFunction=function(b){var a;if(this._delayedFunctions){a=this._delayedFunctions[b];if(a){a.cancel();return true}}return false};f.prototype._cleanup=function(){var c=this.getType(),b;if(this._element){this._unbind("remove.remove_"+this.getTypeName());this._element.unbind("."+this._getEventNameSpace());b=this._element.data(f.ENHANCEMENTS_DATA_KEY);if(b){a.ArrayUtils.remove(b,this);b.length===0&&this._element.data(f.ENHANCEMENTS_DATA_KEY,null)}}};f.prototype._dispose=function(){var b=this._trackedElements,a,c;if(b)for(a=0,c=b.length;a<c;a++)$(b[a]).unbind("."+this._getEventNameSpace());this._trackedElements=null;this._disposed=true};f.prototype.dispose=function(){this._cleanup();this._dispose()};f.prototype.isDisposed=function(){return this._disposed};f.prototype._trackElement=function(d){var a=this._trackedElements,b,f,c,e;if(!a)this._trackedElements=a=[];for(b=0,f=a.length;b<f;b++){c=a[b];if(c.elem===d){c.count++;e=true;break}}!e&&a.push({elem:d,count:1})};f.prototype._untrackElement=function(f){var c=this._trackedElements,a,e,b,d=-1;if(c){for(a=0,e=c.length;a<e;a++){b=c[a];if(b.elem===f){b.count--;d=a;break}}if(d>=0)!b.count&&c.splice(d)}};return f}();b.Enhancement=j;c.initClassPrototype(j,{_id:"",_typeName:"",_eventNamespace:"",_options:null,_initialized:false,_element:null,_trackedElements:null,_delayedFunctions:null,_disposed:false});var l=function(b){__extends(a,b);function a(a){b.call(this,a)}a.createIn=function(b,a,e){var d,c;if(typeof b!=="function"){e=a;a=b;b=this}d=new b(e);if(a instanceof j)c=a.getElement();else c=$(a);d.createIn(c);return d};a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({tagName:"div"},a))};a.prototype._getUniqueId=function(){var a;if(this._element)a=this._element.attr("id");if(typeof a==="undefined")a=b.prototype._getUniqueId.call(this);return a};a.prototype._setId=function(a){this._element&&this._element.attr("id",a);b.prototype._setId.call(this,a)};a.prototype.dispose=function(){b.prototype.dispose.call(this);if(this._element){this._element.remove();this._element=null}};a.prototype.showElement=function(){m(this._element?true:false,"DomElement is null or undefined.");this._element.show()};a.prototype.hideElement=function(){m(this._element?true:false,"DomElement is null or undefined.");this._element.hide()};a.prototype.enableElement=function(a){if(a){this._element.removeAttr("disabled");this._element.removeClass("disabled")}else{this._element.attr("disabled","disabled");this._element.addClass("disabled")}};a.prototype.showBusyOverlay=function(){if(!this._overlay)this._overlay=$("<div />").addClass("control-busy-overlay").appendTo(this._element.parent());this._overlay.show()};a.prototype.hideBusyOverlay=function(){this._overlay&&this._overlay.hide()};a.prototype._createElement=function(){var a=$(g(this._options.tagName||"div"));this._setElement(a)};a.prototype._initializeElement=function(){if(this._element)this._options.id&&this._setId(this._options.id)};a.prototype._setStyles=function(){var a=this._element;this._options.width&&a.width(this._options.width);this._options.height&&a.height(this._options.height);this._options.title&&a.attr("title",this._options.title);b.prototype._setStyles.call(this)};a.prototype.createIn=function(a){this._createIn(a);this._initializeElement();this._attemptInitialize()};a.prototype._createIn=function(a){this._createElement();a.append(this._element)};a.prototype.focus=function(){this._element.focus()};a.prototype._fireChange=function(a){var b;a=a||this;if($.isFunction(this._options.change)){b=arguments;b[0]=a;b.length=arguments.length||1;if(this._options.change.apply(a,b)===false)return false}return this._fire("change",a)};return a}(j);b.BaseControl=l;c.initClassPrototype(l,{_overlay:null});var x=0;function v(b){b=b||a.StringUtils.localeIgnoreCaseComparer;return function(a,c){return b(a.text,c.text)}}var f=function(){function b(c,b,a){this._ensureNodeId();this.text=c;this.config=b||{};this.children=[];this.addRange(a)}b.create=function(d,c,a){return new b(d,c,a)};b.prototype.hasChildren=function(){return this.children.length>0};b.prototype.clear=function(){this.children=[]};b.prototype.remove=function(){var a=this;if(this.parent)this.parent.children=$.map(this.parent.children,function(b){if(b!==a)return b})};b.prototype.add=function(a){this.children.push(a);a.parent=this};b.prototype.moveTo=function(a){e.assertParamIsObject(a,"newParent");this.remove();a.add(this)};b.prototype.addRange=function(b){var a,c;if(b)for(a=0,c=b.length;a<c;a++)this.add(b[a])};b.prototype.findNode=function(d,c,b){return o.findTreeNode.call(this,d,c||"/",b||a.StringUtils.localeIgnoreCaseComparer,"text")};b.prototype.sort=function(b,a){this._sort(b,a)};b.prototype.path=function(a,b){return o.calculateTreePath.call(this,a,b||"/","text","root")};b.prototype.level=function(c){var b=0,a=this.parent;while(a){if(c&&a.root)break;b++;a=a.parent}return b};b.prototype._ensureNodeId=function(){if(this.id<0)this.id=x++};b.prototype._sort=function(d,c){var b,e,a=this.children;if(a&&a.length){a.sort(c);if(d)for(b=0,e=a.length;b<e;b++)a[b]._sort(d,c)}};return b}();b.TreeNode=f;c.initClassPrototype(f,{id:-1,root:false,text:null,parent:null,children:null,config:null,expanded:false,selected:false,icon:null,tag:null,noFocus:false,noContextMenu:false,noTreeIcon:false,folder:null,type:null,link:"",title:"",droppable:null,iterationPath:null,definition:null,linkDelegate:null,hasExpanded:false,owner:null,application:null});var i=function(){function b(b){this._options=$.extend({sorted:false,comparer:a.StringUtils.localeIgnoreCaseComparer},b);this.setSource(this._options.source)}b.prototype.setSource=function(a){this._source=a;this._items=null;this._allItems=null};b.prototype.prepareSource=function(c){var b=c||[];this._options.sorted&&a.ArrayUtils.sortIfNotSorted(b,this._options.comparer||a.StringUtils.localeIgnoreCaseComparer);this.setItems(b)};b.prototype.getComparer=function(){return this._options.comparer};b.prototype.ensureItems=function(){var a;if(!this._items){a=this._source;if($.isFunction(a))a=a.call(this);this.prepareSource(a)}};b.prototype.getItems=function(a){this.ensureItems();return a?this._allItems:this._items};b.prototype.setItems=function(b,a){this._items=b||[];this._allItems=a||this._items};b.prototype.getCount=function(a){return this.getItems(a).length};b.prototype.getItem=function(a,b){return this.getItems(b)[a]};b.prototype.getItemText=function(a,b){return this.getItem(a,b)+""};b.prototype.getItemIndex=function(c,m,d){var b,k,i,j,e,g=this._options.comparer,h,f,l;if(!c)return-1;h=this.getItems(d);if(this._options.sorted){e=c.length;j=0;i=h.length-1;while(i>=j){b=j+i>>1;l=this.getItemText(b,d);f=g(c,l.substr(0,e));if(f<0)i=b-1;else if(f>0)j=b+1;else break}if(f===0)if(l.length===e)return b;else if(m){while(b>0&&g(c,this.getItemText(b-1,d).substr(0,e))===0)b--;return b}}else if(m){for(b=0,k=h.length;b<k;b++)if(a.StringUtils.startsWith(this.getItemText(b,d),c,g))return b}else for(b=0,k=h.length;b<k;b++)if(g(this.getItemText(b,d),c)===0)return b;return-1};b.prototype.nextIndex=function(a,c,d){var b=this.getCount(d);return b<1?-1:a<0?0:c>0?a===b-1?-1:Math.min(b-1,a+c):a===0?-1:Math.max(0,a+c)};return b}();b.BaseDataSource=i;c.initClassPrototype(i,{_options:null,_source:null,_items:null,_allItems:null});var w=function(b){__extends(a,b);function a(a){b.call(this,a)}return a}(i);b.ListDataSource=w;function k(g,d,e){var a,f,b,c=g.children;if(c&&(f=c.length))for(a=0;a<f;a++){b=c[a];d[d.length]=b;(e||b.expanded)&&k(b,d,e)}}function q(a){return $.map(a,function(a){var b=new f(a.text,a.config);a.children&&a.children.length&&b.addRange(q(a.children));return b})}function u(a){if(a){if(a.length)if(!(a[0]instanceof f))return q(a);return a}else return[]}function t(a,b){a.expanded=true;b&&a.hasChildren()&&$.each(a.children,function(c,a){t(a,b-1)})}var s=function(b){__extends(a,b);function a(a){b.call(this,$.extend({sepChar:"\\"},a));this._initRoot()}a.prototype.setSource=function(a){this._initRoot();this.root.clear();b.prototype.setSource.call(this,a)};a.prototype.prepareSource=function(c){var d=u(c),b,a;this.root.addRange(d);this._options.sorted&&this.root.sort(true,v(this._options.comparer));this._options.treeLevel&&t(this.root,this._options.treeLevel);a=[];k(this.root,a,true);b=[];k(this.root,b,false);this.setItems(b,a)};a.prototype.getItemText=function(a,b,c){return c===true?this.getItem(a,b).text:this.getItem(a,b).path(false,this._options.sepChar)};a.prototype.getItemIndex=function(f,e,g){var c=b.prototype.getItemIndex.call(this,f,e,true),a,d;if(c>=0){a=this.getItem(c,true);while(a.parent){a=a.parent;if(!a.expanded)d=true;a.expanded=true}d&&this._prepareCurrentItems();return b.prototype.getItemIndex.call(this,f,e,g)}return c};a.prototype.expandNode=function(a){if(!a.expanded){a.expanded=true;this._prepareCurrentItems()}};a.prototype.collapseNode=function(a){if(a.expanded){a.expanded=false;this._prepareCurrentItems()}};a.prototype._initRoot=function(){if(!this.root){this.root=new f("");this.root.expanded=true;this.root.root=true}};a.prototype._prepareCurrentItems=function(){var a=[];k(this.root,a,false);this.setItems(a,this.getItems(true))};return a}(i);b.TreeDataSource=s;c.initClassPrototype(s,{root:null});var p=function(b){__extends(a,b);function a(a){b.call(this,a)}a._typeName="tfs.virtualizingListView";a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({coreCssClass:"virtualizing-list-view",maxRowCount:8,selectedIndex:-1},a))};a.prototype.initialize=function(){this._bind("click",d(this,this._onClick));this._itemsContainer=$(g("ul","items"));this._bind(this._itemsContainer,"mouseover",d(this,this._onMouseOver));this._bind(this._itemsContainer,"mousemove",d(this,this._onMouseMove));this._bind(this._itemsContainer,n.BrowserCheckUtils.isFirefox()?"DOMMouseScroll":"mousewheel",d(this,this._onMouseWheel));this._element.append(this._itemsContainer);this._scrollContainer=$(g("div","scroller"));this._bind(this._scrollContainer,"scroll",d(this,this._onScroll));this._scrollSpacer=$(g("div","content-spacer"));this._scrollContainer.append(this._scrollSpacer);this._element.append(this._scrollContainer);this._dataSource=this._options.dataSource;this._selectedIndex=this._options.selectedIndex;this.update();this._enableMouseOver=true;b.prototype.initialize.call(this)};a.prototype.update=function(){var b,a;b=this._dataSource.getCount();this.visibleRowCount=Math.min(b,this._options.maxRowCount);if(this._selectedIndex>=0)this._selectedIndex=Math.min(this._selectedIndex,b-1);this._setVisibleBounds(this._selectedIndex);this._drawItems();a=this._itemsContainer.outerHeight();this._element.height(a);this._setupScrollbar(a)};a.prototype.scrollItemIntoView=function(a){this._setVisibleBounds(a);this._drawItems();this._updateScrollbar()};a.prototype.selectNext=function(b){var a=this._dataSource.nextIndex(this._selectedIndex,b?this.visibleRowCount:1);if(a>=0){this.setSelectedIndex(a);this._fireSelectionChanged();return true}return false};a.prototype.selectPrev=function(b){var a=this._dataSource.nextIndex(this._selectedIndex,-(b?this.visibleRowCount:1));if(a>=0){this.setSelectedIndex(a);this._fireSelectionChanged();return true}return false};a.prototype.getSelectedIndex=function(){return this._selectedIndex};a.prototype.setSelectedIndex=function(a,b){if(this._selectedIndex!==a){this._selectedIndex=a;!b&&this.scrollItemIntoView(a)}};a.prototype._setVisibleBounds=function(a){a=a||0;if(a<=this._firstVisible)this._firstVisible=Math.max(0,a);else if(a>=this._firstVisible+this.visibleRowCount)this._firstVisible=Math.max(0,Math.min(a,this._dataSource.getCount()-this.visibleRowCount));this._firstVisible=Math.max(0,Math.min(this._firstVisible,this._dataSource.getCount()-this.visibleRowCount))};a.prototype._createItem=function(b){var a=this._dataSource.getItemText(b)||"";return $(g("li",this._options.itemCss)).text(a).attr("title",a)};a.prototype._drawItems=function(){var a,b,d,e=this._options.createItem||this._createItem,c;this._itemsContainer.empty();b=this._firstVisible;d=Math.min(b+this.visibleRowCount,this._dataSource.getCount());for(a=b;a<d;a++){c=e.call(this,a);c.data("index",a);this._itemsContainer.append(c)}this._updateItemStyles();this._enableMouseOver=false};a.prototype._updateItemStyles=function(){var b=this._firstVisible,a=this._selectedIndex;this._itemsContainer.children("li").each(function(c){$(this).toggleClass("selected",c+b===a)})};a.prototype._setupScrollbar=function(c){var b=this._dataSource.getCount(),a=this.visibleRowCount<b;this._element.toggleClass("scroll",a);if(a){this._rowHeight=(c||this._itemsContainer.outerHeight())/this.visibleRowCount;this._scrollSpacer.height(this._rowHeight*b);this._updateScrollbar()}};a.prototype._updateScrollbar=function(){try{this._ignoreScrollEvent=true;this._scrollContainer.scrollTop(this._rowHeight*this._firstVisible)}finally{this._ignoreScrollEvent=false}};a.prototype._onScroll=function(){var a=this._dataSource.getCount();if(!this._ignoreScrollEvent){this._firstVisible=Math.max(0,Math.min(Math.floor(this._scrollContainer.scrollTop()/this._rowHeight),a-this.visibleRowCount));this._drawItems()}return false};a.prototype._onMouseMove=function(b){var a=b.screenX+"-"+b.screenY;if(!this._prevMousePos||this._prevMousePos!==a){this._prevMousePos=a;this._enableMouseOver=true}};a.prototype._onMouseOver=function(c){var b=$(c.target),a;if(this._enableMouseOver){this._enableMouseOver=false;a=b.closest("li");if(a.length){this._selectedIndex=a.data("index");this._updateItemStyles()}}};a.prototype._onMouseWheel=function(b){var a;a=n.getWheelDelta(b);if(a!==0){this._firstVisible=Math.max(0,Math.min(this._firstVisible+(a>0?-1:1),this._dataSource.getCount()-this.visibleRowCount));this.scrollItemIntoView(this._firstVisible);return false}};a.prototype._onClick=function(d){var c=$(d.target),a,b;a=c.closest("li");if(a.length){b=a.data("index");if(this._options.itemClick)if(this._options.itemClick.call(this,d,b,c,a)===false)return false;this.setSelectedIndex(b);this._updateItemStyles();this._fireSelectionChanged(true)}};a.prototype._fireSelectionChanged=function(a){this._options.selectionChange&&this._options.selectionChange.call(this,this._selectedIndex,a)};return a}(l);b.VirtualizingListView=p;c.initClassPrototype(p,{_itemsContainer:null,_scrollContainer:null,_scrollSpacer:null,_dataSource:null,visibleRowCount:1,_firstVisible:0,_selectedIndex:-1,_ignoreScrollEvent:false,_rowHeight:20,_enableMouseOver:true,_prevMousePos:null});c.tfsModuleLoaded("TFS.UI.Controls",b)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.UI.Controls.Validation",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.UI.Controls","Presentation/Scripts/TFS/Resources/TFS.Resources.Platform"],function(u,c,t,s,r,o){var g=t,d=s,b=r,p=o,e=d.delegate,a=function(c){__extends(a,c);function a(d){c.call(this,d);if(this.getType()===a)throw new Error("You cannot instantiate an abstract type.");this.instanceId="val_"+b.getId()}a.optionsPrefix="validator";a.EVENT_VALIDATE="validate";a.EVENT_VALIDATE_STATUS="validate-status";a.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({invalidCssClass:"invalid",message:"Invalid input value!",group:"*",allowEmptyString:false},a))};a.prototype.initialize=function(){c.prototype.initialize.call(this);this._bind("change",e(this,this.onChanged));this._bind(window.document.body,a.EVENT_VALIDATE,e(this,this.onValidationRequired),true);this._options.bindtokeystrokes&&this._bind("keyup",e(this,this.onKeyUp))};a.prototype.getValue=function(){return this._element.val()};a.prototype.isValid=function(){return true};a.prototype.getValidationGroup=function(){return this._options.group};a.prototype.getMessage=function(){var a=this._options.message;if(a)if($.isFunction(a))a=a.call(this);return a};a.prototype.onKeyUp=function(){this.validate()};a.prototype.onChanged=function(){this.validate()};a.prototype.onValidationRequired=function(b,a){(!a||a==="*"||a===this._options.group)&&this.validate()};a.prototype.validate=function(){var b,c;if(!this._disposed){b=this._testEmptyString()||this.isValid();c=this.getValidationGroup();this._element.toggleClass(this._options.invalidCssClass,!b);this._fire(a.EVENT_VALIDATE_STATUS,[this,c,b])}};a.prototype._testEmptyString=function(){return this._options.allowEmptyString&&this.getValue()===""};return a}(b.Enhancement);c.BaseValidator=a;g.initClassPrototype(a,{instanceId:null});var j=function(b){__extends(a,b);function a(a){b.call(this,a)}a.optionsPrefix="requiredValidator";a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({message:"Input value cannot be empty!"},a))};a.prototype.isValid=function(){return $.trim(this.getValue())?true:false};return a}(a);c.RequiredValidator=j;b.Enhancement.registerEnhancement(j,".validate.required");var l=function(b){__extends(a,b);function a(a){b.call(this,a)}a.optionsPrefix="rangeValidator";a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({message:"Out of range"},a))};a.prototype.isValid=function(){var a=this.getValue(),c=this._element.data("rangeValidator-min"),b=this._element.data("rangeValidator-max");return a>=c&&a<=b};a.prototype.getMessage=function(){var c=this.getValue(),b=this._element.data("rangeValidator-min"),a=this._element.data("rangeValidator-max");return c<b?"Input cannot be smaller than "+b:c>a?"Input cannot be greater than "+a:void 0};return a}(a);c.RangeValidator=l;b.Enhancement.registerEnhancement(l,".validate.range");var m=function(b){__extends(a,b);function a(a){b.call(this,a)}a.optionsPrefix="regexValidator";a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({message:"Input value doesn't match regex",testEmptyString:true},a))};a.prototype.isValid=function(){var b,a;a=this._options.regex||this._element.data("regexValidator-regex");if(a){b=this.getValue();if(this._options.testEmptyString||$.trim(b))return new RegExp(a).test(b)}return true};a.prototype.getMessage=function(){return this._element.data("regexValidator-message")||this._options.message};return a}(a);c.RegexValidator=m;b.Enhancement.registerEnhancement(m,".validate.regex");var k=function(b){__extends(a,b);function a(a){b.call(this,a)}a.optionsPrefix="customValidator";a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({message:"Input value doesn't satisfy function",testEmptyString:true,validate:function(){return true}},a))};a.prototype.isValid=function(){var b,a;a=this._options.validate;if(a){b=this.getValue();if(this._options.testEmptyString||$.trim(b))return a(b)}return true};a.prototype.setValidate=function(a){this._options.validate=a};a.prototype.getMessage=function(){return this._element.data("customValidator-message")||this._options.message};return a}(a);c.CustomValidator=k;b.Enhancement.registerEnhancement(k,".validate.custom");var n=function(b){__extends(a,b);function a(a){b.call(this,a)}a.optionsPrefix="dateValidator";a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({message:"Input value must be a valid date",parseFormat:""},a))};a.prototype.isValid=function(){var b=$.trim(this.getValue()),a;if(b)a=d.DateUtils.parseLocale(b,this._options.parseFormat);else return true;return a instanceof Date&&!isNaN(a)};a.prototype.getMessage=function(){return this._element.data("dateValidator-message")||this._options.message};return a}(a);c.DateValidator=n;b.Enhancement.registerEnhancement(n,".validate.date");var h=function(b){__extends(a,b);function a(a){b.call(this,a)}a.optionsPrefix="integerRangeValidator";a.prototype.isValid=function(){var g=this.getValue(),b=d.NumberUtils.parseLocale(g),e=false,a=parseInt(""+b,10),f=parseFloat(""+b),c;if(!isNaN(b)&&a===f&&isFinite(a)){c=this._getBounds();if(c.min<=a&&c.max>=a)e=true}return e};a.prototype.getMessage=function(){var a=this._getBounds();return d.StringUtils.format(p.Validation_IntegerRange,a.min,a.max)};a.prototype._getBounds=function(){var b,a;b=this._options.minValue!==undefined?this._options.minValue:Number(this._element.data("integerRangeValidator-min"));a=this._options.maxValue!==undefined?this._options.maxValue:Number(this._element.data("integerRangeValidator-max"));return{min:b,max:a}};return a}(a);c.IntegerRangeValidator=h;b.Enhancement.registerEnhancement(h,".validate.integerRange");var i=function(b){__extends(a,b);function a(a){b.call(this,a)}a.optionsPrefix="maxLengthValidator";a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({message:d.StringUtils.format("Input cannot exceed {0} characters.",a.maxLength)},a))};a.prototype.isValid=function(){return this.getValue().length>this._options.maxLength?false:true};return a}(a);c.MaxLengthValidator=i;b.Enhancement.registerEnhancement(i,".validate.maxlength");var f=function(c){__extends(b,c);function b(a){c.call(this,a);this._messages={}}b.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({coreCssClass:"validation-summary",group:"*"},a))};b.prototype.initialize=function(){c.prototype.initialize.call(this);this._bind(this._options.context||window.document.body,a.EVENT_VALIDATE_STATUS,e(this,this.onValidationStatus),true)};b.prototype.onValidationStatus=function(d,a,b,c){delete this._messages[a.instanceId];if(!b||b==="*"||b===this._options.group){if(!c)this._messages[a.instanceId]=a.getMessage();this._updateUI()}};b.prototype.validate=function(){try{this._messages={};this._ignoreUIUpdate=true;this._fire(this._options.context||window.document.body,a.EVENT_VALIDATE,[this._options.group])}finally{this._ignoreUIUpdate=false}this._updateUI()};b.prototype._updateUI=function(){var b=this,a=false;if(!this._ignoreUIUpdate){this._element.empty();$.each(this._messages,function(d,c){a=true;b._element.append($("<div />").text(c||""))});this._element.toggleClass("invalid",a)}};return b}(b.BaseControl);c.ValidationSummary=f;g.initClassPrototype(f,{_messages:null,_ignoreUIUpdate:false});b.Enhancement.registerEnhancement(f,".validation-summary");function q(f,d,c){var b=[];function e(e,c,a,d){if(!a||a==="*"||a===f)!d&&b.push(c)}$(c||window.document.body).bind(a.EVENT_VALIDATE_STATUS,e);$(c||window.document.body).trigger(a.EVENT_VALIDATE,[f]);$(c||window.document.body).unbind(a.EVENT_VALIDATE_STATUS,e);b.length&&d&&$.each(b,function(b,a){d.push(a)});return b.length===0}c.validateGroup=q;g.tfsModuleLoaded("TFS.UI.Controls.Validation",c)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.UI.Controls.Menus",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/TFS.UI.Controls","Presentation/Scripts/TFS/Resources/TFS.Resources.Common","Presentation/Scripts/TFS/TFS.UI"],function(K,a,I,G,H,D,B,A,E){var f=I,v=G,p=H,o=D,g=B,F=A,j=E,J=p.assert,b=v.delegate,i=j.domElem,h=j.KeyCode,C=f.handleError,w=f.getErrorMessage;a.menuManager;var k;(function(a){a.Horizontal=0;a.Vertical=1;function b(b){return b==="vertical"?a.Vertical:a.Horizontal}a.parse=b})(k||(k={}));var e;(function(a){a.None=0;a.Normal=1;a.Static=2;a.Popup=3;a.DropDown=4;a.Chevron=5;a.SubMenu=6;function b(b){switch(b){case"static":return a.Static;case"popup":return a.Popup;case"dropdown":return a.DropDown;case"chevron":return a.Chevron}return a.Normal}a.parse=b})(e||(e={}));(function(a){a._map=[];a.None=0;a.Disabled=1;a.Hidden=2;a.Toggled=4})(a.MenuItemState||(a.MenuItemState={}));var c=a.MenuItemState;function r(b){var a;if(b){a=b.state;if(b.disabled)a=a|c.Disabled;if(b.hidden)a=a|c.Hidden;if(b.toggled)a=a|c.Toggled}return a}var d;(function(a){a.RightBottom=0;a.RightJustify=1;a.LeftBottom=2;function b(b){switch(b){case"right-bottom":return a.RightBottom;case"left-bottom":return a.LeftBottom}return a.RightJustify}a.parse=b})(d||(d={}));var u=function(){function a(){this._commandStates={}}a.prototype.getCommandState=function(b,c){var a=this._commandStates&&this._commandStates[b];return $.isFunction(a)?a.call(c,b,c):a};a.prototype.updateCommandStates=function(a){var b=this;a&&$.each(a,function(c,a){b._commandStates[a.id]=r(a)})};a.prototype.executeCommand=function(a){this._fireEvent(this._executeEvent,this,a)};a.prototype.attachExecuteCommand=function(a){this.attachEvent(this._executeEvent,a)};a.prototype.detachExecuteCommand=function(a){this.detachEvent(this._executeEvent,a)};a.prototype.fire=function(b,c,a){return this._fireEvent(b,c,a)};a.prototype._fireEvent=function(c,d,e){var b,a;if(this._events){a=this._events._getEvent(c);if(!a||a.length===0)return undefined;a=v.ArrayUtils.clone(a);for(b=a.length-1;b>=0;b--)if(a[b](d||this,e)===false)return false}};a.prototype.attachEvent=function(a,b){if(!this._events)this._events=new Sys.EventHandlerList;this._events.addHandler(a,b)};a.prototype.detachEvent=function(a,b){this._events&&this._events.removeHandler(a,b)};return a}();f.initClassPrototype(u,{_executeEvent:"execute-command",_commandStates:null,_events:null});a.menuManager=new u;var n=function(d){__extends(b,d);function b(a){d.call(this,a);this._type=e.parse(this._options.type);this._children=[]}b.prototype.getOwner=function(){return this._parent?this._parent.getOwner():this};b.prototype.getContextInfo=function(){return this._options.contextInfo};b.prototype.getActionArguments=function(){var a=this._options.arguments||this.actionArguments;return typeof a==="string"?{url:a}:$.isFunction(a)?a.call(this,this.getOwner().getContextInfo()):a};b.prototype.getCommandState=function(e,d){var b=this._commandStates&&this._commandStates[e];d=d||this;if((b===null||typeof b==="undefined"||b===c.None)&&$.isFunction(this._options.getCommandState))b=this._options.getCommandState.call(d,e,d);return b===null||typeof b==="undefined"||b===c.None?this._parent?this._parent.getCommandState(e,d):a.menuManager.getCommandState(e,d):$.isFunction(b)?b.call(d,e,d):b};b.prototype.getMenuType=function(){return this._type};b.prototype.updateCommandStates=function(a){this._updateCommandStates(a)};b.prototype.isMenuBar=function(){return this._type===e.Static};b.prototype._fireUpdateCommandStates=function(a){a=a||this;if($.isFunction(this._options.updateCommandStates))if(this._options.updateCommandStates.call(a,a)===false)return;this._parent&&this._parent._fireUpdateCommandStates(a)};b.prototype._clear=function(){for(var b=this._children.length,a=0;a<b;a++){this._children[a]._clear();this._children[a].dispose()}this._children=[]};b.prototype._updateCommandStates=function(a){var b=this;if(!this._commandStates)this._commandStates={};a&&$.each(a,function(c,a){b._commandStates[a.id]=r(a)})};return b}(g.BaseControl);a.MenuBase=n;f.initClassPrototype(n,{_type:null,_parent:null,_children:null,_commandStates:null,actionArguments:null});var l=function(k){__extends(f,k);function f(a){k.call(this,a);this._item=this._options.item||{};this.actionArguments=this._item.arguments;this._align=d.parse(this._options.align)}f._typeName="tfs.menu.item";f.getScopedCommandId=function(b,a){return a?a+"-"+b:b};f.prototype.initializeOptions=function(a){k.prototype.initializeOptions.call(this,$.extend({cssCoreClass:"menu-item",tagName:"li"},a))};f.prototype.getCommandId=function(){return f.getScopedCommandId(this._item.id,this._item.scope)};f.prototype.getAction=function(){var a=this._item.idIsAction;return a===false?this._item.action:this._item.action||this.getCommandId()};f.prototype.hasAction=function(){var a=this.getAction();return a!==null&&typeof a!=="undefined"};f.prototype.hasSubMenu=function(){return!this.isDefault()&&this._item.childItems};f.prototype.isDecorated=function(){return this._item.decorated===true};f.prototype.isDefault=function(){return this._type===e.None};f.prototype.isSeparator=function(){return this._item.separator===true};f.prototype.isLabel=function(){return this.isSeparator()&&this._item.isLabel};f.prototype.isSelected=function(){return this._item.selected===true};f.prototype.getCommandState=function(b,d){var a;b=b||this._item.id;d=d||this;if(b===this._item.id)a=r(this._item);return a===null||typeof a==="undefined"||a===c.None?k.prototype.getCommandState.call(this,b,d):$.isFunction(a)?+a.call(d,b,d):+a};f.prototype.getIndex=function(){return this._index};f.prototype.setIndex=function(a){this._index=a};f.prototype.isHidden=function(){return(this.getCommandState()&c.Hidden)===c.Hidden};f.prototype.isEnabled=function(){var a=false;if(!this.isSeparator())a=(this.getCommandState()&(c.Disabled|c.Hidden))===c.None;return a};f.prototype.isToggled=function(){var a=false;if(!this.isSeparator()&&!this.isHidden())a=(this.getCommandState()&c.Toggled)===c.Toggled;return a};f.prototype.initialize=function(){k.prototype.initialize.call(this);this._decorate()};f.prototype.update=function(a){this._clear();this._item=a;this._item.decorated=false;this._element.empty();this._unbind("click mouseover mouseout mousedown mouseup");this._decorate()};f.prototype.updateItems=function(a){this._clear();this._item.childItems=a};f.prototype._decorate=function(){var a=this._element,m=this.getOwner()._options.showIcon===true,l=this.hasSubMenu(),h,n=this._item.showText!==false,e,f,d,c,i=false,k=false;a.attr("id","mi_"+g.getId());if(!this.isDecorated()){h=this._item.title;if(!h&&!this._item.encoded)h=this._item.text;a.addClass(this._options.cssCoreClass).addClass(this._options.cssClass).attr("title",h);this._item.id&&a.attr("command",this._item.id);this._item.cssClass&&this._element.addClass(this._item.cssClass);if(this.isSeparator()){this._element.addClass("menu-item-separator");e=this._createSeparatorElement();if(this._item.text){e.text(this._item.text);e.removeClass("separator");e.addClass("text-separator")}a.append(e)}else{if(m&&!this._item.noIcon){f=this._createIconElement();if($.isFunction(this._item.icon))f.append(this._item.icon.call(this,f));else this._item.icon&&f.addClass(this._item.icon);a.append(f);i=true}if(n){d=this._createTextElement();if(this._item.encoded)d[0].innerHTML=this._item.text||"";else if(typeof this._item.text==="string")d.text(this._item.text);else $.isFunction(this._item.text)&&d.text(this._item.text.call(this)||"");this._item.textClass&&d.addClass(this._item.textClass);k=true;a.append(d)}!k&&i&&a.addClass("icon-only");if(l&&!this._item.hideDrop){c=this._createDropElement();a.append(c);a.addClass("drop-visible")}}}else c=a.children(".drop").eq(0);this._updateState();if(this.isSelected())a.addClass("selected");else a.removeClass("selected");if(!this.isDefault()&&!this.isSeparator()){this._bind("click",b(this,this._onClick));this._bind("mouseover",b(this,this._onMouseOver));this._bind("mouseout",b(this,this._onMouseOut));this._bind("mousedown",b(this,this._onMouseDown));this._bind("mouseup",b(this,this._onMouseUp));l&&c&&c.length>0&&this._bind(c,"click",b(this,this._onDropClick))}this.getOwner()._options.markUnselectable===true&&j.makeElementUnselectable(a[0])};f.prototype.select=function(){this._parent._selectItem(this);this._parent._clearTimeouts()};f.prototype.deselect=function(){this._parent._selectItem(null)};f.prototype.escaped=function(){this.select()};f.prototype.execute=function(a){a&&p.assertParamIsObject(a,"options");var b=this.getOwner();this.collapse({immediate:true});b.escaped();this.deselect();b.isMenuBar()&&a&&a.keepHighlight&&this.showHoverHighlight();b._proceedBlur();if(this.hasAction())return this.executeAction($.extend({},b.getActionArguments(),this.getActionArguments()))};f.prototype.executeAction=function(b){var c=this.getAction(),d=this.getOwner();if(c)if($.isFunction(c))return c.apply(this,[b]);else if(c==="navigate"&&b.url){try{if(b.target)o.ActionManager.performAction(o.CommonActions.ACTION_WINDOW_OPEN,{url:b.url,target:b.target});else o.ActionManager.performAction(o.CommonActions.ACTION_WINDOW_NAVIGATE,{url:b.url})}catch(e){}return false}else return d?d.executeAction(new Sys.CommandEventArgs(c,b,this)):a.menuManager.executeCommand(new Sys.CommandEventArgs(c,b,this))};f.prototype.collapse=function(b){var a=this._parent,c=b&&b.immediate===true;while(a){$.isFunction(a.hide)&&a.hide({immediate:c});a=a._parent}this.getOwner().ownFocus()};f.prototype.setFocus=function(){var a=this._element;a&&this.isEnabled()&&!(this.isSeparator()||this.isDefault())&&a.addClass("focus")};f.prototype.removeFocus=function(){var a=this._element;a&&this.isEnabled()&&!(this.isSeparator()||this.isDefault())&&a.removeClass("focus")};f.prototype.showHoverHighlight=function(){this._highlightHover=true;this._updateState()};f.prototype.showPressedHighlight=function(){if(!this.hasSubMenu()||!this.getSubMenu()._visible){this._highlightPressed=true;this._updateState()}};f.prototype.removePressedHighlight=function(){if(this._highlightPressed){this._highlightPressed=false;this._updateState()}};f.prototype.removeHighlight=function(){this._highlightHover=false;this._highlightPressed=false;this._updateState()};f.prototype.updateTitle=function(b){var a;if(typeof b==="string")a=b;else if(this._item&&$.isFunction(this._item.attr("title")))a=this._item.text.call(this);a&&this._element.attr("title",a)};f.prototype.updateText=function(b){var a;if(typeof b==="string")a=b;else if(this._item&&$.isFunction(this._item.text))a=this._item.text.call(this);a&&this._element.children("span.text").text(a)};f.prototype.getSubMenu=function(){var a=null;if(this.hasSubMenu())if(this._children.length===0){a=g.BaseControl.createIn(q,this._element,$.extend({},this._options,this._item.childOptions,{earlyInitialize:false,items:this._item.childItems,type:"submenu",cssCoreClass:"menu sub-menu",tagName:"ul"}));a._parent=this;a._type=e.SubMenu;this._children.push(a)}else a=this._children[0];return a};f.prototype.tryShowSubMenu=function(a){var b=a&&a.immediate;if(!this.isDefault()&&this.isEnabled()&&this.getSubMenu()){this.showSubMenu({immediate:b});return true}return false};f.prototype.showSubMenu=function(a){var c=a&&a.immediate===true,b=this.getSubMenu();J(Boolean(b),"There is no sub menu to show.");b.show({immediate:c,element:this._element,align:this._align})};f.prototype.hideSubMenu=function(a){if(this.hasSubMenu()){var c=a&&a.immediate===true,b=this.getSubMenu();b._parent===this&&b.hide({immediate:c})}};f.prototype.hideSiblings=function(a){this._parent.hideChildren(this,a)};f.prototype._attachMenuEvents=function(){};f.prototype._createIconElement=function(){return $(i("span","icon"))};f.prototype._createTextElement=function(){return $(i("span","text"))};f.prototype._createDropElement=function(){return $(i("span","drop"))};f.prototype._createSeparatorElement=function(){return $(i("div","separator"))};f.prototype._updateState=function(){var a=this._element;if(a&&!(this.isSeparator()||this.isDefault())){if(this.isEnabled()){a.toggleClass("hover",this._highlightHover);a.toggleClass("pressed",this._highlightPressed);a.removeAttr("disabled");a.removeClass("disabled")}else{a.attr("disabled","disabled");a.addClass("disabled");a.removeClass("hover");a.removeClass("pressed")}a.toggleClass("toggle-on",this.isToggled())}a&&!this.isDefault()&&a.toggleClass("invisible",this.isHidden())};f.prototype._onMouseOver=function(d){p.logTracePoint("MenuItem._onMouseOver.start");var b=this.getOwner(),a,c;if(b._active){c=b._subMenuVisible;this.hideSiblings({immediate:this._options.immediateShowHide});this.select();if(b!==this._parent||c){b._subMenuVisible=c;if(this.isEnabled()&&this.hasSubMenu()){a=this.getSubMenu();if(a._parent===this)if(!a._visible){this.showSubMenu({immediate:this._options.immediateShowHide});a.selectDefaultItem()}}}}else this.showHoverHighlight();d.stopPropagation()};f.prototype._onMouseOut=function(c){var b=this.getOwner(),a;if(b._active)if(b!==this._parent)if(this.hasSubMenu()){a=this.getSubMenu();if(a._parent===this){if(!a._visible){this.deselect();a._clearTimeouts()}}else this.deselect()}else this.deselect();else this.hasSubMenu()&&!this.getSubMenu()._visible&&this.removeHighlight();else this.removeHighlight();c.stopPropagation()};f.prototype._onMouseDown=function(){this.showPressedHighlight()};f.prototype._onMouseUp=function(){this.removePressedHighlight()};f.prototype._onClick=function(c){var a,b=this.actionArguments;if(!b)b={};if(!b.clickArguments)b.clickArguments={};$.extend(b.clickArguments,c);if(this.isEnabled()){if(this.hasSubMenu()){a=this.getSubMenu();if(a._parent===this&&a._visible){this.getOwner().activate();if(this._options.clickToggles===true){a.hide({immediate:true});this.select()}else a.ownFocus()}else if(this.hasAction()&&this._item.clickOpensSubMenu===false){this.select();return this.execute({keepHighlight:this._parent.getMenuType()!==e.SubMenu})===true}else{this.getOwner().activate();this.hideSiblings({immediate:true});this.showSubMenu({immediate:true});a.selectDefaultItem()}}else if(this.hasAction()){this.select();return this.execute({keepHighlight:this._parent.getMenuType()!==e.SubMenu})===true}}else{this.getOwner().activate();this.hideSiblings({immediate:true});this.select()}return false};f.prototype._onDropClick=function(){var a;if(this.isEnabled()){this.getOwner().activate();if(this.hasSubMenu()){a=this.getSubMenu();if(a._parent===this&&a._visible)if(this._options.clickToggles===true){a.hide({immediate:true});this.select()}else a.ownFocus();else{this.hideSiblings({immediate:true});this.showSubMenu({immediate:true});a.selectDefaultItem()}}}return false};f.prototype._onKeyDown=function(a){switch(a.keyCode){case h.DOWN:this._parent.selectDown();return false;case h.UP:this._parent.selectUp();return false;case h.RIGHT:this._parent.selectRight();return false;case h.LEFT:this._parent.selectLeft();return false;case h.ENTER:if(this.isEnabled())if(this.hasAction())this.execute();else if(this.hasSubMenu()){this.hideSiblings(true);this.showSubMenu(true);this.getSubMenu().selectFirstItem()}return false;case h.ESCAPE:if(this._parent.escape())return false;break;case h.TAB:if(this.getOwner()===this._parent){if(a.shiftKey){if(this._parent.selectPrevItem())return false}else if(this._parent.selectNextItem())return false}else{this.collapse(true);return this.getOwner()._selectedItem._onKeyDown(a)}}};return f}(n);a.MenuItem=l;f.initClassPrototype(l,{_item:null,_align:null,_index:0,_highlightHover:false,_highlightPressed:false});var q=function(f){__extends(c,f);function c(a){f.call(this,a);this._itemsSource=this._options.items;this._menuItems=[]}c._typeName="tfs.menu.menu";c.prototype.initializeOptions=function(a){f.prototype.initializeOptions.call(this,$.extend({cssCoreClass:"menu",tagName:"ul"},a))};c.prototype.initialize=function(){f.prototype.initialize.call(this);this._decorate()};c.prototype._decorate=function(){this._element.addClass(this._options.cssCoreClass).addClass(this._options.cssClass);this._bind("mousedown",b(this,this._onMouseDown));this._ensureChildren()};c.prototype.getItem=function(d){var b,c,a;for(b=0,c=this._menuItems.length;b<c;b++){a=this._menuItems[b];if(a&&d===a.getCommandId())return a}return null};c.prototype.getItems=function(){return this._menuItems};c.prototype.getItemByTag=function(d){var b,c,a;for(b=0,c=this._menuItems.length;b<c;b++){a=this._menuItems[b];if(a&&d===a._item.tag)return a}return null};c.prototype.updateCommandStates=function(a){f.prototype.updateCommandStates.call(this,a);!this._skipUpdateMenuItemStates&&this._updateMenuItemStates()};c.prototype.updateItems=function(a){this._clear();this._itemsSource=a;if(this._initialized){this._ensureChildren();this.updateMenuItemStates();$.isFunction(this._positioningRoutine)&&this._positioningRoutine.call(this)}};c.prototype.appendItems=function(a){$.isArray(a)&&a.length&&this.updateItems((this._itemsSource||[]).slice(0).concat(a))};c.prototype._enhance=function(a){f.prototype._enhance.call(this,a);this._enhanceChildren()};c.prototype._getMenuItemType=function(){return l};c.prototype._getMenuItemOptions=function(b,a){return $.extend({earlyInitialize:false,item:b,align:this._getMenuItemAlignment(),overflow:this._options.overflow},a)};c.prototype._getFirstMenuItem=function(){return this._getNextEnabledItem(0)};c.prototype._selectItem=function(a,b){this._parent&&this._parent.select();if(this._selectedItem){this._selectedItem.removeHighlight();this._selectedItem.removeFocus()}if(!a)a=this._getDefaultMenuItem();a.showHoverHighlight();this._selectedItem=a;this._selectedItem.setFocus();this.getOwner()._updateAriaAttribute(a);if(!b)this.getOwner()._focusItem=a};c.prototype.selectDefaultItem=function(a){this._selectItem(null,a)};c.prototype.selectFirstItem=function(){var a=this._getFirstMenuItem();if(a){this._selectItem(a);return true}return false};c.prototype.selectNextItem=function(){var c=0,d=this._menuItems,b=this._selectedItem,a;if(d.length>0){if(b)c=b.getIndex()+1;a=this._getNextEnabledItem(c);if(a){a.select();return true}}return false};c.prototype.selectPrevItem=function(){var c=-1,d=this._menuItems,b=this._selectedItem,a;if(d.length>0){if(b)c=b.getIndex()-1;a=this._getPrevEnabledItem(c);if(a){a.select();return true}}return false};c.prototype.selectDown=function(){var a;if(this._menuItems.length>0){a=this._getNextEnabledItem(this._selectedItem.getIndex()+1,{rollOver:true});if(a){a.select();this._ensureVisible(a);return true}}return false};c.prototype.selectUp=function(){var a;if(this._menuItems.length>0){a=this._getPrevEnabledItem(this._selectedItem.getIndex()-1,{rollOver:true});if(a){a.select();this._ensureVisible(a);return true}}return false};c.prototype.selectRight=function(){if(this._selectedItem.tryShowSubMenu({immediate:true})){this._selectedItem.getSubMenu().selectFirstItem();return true}else return this.getOwner().selectRight({redirected:true})};c.prototype.selectLeft=function(){if(this._parent&&this._parent._parent!==this.getOwner()){this.hide({immediate:true});this._parent.select();return true}else return this.getOwner().selectLeft({redirected:true})};c.prototype.show=function(a){var e=a&&a.immediate===true,b=a?a.element:null,c=a?a.align:d.RightJustify;if(e)this._showPopup(b,c);else this._startShowTimeout(b,c);return true};c.prototype.hide=function(a){var b=a&&a.immediate===true;if(b)this._hidePopup();else this._startHideTimeout()};c.prototype.hideChildren=function(f,d){var a,e,c,b=this._children,g=d&&d.immediate===true;if($.isArray(b))for(a=0,e=b.length;a<e;a++){c=b[a];c!==f&&c.hideSubMenu({immediate:g})}};c.prototype.escape=function(){this.hide({immediate:true});this._parent&&this._parent.escaped();return true};c.prototype.ownFocus=function(){this._selectItem(this._selectedItem)};c.prototype.attach=function(a){if(this._parent!==a)this._visible&&this.hide({immediate:true});this._parent=a};c.prototype._getMenuItemAlignment=function(){return"right-justify"};c.prototype.updateMenuItemStates=function(){try{this._skipUpdateMenuItemStates=true;this._fireUpdateCommandStates(this)}finally{this._skipUpdateMenuItemStates=false}this._updateMenuItemStates()};c.prototype.executeAction=function(c){var b;if($.isFunction(this._options.executeAction))b=this._options.executeAction.call(this,c);if(b!==false)b=a.menuManager.executeCommand(c);return b};c.prototype._ensureVisible=function(b){if(b&&b.getElement()){var c,e,d,f=b.getElement(),a=this.getElement();d=f.outerHeight(true);c=b.getIndex()*d;e=c+d;if(c<a.scrollTop())a.scrollTop(c);else e-a.height()>a.scrollTop()&&a.scrollTop(e-a.height())}};c.prototype._getItems=function(){var b=this,c,a=false;if(!this._items)if(this._itemsSource)if($.isFunction(this._itemsSource)){c=this._itemsSource.call(this,this.getOwner().getContextInfo(),function(c){if(a)!b._disposed&&b.updateItems(c);else{a=true;b._items=c||[]}},function(c){var d=[{text:w(c),icon:"icon-tfs-build-failed"}];if(a)!b._disposed&&b.updateItems(d);else{a=true;b._items=d}C(c)});if(!a){a=true;if(!c)c=[{text:F.MenuItemsLoading}];this._items=c}}else this._items=this._itemsSource;else this._items=[];return this._items};c.prototype._clear=function(){f.prototype._clear.call(this);this._defaultMenuItem=null;this._menuItems=[];this._items=null;this._childrenCreated=false};c.prototype._createChildMenuItem=function(d,c){var a,b;b=this._getMenuItemOptions(d);if(c)a=g.Enhancement.enhance(this._getMenuItemType(),c,b);else a=g.BaseControl.createIn(this._getMenuItemType(),this._element,b);a._parent=this;this._children.push(a);if(!a._item.separator){a.setIndex(this._menuItems.length);this._menuItems.push(a)}a.initialize()};c.prototype._ensureChildren=function(){var a=this;if(!this._childrenCreated){$.each(this._getItems(),function(c,b){a._createChildMenuItem(b)});this._childrenCreated=true}};c.prototype._enhanceChildren=function(){var b=this,a;a=this._getItems();this._element.children("li").each(function(d,c){b._createChildMenuItem($.extend({},a[d],{decorated:true}),$(c))});this._childrenCreated=true};c.prototype._getDefaultMenuItem=function(){if(!this._defaultMenuItem){var a=new l;a._type=e.None;a._parent=this;a._align=d.RightBottom;a.setIndex(-1);this._children.push(a);this._defaultMenuItem=a}return this._defaultMenuItem};c.prototype._getNextEnabledItem=function(b,e){var f=e&&e.rollOver===true,a,c=this._menuItems;function d(d,e){for(var a,b=d;b<=e;b++){a=c[b];if(a.isEnabled())return a}return null}b=b||0;a=d(b,c.length-1);if(a)return a;if(f){a=d(0,b);if(a)return a}return null};c.prototype._getPrevEnabledItem=function(b,e){var f=e&&e.rollOver===true,a,c=this._menuItems;function d(d,e){for(var a,b=e;b>=d;b--){a=c[b];if(a.isEnabled())return a}return null}b=b||0;a=d(0,b);if(a)return a;if(f){a=d(b,c.length-1);if(a)return a}return null};c.prototype._ensurePopup=function(){if(this._ensureInitialized())this._popupElement=this._element;this._ensureChildren()};c.prototype._getPopupAlign=function(a){switch(a){case d.RightJustify:return["left-top","right-top"];case d.RightBottom:return["right-top","right-bottom"]}return["left-top","left-bottom"]};c.prototype._showPopup=function(a,c){this._clearTimeouts();this._ensurePopup();this._pinElement=a;this._attachAncestorScroll(a);this.updateMenuItemStates();var b=this._getPopupAlign(c);this._element.show();this._positioningRoutine=function(){var c,d;if(this._options.alignToMarkerVertical||this._options.alignToMarkerHorizontal){c=this._element.find(".alignment-marker").first();d=a.find(".alignment-marker:not(.sub-menu .alignment-marker)").first()}j.Positioning.position(this._element,a,{elementAlign:b[0],baseAlign:b[1],overflow:this._options.overflow||"fit-flip",supportScroll:true,alignToMarkerHorizontal:this._options.alignToMarkerHorizontal,alignToMarkerVertical:this._options.alignToMarkerVertical,elementAlignmentMarker:c,baseAlignmentMarker:d})};this._positioningRoutine.call(this);this._visible=true;this.getOwner()._updateSubMenuVisibleState();this.ownFocus()};c.prototype._hidePopup=function(){this._clearTimeouts();this._visible=false;if(this._pinElement){this._detachAncestorScroll(this._pinElement);this._pinElement=null}this._popupElement&&this._popupElement.hide();delete this._positioningRoutine;this.hideChildren(null,{immediate:true});this.getOwner()._updateSubMenuVisibleState()};c.prototype._updateMenuItemStates=function(){var d,g,a,f=this._children,b,c=false;function e(){b&&b.isHidden()===c&&b.update($.extend(b._item,{separator:true,hidden:!c}))}for(d=0,g=f.length;d<g;d++){a=f[d];if(a.isSeparator()&&!a.isLabel()){e();b=a;c=false}else{if(b&&!a.isHidden())c=true;a._updateState();a.updateText()}}e()};c.prototype._startShowTimeout=function(a,c){this._clearTimeouts();this.delayExecute("show",this.getOwner()._options.showTimeout,true,b(this,this._showPopup,[a,c]))};c.prototype._startHideTimeout=function(){this._clearTimeouts();this.delayExecute("hide",this.getOwner()._options.hideTimeout,true,this._hidePopup)};c.prototype._clearTimeouts=function(){this.cancelDelayedFunction("show");this.cancelDelayedFunction("hide")};c.prototype._attachAncestorScroll=function(a){this._bind($(a).parents(),"scroll",b(this,this._onParentScroll))};c.prototype._detachAncestorScroll=function(a){this._unbind($(a).parents(),"scroll")};c.prototype._onParentScroll=function(){this._hidePopup()};c.prototype._onMouseDown=function(a){a.which===1&&this._blockBlurUntilTimeout()};c.prototype._blockBlurUntilTimeout=function(){this._blockBlur=true;this.delayExecute("blockBlur",200,true,function(){this._blockBlur=false})};return c}(n);a.Menu=q;f.initClassPrototype(q,{_items:null,_itemsSource:null,_menuItems:null,_defaultMenuItem:null,_selectedItem:null,_focusItem:null,_childrenCreated:false,_popupElement:null,_visible:false,_active:false,_blockBlur:false,_skipUpdateMenuItemStates:false,_positioningRoutine:null,_pinElement:null});var m=function(c){__extends(a,c);function a(a){c.call(this,a);this._align=d.parse(this._options.align)}a.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({markUnselectable:true,showIcon:true,showTimeout:500,hideTimeout:500},a))};a.prototype.setShowIcon=function(a){p.assertParamIsBool(a,"showIcon");this._options.showIcon=a};a.prototype.initialize=function(){c.prototype.initialize.call(this);this._fire("menuInitialized",{menu:this})};a.prototype._decorate=function(){var a;c.prototype._decorate.call(this);this._focusElement=a=$(i("div","menu-focus-receiver")).attr("tabIndex",0).attr("role","menu");this._bind(a,"keydown",b(this,this._onKeyDown));this._bind(a,"focus",b(this,this._onFocus));this._bind(a,"blur",b(this,this._onBlur));this._bind(a,"contextmenu",b(this,this._onContextMenu));this._element.append($(i("li","menu-focus-container")).append(a))};a.prototype._getMenuItemAlignment=function(){return this._options.popupAlign||c.prototype._getMenuItemAlignment.call(this)};a.prototype._getMenuItemOptions=function(b,a){return c.prototype._getMenuItemOptions.call(this,b,$.extend({immediateShowHide:true,clickToggles:true,type:"static"},a))};a.prototype.escape=function(){return false};a.prototype.escaped=function(){};a.prototype.isActive=function(){return this._active};a.prototype.activate=function(){if(!this._activating){this._activating=true;try{this._clearBlurTimeout();this._active=true;j.tryFocus(this._focusElement);$.isFunction(this._options.onActivate)&&this._options.onActivate.call(this)}finally{this._activating=false}}};a.prototype._updateAriaAttribute=function(a){a&&a._element&&this._focusElement.attr("aria-activedescendant",a._element.attr("id"))};a.prototype._hide=function(){if(this._active){this.hide({immediate:true});this.ownFocus()}};a.prototype._blur=function(){this._clearBlurTimeout();this.hide({immediate:true});!this._disposed&&this._selectItem(null);this._active=false;$.isFunction(this._options.onDeactivate)&&this._options.onDeactivate.call(this)};a.prototype._updateSubMenuVisibleState=function(){var b,e,a,c=this._menuItems,d;this._subMenuVisible=false;if($.isArray(c))for(b=0,e=c.length;b<e;b++){a=c[b];if(a.hasSubMenu()){d=a.getSubMenu();if(d._parent===a&&d._visible){this._subMenuVisible=true;break}}}};a.prototype._onKeyDown=function(a){if(this._focusItem)if(this._focusItem._onKeyDown(a)===false)return false;if(a.keyCode===h.TAB)this._immediateBlur=true;else if(a.keyCode===h.F10)if(a.shiftKey)return this._onContextMenu(a)};a.prototype._onFocus=function(){this.activate();(!this._selectedItem||this._selectedItem&&this._selectedItem.getIndex()<0)&&this.selectFirstItem()};a.prototype._onBlur=function(){if(this._immediateBlur){this._immediateBlur=false;this._blur()}else if(this._blockBlur)this._startBlurTimeout();else this._blur()};a.prototype._proceedBlur=function(){this._canBlur=true};a.prototype._startBlurTimeout=function(){this.delayExecute("blur",j.Constants.BlurTimeout,true,function(){if(this._canBlur){this._canBlur=false;this._blur()}else this.activate()})};a.prototype._clearBlurTimeout=function(){this.cancelDelayedFunction("blur")};a.prototype._onParentScroll=function(){this._hide()};a.prototype._onResize=function(){this._hide()};a.prototype._onContextMenu=function(){var a=this._focusItem;return a&&a.tryShowSubMenu({immediate:true})?false:false};return a}(q);a.MenuOwner=m;f.initClassPrototype(m,{_focusItem:null,_focusElement:null,_activating:false,_subMenuVisible:false,_align:null,_canBlur:false,_immediateBlur:false});var t=function(b){__extends(a,b);function a(a){b.call(this,a);this._orientation=k.parse(this._options.orientation);this._type=e.Static}a._typeName="tfs.menu.menubar";a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({cssCoreClass:"menu-bar"},a))};a.prototype._getMenuItemAlignment=function(){return this._orientation===k.Horizontal?"left-bottom":"right-justify"};a.prototype.selectUp=function(a){return b.prototype.selectLeft.call(this,a)};a.prototype.selectDown=function(a){return b.prototype.selectRight.call(this,a)};a.prototype.selectLeft=function(){var a=this._subMenuVisible;this.hideChildren(null,{immediate:true});b.prototype.selectUp.call(this);if(a){this._subMenuVisible=true;if(this._selectedItem.tryShowSubMenu({immediate:true})){this._selectedItem.getSubMenu().selectFirstItem();return true}}return false};a.prototype.selectRight=function(){var a=this._subMenuVisible;this.hideChildren(null,{immediate:true});b.prototype.selectDown.call(this);if(a){this._subMenuVisible=true;if(this._selectedItem.tryShowSubMenu({immediate:true})){this._selectedItem.getSubMenu().selectFirstItem();return true}}return false};return a}(m);a.MenuBar=t;f.initClassPrototype(t,{_orientation:k.Horizontal});var x=function(b){__extends(a,b);function a(a){b.call(this,a)}a._typeName="tfs.menu.popup-menuitem";a.prototype.escaped=function(){b.prototype.escaped.call(this);this._parent.escaped()};return a}(l),s=function(b){__extends(a,b);function a(a){b.call(this,a);this._type=e.Popup;this._hidden=this._options.hidden===true}a._typeName="tfs.menu.popup";a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({cssCoreClass:"menu-popup",cssClass:"invisible",hidden:true},a))};a.prototype._getMenuItemType=function(){return x};a.prototype._decorate=function(){b.prototype._decorate.call(this);this._hidden===true&&this._element.addClass("invisible")};a.prototype.popup=function(c,d){var b,a;this._escapeFocusReceiver=c;this._floating=true;if(this._active)this.escaped();else{this.activate();b=this._getFirstMenuItem();a=b.getSubMenu();if(a){a.show({immediate:true,element:d,align:this._align});a.selectDefaultItem()}}};a.prototype.selectUp=function(){return true};a.prototype.selectDown=function(a){var c=a&&a.redirected;if(!c)if(this._align!==d.RightJustify)return b.prototype.selectRight.call(this);return false};a.prototype.selectLeft=function(){return true};a.prototype.selectRight=function(a){var c=a&&a.redirected;if(!c)if(this._align===d.RightJustify)return b.prototype.selectRight.call(this);return false};a.prototype.escaped=function(){if(this._floating){this._floating=false;if(this._escapeFocusReceiver){this._escapeFocusReceiver.focus();this._escapeFocusReceiver=null;$.isFunction(this._options.onPopupEscaped)&&this._options.onPopupEscaped.call(this)}}};return a}(m);a.PopupMenu=s;f.initClassPrototype(s,{_align:d.RightJustify,_floating:false,_hidden:false,_escapeFocusReceiver:null});var y=function(d){__extends(c,d);function c(a){d.call(this,a)}c.prototype.initialize=function(){var a=this._element.data();d.prototype.initialize.call(this);this._bind(a.commandAction||"click",b(this,this.onCommandExecute));a.commandCompleteEvent&&this._bind(window,a.commandCompleteEvent,b(this,this.onCommandComplete))};c.prototype.onCommandExecute=function(){var b=this._element.data();if(b.commandName){this._element.attr("disabled",true);a.menuManager.executeCommand(new Sys.CommandEventArgs(b.commandName,b.commandArg,this))}return false};c.prototype.onCommandComplete=function(){this._element.removeAttr("disabled")};return c}(g.BaseControl);g.Enhancement.registerEnhancement(t,".menu-bar.enhance");g.Enhancement.registerEnhancement(s,".menu-popup.enhance");g.Enhancement.registerEnhancement(y,".single-command");function z(a){return a.sort(function(a,b){var d=a.rank?a.rank:9999,c=b.rank?b.rank:9999;return d-c})}a.sortMenuItems=z;f.tfsModuleLoaded("TFS.UI.Controls.Menus",a)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.UI.Controls.Common",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/Resources/TFS.Resources.Platform","Presentation/Scripts/TFS/TFS.Core.Ajax","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/TFS.UI.Controls","Presentation/Scripts/TFS/TFS.UI.Controls.Validation","Presentation/Scripts/TFS/TFS.UI.Controls.Menus","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/TFS.UI"],function(zb,g,xb,vb,wb,ib,ub,tb,nb,lb,kb,ob,qb){var h=xb,f=vb,b=wb,e=ib,S=ub,s=tb,c=nb,pb=lb,bb=kb,p=ob,i=qb,t=b.log,yb=b.assert,r=b.LogVerbosity.Verbose,a=f.delegate,Z=h.getErrorMessage,n=p.notificationService,k=i.KeyCode,d=i.domElem;function ab(c,a){var b=$.extend({},c);a&&$.each(a,function(c,a){delete b[a]});return b}var jb=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.initialize=function(){var a=this.getElement();a.hide();this._processOptions();var b=$("<div>").appendTo(a);this._messageArea=c.Enhancement.enhance(v,b,{closeable:false,fillVertical:true});this._toasting=false};a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({coreCssClass:"toast-notification"},a))};a.prototype._processOptions=function(){var a=this._getOptions(),b=this.getElement();b.width(a.width);b.css("min-height",a.minHeight);this._fadeInTime=a.fadeInTime;this._fadeOutTime=a.fadeOutTime;this._toastTime=a.toastTime};a.prototype._getOptions=function(){return $.extend(this._getDefaultOptions(),this._options)};a.prototype._getDefaultOptions=function(){return{width:280,fadeInTime:1e3,fadeOutTime:1e3,toastTime:5e3}};a.prototype.toast=function(d,a){if(typeof a==="undefined")a=l.Info;var c=this;this._ensureNoActiveToast();this._toasting=true;this._messageArea.setMessage(d,a);var b=this.getElement();b.fadeIn(this._fadeInTime);this._delayedFunction=f.delay(this,this._toastTime,function(){b.fadeOut(c._fadeOutTime,function(){c._toasting=false})})};a.prototype._ensureNoActiveToast=function(){if(this._toasting){this.getElement().stop().hide();this._delayedFunction.cancel()}};return a}(c.BaseControl);g.ToastNotification=jb;var w=function(){function b(c,b){this.combo=c;this._options=b||{};this._onForceHideDropPopupDelegate=a(this,this.onForceHideDropPopup)}b.prototype.initialize=function(){this._options.source&&this.setSource(this._options.source)};b.prototype.dispose=function(){this.hideDropPopup()};b.prototype.isDropVisible=function(){return this._dropPopup};b.prototype.setMode=function(a){this._options.mode=a};b.prototype.canType=function(){return true};b.prototype.getDataSource=function(){return this._dataSource};b.prototype.getDropOptions=function(){return $.extend({combo:this.combo,anchor:this.combo.getElement(),host:this.combo.getElement(),width:this.getDropWidth(),dropElementAlign:"left-top",dropBaseAlign:"left-bottom",dataSource:this._dataSource},this._options.dropOptions)};b.prototype.getDropWidth=function(){return this.combo.getElement().outerWidth()};b.prototype.showDropPopup=function(){var b=this._options.dropControlType,a;this._dropPopup&&this.hideDropPopup();if(b){a=this.getDropOptions();a.width=this.getDropWidth();this._attachGlobalEvents();this._dropPopup=c.BaseControl.createIn(b,a.host||$(document.body),a);this._options.dropShow&&this._options.dropShow(this._dropPopup);return true}return false};b.prototype.hideDropPopup=function(){if(this._dropPopup){this._detachGlobalEvents();if(!this._options.dropHide||this._options.dropHide(this._dropPopup)){this._dropPopup.dispose();this._dropPopup=null;return true}this._dropPopup=null}return false};b.prototype.toggleDropDown=function(){if(this._dropPopup)this.hideDropPopup();else this.showDropPopup()};b.prototype.setSource=function(a){this._dataSource&&this._dataSource.setSource(a)};b.prototype.getSelectedIndex=function(){return-1};b.prototype.setSelectedIndex=function(){};b.prototype.getText=function(){return this.combo.getInputText()};b.prototype.setText=function(a,b){typeof a!=="undefined"&&this.combo.setInputText(a,b)};b.prototype.upKey=function(){};b.prototype.downKey=function(a){if(a.altKey)if(this.showDropPopup())return false};b.prototype.pageUpKey=function(){};b.prototype.pageDownKey=function(){};b.prototype.leftKey=function(){};b.prototype.rightKey=function(){};b.prototype.keyDown=function(){};b.prototype.keyPress=function(){};b.prototype.keyUp=function(){};b.prototype.onForceHideDropPopup=function(){this.hideDropPopup()};b.prototype._attachGlobalEvents=function(){this.combo._bind(this.combo.getElement().parents(),"scroll",this._onForceHideDropPopupDelegate);n.attachEvent("dialog-move",this._onForceHideDropPopupDelegate)};b.prototype._detachGlobalEvents=function(){this.combo._unbind(this.combo.getElement().parents(),"scroll",this._onForceHideDropPopupDelegate);n.detachEvent("dialog-move",this._onForceHideDropPopupDelegate)};return b}();g.BaseComboBehavior=w;h.initClassPrototype(w,{combo:null,_options:null,_dropPopup:null,_dataSource:null,_onForceHideDropPopupDelegate:null});var y=function(c){__extends(b,c);function b(a){c.call(this,a);this.combo=this._options.combo}b.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({coreCssClass:"combo-drop-popup"},a))};b.prototype.initialize=function(){this._bind("mousedown",a(this,this._onMouseDown));this.setPosition();c.prototype.initialize.call(this)};b.prototype.setPosition=function(){i.Positioning.position(this._element,this._options.anchor,{elementAlign:this._options.dropElementAlign,baseAlign:this._options.dropBaseAlign})};b.prototype._onMouseDown=function(){this.combo.blockBlur()};return b}(c.BaseControl);g.BaseComboDropPopup=y;h.initClassPrototype(y,{combo:null});var O={},j=function(c){__extends(b,c);function b(a){c.call(this,a)}b._typeName="tfs.combo";b.registerBehavior=function(a,b){O[a]=b};b.attachBehavior=function(b,c){var a=O[b._options.type];if(b._options.type)a=O[b._options.type];else a=w;return a?new a(b,c):null};b.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({allowEdit:true,type:"list",treeLevel:1,mode:"drop",dropWidth:"dynamic",dropCount:8,invalidCss:"invalid",disabledCss:"disabled",dropButtonHoverCss:"hover",inputCss:undefined,coreCssClass:"combo"},a))};b.prototype._dispose=function(){if(this._behavior){$.isFunction(this._behavior.dispose)&&this._behavior.dispose();this._behavior=null}c.prototype._dispose.call(this)};b.prototype._createIn=function(a){c.prototype._createIn.call(this,a);this._input=$(d("input")).attr("type","text");this._options.id&&this._input.attr("id",this._options.id+"_txt");if(typeof this._options.value!=="undefined"){this._input.val(this._options.value);this._currentText=this.getInputText()}this._decorate()};b.prototype._enhance=function(a){this._createElement();this._input=a;a.after(this._element);this._decorate();this._currentText=this.getInputText()};b.prototype.initialize=function(){this._ensureBehavior();c.prototype.initialize.call(this)};b.prototype.getBehavior=function(){return this._behavior};b.prototype.getText=function(){return this._behavior.getText()};b.prototype.setText=function(b,a){return this._behavior.setText(b,a)};b.prototype.getInput=function(){return this._input};b.prototype.getInputText=function(){return this._input.val()};b.prototype.setInputText=function(a,b){this._input.val(a);this._input.attr("title",a);if(b)this.fireChangeIfNecessary(a);else this._currentText=a};b.prototype.getSelectedIndex=function(){return this._behavior.getSelectedIndex()};b.prototype.setSelectedIndex=function(a,b){this._behavior.setSelectedIndex(a,b)};b.prototype.fireChangeIfNecessary=function(a){if(typeof a==="undefined")a=this.getText();if(this._currentText!==a){this._currentText=a;this._input.attr("title",a);return this._fireChange()}};b.prototype.toggleDropDown=function(){this._behavior.toggleDropDown();this._input.focus();this._fire("dropDownToggled",{isDropVisible:this._behavior.isDropVisible(),target:this._element})};b.prototype.showDropPopup=function(){this._behavior.showDropPopup();this._input.focus()};b.prototype.hideDropPopup=function(){return this._behavior.hideDropPopup()};b.prototype.blockBlur=function(){this._blockBlur=true;this.delayExecute("blockBlur",200,true,function(){this.cancelBlockBlur()})};b.prototype.cancelBlockBlur=function(){this._blockBlur=false;this.cancelDelayedFunction("blockBlur")};b.prototype._onInputKeyDown=function(a){if(this._behavior.keyDown(a)===false)return false;switch(a.keyCode){case k.PAGE_UP:return this._options.enabled?this._behavior.pageUpKey(a):false;case k.UP:return this._options.enabled?this._behavior.upKey(a):false;case k.PAGE_DOWN:return this._options.enabled?this._behavior.pageDownKey(a):false;case k.DOWN:return this._options.enabled?this._behavior.downKey(a):false;case k.LEFT:return this._options.enabled?this._behavior.leftKey(a):false;case k.RIGHT:return this._options.enabled?this._behavior.rightKey(a):false;case k.TAB:this.cancelBlockBlur();break;case k.ENTER:case k.ESCAPE:this.fireChangeIfNecessary();if(this.hideDropPopup())return false;break;default:if(!this._behavior.canType())return false}};b.prototype.setTextSelection=function(c){var b,a=this._input[0];if(a.setSelectionRange)a.setSelectionRange(c,a.value.length);else if(a.createTextRange){b=a.createTextRange();b.moveStart("character",c);b.select()}};b.prototype.setSource=function(a){this._behavior.setSource(a)};b.prototype.getEnabled=function(){return this._options.enabled===true};b.prototype.setEnabled=function(a){this._options.enabled=a===true;this._updateStyles()};b.prototype.getMode=function(){return this._options.mode};b.prototype.setMode=function(a){this._options.mode=a;this._behavior.setMode(a);this._updateStyles()};b.prototype.setType=function(a){if(this._options.type!==a){this.hideDropPopup();this._element.removeClass(this._options.type);this._options.type=a;this._ensureBehavior();this._updateStyles()}};b.prototype.setInvalid=function(a){this._element.toggleClass(this._options.invalidCss,a)};b.prototype._ensureBehavior=function(){if(this._behavior){$.isFunction(this._behavior.dispose)&&this._behavior.dispose();this._behavior=null}this._behavior=b.attachBehavior(this,this._options);this._behavior.initialize();if(!this._behavior)throw Error.create(f.StringUtils.format("Unsupported combo behavior '{0}'.",this._options.type));};b.prototype._decorate=function(){var g=this,c=this._options,e=this._element,b=this._input,f;e.val=function(){return!arguments.length?g.getText():g.setText(arguments[0],false)};b.attr("autocomplete","off");this._bind("mousedown",a(this,this._onMouseDown));this._bind(b,"keydown",a(this,this._onInputKeyDown));this._bind(b,"keypress",a(this,this._onInputKeyPress));this._bind(b,"keyup",a(this,this._onInputKeyUp));this._bind(b,"focus",a(this,this._onInputFocus));this._bind(b,"blur",a(this,this._onInputBlur));this._bind(b,"click",a(this,this._onInputClick));if(!c.allowEdit){b.attr("readonly",true);e.addClass("no-edit")}c.inputCss&&b.addClass(c.inputCss);b.bind("change input",function(){return g.fireChangeIfNecessary()});c.noDropButton&&e.addClass("no-background");f=$(d("div","wrap"));f.append(b);this._options.label&&this._options.id&&f.append($(d("label","hidden")).append(this._options.label).attr("For",b.attr("id")));if(c.iconCss){$(d("div","preWrapIcon")).addClass(c.iconCss).appendTo(e);f.addClass("withIcon")}e.append(f);this.$dropButton=$(d("div","drop"));this._bind(this.$dropButton,"mouseenter",function(){$(this).addClass(c.dropButtonHoverCss)});this._bind(this.$dropButton,"mouseleave",function(){$(this).removeClass(c.dropButtonHoverCss)});this._bind(this.$dropButton,"click",a(this,this._onDropButtonClick));e.append(this.$dropButton);this._updateStyles()};b.prototype._updateStyles=function(){var c=this._element,d=this._input,a,b;c.addClass(this._options.type);a=this._options.enabled;if(a&&this._options.allowEdit)d.removeAttr("readonly");else d.attr("readonly",true);d.toggleClass(this._options.disabledCss,!a);b=a&&this._options.mode==="drop";c.toggleClass("drop",b&&!this._options.noDropButton);c.toggleClass("text",!b)};b.prototype._onDropButtonClick=function(){this.toggleDropDown();return false};b.prototype._onInputClick=function(){!this._options.allowEdit&&this._options.enabled&&this.toggleDropDown();return false};b.prototype._onInputFocus=function(){!this._blockBlur&&this._input.select();$.isFunction(this._options.focus)&&this._options.focus.apply(this,arguments)};b.prototype._onInputBlur=function(){if(!this._disposed){this.fireChangeIfNecessary();if(this._blockBlur){this._input.focus(10);this._blockBlur=false}else this.hideDropPopup();$.isFunction(this._options.blur)&&this._options.blur.apply(this,arguments)}};b.prototype._onMouseDown=function(){this.blockBlur()};b.prototype._onInputKeyPress=function(a){return this._behavior.keyPress(a)};b.prototype._onInputKeyUp=function(b){var a=this._behavior.keyUp(b);this.fireChangeIfNecessary();return a};return b}(c.BaseControl);g.Combo=j;h.initClassPrototype(j,{_dropPopup:null,_input:null,$dropButton:null,_behavior:null,_blockBlur:false,_currentText:""});c.Enhancement.registerJQueryWidget(j,"comboList",{type:"list"});c.Enhancement.registerJQueryWidget(j,"comboTree",{type:"tree"});var u=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({itemCss:""},a))};a.prototype.initialize=function(){this.dataSource=this._options.dataSource;this.virtualizingListView=c.Enhancement.enhance(c.VirtualizingListView,this._element,$.extend(ab(this._options,["coreCssClass"]),{maxRowCount:this._options.dropCount}));b.prototype.initialize.call(this)};a.prototype.selectPrev=function(a){return this.virtualizingListView.selectPrev(a)};a.prototype.selectNext=function(a){return this.virtualizingListView.selectNext(a)};a.prototype.getSelectedIndex=function(){return this.virtualizingListView.getSelectedIndex()};a.prototype.getSelectedValue=function(){return this.dataSource.getItemText(this.virtualizingListView.getSelectedIndex())};a.prototype.setSelectedValue=function(a){var b=a?this.dataSource.getItemIndex(a):-1;this.virtualizingListView.setSelectedIndex(b)};return a}(y);g.ComboListDropPopup=u;h.initClassPrototype(u,{virtualizingListView:null,dataSource:null});var x=function(e){__extends(d,e);function d(b,a){e.call(this,b,$.extend({dropControlType:u},a))}d.prototype.initialize=function(){this._dataSource=this._createDataSource();e.prototype.initialize.call(this)};d.prototype.setSource=function(a){e.prototype.setSource.call(this,a);this._maxItemLength=null};d.prototype.getDropOptions=function(){return $.extend(e.prototype.getDropOptions.call(this),{selectedIndex:this._dataSource.getItemIndex(this.combo.getText()),selectionChange:a(this,this._dropSelectionChanged)})};d.prototype.getMaxItemLength=function(){var a,e,d,b=0,c=this._dataSource;if(this._maxItemLength===null){d=c.getCount(true);for(a=0;a<d;a++){e=c.getItemText(a,true,true);b=Math.max(e.length,b)}this._maxItemLength=b}return this._maxItemLength};d.prototype.getDropWidth=function(){var b,a;b=e.prototype.getDropWidth.call(this);a=this.getMaxItemLength()*i.Measurement.getUnitEx();a*=1.2;return Math.max(b,a)};d.prototype.getSelectedIndex=function(a){return this._dataSource.getItemIndex(a||this.getText(),false)};d.prototype.setSelectedIndex=function(a,b){this._setSelectedIndex(a,b)};d.prototype.setText=function(b,a){var c;if(a)c=b!==this.getText();e.prototype.setText.call(this,b,a);if(a&&c)this._options.indexChanged&&this._options.indexChanged.call(this,this.getSelectedIndex(b))};d.prototype.upKey=function(a){if(this._options.mode!=="text")return e.prototype.upKey.call(this,a)===false?false:this.selectPrev()};d.prototype.downKey=function(a){if(this._options.mode!=="text")return e.prototype.downKey.call(this,a)===false?false:this.selectNext()};d.prototype.pageUpKey=function(a){if(this._options.mode!=="text")return e.prototype.pageUpKey.call(this,a)===false?false:this.selectPrev(true)};d.prototype.pageDownKey=function(a){if(this._options.mode!=="text")return e.prototype.pageDownKey.call(this,a)===false?false:this.selectNext(true)};d.prototype.keyDown=function(a){if(this._options.mode!=="text")if(a.keyCode===229)this._enableAutoFill=false;else if(a.ctrlKey&&(a.keyCode===89||a.keyCode===90))return false};d.prototype.keyPress=function(){if(this._options.mode!=="text"){if(typeof this._options.autoComplete==="undefined")this._enableAutoFill=true;else this._enableAutoFill=this._options.autoComplete;return true}};d.prototype.keyUp=function(b){var a;if(this._options.mode!=="text"){a=b.keyCode||b.charCode;if(this._enableAutoFill){(a>=47||a===k.SPACE)&&this._tryAutoFill();this._enableAutoFill=false}return true}};d.prototype.selectPrev=function(b){var a;if(this._dropPopup){if(this._dropPopup.selectPrev(b))return false}else if(!b){a=this._dataSource.nextIndex(this.getSelectedIndex(),-1,true);if(a>=0){this._setSelectedIndex(a,true);return false}}};d.prototype.selectNext=function(b){var a;if(this._dropPopup){if(this._dropPopup.selectNext(b))return false}else if(!b){a=this._dataSource.nextIndex(this.getSelectedIndex(),1,true);if(a>=0){this._setSelectedIndex(a,true);return false}}};d.prototype._createDataSource=function(){return new c.ListDataSource(this._options)};d.prototype._dropSelectionChanged=function(c,b){var a=this._dropPopup.getSelectedValue();this.setText(a,true);b&&this.hideDropPopup()};d.prototype._setSelectedIndex=function(a,b){this.setText(this._dataSource.getItemText(a,true),b)};d.prototype._tryAutoFill=function(){var d,c,a;b.logTracePoint("Combo._tryAutoFill.start");c=this.combo.getText();d=this._dataSource.getItemIndex(c,true,true);if(d>=0)a=this._dataSource.getItemText(d,true);if(a){this.combo.setText(a,true);this.combo.setTextSelection(c.length)}this._dropPopup&&this._dropPopup.setSelectedValue(a);b.logTracePoint("Combo._tryAutoFill.complete")};return d}(w);g.ComboListBehavior=x;h.initClassPrototype(x,{_enableAutoFill:false,_maxItemLength:null});j.registerBehavior("list",x);var W=function(c){__extends(b,c);function b(a){c.call(this,a)}b.prototype.initializeOptions=function(b){c.prototype.initializeOptions.call(this,$.extend({cssClass:"tree",createItem:a(this,this._createItem),itemClick:a(this,this._onItemClick)},b))};b.prototype.expandNode=function(){var a=this._getSelectedNode();if(a&&a.hasChildren()&&!a.expanded){this.dataSource.expandNode(a);this.virtualizingListView.update();return true}return false};b.prototype.collapseNode=function(){var a=this._getSelectedNode();if(a&&a.hasChildren()&&a.expanded){this.dataSource.collapseNode(a);this.virtualizingListView.update();return true}return false};b.prototype._createItem=function(e){var a=this.dataSource.getItem(e),c,b;c=$(d("li",this._options.nodeCss));a.hasChildren()&&c.addClass(a.expanded?"expanded":"collapsed");b=$(d("div","node-content")).css("padding-left",a.level(true)*10);$(d("span","node-img icon")).appendTo(b);this._options.showIcons&&a.icon&&$(d("span",a.icon)).appendTo(b);b.append($(d("span","text")).text(a.text||"").attr("title",a.text||""));c.append(b);return c};b.prototype._onItemClick=function(e,b,c){var a;if(c.hasClass("node-img")){a=this.dataSource.getItem(b);if(a.hasChildren()){if(a.expanded)this.dataSource.collapseNode(a);else this.dataSource.expandNode(a);this.virtualizingListView.update();return false}}};b.prototype._getSelectedNode=function(){return this.dataSource.getItem(this.virtualizingListView.getSelectedIndex())};return b}(u);g.ComboTreeDropPopup=W;var Y=function(b){__extends(a,b);function a(c,a){b.call(this,c,$.extend({dropControlType:W,sepChar:"\\",treeLevel:2},a))}a.prototype.canType=function(){return!this._dropPopup};a.prototype.leftKey=function(){if(this._dropPopup){this._dropPopup.collapseNode();return false}};a.prototype.rightKey=function(){if(this._dropPopup){this._dropPopup.expandNode();return false}};a.prototype.keyUp=function(a){return this._dropPopup?false:b.prototype.keyUp.call(this,a)};a.prototype._createDataSource=function(){return new c.TreeDataSource(this._options)};return a}(x);g.ComboTreeBehavior=Y;j.registerBehavior("tree",Y);var gb=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({message:"Input value is not allowed!"},a))};a.prototype.isValid=function(){var b=$.trim(this.getValue()),a;if(b){a=c.Enhancement.getInstance(j,this._element);if(a)return a.getSelectedIndex()>=0}return true};return a}(pb.BaseValidator);g.ComboControlValidatior=gb;var o=function(){function a(a){this._setDate(a||new Date)}a.DAY_IN_MILLISECONDS=864e5;a.DAYS_IN_A_WEEK=7;a.toGregorian=function(c,b,d){var a=Sys.CultureInfo.CurrentCulture.dateTimeFormat.Calendar.convert;return a?a.toGregorian(c,b,d):new Date(c,b,d)};a.fromGregorian=function(b){var a=Sys.CultureInfo.CurrentCulture.dateTimeFormat.Calendar.convert;if(a)return a.fromGregorian(b)};a.prototype.getBaseDate=function(){return this._baseDate};a.prototype.setTime=function(a){a=a instanceof Date?a:new Date(a);this._setDate(a)};a.prototype.getTime=function(){return this.getBaseDate().getTime()};a.prototype.getDay=function(){return this.getBaseDate().getDay()};a.prototype.getFullYear=function(a){return a===true&&this._convertedDate?this._convertedDate[0]:this.getBaseDate().getFullYear()};a.prototype.getMonth=function(a){return a===true&&this._convertedDate?this._convertedDate[1]:this.getBaseDate().getMonth()};a.prototype.getDate=function(a){return a===true&&this._convertedDate?this._convertedDate[2]:this.getBaseDate().getDate()};a.prototype.jumpToMonthStart=function(){var e,c,d,b;e=this.getFullYear();c=this.getMonth();d=this.getDate();b=new a(new Date(e,c,d,12));this.setTime(b.getTime()-a.DAY_IN_MILLISECONDS*(b.getDate(true)-1));return this};a.prototype.jumpToWeekStart=function(){var c,b;b=Sys.CultureInfo.CurrentCulture.dateTimeFormat.FirstDayOfWeek;c=(a.DAYS_IN_A_WEEK-b+this.getDay())%a.DAYS_IN_A_WEEK;this.setTime(this.getTime()-c*a.DAY_IN_MILLISECONDS);return this};a.prototype.nextDay=function(){this.setTime(this.getTime()+a.DAY_IN_MILLISECONDS);return this};a.prototype.prevMonth=function(){this._increment(0,-1);return this};a.prototype.nextMonth=function(){this._increment(0,1);return this};a.prototype.prevYear=function(){this._increment(-1,0);return this};a.prototype.nextYear=function(){this._increment(1,0);return this};a.prototype.equals=function(a){return this.getFullYear()===a.getFullYear()&&this.getMonth()===a.getMonth()&&this.getDate()===a.getDate()};a.prototype._setDate=function(b){this._baseDate=b;this._convertedDate=a.fromGregorian(b)};a.prototype._increment=function(e,d){var b=this.getMonth(true),c=this.getFullYear(true);if(d>0){if(++b>11){b=0;c++}}else if(d<0)if(--b<0){b=11;c--}c+=e;this.setTime(a.toGregorian(c,b,1))};return a}();h.initClassPrototype(o,{_baseDate:null,_convertedDate:null});var P=function(c){__extends(b,c);function b(a){c.call(this,a)}b.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({coreCssClass:"date-panel",canTakeFocus:false},a))};b.prototype.initialize=function(){this._selectedDate=this._options.selectedDate;this._date=this._selectedDate||f.DateUtils.getNowInUserTimeZone();this._bind("click",a(this,this._onClick));this._bind("keydown",a(this,this._onKeyDown));this._draw(this._date,"prev-month");c.prototype.initialize.call(this)};b.prototype.prevMonth=function(){var a=new o(this._date);this._date=a.prevMonth().getBaseDate();this._draw(this._date,"prev-month")};b.prototype.nextMonth=function(){var a=new o(this._date);this._date=a.nextMonth().getBaseDate();this._draw(this._date,"next-month")};b.prototype.prevYear=function(){var a=new o(this._date);this._date=a.prevYear().getBaseDate();this._draw(this._date,"prev-year")};b.prototype.nextYear=function(){var a=new o(this._date);this._date=a.nextYear().getBaseDate();this._draw(this._date,"next-year")};b.prototype.selectDate=function(a){this.setSelectedDate(a);this._options.onSelectDate&&this._options.onSelectDate()};b.prototype.setSelectedDate=function(a){this._selectedDate=this._date=a;this._draw(this._selectedDate);this._fireChange()};b.prototype.getSelectedDate=function(){return this._selectedDate};b.prototype._draw=function(g,d){var i=this._element,h=this._options.todayFormat||"d",c,a,b;c=$("<table />").attr("cellSpacing",0).attr("cellPadding",0).attr("border",0);a=$("<tr />").addClass("quick-nav");$("<a />").addClass("prev-month").attr("href","#").attr("tabindex",0).append($("<span/>").addClass("icon icon-drop-left")).appendTo($("<td/>").addClass("prev-month").appendTo(a));b=$("<td/>").addClass("month-year").appendTo(a);b.text(f.DateUtils.localeFormat(g,"y",true));$("<a />").addClass("next-month").attr("href","#").attr("tabindex",0).append($("<span/>").addClass("icon icon-drop-right")).appendTo($("<td/>").addClass("next-month").appendTo(a));c.append(a);a=$("<tr />");b=$("<td />").attr("colspan",6).addClass("days");b.append(this._drawCalendarTable(g));a.append(b);c.append(a);a=$("<tr />");b=$("<td />").attr("colspan",6).addClass("legend");$("<a />").addClass("today").attr("href","#").attr("tabindex",0).append($("<span/>").addClass("today")).append(f.StringUtils.format(e.TodayTitle,f.DateUtils.localeFormat(new Date,h))).appendTo(b);a.append(b);c.append(a);i.empty().append(c);d&&this._options.canTakeFocus&&$("."+d).focus()};b.prototype._drawCalendarTable=function(i){var b,h,e,d,a,c,g,k=f.DateUtils.getTodayInUserTimeZone(),j=Sys.CultureInfo.CurrentCulture.dateTimeFormat;b=new o(i);h=b.getMonth(true);b.jumpToMonthStart();b.jumpToWeekStart();e=$("<table />").attr("cellSpacing",0).attr("border",0);d=$("<tr />").addClass("day-names");for(c=0;c<7;c++){a=$("<td />");a.text(j.ShortestDayNames[(j.FirstDayOfWeek+c)%o.DAYS_IN_A_WEEK]);d.append(a)}e.append(d);for(c=0;c<6;c++){d=$("<tr />").addClass("days");for(g=0;g<o.DAYS_IN_A_WEEK;g++){a=$("<td />").addClass("date-cell");$("<a />").addClass("date").attr("href","#").attr("tabindex",0).data("date",b.getTime()).text(b.getDate(true)).appendTo(a);b.getMonth(true)!==h&&a.addClass("other-month");b.equals(k)&&a.addClass("today");if(this._selectedDate instanceof Date){if(b.equals(this._selectedDate)){a.addClass("selected");this._options.canTakeFocus&&a.focus()}}else if(b.equals(i)){this._options.canTakeFocus&&a.focus();a.addClass("selected")}d.append(a);b.nextDay()}e.append(d)}return e};b.prototype._onKeyDown=function(a){return a.keyCode===i.KeyCode.ENTER||a.keyCode===i.KeyCode.SPACE?this._onClick(a):a.keyCode===i.KeyCode.LEFT||a.keyCode===i.KeyCode.RIGHT||a.keyCode===i.KeyCode.UP||a.keyCode===i.KeyCode.DOWN?false:void 0};b.prototype._onClick=function(d){var c,a,b;c=$(d.target);a=c.closest("a");if(a.length){if(a.hasClass("prev-month"))this.prevMonth();else if(a.hasClass("next-month"))this.nextMonth();else if(a.hasClass("prev-year"))this.prevYear();else if(a.hasClass("next-year"))this.nextYear();else if(a.hasClass("today"))this.selectDate(f.DateUtils.getNowInUserTimeZone());else a.hasClass("date")&&this.selectDate(new Date(a.data("date")));return false}else{b=c.closest(".date-cell");if(b.length){this.selectDate(new Date(b.find("a").data("date")));return false}}};return b}(c.BaseControl);g.DatePanel=P;h.initClassPrototype(P,{_date:null,_selectedDate:null});var D=function(d){__extends(b,d);function b(a){d.call(this,a)}b.prototype.initialize=function(){this._selectedDate=this._options.selectedDate;this._datePanel=c.BaseControl.createIn(P,this._element,$.extend(ab(this._options,["coreCssClass"]),{change:a(this,this._onChange)}));d.prototype.initialize.call(this)};b.prototype.getSelectedDate=function(){return this._selectedDate};b.prototype.setSelectedDate=function(a){this._selectedDate=a;this._datePanel&&this._datePanel.setSelectedDate(a)};b.prototype._onChange=function(){this._selectedDate=this._datePanel.getSelectedDate();this._fireChange();return false};return b}(y);g.ComboDateDropPopup=D;h.initClassPrototype(D,{_datePanel:null,_selectedDate:null});var G=function(d){__extends(c,d);function c(b,a){d.call(this,b,$.extend({dropControlType:D,dateTimeFormat:Sys.CultureInfo.CurrentCulture.dateTimeFormat.ShortDatePattern},a))}c.prototype.initialize=function(){d.prototype.initialize.call(this);this._timeValue=this._options.defaultTimeOfDay||0};c.prototype.canType=function(){return this._dropPopup===null||typeof this._dropPopup==="undefined"};c.prototype.getDropOptions=function(){var c=this,b=this.getSelectedDate();if(!b&&this._options.getInitialDate)b=this._options.getInitialDate(this.combo);return $.extend(d.prototype.getDropOptions.call(this),{dropElementAlign:"right-top",dropBaseAlign:"right-bottom",selectedDate:b,onSelectDate:function(){c.hideDropPopup()},change:a(this,this._onChange)})};c.prototype.getDropWidth=function(){return undefined};c.prototype.getSelectedDate=function(){var c=$.trim(this.combo.getText()),a=null,b;if(c){a=f.DateUtils.parseDateString(c,this._options.parseFormat,true);if(a){b=new Date(a.getFullYear(),a.getMonth(),a.getDate());if(this._options.defaultTimeOfDay&&a.getTime()===b.getTime()){a=new Date(a.getTime()+this._options.defaultTimeOfDay);this.setText(f.DateUtils.localeFormat(a,this._options.dateTimeFormat,true),false)}else this._timeValue=a-b}}return a};c.prototype.setSelectedDate=function(a,c){if(typeof c==="undefined")c=true;b.assertParamIsDate(a,"selectedDate");a=new Date(a.getFullYear(),a.getMonth(),a.getDate());a=new Date(a.getTime()+(this._timeValue||0));this.setText(f.DateUtils.localeFormat(a,this._options.dateTimeFormat,true),c)};c.prototype.upKey=function(){if(this._dropPopup){this._dropPopup.setSelectedDate(this._addDays(this._getSelectedDate(),-7));return false}};c.prototype.downKey=function(a){if(d.prototype.downKey.call(this,a)===false)return false;if(this._dropPopup){this._dropPopup.setSelectedDate(this._addDays(this._getSelectedDate(),7));return false}};c.prototype.pageUpKey=function(){var a;if(this._dropPopup){a=this._getSelectedDate();this._dropPopup.setSelectedDate(this._addDays(a,-1*this._getMonthLength(a.getMonth()-1,a.getFullYear())));return false}};c.prototype.pageDownKey=function(){var a;if(this._dropPopup){a=this._getSelectedDate();this._dropPopup.setSelectedDate(this._addDays(a,this._getMonthLength(a.getMonth(),a.getFullYear())));return false}};c.prototype.leftKey=function(){if(this._dropPopup){this._dropPopup.setSelectedDate(this._addDays(this._getSelectedDate(),-1));return false}};c.prototype.rightKey=function(){if(this._dropPopup){this._dropPopup.setSelectedDate(this._addDays(this._getSelectedDate(),1));return false}};c.prototype._onChange=function(){var a=this._dropPopup.getSelectedDate();a&&this.setSelectedDate(a);return false};c.prototype._getSelectedDate=function(){return this._dropPopup.getSelectedDate()||new Date};c.prototype._addDays=function(b,c){var a=new Date;a.setTime(b.getTime()+c*864e5);return a};c.prototype._getMonthLength=function(a,c){var b;a=(a+12)%12+1;switch(a){case 4:case 6:case 9:case 11:return 30;case 2:if(c%4===0){b=new Date(c,1,29);if(b.getMonth()===1)return 29}return 28;default:return 31}};return c}(w);g.ComboDateBehavior=G;h.initClassPrototype(G,{_timeValue:null});j.registerBehavior("date-time",G);c.Enhancement.registerJQueryWidget(j,"comboDateTime",{type:"date-time"});var cb=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({type:"date-time"},a))};return a}(j);g.DatePicker=cb;c.Enhancement.registerJQueryWidget(cb,"datePicker");var U=function(e){__extends(b,e);function b(a){e.call(this,a);this._checkStates={};if(!this._options.id)this._options.id="cmvdp_"+c.getId()}b.prototype.initializeOptions=function(b){e.prototype.initializeOptions.call(this,$.extend({cssClass:"multi-value",createItem:a(this,this._createItem),itemClick:a(this,this._onItemClick)},b))};b.prototype.initialize=function(){var a=this.combo.getText().split(this._options.sepChar),b=this;$.each(a,function(c,a){a=$.trim(a);if(a)b._checkStates[a]=true});e.prototype.initialize.call(this)};b.prototype.getValue=function(){var a=this;return $.map(this.dataSource.getItems(),function(b){if(a._checkStates[b])return b}).join(this._options.joinChar||this._options.sepChar+" ")};b.prototype.toggleCheckbox=function(c){var d=this._options.id+"_cb"+c,a,b;b=this.dataSource.getItemText(c);a=$("#"+d);if(a.attr("checked")){a.attr("checked",false);this._checkStates[b]=false}else{a.attr("checked",true);this._checkStates[b]=true}};b.prototype._createItem=function(c){var b=this.dataSource.getItemText(c),a,e,f=this._options.id+"_cb"+c;a=$(d("li",this._options.nodeCss));e=$("<input />").data("value",b).attr("type","checkbox").attr("id",f).data("index",c).appendTo(a);this._checkStates[b]&&e.attr("checked",true);a.append($(d("label")).attr("for",f).text(b||""));return a};b.prototype._onItemClick=function(g,d,f,e){var c,a,b=this.dataSource.getItemText(d);c=Boolean(this._checkStates[b]);a=Boolean(e.find("input").attr("checked"));this._checkStates[b]=a;c!==a&&this._fireChange()};return b}(u);h.initClassPrototype(U,{_checkStates:null});var fb=function(c){__extends(b,c);function b(b,a){c.call(this,b,$.extend({dropControlType:U,sepChar:",",joinChar:", "},a))}b.prototype.canType=function(){return!this._dropPopup};b.prototype.getDropOptions=function(){return $.extend(c.prototype.getDropOptions.call(this),{sepChar:this._options.sepChar,joinChar:this._options.joinChar,selectedIndex:-1,selectionChange:false,change:a(this,this._onChange)})};b.prototype.keyDown=function(b){var a;if(this._dropPopup)if(b.keyCode===k.SPACE){a=this._dropPopup.getSelectedIndex();if(a>=0){this._dropPopup.toggleCheckbox(a);this.setText(this._dropPopup.getValue(),true)}}};b.prototype._onChange=function(){this.setText(this._dropPopup.getValue(),true);return false};return b}(x);j.registerBehavior("multi-value",fb);var I=function(b){__extends(a,b);function a(a){b.call(this,a)}a.EVENT_CONTENT_EXPANDED="collapsible-panel-expanded";a.EVENT_CONTENT_COLLAPSED="collapsible-panel-collapsed";a._typeName="tfs.collapsiblepanel";a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({collapsed:true,iconCss:"icon",iconCollapseCss:"icon-tree-collapsed",iconExpandCss:"icon-tree-expanded"},a))};a.prototype._createIn=function(a){b.prototype._createIn.call(this,a);this._createControl()};a.prototype._enhance=function(a){var b;this._options.collapsed=a.hasClass("collapsed");this._createElement();this._createControl();a.after(this._element);this.appendContent(a);if(typeof this._options.headerText!=="undefined")this._options.headerText&&this.appendHeaderText(this._options.headerText);else if(typeof this._options.headerContent!=="undefined")this._options.headerContent&&this.appendHeader(this._options.headerContent);else{b=a.attr("title");if(b){if(a.hasClass("header")){a.removeClass("header");this._header.addClass("header")}this.appendHeader(b)}}};a.prototype.replaceHeaderTextIfPresent=function(a){return $("span",this._header).text(a)};a.prototype.appendHeaderText=function(a){return this.appendHeader($(d("span")).text(a))};a.prototype.appendHeader=function(a){this._header.append(a);return this};a.prototype.appendContent=function(b){var c=this._options,a;if($.isFunction(b))if(c.collapsed){if(!this._dynamicContents)this._dynamicContents=[];this._dynamicContents.push(b)}else a=b.call(this);else a=b;if(a){this._content.append(a);this._element.removeClass("collapsed")}return this};a.prototype.isExpanded=function(){return this._options.collapsed?false:true};a.prototype.expand=function(){!this.isExpanded()&&this.toggleExpandedState()};a.prototype.collapse=function(){this.isExpanded()&&this.toggleExpandedState()};a.prototype.toggleExpandedState=function(){var c,h,b=this._options,g,e=this._content,f=this._dynamicContents,d;b.collapsed=!b.collapsed;g=this._$toggleIcon;g.removeClass(b.iconCollapseCss+" "+b.iconExpandCss);g.addClass(b.collapsed?b.iconCollapseCss:b.iconExpandCss);if(b.collapsed){e.hide();b.expandCss&&this._element.removeClass(b.expandCss);this._fire(a.EVENT_CONTENT_COLLAPSED)}else{if(f){for(c=0,h=f.length;c<h;c++){d=f[c];$.isFunction(d)&&e.append(d.apply())}this._dynamicContents=null}e.show();b.expandCss&&this._element.addClass(b.expandCss);this._fire(a.EVENT_CONTENT_EXPANDED)}return false};a.prototype._createControl=function(){var b=this,a=this._options;a.hoverCss&&this._element.hover(function(){$(this).addClass(a.hoverCss)},function(){$(this).removeClass(a.hoverCss)});this._header=$(d("div","tfs-collapsible-header"));a.headerCss&&this._header.addClass(a.headerCss);this._$toggleIcon=$(d("a","tfs-collapsible-collapse")).attr("href","#").addClass(a.iconCss).addClass(a.collapsed?a.iconCollapseCss:a.iconExpandCss).bind("click.CollapsiblePanel",function(){return b.toggleExpandedState()});a.collapseCss&&this._$toggleIcon.addClass(a.collapseCss);this._header.append(this._$toggleIcon);this._element.append(this._header);this._content=$(d("div","tfs-collapsible-content"));a.contentCss&&this._content.addClass(a.contentCss);a.collapsed&&this._content.hide();this._element.append(this._content);return this._element};return a}(c.BaseControl);g.CollapsiblePanel=I;c.Enhancement.registerJQueryWidget(I,"collapsible");c.Enhancement.registerEnhancement(I,".tfs-collapsible");var B=function(g){__extends(a,g);function a(a){g.call(this,a)}a._typeName="tfs.ajaxPanel";a.prototype.initializeOptions=function(a){g.prototype.initializeOptions.call(this,$.extend({cssClass:"ajax-panel",replaceContent:true,cache:true},a))};a.prototype.initialize=function(){var a=this._options.url;g.prototype.initialize.call(this);a&&this.beginLoad(a,this._options.urlParams,this._options.success,this._options.error)};a.prototype._dispose=function(){this._cancelPendingLoad();g.prototype._dispose.call(this)};a.prototype.beginLoad=function(k,j,i,h){var d=this,a,g;b.logTracePoint("AjaxPanel.beginLoad.start");this._cancelPendingLoad();a=new f.Cancelable(this);this._cancelable=a;this._element.empty();if(this._options.showStatusIndicator!==false){g=c.BaseControl.createIn(z,this._element,{center:true,imageClass:"big-status-progress",message:e.Loading});g.start()}S.getHTML(k,j,a.wrap(function(a){d.onLoadCompleted(a);$.isFunction(i)&&i.call(d,a)}),a.wrap(function(b){var a;if($.isFunction(h))a=h.call(d,b)===true;d.onLoadError(b,a)}),{cache:this._options.cache})};a.prototype.onLoadCompleted=function(a){if(this._element&&this._options.replaceContent){this._element.empty();this._element.html(a);c.Enhancement.ensureEnhancements(this._element)}b.logTracePoint("AjaxPanel.beginLoad.complete")};a.prototype.onLoadError=function(c,a){!a&&this.showError(c);b.logTracePoint("AjaxPanel.beginLoad.complete")};a.prototype.showError=function(a){this._element.empty();$(d("div","error")).appendTo(this._element).text(Z(a))};a.prototype._cancelPendingLoad=function(){if(this._cancelable){this._cancelable.cancel();this._cancelable=null}};return a}(c.BaseControl);g.AjaxPanel=B;h.initClassPrototype(B,{_cancelable:false});var C=function(g){__extends(d,g);function d(b){g.call(this,b);this._resizeDelegate=a(this,this._onWindowResize)}d._typeName="tfs.dialog";d._dialogActionInProgress=false;d.beginExecuteDialogAction=function(a){b.assertParamIsFunction(a,"actionDelegate");if(!d._dialogActionInProgress){d._dialogActionInProgress=true;a(function(){d._dialogActionInProgress=false})}};d.create=function(d,a){var b=a&&a.content||$("<div />");a&&a.contentText&&b.text(a.contentText);return c.Enhancement.enhance(d,b,a)};d.show=function(a,b){return this.create(a,$.extend({autoOpen:true},b))};d.prototype.initializeOptions=function(a){g.prototype.initializeOptions.call(this,$.extend({coreCssClass:"dialog",position:"center",widthPct:.8,heightPct:.8,modal:true,draggable:true,resizable:true,autoOpen:false,dynamicSize:true,disposeOnClose:true},a))};d.prototype.initialize=function(){g.prototype.initialize.call(this);var h=this,i=$(window),c;c=$.extend({},this._options);this._bind("dialogdragstart",function(){n.fire("dialog-move",h)});this._options.attachResize&&this._bind("dialogresizestop",a(this,this.onDialogResize));this._options.resizable&&this._bind("dialogresize",a(this,this._onDialogResizing));c.title=f.StringUtils.htmlEncode(this.getTitle());c.close=function(a){h._options.close&&h._options.close.call(this,a);h.onClose(a)};c.open=function(a){h._options.open&&h._options.open.call(this,a);h.onOpen(a)};if(c.dynamicSize){c.width=i.width()*c.widthPct;c.height=i.height()*c.heightPct;n.attachEvent("window-resize",this._resizeDelegate);this._bind("dialogclose",function(){n.fire("dialog-close",h);n.detachEvent("window-resize",h._resizeDelegate)})}if(c.height&&!isNaN(c.height))c.height=Math.min(c.height,i.height());if(c.width&&!isNaN(c.width))c.width=Math.min(1200,c.width,i.width());!c.url&&b.logTracePoint("Dialog.initialize.complete");this._element.dialog(c);this._element.keydown(function(c){var b,d,a;if(c.keyCode===$.ui.keyCode.ENTER){a=$(c.target);if(!c.shiftKey&&a.is("input[type='text']"))if(h._options.defaultButton&&h._options.buttons){b=h._options.buttons[h._options.defaultButton];if(b){d=$("#"+b.id).button("option");!d.disabled&&b.click.apply(this,[c])}return false}if(!a.is("textarea")&&!a.is("a")&&!a.hasClass("propagate-keydown-event"))return false}});this._element.dialog("option","closeText",e.CloseButtonLabelText);d._dialogActionInProgress=false};d.prototype.onLoadCompleted=function(a){g.prototype.onLoadCompleted.call(this,a);this.setInitialFocus();b.logTracePoint("Dialog.initialize.complete")};d.prototype.setInitialFocus=function(){var a=this._options.initialFocusSelector||":visible:tabbable";this._element.find(a).first().focus()};d.prototype.setFormFocusDelayed=function(a){b.assertParamIsObject(a,"$field");f.delay(this,300,function(){a.eq(0).focus().select()})};d.prototype.setTitle=function(a){this._title=a;this._updateTitle()};d.prototype.getTitle=function(){return this._title||this._options.title||this._element.attr("title")||""};d.prototype.getDialogResult=function(){return this._dialogResult};d.prototype.setDialogResult=function(a){this._dialogResult=a};d.prototype.show=function(){this._element.dialog("open")};d.prototype.onOpen=function(){var a;if(!this._options||this._options.hasProgressElement!==false){a=$("<div />").addClass("ui-dialog-titlebar-progress-container").appendTo(this._element.parent().find(".ui-dialog-titlebar"));this._progressElement=$("<div />").addClass("ui-dialog-titlebar-progress-element").appendTo(a);h.globalProgressIndicator.registerProgressElement(this._progressElement)}n.fire("dialog-open",this)};d.prototype.onClose=function(){var a;n.fire("dialog-close",this);this._progressElement&&h.globalProgressIndicator.unRegisterProgressElement(this._progressElement);this._options.disposeOnClose&&this.dispose();a=$(".ui-dialog").slice(-1);a.length&&a.focus()};d.prototype.close=function(){this._element&&this._element.dialog("close")};d.prototype.onDialogResize=function(){};d.prototype._updateTitle=function(){this._initialized&&this._element&&this._element.dialog("option","title",f.StringUtils.htmlEncode(this.getTitle()))};d.prototype._onWindowResize=function(){var b=$(window),a=this._options;this._element.dialog("option",{width:b.width()*a.widthPct,height:b.height()*a.heightPct});this._element.dialog("option",{position:a.position})};d.prototype._onDialogResizing=function(e,a){var d=$(window),b,c;if(!a||!a.position||!a.size)return;b=Math.min(a.size.height,d.height()-a.position.top);c=Math.min(a.size.width,d.width()-a.position.left);(b!==a.size.height||c!==a.size.width)&&this._element.dialog("option",{width:c,height:b})};return d}(B);g.Dialog=C;h.initClassPrototype(C,{_title:null,_dialogResult:null,_resizeDelegate:null,_progressElement:null});var L=function(d){__extends(c,d);function c(a){d.call(this,a);var b;b=this}c._typeName="tfs.modaldialog";c.EVENT_BUTTON_STATUS_CHANGE="buttonStatusChange";c.prototype.initializeOptions=function(b){d.prototype.initializeOptions.call(this,$.extend({coreCssClass:"dialog modal-dialog",modal:true,dynamicSize:false,width:500,height:"auto",defaultButton:"ok",buttons:{ok:{id:"ok",text:b&&b.okText||e.ModalDialogOkButton,click:a(this,this.onOkClick),disabled:"disabled"},cancel:{id:"cancel",text:b&&b.cancelText||e.ModalDialogCancelButton,click:a(this,this.onCancelClick)}}},b))};c.prototype.initialize=function(){this._bind(c.EVENT_BUTTON_STATUS_CHANGE,a(this,this.onButtonStatusChange));this._bind("resultReady",a(this,this.onResultReady));d.prototype.initialize.call(this)};c.prototype.updateOkButton=function(a){this._element&&this._element.trigger(c.EVENT_BUTTON_STATUS_CHANGE,{enabled:a===true})};c.prototype.processResult=function(c){var a=this._options.okCallback;if(c){if($.isFunction(a)){a.call(this,c);b.logTracePoint(this.getTypeName()+".callback-complete")}this.close()}};c.prototype.onOkClick=function(){b.logTracePoint(this.getTypeName()+".OkClicked");this.processResult(this.getDialogResult())};c.prototype.onResultReady=function(b,a){this.processResult(a)};c.prototype.onCancelClick=function(){$.isFunction(this._options.cancelCallback)&&this._options.cancelCallback();this.close()};c.prototype.onButtonStatusChange=function(b,a){this._element.siblings(".ui-dialog-buttonpane").find("#"+(a.button||"ok")).button("option","disabled",a.enabled?"":"disabled")};return c}(C);g.ModalDialog=L;var X=function(c){__extends(a,c);function a(a){c.call(this,a)}a.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({width:400,height:200,resizable:false,cssClass:"confirmation-dialog"},a))};a.prototype.initialize=function(){c.prototype.initialize.call(this);this.$errorContainer=$(d("div")).addClass("confirmation-dialog-error").prependTo(this._element).hide();this.updateOkButton(true)};a.prototype._onSuccess=function(){this._fire("resultReady",true);var a=this._options.successCallback;if($.isFunction(a)){a.apply(this,arguments);b.logTracePoint(this.getTypeName()+".callback-complete")}};a.prototype._onError=function(a){this.$errorContainer.text(a.message).show()};a.prototype.onOkClick=function(a){this.updateOkButton(false);c.prototype.onOkClick.call(this,a)};return a}(L);g.ConfirmationDialog=X;h.initClassPrototype(X,{$errorContainer:null});var M=function(){function a(a){this._options=$.extend({},a);this._init()}a.prototype._init=function(){};a.prototype.appendTo=function(a){this._element.appendTo(a)};return a}();h.initClassPrototype(M,{_options:null,_element:null});var m=function(c){__extends(b,c);function b(a){c.call(this,a)}b.create=function(d,a){var c;switch(a){case"fore-color":case"back-color":break;default:c=new b({name:d,command:a})}return c};b.prototype._init=function(){c.prototype._init.call(this);this._element=$(d("span","richeditor-toolbar-button")).addClass("richeditor-toolbar-"+this._options.command).attr("title",this._options.name).attr("tabindex",0).attr("unselectable","on").hover(function(){$(this).addClass("richeditor-toolbar-hover")},function(){$(this).removeClass("richeditor-toolbar-hover")}).bind("click",a(this,this._onClick)).bind("keydown",a(this,this._onKeyDown))};b.prototype._onClick=function(){this._element.trigger("toolbarButtonClick",{command:this._options.command});return false};b.prototype._onKeyDown=function(a){if(a.keyCode===i.KeyCode.ENTER||a.keyCode===i.KeyCode.SPACE)return this._onClick()};return b}(M),E=function(b){__extends(a,b);function a(a){b.call(this,a);this._buttons=[]}a.create=function(d,c){var b=new a({name:d});switch(d){case"fontstyle":b.addButton(m.create(e.EditorBold,"bold"));b.addButton(m.create(e.EditorItalic,"italic"));b.addButton(m.create(e.EditorUnderline,"underline"));break;case"list":b.addButton(m.create(e.EditorBulletedList,"insertunorderedlist"));b.addButton(m.create(e.EditorNumberedList,"insertorderedlist"));break;case"indentation":b.addButton(m.create(e.EditorDecreaseIndent,"outdent"));b.addButton(m.create(e.EditorIncreaseIndent,"indent"));break;case"hyperlink":b.addButton(m.create(e.EditorCreateLink,"createlink"));b.addButton(m.create(e.EditorRemoveLink,"unlink"));break;default:c&&$.isFunction(c)&&c(b)}return b};a.prototype.addButton=function(a){this._buttons.push(a)};a.prototype.appendTo=function(d){var a,c;b.prototype.appendTo.call(this,d);this._element.empty();for(a=0,c=this._buttons.length;a<c;a++)this._buttons[a].appendTo(this._element)};a.prototype._init=function(){b.prototype._init.call(this);this._element=$(d("div","richeditor-toolbar-group"))};return a}(M);h.initClassPrototype(E,{_buttons:null});var N=function(g){__extends(c,g);function c(a){g.call(this,a);this._customCommandHandlersMap={}}c._typeName="tfs.richeditor";c.INSERT_IMAGE_COMMAND="insertImage";c.IMAGE_AUTOFIT_SCALE_FACTOR=.85;c.prototype.initializeOptions=function(a){g.prototype.initializeOptions.call(this,$.extend({height:"200px",buttonGroups:["fontstyle","hyperlink","list","indentation"]},a))};c.prototype._createIn=function(a){var b=this;g.prototype._createIn.call(this,a);this._textArea=$("<textarea />").appendTo(this._element);if(this._options.id){this._textAreaId=this._options.id+"_txt";this._textArea.attr("id",this._textAreaId).bind("focus",function(){b._textAreaFocus()})}this._decorate()};c.prototype._enhance=function(a){this._createElement();this._textArea=a;a.after(this._element);this._element.append(a);this._decorate()};c.prototype.ready=function(b){var a=this._readyList;if(!this._isReady){if(!a)a=this._readyList=[];a.push(b)}else $.isFunction(b)&&b.call(this)};c.prototype.setEnabled=function(a){this._ensureControlReadiness();this._setEditable(a)};c.prototype.getValue=function(){if(!this._window.document)return"";var b=this._window.document,a="";this._ensureControlReadiness();if(!this._hasWaterMark&&b.body)a=this._normalizeValue(b.body.innerHTML);return a};c.prototype.isEmpty=function(a){return a===""||a==="<br>"||a==="<P>&nbsp;</P>"||a==="<p>&nbsp;</p>"||a==="<br>\r\n"};c.prototype.setValue=function(a){this._ensureControlReadiness();var b=this._window.document;if(b.body){b.body.innerHTML=a;this._trySettingWaterMark(a);this._originalValue=this._currentValue=this._normalizeValue(b.body.innerHTML)}else this._originalValue=this._currentValue=this._normalizeValue(a)};c.prototype.insertImage=function(a){b.assertParamIsString(a,"url");b.logTracePoint("RichEditor.InlineImage.insertion.start");this._ensureControlReadiness();this._window.focus();this._window.document.execCommand(c.INSERT_IMAGE_COMMAND,false,a);this._resizeImageOnLoadComplete(a)};c.prototype._resizeImageOnLoadComplete=function(f,e){var d=$('img[src="'+f+'"]',this._window.document);d.bind("load",a(this,function(){d.width(Math.min(d.width(),$(this._window.document.body).width()*c.IMAGE_AUTOFIT_SCALE_FACTOR));$.isFunction(this._options.change)&&this._options.change();e&&e();b.logTracePoint("RichEditor.InlineImage.insertion.complete")}))};c.prototype.setFieldRequired=function(a){this._fieldRequired=a};c.prototype.setUploadAttachmentApiLoc=function(a){this._uploadAttachmentApi=a};c.prototype.getTextAreaId=function(){return this._textAreaId};c.prototype._pasteImage=function(a){var c=this,b="tfs_ui_controls_common_paste_image_dummy_div",d='<img src = "'+a+'" /><br /><div id="'+b+'"></div>';this._ensureControlReadiness();this._window.focus();i.HtmlInsertionUtils.pasteHtmlAtCaret(d,this._window);this._resizeImageOnLoadComplete(a,function(){var d="div#"+b,a=$(d,c._window.document);if(a.length>0){a[0].scrollIntoView();a.remove()}})};c.prototype._getToolbar=function(){if(!this._toolbar)this._toolbar=this._createToolbar();return this._toolbar};c.prototype._createToolbar=function(){var a,e,b,c=this,f,g;b=$(d("div","richeditor-toolbar")).hide().prependTo(this._element);f=this._options.buttonGroups||[];for(a=0,e=f.length;a<e;a++)E.create(f[a]).appendTo(b);g=this._options.customCommandGroups||[];for(a=0,e=g.length;a<e;a++)c._createToolbarButtonGroup(g[a]).appendTo(b);b.find(".richeditor-toolbar-button").bind("focus",function(a){c._onFocusIn(a)}).bind("blur",function(a){c._explicitFocus=false;c._onFocusOut(a)});$.browser.msie&&i.makeElementUnselectable(b[0]);return b};c.prototype._createToolbarButtonGroup=function(a){b.assertParamIsObject(a,"customGroup");var c=this;return E.create(a.groupName,function(f){var d=a.commands,b,e;for(b=0,e=d.length;b<e;b+=1){c._customCommandHandlersMap[d[b].command]=d[b].execute;f.addButton(m.create(d[b].name,d[b].command))}})};c.prototype._showPanel=function(a,b){a.stop(true,true);if(b===0)a.fadeOut("slow");else{a.css("opacity",typeof b==="number"?b:1);a.fadeIn("slow")}};c.prototype._showToolbar=function(a){t(r,"(richeditor) Showing toolbar (opacity="+a+")");this._showPanel(this._getToolbar(),a)};c.prototype._getNavigator=function(){if(!this._navigator)this._navigator=this._createNavigator().hide();return this._navigator};c.prototype._createNavigator=function(){return $(d("div","richeditor-navigator")).appendTo(this._element)};c.prototype._showNavigator=function(a){if(this._navigator){t(r,"(richeditor) Showing link navigator (opacity="+a+")");this._showPanel(this._navigator,a)}};c.prototype._decorate=function(){var b,c=this._options;this._element.addClass("richeditor-container").addClass("propagate-keydown-event");this._bind("toolbarButtonClick",a(this,this._onToolbarButtonClick));b=$("<iframe />").attr("frameBorder","no").appendTo($(d("div","richeditor-editarea")).appendTo(this._element)).bind("load",a(this,this._initialize));b.attr("src",c.blankPageUrl);this._iframe=b[0];this._textArea.hide()};c.prototype._initialize=function(){this._window=this._iframe.contentWindow;$(this._window.document).ready(a(this,this._onDocumentReady));this._showToolbar(.35)};c.prototype._attachEvents=function(){this._bind(this._iframe,"blur",a(this,this._onFocusOut));this._bind(this._iframe,"focus",a(this,this._onFocusIn));if(!$.browser.msie){this._bind(this._window,"blur",a(this,this._onFocusOut));this._bind(this._window,"focus",a(this,this._onFocusIn))}this._bind(this._window.document,"mouseup",a(this,this._onMouseUp));this._bind(this._window.document,"keyup",a(this,this._onKeyUp));this._bind(this._window.document,"keydown",a(this,this._onKeyDown));this._bind(this._window.document,"keypress",a(this,this._onKeyPress));this._bind(this._window.document,"input",a(this,this._onInput));this._bind(this._window.document,"dblclick",a(this,this._onDblClick));this._bind(this._window.document,"paste",a(this,this._onPaste));$.isFunction(this._options.change)&&this._bind(this._textArea,"change",this._options.change)};c.prototype._detachEvents=function(){this._unbind(this._iframe,"blur");this._unbind(this._iframe,"focus");if(!$.browser.msie){this._unbind(this._window,"blur");this._unbind(this._window,"focus")}this._unbind(this._window.document,"mouseup");this._unbind(this._window.document,"keyup");this._unbind(this._window.document,"paste");$.isFunction(this._options.change)&&this._unbind(this._textArea,"change")};c.prototype._onDblClick=function(e){var b=$(e.srcElement),d,c,a;if(b.is("img")){d=b.attr("src");c=b.attr("alt");a=d.toLowerCase();if(a.indexOf("data")===0)a=c.toLowerCase();this._window.open(a,"_blank")}};c.prototype._onDocumentReady=function(){this._isReady=true;this._window.document.body.innerHTML=this._textArea.val();this._trySettingWaterMark(this._textArea.val());this._setEditable(this._options.enabled!==false);this._processReadyList();this._setFieldRequiredStyle()};c.prototype._trySettingWaterMark=function(a){if(this.isEmpty(a)&&this._options.waterMark){this._window.document.body.innerHTML="<i class='watermark'>"+this._options.waterMark+"</i>";this._hasWaterMark=true}else this._hasWaterMark=false};c.prototype._clearWaterMark=function(){if(this._hasWaterMark){this._window.document.body.innerHTML="";this._hasWaterMark=false}};c.prototype._textAreaFocus=function(){this._iframe.focus()};c.prototype._onFocusIn=function(a){if(!this._explicitFocus){a&&a.currentTarget&&t(r,"(richeditor) focus in "+a.currentTarget.nodeType);this._showToolbar()}this._hasFocus=true;this._clearWaterMark()};c.prototype._onFocusOut=function(a){f.delay(this,250,function(){if(!this._explicitFocus&&!this._hasFocus){this._showToolbar(.35);this._showNavigator(0)}else this._explicitFocus=false});this._hasFocus=false;this._checkModified(a);this._trySettingWaterMark(this.getValue())};c.prototype._onPaste=function(f){var g=f&&f.originalEvent&&f.originalEvent.clipboardData,c,e,d,h,b=null;if(this._uploadAttachmentApi==="")return;if(g){c=g.items;e=this._getImageItem(c);if(e)b=e.getAsFile()}else if(clipboardData){c=clipboardData.files;b=this._getImageItem(c)}if(b&&b.size>0){d=new FileReader;d.onloadend=a(this,this._onFileReadComplete);d.readAsDataURL(b);return false}};c.prototype._getImageItem=function(b){for(var a=0,c=b.length,d,a=0;a<c;a++)if(b[a].type.indexOf("image")===0)return b[a]};c.prototype.getRandomFileName=function(){var a=new Date;return"temp"+a.getTime()+".png"};c.prototype._onFileReadComplete=function(a){if(a.target&&a.target.result){var b={fileName:this.getRandomFileName(),binaryData:a.target.result};this._uploadAttachment(b)}};c.prototype._uploadAttachment=function(b){this._uploadAttachmentApi!==""&&S.postMSJSON(this._uploadAttachmentApi,b,a(this,this._onUploadComplete),a(this,this._onUploadError))};c.prototype._onUploadComplete=function(a){a.attachments.length>0&&this._pasteImage(a.attachments[0].Url)};c.prototype._onUploadError=function(a){alert(a.message)};c.prototype._onMouseUp=function(){this._options.fireOnEveryChange===true&&this._checkModified();this._checkLinkNode()};c.prototype._reTriggerEvent=function(a){if(a)a.target=this._element[0];this._element.trigger(a)};c.prototype._onKeyDown=function(a){this._reTriggerEvent(a);this._keyDownInDocument=true};c.prototype._onKeyPress=function(a){this._reTriggerEvent(a)};c.prototype._onKeyUp=function(a){this._options.fireOnEveryChange===true&&this._checkModified();this._checkLinkNode();this._keyDownInDocument=false;this._reTriggerEvent(a)};c.prototype._onInput=function(){if(!this._keyDownInDocument)this._options.fireOnEveryChange===true&&this._checkModified()};c.prototype._onToolbarButtonClick=function(b,a){t(r,"(richeditor) toolbar click"+this._window.document.readyState);this._explicitFocus=!$.browser.msie&&this._hasFocus;this._executeCommand(a);this._options.fireOnEveryChange===true&&this._checkModified()};c.prototype._getNodeUnderCaret=function(d){var b,c=null,a=this._getTextRange();if(a){if(a.parentElement)b=a.parentElement();else if(a.commonAncestorContainer)b=a.commonAncestorContainer.nodeType===3?a.commonAncestorContainer.parentNode:a.commonAncestorContainer;if(b)c=this._getNodeAncestor(b,d)}return c};c.prototype._getNodeAncestor=function(a,b){b=b.toUpperCase();while(a&&a.tagName!=="BODY"){if(a.tagName===b)return a;a=a.parentNode}return null};c.prototype._getTextRange=function(){var b,a;if(this._window.getSelection){a=this._window.getSelection();if(a.getRangeAt)return a.rangeCount>0?a.getRangeAt(0):null;else{b=this._window.document.createRange();b.setStart(a.anchorNode,a.anchorOffset);b.setEnd(a.focusNode,a.focusOffset);return b}}else if(this._window.document.selection)return this._window.document.selection.createRange()};c.prototype._checkLinkNode=function(){var a=this,b,d=this._options.linkClickHandler;b=this._getNodeUnderCaret("A");function c(g){var h,c,f;if(g&&!a._disposed){c=b.href;f=c.length;if(f>30)c=c.substring(0,15)+"..."+c.substring(f-10,f);t(r,"(richeditor) Displaying link navigator");h=$("<a/>").attr({target:"_blank",href:g,title:b.href}).text(c).click(function(b){var a;if($.isFunction(d))a=d(b);a!==false&&p.ActionManager.performAction(p.CommonActions.ACTION_WINDOW_OPEN,{url:g,target:"_blank"});return false}).focus(function(){$(this).addClass("focus");a._explicitFocus=true}).blur(function(){$(this).removeClass("focus");a._explicitFocus=false;a._onFocusOut()});a._getNavigator().empty().append($("<span/>").text(e.NavigateTo)).append(" ").append(h);a._showNavigator()}else{t(r,"(richeditor) Hiding link navigator");a._showNavigator(0)}}if(b)p.urlHelper.beginTranslateUrl(b.href,this._options,c,function(){c(null)});else c(null)};c.prototype._checkModified=function(){var a=this.getValue();if(this._currentValue!==a||this._options.fireOnEveryChange){this._currentValue=a;this._fireChange(this._textArea);this._setFieldRequiredStyle()}};c.prototype._executeCommand=function(f){var g=f.command,i=null,a=f.args||null,h,c,b,d,j=this;if(g==="createlink"){if($.browser.msie)i=true;else{h=this._getNodeUnderCaret("a");c=prompt(e.EditorEnterAddress,h?h.href:"http://");if(c&&c!=="")a=c;if(a){b=a.toLowerCase();if(b==="http:"||b==="http:/")a="http://";else if(b==="https:"||b==="https:/")a="https://"}}this._explicitFocus=false}!$.browser.msie&&this._window.document.execCommand("useCSS",false,false);d=this._customCommandHandlersMap[g];if($.isFunction(d))d(f,j);else{this._window.focus();this._window.document.execCommand(g,i,a)}};c.prototype._setEditable=function(a){if(this._editable!==a){this._editable=a;if(a){this._window.document.body.contentEditable="true";this._attachEvents()}else{this._window.document.body.contentEditable="false";this._detachEvents()}}};c.prototype._processReadyList=function(){var a=this;if(this._readyList){$.each(this._readyList,function(){$.isFunction(this)&&this.call(a)});delete this._readyList}};c.prototype._ensureControlReadiness=function(){if(!this._isReady)throw e.RichEditorControlNotReadyWarning;};c.prototype._normalizeValue=function(a){return this.isEmpty(a)?"":a};c.prototype._setFieldRequiredStyle=function(){this._iframe&&this._fieldRequired&&$(this._iframe).contents().find("body").toggleClass("invalid",this.getValue()==="")};return c}(c.BaseControl);g.RichEditor=N;h.initClassPrototype(N,{_iframe:null,_window:null,_textArea:null,_isReady:false,_readyList:null,_editable:null,_toolbar:null,_navigator:null,_editor:null,_hasFocus:false,_explicitFocus:false,_keyDownInDocument:false,_customCommandHandlersMap:null,_originalValue:null,_currentValue:null,_textAreaId:null,_hasWaterMark:false,_fieldRequired:null,_uploadAttachmentApi:""});c.Enhancement.registerJQueryWidget(N,"richEditor");var R=function(h){__extends(g,h);function g(b){h.call(this,b);this.rootNode=new c.TreeNode("root");this.rootNode.root=true;this._droppable=b.droppable;this._draggable=b.draggable;this._focusDelegate=a(this,this._onFocus);this._blurDelegate=a(this,this._onBlur);this._dragStartDelegate=a(this,this._onDragStart)}g._typeName="tfs.treeView";g.NODE_DATA_NAME="node-data";g.LEVEL_DATA_NAME="node-level";g.prototype.initializeOptions=function(a){h.prototype.initializeOptions.call(this,$.extend({coreCssClass:"tree-view",showIcons:true,clickToggles:false,clickSelects:true,contextMenu:false,styleFocusElement:true,useEmptyFolderNodes:true},a))};g.prototype.initialize=function(){var c=this;h.prototype.initialize.call(this);this._bind("mouseover",function(e){var d=$(e.target),a,b;a=d.closest("div.node-content, div.node-context-menu");if(a.length>0){b=a.closest("li.node");c._setFocusElement(b)}});this._bind("mouseout",function(){c._setFocusElement(null)});this._bind("click",a(this,this._click));this._bind("contextmenu",a(this,this._onContextMenu));this._bind("keydown",a(this,this._onInputKeyDown));$.isArray(this._options.nodes)&&this.rootNode.addRange(this._options.nodes);this._draw();b.logTracePoint("TreeView.initialize.complete")};g.prototype._draw=function(){this._element.empty();this._drawNode(this.rootNode,this._element,-1)};g.prototype._getNodeElement=function(a){return this._element.find("#tfs_tnli"+a.id).eq(0)};g.prototype._getNode=function(a){return a.data(g.NODE_DATA_NAME)};g.prototype.getSelectedNode=function(){return this._selectedNode};g.prototype.setSelectedNode=function(a,b){if(a&&a.config&&a.config.unselectable)return;if(this._selectedNode)this._selectedNode.selected=false;this._selectedNode=a;if(a){a.selected=true;!b&&this._fire("selectionchanged",{selectedNode:a});this._expandNodeParents(a)}this._updateSelections()};g.prototype.focus=function(){this._selectedNode&&this._getNodeElement(this._selectedNode).children(".node-link").focus()};g.prototype._expandNodeParents=function(d){var a=d,e=this.rootNode,b,c;while(a.parent){a=a.parent;if(a!==e&&!a.expanded){a.expanded=true;b=a}}if(b){b.expanded=false;c=this._getNodeElement(b);this._toggle(b,c)}};g.prototype._updateSelections=function(){var a=this;this._element.find("li.node").each(function(){var c=$(this),b;b=a._getNode(c);c.toggleClass("selected",b.selected)})};g.prototype._updateNode=function(b,a,h){var c,e,f;b.addClass("node");if(!a.root){b.attr("title",a.title||a.text||"").attr("id","tfs_tnli"+a.id);a.draggable&&this._draggable&&b.draggable(this._draggable);a.droppable&&this._droppable&&b.droppable(this._droppable);this._draggable&&this._bind(b,"selectstart",function(a){a.preventDefault()});a.selected&&b.addClass("selected");a.noFocus&&b.addClass("nofocus");a.folder&&b.addClass("folder");a.config&&a.config.css&&b.addClass(a.config.css);if(this._options.contextMenu&&!a.noContextMenu)b.append($(d("div","node-context-menu icon")));else a.noContextMenu&&b.append($(d("div","node-no-context-menu")));c=$("<a />").addClass("node-link");this._draggable&&this._bind(c,"dragstart",this._dragStartDelegate);a.link&&c.attr("href",a.link);if(!a.noFocus){c.attr("tabindex",0);this._bind(c,"focus",this._focusDelegate);this._bind(c,"blur",this._blurDelegate)}e=$("<div />").addClass("node-content").text(a.text||"");this._draggable&&this._bind(e,"dragstart",this._dragStartDelegate);f=4;if(this._options.showIcons&&a.icon){f=0;$("<span />").addClass("icon tree-node-img").addClass(a.icon).prependTo(e)}if(!a.noTreeIcon){f=0;$(d("span","node-img icon")).prependTo(e)}e.css("padding-left",f+h*12);c.append(e);b.append(c)}b.data(g.NODE_DATA_NAME,a);b.data(g.LEVEL_DATA_NAME,h);(a.hasChildren()||a.folder&&this._options.useEmptyFolderNodes)&&this._drawChildren(a,b,h);return e};g.prototype._drawChildren=function(b,c,a){var f,h,i;if(b.root||b.expanded){c.addClass("expanded");f=$(d("ul","tree-children")).attr("id","tfs_tnul"+b.id);if(typeof a==="undefined")a=c.data(g.LEVEL_DATA_NAME);a=a+1;i=b.children.length;if(i===0)this._drawEmptyFolderNode(f,a,b.emptyFolderNodeText||this._options.defaultEmptyFolderNodeText||e.NoItemsInThisFolder);else for(h=0;h<i;h++)this._drawNode(b.children[h],f,a);c.append(f)}else c.addClass("collapsed")};g.prototype._toggle=function(a,b){var c;if(a&&(a.folder||a.hasChildren())){b.removeClass("collapsed expanded");if(a.expanded){c=b.find("ul.tree-children:first");c.remove();a.expanded=false;b.addClass("collapsed")}else{a.expanded=true;this._drawChildren(a,b)}return true}return false};g.prototype._setNodeExpansion=function(a,b,c){return a.expanded!==c?this._toggle(a,b):false};g.prototype.removeNode=function(a){this._getNodeElement(a).remove();a.remove()};g.prototype.updateNode=function(c){var a,b;if(c.root){a=this._element;b=-1}else{a=this._getNodeElement(c);b=a.data(g.LEVEL_DATA_NAME);a.removeClass()}a.draggable("destroy");a.droppable("destroy");a.empty();this._updateNode(a,c,b)};g.prototype.onItemClick=function(a,b){if(this._options.clickToggles)if(this._toggle(a,b))return false;this._options.clickSelects&&this.setSelectedNode(a)};g.prototype.onShowPopupMenu=function(h,a){var g,b,d,e;if(a&&a.items&&a.items.length){b=this._getNodeElement(h);d=b.find("a.node-link, div.node-content[tabIndex]").first()[0];e=b.find("div.node-context-menu");if(this._popupMenu)if(b.hasClass("context-menu-active")){this._popupMenu.popup(d,e);return}else{this._popupMenu.dispose();this._popupMenu=null}g=a.items.slice(0);g.sort(function(a,b){return(a.rank||9999)-(b.rank||9999)});this._popupMenu=c.BaseControl.createIn(bb.PopupMenu,b,{align:a.align||"left-bottom",executeAction:a.executeAction||a.clickHandler,items:[{childItems:g}],onActivate:function(){b.addClass("context-menu-active")},onDeactivate:function(){b.removeClass("context-menu-active")},onPopupEscaped:function(){b.removeClass("context-menu-active")},getCommandState:a.getCommandState,updateCommandStates:a.updateCommandStates,arguments:a.arguments,contextInfo:{item:h,menu:this._popupMenu}});this._popupMenu.getElement().prependTo(b);f.delay(this,10,function(){this._popupMenu.popup(d,e)})}};g.prototype.enableFocusStyling=function(a){if(this._options.styleFocusElement!==a){this._options.styleFocusElement=a;this._setFocusElement(this._focusedNode)}};g.prototype._setFocusElement=function(b){var a=this._options.styleFocusElement;this._focusedNode&&this._focusedNode.length&&this._focusedNode.removeClass("focus");this._focusedNode=b;if(a&&this._focusedNode&&this._focusedNode.length)!this._focusedNode.hasClass("nofocus")&&this._focusedNode.addClass("focus")};g.prototype.getNodeFromElement=function(a){b.assertParamIsNotNull(a,"element");var c=$(a);return this._getNode(c)};g.prototype._drawNode=function(c,b,d){var a;if(c.root)a=b;else a=$("<li />").appendTo(b);this._updateNode(a,c,d)};g.prototype._drawEmptyFolderNode=function(d,e,f){var a,b;b=$("<li />").appendTo(d);a=new c.TreeNode(f);a.isEmptyFolderChildNode=true;a.config.css="info";a.config.unselectable=true;a.noFocus=true;a.noContextMenu=true;this._updateNode(b,a,e)};g.prototype._click=function(b){var a=$(b.target),c=a.closest("li.node");if(c.length>0){this._setFocusElement(c);if(a.closest("span.node-img").length>0)return this._onToggle(b);else if(a.closest("div.node-content").length>0)return this._itemClick(b);else if(a.closest("div.node-context-menu").length>0)return this._onContextMenu(b)}};g.prototype._onInputKeyDown=function(b){var d=$(b.target),a=d.closest("li.node"),c;switch(b.keyCode){case k.RIGHT:return this._setNodeExpansion(this._getNode(a),a,true);case k.LEFT:return this._setNodeExpansion(this._getNode(a),a,false);case k.ENTER:if(!$(".node-link",a).attr("href")){c=this._getNode(a);this.onItemClick(c,a);return false}break;case 121:if(b.shiftKey)return this._onContextMenu()}};g.prototype._onToggle=function(b){var a=$(b.target).parents("li.node:first");this._toggle(this._getNode(a),a);return false};g.prototype._itemClick=function(c){var b=$(c.target).closest("li.node"),a;a=this._getNode(b);return this.onItemClick(a,b,c)};g.prototype._onContextMenu=function(){if(this._options.contextMenu)if(this._focusedNode&&this._focusedNode.length>0){this._showPopupMenu(this._getNode(this._focusedNode));return false}};g.prototype._showPopupMenu=function(c){var a,b;if(c){a=c.contextMenu;if(typeof a!=="undefined")if($.isFunction(a))b=a.call(this,c);else b=a;else b=this._options.contextMenu;this.onShowPopupMenu(c,b)}};g.prototype._onFocus=function(b){var a=$(b.target).closest("li.node");a.length>0&&this._setFocusElement(a);this._element.toggleClass("focus",true);this._hasFocus=true};g.prototype._onBlur=function(){this._setFocusElement(null);this._clearFocusOnElement()};g.prototype._clearFocusOnElement=function(){this._element.toggleClass("focus",false);this._hasFocus=false};g.prototype._onDragStart=function(){return false};return g}(c.BaseControl);g.TreeView=R;h.initClassPrototype(R,{rootNode:null,_focusDelegate:null,_blurDelegate:null,_dragStartDelegate:null,_hasFocus:false,_selectedNode:null,_draggable:null,_droppable:null,_focusedNode:null,_popupMenu:null});c.Enhancement.registerJQueryWidget(R,"treeView");var F=function(g){__extends(e,g);function e(a){g.call(this,a)}e._typeName="tfs.verticalBreadCrumb";e.NODE_DATA_NAME="node-data";e.prototype.initializeOptions=function(a){g.prototype.initializeOptions.call(this,$.extend({coreCssClass:"vertical-bread-crumb"},a))};e.prototype.initialize=function(){var c=this;g.prototype.initialize.call(this);this._draw();this._bind("mouseover",function(e){var d=$(e.target),a,b;a=d.closest("div.node-content, div.node-context-menu");if(a.length>0){b=a.closest("li.node");c._setFocusElement(b)}});this._bind("mouseout",function(){c._setFocusElement(null)});this._bind("click",a(this,this._click));b.logTracePoint("VerticalBreadCrumb.initialize.complete")};e.prototype.setNode=function(a){this._node=a;this._draw()};e.prototype._setFocusElement=function(a){this._focusedNode&&this._focusedNode.length&&this._focusedNode.removeClass("focus");this._focusedNode=a;if(this._focusedNode&&this._focusedNode.length)!this._focusedNode.hasClass("nofocus")&&this._focusedNode.addClass("focus")};e.prototype.onShowPopupMenu=function(h,a){var g,b,d,e;if(a&&a.items&&a.items.length){b=this._focusedNode;d=b.find("div.node-content").first()[0];e=b.find("div.node-context-menu");if(this._popupMenu)if(b.hasClass("context-menu-active")){this._popupMenu.popup(d,e);return}else this._popupMenu.dispose();g=a.items.slice(0);g.sort(function(a,b){return(a.rank||9999)-(b.rank||9999)});this._popupMenu=c.BaseControl.createIn(bb.PopupMenu,b,{align:a.align||"left-bottom",executeAction:a.executeAction||a.clickHandler,items:[{childItems:g}],onActivate:function(){b.addClass("context-menu-active")},onDeactivate:function(){b.removeClass("context-menu-active")},onPopupEscaped:function(){b.removeClass("context-menu-active")}});this._popupMenu.actionArguments=a.actionArguments||{item:h,menu:this._popupMenu};if($.isFunction(a.getActionArguments))this._popupMenu.actionArguments=a.getActionArguments.call(this,this._popupMenu.actionArguments);f.delay(this,10,function(){this._popupMenu.popup(d,e)})}};e.prototype._updateNode=function(){};e.prototype._click=function(c){var b=$(c.target),a=b.closest("li.node");if(a.length>0){this._setFocusElement(a);if(b.closest("div.node-context-menu").length>0)return this._onContextMenu(c)}};e.prototype._onContextMenu=function(){if(this._options.contextMenu)this._focusedNode&&this._focusedNode.length>0&&this._showPopupMenu(this._focusedNode.data(e.NODE_DATA_NAME))};e.prototype._showPopupMenu=function(c){var a,b;if(c){a=c.contextMenu;if(typeof a!=="undefined")if($.isFunction(a))b=a.call(this,c);else b=a;else b=this._options.contextMenu;this.onShowPopupMenu(c,b)}};e.prototype._draw=function(){var a,c,b=0,d=0;this._element.empty();this._ul=$("<ul />");if(this._node){if(this._node.parents){for(a=0,c=this._node.parents.length;a<c;a++)this._drawNode(this._node.parents[a],b,d++);if(c>0)b++}this._drawNode(this._node,b,d++);b++;if(this._node.children)for(a=0,c=this._node.children.length;a<c;a++)this._drawNode(this._node.children[a],b,d++)}this._element.append(this._ul)};e.prototype._drawNode=function(a,f,h){var b,g,i,c;b=$("<li />").attr("title",a.title||a.text||"").addClass("node").appendTo(this._ul);if(h>0)if(f===0)b.addClass("up");else b.addClass("corner");a.selected&&b.addClass("selected");a.config&&a.config.css&&b.addClass(a.config.css);this._options.contextMenu&&$(d("div","node-context-menu icon")).appendTo(b);c=$("<div />").addClass("node-content").css("padding-left",10+f*6).appendTo(b);g=$(d("span","icon")).addClass("bread-crumb").appendTo(c);if(a.link)i=$("<a />").attr("href",a.link).addClass("node-link").appendTo(b).append(c);else{c.appendTo(b);c.attr("tabIndex",0)}c.append(a.text||"");b.data(e.NODE_DATA_NAME,a);this._updateNode(b,a)};return e}(c.BaseControl);g.VerticalBreadCrumb=F;h.initClassPrototype(F,{_node:null,_focusedNode:null,_ul:null,_popupMenu:null});c.Enhancement.registerJQueryWidget(F,"verticalBreadCrumb");var q=function(f){__extends(c,f);function c(a){f.call(this,a)}c._typeName="tfs.splitter";c._noSplitCssClass="no-split";c.CORE_CSS_CLASS="splitter";c.HORIZONTAL_CLASS="horizontal";c.VERTICAL_CLASS="vertical";c.TOGGLE_BUTTON_LENGTH=16;c.TOGGLE_BUTTON_MARGIN=2;c.COLLAPSED_CLASS_NAME="collapsed";c.TOGGLE_BUTTON_ENABLED_CLASS_NAME="toggle-button-enabled";c.TOGGLE_BUTTON_HOTKEY_ENABLED_CLASS_NAME="toggle-button-hotkey-enabled";c.AUTO_COLLAPSE_THRESHOLD=20;c.DEFAULT_ANIMATION_SPEED=800;c.HANDLE_BAR_CLONE_SIZE=5;c.prototype.initializeOptions=function(a){f.prototype.initializeOptions.call(this,$.extend({coreCssClass:"splitter",vertical:true,fixedSide:"left"},a))};c.prototype._enhance=function(a){f.prototype._enhance.call(this,a);this._options.vertical=a.hasClass(c.VERTICAL_CLASS);this.leftPane=this._element.children(".leftPane");this.handleBar=this._element.children(".handleBar");this.rightPane=this._element.children(".rightPane");if(this._element.hasClass("left-expand"))this.expandState="left";else if(this._element.hasClass("right-expand"))this.expandState="right";if(this._element.hasClass("right-fix"))this._options.fixedSide="right";this._options.collapsedLabel&&this.setCollapsedLabel(this._options.collapsedLabel);this._attachEvents()};c.prototype.initialize=function(){f.prototype.initialize.call(this);this._configureCssProps();if(this._options.enableToggleButton||this._isToggleButtonEnabled()){this._ensureToggleButton();this._isToggleButtonHotkeyEnabled()&&this._bind($(window.document),"keyup",a(this,this._onDocumentKeyup))}};c.prototype.setMinWidth=function(a){this._minWidth=a};c.prototype.resize=function(a,h,g){if(this._element.hasClass(c._noSplitCssClass))return;var f,b,d,e;this._element.toggleClass(c.COLLAPSED_CLASS_NAME,false);if(a!==null&&a!==undefined)if(a<0)a=0;else{f=this._element[this._cssSizeProp]()-this.handleBar[this._cssSizeProp]();if(a>f)a=f}if(a===null||a===undefined)b="";else b=a;if(g){e=this._options.animationSpeed||c.DEFAULT_ANIMATION_SPEED;d=this._createAnimationOption(this._cssSizeProp,b+"px");this._fixedSide.animate(d,e);d=this._createAnimationOption(this._cssPosProp,b+"px");this._fillSide.animate(d,e);this.handleBar.animate(d,e)}else{this._fixedSide.css(this._cssSizeProp,b);this._fillSide.css(this._cssPosProp,b);this.handleBar.css(this._cssPosProp,b)}this._fixedSidePixels=a;this._layoutToggleButton(g);!h&&this._fireWindowResize()};c.prototype.toggleExpanded=function(a){if(a===undefined||a!==this.isExpanded()){if(this.expandState)this.removeExpand();else if(this._options.fixedSide==="left")this.expand("right");else this.expand("left");this._element.toggleClass(c.COLLAPSED_CLASS_NAME,!this.isExpanded());this._setToggleButtonTooltip();this._fire("changed",this)}};c.prototype.isExpanded=function(){return!this.expandState};c.prototype.removeExpand=function(a){this._element.removeClass("left-expand");this._element.removeClass("right-expand");this.expandState=null;if(!a)this.resize(this._fixedSidePixels);else{this._layoutToggleButton();this._fireWindowResize()}};c.prototype.expand=function(a){if(!a)a="left";if(a==="left"){this._element.removeClass("right-expand");this._element.addClass("left-expand")}else{this._element.removeClass("left-expand");this._element.addClass("right-expand")}this.expandState=a;this._fixedSide.css(this._cssSizeProp,"");this._fillSide.css(this._cssPosProp,"");this.handleBar.css(this._cssPosProp,"");this._layoutToggleButton();this._fireWindowResize()};c.prototype.getFixedSidePixels=function(){return this._fixedSidePixels};c.prototype.toggleSplit=function(e,d,a){var b;if(e){this._element.removeClass(c._noSplitCssClass);if(this.expandState){this.expand(this.expandState);this._element.addClass(c.COLLAPSED_CLASS_NAME);this._setToggleButtonTooltip()}else if(d){b=this._fixedSidePixels||a;this.resize(0,true,false);this.resize(b,true,true)}else this.resize(this._fixedSidePixels||a)}else{this._element.addClass(c._noSplitCssClass);this._element.removeClass(c.COLLAPSED_CLASS_NAME);this._fixedSide.css(this._cssSizeProp,"");this._fillSide.css(this._cssPosProp,"");this.handleBar.css(this._cssPosProp,"");this._fireWindowResize()}};c.prototype.noSplit=function(){this.toggleSplit(false)};c.prototype.split=function(b,a){this.toggleSplit(true,b,a)};c.prototype.toggleOrientation=function(a,b){a=Boolean(a);if(this._options.vertical!==a){this._element.removeClass("left-expand");this._element.removeClass("right-expand");this.expandState=null;this._fixedSide.css(this._cssSizeProp,"");this._fillSide.css(this._cssPosProp,"");this.handleBar.css(this._cssPosProp,"");this._options.vertical=a;this._element.toggleClass(c.VERTICAL_CLASS,a);this._element.toggleClass(c.HORIZONTAL_CLASS,!a);this._configureCssProps();this.resize(b)}};c.prototype.vertical=function(){this.toggleOrientation(true)};c.prototype.horizontal=function(){this.toggleOrientation(false)};c.prototype.setCollapsedLabel=function(a){var c=this,b;this.handleBar.empty();if(a){b=$(d("div","handlebar-label")).appendTo(this.handleBar).attr("title",a).bind("mousedown",function(a){c.toggleExpanded(true);a.preventDefault()});$(d("span","handlebar-label-text")).appendTo(b).text(a)}};c.prototype._createElement=function(){f.prototype._createElement.call(this);if(this._options.vertical===false)this._element.addClass(c.HORIZONTAL_CLASS);else this._element.addClass(c.VERTICAL_CLASS);if(this._options.expandState){this.expandState=this._options.expandState;this._element.addClass(this.expandState==="left"?"left-expand":"right-expand")}this._options.fixedSide==="right"&&this._element.addClass("right-fix");this.leftPane=$(d("div","leftPane")).appendTo(this._element);this.handleBar=$(d("div","handleBar")).appendTo(this._element);this.rightPane=$(d("div","rightPane")).appendTo(this._element);this._options.collapsedLabel&&this.setCollapsedLabel(this._options.collapsedLabel);this._attachEvents()};c.prototype._configureCssProps=function(){var a=this._leftFix=this._options.fixedSide==="left";if(a){this._deltaMultiplier=1;this._fixedSide=this.leftPane;this._fillSide=this.rightPane}else{this._deltaMultiplier=-1;this._fixedSide=this.rightPane;this._fillSide=this.leftPane}if(this._options.vertical===false){this._screenXY="pageX";this._cssSizeProp="width";this._cssPosProp=a?"left":"right"}else{this._screenXY="pageY";this._cssSizeProp="height";this._cssPosProp=a?"top":"bottom"}if(this._isCollapsed())if(this._options.fixedSide==="left")this.expandState="right";else this.expandState="left"};c.prototype._attachEvents=function(){var b=this;this._bind(this.handleBar,"mousedown",a(this,this._handleBarMouseDown));this._bind(this.handleBar,"dblclick",a(this,this._handleBarDoubleClick));this._bind(this.handleBar,"mouseover",function(){b.handleBar.addClass("hover")});this._bind(this.handleBar,"mouseout",function(){b.handleBar.removeClass("hover")});this._bind(this.handleBar,"selectstart",function(){return false});i.attachResize(this._element,a(this,this._onWindowResize))};c.prototype._ensureToggleButton=function(){var b;if(!this._$toggleButton){b=this._element.find(".toggle-button");if(b.length>0)this._$toggleButton=b;else{this._$toggleButtonIcon=$("<div>").addClass("icon");this._$toggleButton=$("<div>").addClass("toggle-button").attr("tabindex",0).append(this._$toggleButtonIcon).appendTo(this._element)}this._setToggleButtonTooltip();this._layoutToggleButton();this._$toggleButton.click(a(this,this._onToggleButtonClick));this._$toggleButton.keyup(a(this,this._onToggleButtonKeyup))}};c.prototype._layoutToggleButton=function(e){var a,b,d=this.isExpanded();if(!this._$toggleButton)return;if(d){this._measureFixedSide();a=this._fixedSidePixels-(c.TOGGLE_BUTTON_MARGIN+c.TOGGLE_BUTTON_LENGTH)}else a=c.TOGGLE_BUTTON_MARGIN;this._setToggleButtonIconClass(d);if(e){b=this._createAnimationOption(this._cssPosProp,a+"px");this._$toggleButton.animate(b,this._options.animationSpeed||c.DEFAULT_ANIMATION_SPEED)}else this._$toggleButton.css(this._cssPosProp,a)};c.prototype._setToggleButtonIconClass=function(c){b.assertParamIsBool(c,"isExpanded");var a=this._options.vertical?"vertical":"horizontal",d="icon-toggle-button-"+a+"-collapsed",e="icon-toggle-button-"+a+"-expanded",f=c?e:d;this._$toggleButtonIcon.removeClass().addClass(f).addClass("icon")};c.prototype._setToggleButtonTooltip=function(){if(this._$toggleButton)if(this._isCollapsed())this._$toggleButton.attr("title",e.ExpandSplitterTooltip);else this._$toggleButton.attr("title",e.CollapseSplitterTooltip)};c.prototype._measureFixedSide=function(){this._fixedSidePixels=this._cssSizeProp==="width"?this._fixedSide.outerWidth():this._fixedSide.outerHeight()};c.prototype._handleBarMouseDown=function(a){a.preventDefault();this._dragStart={pointer:a[this._screenXY],originalSize:this._isCollapsed()?a[this._screenXY]:this._fixedSide[this._cssSizeProp]()};this._element.addClass("dragging");this._ensureHandleBarClone();this._setupDragEvents();this._ensureOverlay()};c.prototype._isToggleButtonEnabled=function(){return this._element.hasClass(c.TOGGLE_BUTTON_ENABLED_CLASS_NAME)};c.prototype._isToggleButtonHotkeyEnabled=function(){return this._element.hasClass(c.TOGGLE_BUTTON_HOTKEY_ENABLED_CLASS_NAME)};c.prototype._isCollapsed=function(){return this._element.hasClass(c.COLLAPSED_CLASS_NAME)};c.prototype._onToggleButtonKeyup=function(a){b.assertParamIsObject(a,"e");if(a.keyCode===i.KeyCode.ENTER){this.toggleExpanded();return false}};c.prototype._onDocumentKeyup=function(a){b.assertParamIsObject(a,"e");if(a.ctrlKey&&a.altKey&&a.keyCode===i.KeyCode.SPACE)if(this._isToggleButtonHotkeyEnabled()){this.toggleExpanded();return false}};c.prototype._onToggleButtonClick=function(a){b.assertParamIsObject(a,"e");this.toggleExpanded();return false};c.prototype._ensureHandleBarClone=function(){if(!this._$handleBarClone){b.assertIsObject(this._dragStart,"_dragStart");this._$handleBarClone=$("<div>").addClass("handleBar-clone").css(this._cssPosProp,this._dragStart.originalSize+"px").css(this._cssSizeProp,c.HANDLE_BAR_CLONE_SIZE).appendTo(this._element)}};c.prototype._removeHandleBarClone=function(){if(this._$handleBarClone){this._$handleBarClone.remove();this._$handleBarClone=null}};c.prototype._setupDragEvents=function(){this._bind(window.document,"mousemove",a(this,this._documentMouseMove),true);this._bind(window.document,"mouseup",a(this,this._documentMouseUp),true)};c.prototype._ensureOverlay=function(){if(!this._splitterOverlay){this._splitterOverlay=$(d("div","overlay"));this._element.append(this._splitterOverlay);this._bind(this._splitterOverlay,"mousemove",a(this,this._documentMouseMove));this._bind(this._splitterOverlay,"mouseup",a(this,this._documentMouseUp));this._bind(this._splitterOverlay,"selectstart",function(){return false})}};c.prototype._removeOverlay=function(){if(this._splitterOverlay){this._splitterOverlay.remove();this._splitterOverlay=null}};c.prototype._clearDragEvents=function(){this._removeOverlay();this._unbind(window.document,"mousemove");this._unbind(window.document,"mouseup")};c.prototype._documentMouseMove=function(b){var a;if(this._dragStart){a=b[this._screenXY]-this._dragStart.pointer;a&&this._ensureOverlay();this._ensureHandleBarClone();this._$handleBarClone.css(this._cssPosProp,+(this._dragStart.originalSize+this._deltaMultiplier*a)+"px");return false}};c.prototype._documentMouseUp=function(e){var b,d,a;if(this._dragStart){b=e[this._screenXY]-this._dragStart.pointer;if(Math.abs(b)>1){d=true;a=this._dragStart.originalSize+this._deltaMultiplier*b;if(this._minWidth&&this._minWidth>0&&this._minWidth>a)a=this._minWidth;if(this._isToggleButtonEnabled()&&a<=c.AUTO_COLLAPSE_THRESHOLD)this.toggleExpanded(false);else{this.expandState&&this.removeExpand(true);this.resize(a)}}this._dragStart=null;this._element.removeClass("dragging");this._removeHandleBarClone();this._clearDragEvents();d&&this._fire("changed",this);return false}};c.prototype._onWindowResize=function(){if(!this._ignoreWindowResize)!this.expandState&&this.resize(this._fixedSidePixels,true)};c.prototype._fireWindowResize=function(){try{this._ignoreWindowResize=true;$(window).trigger("resize")}finally{this._ignoreWindowResize=false}};c.prototype._createAnimationOption=function(d,a){b.assertParamIsString(d,"cssPropertyName");b.assertParamIsString(a,"cssPropertyValue");var c={};c[d]=a;return c};c.prototype._handleBarDoubleClick=function(){this.toggleExpanded()};c.prototype._dispose=function(){f.prototype._dispose.call(this);i.detachResize(this._element)};return c}(c.BaseControl);g.Splitter=q;h.initClassPrototype(q,{leftPane:null,rightPane:null,handleBar:null,_screenXY:"pageX",_cssPosProp:"left",_cssSizeProp:"width",_leftFix:true,_fixedSide:null,_fillSide:null,_deltaMultiplier:1,_dragStart:false,_fixedSidePixels:null,_splitterOverlay:null,_$handleBarClone:null,_ignoreWindowResize:false,_$toggleButton:null,_$toggleButtonIcon:null,expandState:null});c.Enhancement.registerJQueryWidget(q,q.CORE_CSS_CLASS);c.Enhancement.registerEnhancement(q,"."+q.CORE_CSS_CLASS);var K=function(d){__extends(b,d);function b(a){d.call(this,a)}b._typeName="tfs.checkboxList";b.prototype.initializeOptions=function(a){d.prototype.initializeOptions.call(this,$.extend({coreCssClass:"checkbox-list",tagName:"ul"},a))};b.prototype.enableElement=function(a){d.prototype.enableElement.call(this,a);if(a)this._element.find("input").removeAttr("disabled");else this._element.find("input").attr("disabled","disabled")};b.prototype.setItems=function(a){this._options.items=a;this._draw()};b.prototype.getCheckedValues=function(){var b=[],a;for(a in this._checkedItems)this._checkedItems.hasOwnProperty(a)&&b.push(a);return b};b.prototype.getCheckedItems=function(){var a=this;return $.map(this._options.items||[],function(c){var b;if(typeof c==="string")b=c;else b=c.value||c.text;if(b!==null&&b!==undefined&&b in a._checkedItems)return c})};b.prototype.setCheckedValues=function(d){var a={},c=this,b;$.each(d,function(c,b){a[b]=true});$.each(this.getCheckedValues(),function(d,b){if(b in a)delete a[b];else{c._element.find("#"+c._idMap[b]).attr("checked",false);delete c._checkedItems[b]}});for(b in a)if(a.hasOwnProperty(b)){this._element.find("#"+this._idMap[b]).attr("checked",true);this._checkedItems[b]=true}};b.prototype._initializeElement=function(){if(!this._options.id)this._options.id="cbl_"+c.getId();d.prototype._initializeElement.call(this);this._element.click(a(this,this._onCheckClick));this._draw()};b.prototype._draw=function(){var a=this;this._element.empty();this._checkedItems={};this._idMap={};$.each(this._options.items||[],function(k,d){var b,c,e,h,f,j,i=k,g=a._options.id+"_cb"+i;if(typeof d==="string")b=d;else if(d){b=d.text;c=d.value;e=d.title;h=d.checked}b=b||c;if(c===null||c===undefined)c=b;if(e===null||e===undefined)e=b;if(b!==null&&b!==undefined){f=$("<li />").attr("title",e);j=$("<input />").data("value",c).attr("type","checkbox").attr("id",g).data("index",i).appendTo(f);if(h){j.attr("checked",true);a._checkedItems[c]=true}a._idMap[c]=g;$("<label />").attr("for",g).text(b).appendTo(f);a._element.append(f)}})};b.prototype._onCheckClick=function(c){var a=$(c.target),b;if(a.is("input[type=checkbox]")){b=a.data("value");if(a.attr("checked"))this._checkedItems[b]=true;else delete this._checkedItems[b];this._fireChange()}};return b}(c.BaseControl);g.CheckboxList=K;h.initClassPrototype(K,{_checkedItems:null,_idMap:null});c.Enhancement.registerJQueryWidget(K,"checkboxList");var J=function(b){__extends(a,b);function a(a){b.call(this,a)}a._typeName="tfs.filterControl";a.prototype._getDefaultClause=function(){throw new Error("_getDefaultClause is abstract and must be overriden by derived classes.");};a.prototype._updateAndOrControl=function(){throw new Error("_updateAndOrControl is abstract and must be overriden by derived classes.");};a.prototype._updateFieldControl=function(){throw new Error("_updateFieldControl is abstract and must be overriden by derived classes.");};a.prototype._updateOperatorControl=function(){throw new Error("_updateOperatorControl is abstract and must be overriden by derived classes.");};a.prototype._updateValueControl=function(){throw new Error("_updateValueControl is abstract and must be overriden by derived classes.");};a.prototype._validateClause=function(){throw new Error("_validateClause is abstract and must be overriden by derived classes.");};a.prototype._handleFieldNameChanged=function(){throw new Error("_handleFieldNameChanged is abstract and must be overriden by derived classes.");};a.prototype._handleOperatorChanged=function(){throw new Error("_handleOperatorChanged is abstract and must be overriden by derived classes.");};a.prototype._setDirty=function(){throw new Error("_setDirty is abstract and must be overriden by derived classes.");};a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({enableRowAddRemove:true,enableGrouping:true,coreCssClass:"filter-control"},a))};a.prototype.setFilter=function(a){this._filter=a;this._createClauseTable()};a.prototype._createClauseTable=function(){var a=this;if(this._clauseTable){this._clauseTable.remove();this._clauseTable=null;this._groupHeaderCell=null}if(this._filter){this._clauseTable=$("<table />").addClass("clauses");this._clauseTable.append(this._createHeaderRow());if(!this._filter.clauses||this._filter.clauses.length===0)this._filter.clauses=[this._getDefaultClause()];$.each(this._filter.clauses,function(c,b){b.index=c;a._clauseTable.append(a._createClauseRow(b))});this._options.enableRowAddRemove&&this._clauseTable.append(this._createAddClauseRow());this._element.append(this._clauseTable)}};a.prototype._createHeaderRow=function(){var c=this,a=$("<tr/>").addClass("header"),b;this._options.enableRowAddRemove&&a.append($("<td/>").addClass("add-remove"));if(this._options.enableGrouping){a.append();$("<td/>").addClass("grouping disabled").append($("<a/>").attr("href","#").attr("disabled","disabled").css("opacity",.25).append($("<span/>").addClass("icon")).attr("title",e.FilterGroupClauses||"").click(function(){!$(this).attr("disabled")&&c._groupSelectedClauses();return false})).appendTo(a);this._groupHeaderCell=$("<td/>").addClass("groups");this._filter&&this._filter.maxGroupLevel&&this._groupHeaderCell.attr("colspan",this._filter.maxGroupLevel+1);a.append(this._groupHeaderCell)}!this._options.hideLogicalOperator&&a.append($("<td/>").addClass("logical").text(e.FilterControlAndOr));a.append($("<td/>").addClass("field").text(e.FilterControlField));b=$("<td/>").addClass("operator");a.append(b);!this._options.hideOperatorHeader&&b.text(e.FilterControlOperator);a.append($("<td/>").addClass("value").text(e.FilterControlValue));return a};a.prototype._getInsertClauseTooltipText=function(){return e.FilterControlInsertClause};a.prototype._getRemoveClauseTooltipText=function(){return e.FilterControlRemoveClause};a.prototype._createClauseRow=function(h){var f,b,i=this,d,k,n,a,g,p,q,o,r;f=h.index+1;b=$("<tr/>").addClass("clause clause-row").data("clause",h);function l(){return{clause:h,$row:b,logicalOperatorControl:p,fieldNameControl:q,operatorControl:o,valueControl:r}}function m(a){i._onClauseChange(a,l())}function s(){if(k){a.addClass("group g-cat-"+(k.level||0)%5);if(k.start===f){a.addClass("group-start");$("<a/>").attr("href","#").append($("<span/>").addClass("icon icon-tfs-clause-ungroup")).attr("title",e.FilterControlUngroupClauses||"").click(function(a){return function(b){return i._ungroupClick(b,$.extend(l(),{group:a}))}}(k)).appendTo(a)}else $("<div/>").addClass("group-placeholder").appendTo(a);k.end===f&&a.addClass("group-end")}g>1&&a.attr("colspan",g);b.append(a)}this._options.enableRowAddRemove&&b.append($("<td/>").addClass("add-remove").append($("<a/>").attr("href","#").append($("<span/>").addClass("icon icon-add")).attr("title",i._getInsertClauseTooltipText()||"").click(function(a){return i._addClauseClick(a,l())})).append($("<a/>").attr("href","#").append($("<span/>").addClass("icon icon-delete")).attr("title",i._getRemoveClauseTooltipText()||"").click(function(a){return i._removeClauseClick(a,l())})));if(this._options.enableGrouping){b.append($("<td/>").addClass("grouping").append($("<input/>").attr("type","checkbox").data("clauseRow",f).click(function(){i._updateGroupLink()})));if(this._filter.groups&&this._filter.groups.length){d=[];$.each(this._filter.groups,function(b,a){if(a.start<=f&&a.end>=f){a.level=a.level||0;d.push(a)}});d.sort(function(a,b){return b.level-a.level})}if(d&&d.length){a=$("<td/>");g=0;for(n=this._filter.maxGroupLevel||0;n>=0;n--){if(d.length>0)if((d[0].level||0)===n){if(g>0){s();a=$("<td/>");g=0}k=d.shift()}g++}g>0&&s()}else b.append($("<td />").addClass("no-group").attr("colspan",(this._filter.maxGroupLevel||0)+1))}if(!this._options.hideLogicalOperator){a=$("<td/>").addClass("logical");if(f>1){p=c.BaseControl.createIn(j,a,{mode:"drop",allowEdit:false,change:function(){m("logicalOperator")}});this._updateAndOrControl(p,h)}b.append(a)}a=$("<td/>").addClass("field");q=c.BaseControl.createIn(j,a,{mode:"drop",change:function(){m("fieldName")}});this._updateFieldControl(q,h);b.append(a);a=$("<td/>").addClass("operator");o=c.BaseControl.createIn(j,a,{mode:"drop",sorted:false,source:[],change:function(){m("operator")}});this._updateOperatorControl(o,h);b.append(a);a=$("<td/>").addClass("value");r=c.BaseControl.createIn(j,a,{mode:"text",change:function(){m("value")}});this._updateValueControl(r,h);b.append(a);this._validateClause(l());return b};a.prototype._getAddNewClauseText=function(){return e.FilterControlAddNewClause};a.prototype._createAddClauseRow=function(){var b=$("<tr/>").addClass("add-clause clause-row"),a,e=this,d=this._getAddNewClauseText();function c(a){return e._addClauseClick(a,{$row:b})}a=$("<td/>").addClass("add-remove").append($("<span/>").addClass("icon action icon-add").attr("title",d).click(c)).append($("<a/>").attr("href","#").addClass("add-row-link").append(d).click(c));if(this._options.enableGrouping)a.attr("colspan",5+(this._filter.maxGroupLevel||0));else a.attr("colspan",4);b.append(a);return b};a.prototype._onClauseChange=function(e,c){var b,d,a=c.clause;switch(e){case"logicalOperator":b=a.logicalOperator;a.logicalOperator=c.logicalOperatorControl.getText();if(f.StringUtils.localeIgnoreCaseComparer(b,a.logicalOperator)!==0)d=true;break;case"fieldName":b=a.fieldName;a.fieldName=$.trim(c.fieldNameControl.getText());if(f.StringUtils.localeIgnoreCaseComparer(b,a.fieldName)!==0){d=true;this._handleFieldNameChanged(c,b)}break;case"operator":b=a.operator;a.operator=$.trim(c.operatorControl.getText());if(f.StringUtils.localeIgnoreCaseComparer(b,a.operator)!==0){d=true;this._handleOperatorChanged(c,b)}break;case"value":b=a.value;a.value=c.valueControl.getText();if(f.StringUtils.localeIgnoreCaseComparer(b,a.value)!==0)d=true}if(d){this._validateClause(c);this._handleFilterModified()}};a.prototype._addClauseClick=function(e,c){var a,b,d;this._filter.clauses=this._filter.clauses||[];a=this._getDefaultClause();if(c.clause){a.index=c.clause.index;this._filter.clauses.splice(c.clause.index,0,a);for(b=a.index+1,d=this._filter.clauses.length;b<d;b++)this._filter.clauses[b].index=b;this._filter.groups=s.updateFilterGroups(this._filter.groups,a.index+1,true)}else{a.index=this._filter.clauses.length;this._filter.clauses.push(a)}this._createClauseTable();$(f.StringUtils.format("td.field:eq({0}) input",a.index+1),this._element).focus();this._handleFilterModified();return false};a.prototype._removeClauseClick=function(e,d){var b=d.clause.index,a,c;this._filter.clauses.splice(b,1);c=this._filter.clauses.length;for(a=b;a<c;a++)this._filter.clauses[a].index=a;this._filter.groups=s.updateFilterGroups(this._filter.groups,b+1,false);this._filter.maxGroupLevel=s.updateFilterGroupLevels(this._filter.groups);this._createClauseTable();this._handleFilterModified();return false};a.prototype._updateGroupLink=function(){var b=0,c=0,d=false,a;$("td.grouping input",this._element).each(function(e,a){if($(a).attr("checked")){b++;if(d||c===0)c++;d=true}else d=false});a=$(".header td.grouping",this._element);if(b>1&&b===c){a.removeClass("disabled");a.find("a").removeAttr("disabled").css("opacity",1)}else{a.addClass("disabled");a.find("a").attr("disabled","disabled").css("opacity",.25)}return false};a.prototype._groupSelectedClauses=function(){var a=Number.MAX_VALUE,b=0,c,d=this._filter.groups||[];$("td.grouping input:checked",this._element).each(function(e,d){var c=$(d).data("clauseRow");a=Math.min(a,c);b=Math.max(b,c)});if(a>=b){alert(e.FilterGroupingCannotGroup);return}$.each(d,function(f,d){if(d.start===a&&d.end===b){alert(e.FilterGroupingGroupAlreadyExist);c=true;return false}if(d.start<a&&d.end>a&&d.end<b||d.start<b&&d.end>b&&d.start>a){alert(e.FilterGroupingCannotIntersect);c=true;return false}if(d.end===a||d.start===b){alert(e.FilterGroupingCannotGroup);c=true;return false}});if(!c){d.push({start:a,end:b});this._filter.groups=d;this._filter.maxGroupLevel=s.updateFilterGroupLevels(d);this._createClauseTable();this._handleFilterModified()}};a.prototype._ungroupClick=function(c,b){var a=[];$.each(this._filter.groups,function(d,c){(b.group.start!==c.start||b.group.end!==c.end)&&a.push(c)});this._filter.groups=a;this._filter.maxGroupLevel=s.updateFilterGroupLevels(a);this._createClauseTable();this._handleFilterModified();return false};a.prototype._handleFilterModified=function(){this._setDirty();this._fire("filterModified",this._filter)};return a}(c.BaseControl);g.FilterControl=J;h.initClassPrototype(J,{_clauseTable:null,_groupHeaderCell:null,_filter:null});h.classExtend(J,p.TfsContext.ControlExtensions);var z=function(c){__extends(b,c);function b(a){c.call(this,a)}b._typeName="tfs.statusIndicator";b.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({coreCssClass:"status-indicator"},a))};b.prototype.initialize=function(){c.prototype.initialize.call(this);this._options.center&&this._options.center===true&&this._element.addClass("center");this._throttleMinTime=this._options.throttleMinTime||100;this._bindEvents();this._bind("click",a(this,this._onClick))};b.prototype._dispose=function(){this._clearTimeout();c.prototype._dispose.call(this)};b.prototype.start=function(b,a){this._clearTimeout();$.extend(this._options,a);if(!this._statusDiv)this._draw();else this._setImageClass();this._show()};b.prototype.complete=function(){this._clearTimeout();this._hide()};b.prototype.error=function(a){this._lastError=a;this._clearTimeout();this._hide()};b.prototype.setMessage=function(a){var b=this.getElement().find("#indicator_message");b.text(a)};b.prototype._draw=function(){var d,e,c,b,a=this._element;a.empty();this._statusDiv=$("<div />").appendTo(a).addClass("status");if(!this._options.center){this._statusDiv.addClass("status-inline");a.addClass("inline");this._image=$("<span />").appendTo(a);b=a}else{d=$("<table />").appendTo(this._statusDiv);e=$("<tr />").appendTo(d);c=$("<td />").appendTo(e);this._image=$("<span />").appendTo(c);b=c}this._setImageClass();this._options.message&&$("<span id='indicator_message' />").appendTo(b).text(this._options.message);this._hide()};b.prototype._onClick=function(){this._lastError&&alert(this._lastError)};b.prototype._setImageClass=function(){this._image.removeClass();if(this._options.imageClass){this._image.addClass("icon");this._image.addClass(this._options.imageClass)}else this._image.addClass("status-progress")};b.prototype._bindEvents=function(){var b=this._options.eventTarget||window;this._options.statusStartEvent&&this._bind(b,this._options.statusStartEvent,a(this,this._startHandler),true);this._options.statusCompleteEvent&&this._bind(b,this._options.statusCompleteEvent,a(this,this.complete),true);this._options.statusErrorEvent&&this._bind(b,this._options.statusErrorEvent,a(this,this.error),true)};b.prototype._show=function(){this._element.css("display","")};b.prototype._hide=function(){this._element.css("display","none")};b.prototype._error=function(d,c,b,a){this._lastError=a;this._hide()};b.prototype._startHandler=function(b,a){this.delayExecute("start",this._throttleMinTime,true,function(){this.start(b,a)})};b.prototype._clearTimeout=function(){this.cancelDelayedFunction("start")};return b}(c.BaseControl);g.StatusIndicator=z;h.initClassPrototype(z,{_lastError:null,_statusDiv:null,_image:null,_throttleMinTime:null});c.Enhancement.registerJQueryWidget(z,"statusIndicator");var sb=function(b){__extends(a,b);function a(a){a.coreCssClass="histogram";b.call(this,a)}a.prototype._getBarCount=function(){var a=this._options.barCount||9;a=Math.min(Math.max(a,5),100);return a};a.prototype.initialize=function(){var a=this._options;this._decorate();if($.isArray(a.items))this._load(a.items);else if($.isFunction(a.items))this._load(a.items.call(this));else a.defaultBars!==false&&this._renderDefaultBars()};a.prototype.refresh=function(a){this._load(a)};a.prototype._clearBars=function(){this._element.find("div.bar").remove()};a.prototype._getBarWidth=function(){var a=this._options.barWidth||5;a=Math.min(Math.max(a,2),30);return a};a.prototype._getBarSpacing=function(){var a=this._options.barSpacing||2;a=Math.min(Math.max(a,0),10);return a};a.prototype._getBarMaxHeight=function(){var a=this._options.barHeight||35;a=Math.min(Math.max(a,10),300);return a};a.prototype._load=function(a){this._renderBars(a)};a.prototype._decorate=function(){this._element.width(this._getBarCount()*(this._getBarSpacing()+this._getBarWidth()));this._element.height(this._getBarMaxHeight())};a.prototype._renderDefaultBars=function(){this._clearBars();for(var a=0;a<this._getBarCount();a++)this._element.append(this._createBar(a))};a.prototype._renderBars=function(c){var a,d,b;yb($.isArray(c),"Array of items expected.");this._clearBars();b=this._getBarCount();d=b-c.length;for(a=0;a<d;a++)this._element.append(this._createBar(a,{state:"default",value:5}));while(a<b){this._element.append(this._createBar(a,c[a-d]));a+=1}};a.prototype._createBar=function(i,b){var j,a,g,k,d,c,f=this._options.hoverState,h=this._options.selectedState,e=this._options.allowInteraction!==false;g=this._getBarWidth();k=this._getBarSpacing();d=b&&b.state;d=d||"default";j=i*(g+this._getBarSpacing());c=b&&b.value;c=typeof c==="number"?Math.max(Math.min(c,100),0):c||(i%2?50:100);c=Math.max(c,Math.ceil(100/this._getBarMaxHeight()));a=$("<div />").addClass("bar");a.addClass(d);a.css("left",j);a.css("width",g);a.css("height",c+"%");a.css("bottom",0);if(b){h&&(b.selected||!e)&&a.addClass(h);e&&f&&!b.selected&&a.hover(function(){$(this).addClass(f)},function(){$(this).removeClass(f)});if(e&&$.isFunction(b.action)){a.data("action",{action:b.action,args:b.actionArgs});a.click(function(){var a=$(this).data("action");a.action(a.args);return false})}b.title&&a.attr("title",b.title)}return a};return a}(c.BaseControl);g.Histogram=sb;var Q=function(d){__extends(c,d);function c(a){d.call(this,a)}c.prototype.initializeOptions=function(a){d.prototype.initializeOptions.call(this,$.extend({previewOpacity:.7,previewScale:15},a))};c.prototype.initialize=function(){d.prototype.initialize.call(this);var a=this;this._element.sortable({opacity:this._options.previewOpacity,cursor:"default",cursorAt:{left:75,top:75},revert:false,helper:"clone",containment:"parent",tolerance:"pointer",start:function(d,c){var b=$(c.helper);b.height(b.height()+a._options.previewScale);b.width(b.width()+a._options.previewScale)},update:function(){a.setTileOrder.call(a)}});this._element.disableSelection();this._tileZoneId=this._element.data("tile-zone-id");this._tileCount=$(".tile",this._element).length;this._attachEvents()};c.prototype.setTileOrder=function(){var c=$(".tile",this._element),a=[],b=function(){};$.map(c,function(b,c){a[c]=$(b).data("tile-id")});S.postMSJSON(p.TfsContext.getDefault().getActionUrl("SetTileOrder","tilezone",{area:"api"}),{tileZoneId:this._tileZoneId,data:s.stringifyMSJSON(a)},null,b)};c.prototype._attachEvents=function(){this._bind(this._element,"keyup",a(this,this._onKeyUp));this._bind(this._element,"keydown",a(this,this._onKeyDown));this._bind(window,"blur",a(this,this._onBlur))};c.prototype._clearReorderTileState=function(){b.assertIsNotNull(this._keyboardReorderTile,"Unexpected, there is no reorder tile state.");this._keyboardReorderTile.css("opacity","1.0");this._keyboardReorderTile=null;this._keyboardReorderTileIndex=null};c.prototype._getTileIndex=function(a){b.assertParamIsJQueryObject(a,"$tile");var c=$(".tile",this._element);return c.index(a)};c.prototype._isKeyboardMovementValid=function(c,a){b.assertParamIsNumber(c,"index");b.assertParamIsNumber(a,"keyCode");var f=a===i.KeyCode.LEFT||a===i.KeyCode.RIGHT,d=c===0&&a===i.KeyCode.LEFT,e=c===this._tileCount-1&&a===i.KeyCode.RIGHT;return f&&!d&&!e};c.prototype._isKeyboardReorderGestureActive=function(a){return a.shiftKey};c.prototype._onBlur=function(){this._setTileOrderFromKeyboard()};c.prototype._onKeyUp=function(a){b.assertParamIsObject(a,"e");if(!this._isKeyboardReorderGestureActive(a))this._setTileOrderFromKeyboard();else this._isKeyboardReorderGestureActive(a)&&a.keyCode===i.KeyCode.TAB&&this._reorderTileFromKeyboard(a)};c.prototype._onKeyDown=function(a){b.assertParamIsObject(a,"e");if(this._isKeyboardReorderGestureActive(a)){this._reorderTileFromKeyboard(a);a.keyCode===i.KeyCode.TAB&&this._setTileOrderFromKeyboard()}};c.prototype._reorderTileFromKeyboard=function(a){var e=$(a.target).closest(".tile"),b=this._getTileIndex(e),d,c;this._keyboardReorderTile===null&&this._setReorderTileState(e,b);if(this._isKeyboardMovementValid(b,a.keyCode))if(a.keyCode===i.KeyCode.LEFT){d=this._keyboardReorderTile.prev();d.insertAfter(this._keyboardReorderTile)}else if(a.keyCode===i.KeyCode.RIGHT){c=this._keyboardReorderTile.next();c.insertBefore(this._keyboardReorderTile)}};c.prototype._setReorderTileState=function(a,c){b.assertParamIsJQueryObject(a,"$tile");b.assertParamIsNumber(c,"index");this._keyboardReorderTile=a;this._keyboardReorderTile.css("opacity",this._options.previewOpacity);this._keyboardReorderTileIndex=c};c.prototype._setTileOrderFromKeyboard=function(){if(this._keyboardReorderTile!==null){var a=this._getTileIndex(this._keyboardReorderTile);a!==this._keyboardReorderTileIndex&&this.setTileOrder();this._clearReorderTileState()}};return c}(c.BaseControl);g.TileZone=Q;h.initClassPrototype(Q,{_tileZoneId:null,_tileCount:null,_keyboardReorderTile:null,_keyboardReorderTileIndex:null});c.Enhancement.registerEnhancement(Q,".tile-zone-team-favorites");var db=function(c){__extends(a,c);function a(a){c.call(this,a)}a.prototype.initialize=function(){this._options.showStatusIndicator=false;c.prototype.initialize.call(this);!this._options.url&&this.tryMakingActionable()};a.prototype.tryMakingActionable=function(){var c=this._options.actionUrl,b=this._options.actionTarget,a;if(c){a=$("<a />").attr("href",c);b&&a.attr("target",b);this._element.wrapInner(a)}};a.prototype.beginLoad=function(f,e,d,a){this._options.name&&b.logTracePoint("Tile."+this._options.name+".beginLoad.Start");c.prototype.beginLoad.call(this,f,e,d,a)};a.prototype.onLoadCompleted=function(a){c.prototype.onLoadCompleted.call(this,a);this.tryMakingActionable();this._options.name&&b.logTracePoint("Tile."+this._options.name+".beginLoad.Complete")};a.prototype.showError=function(c){var a=this._element,b=Z(c);a.empty().addClass("error").attr("title",b);this._options.context&&this._options.context.name&&$("<div />").text(this._options.context.name).appendTo(a);$("<p />").text(b||"").appendTo(a);this.tryMakingActionable()};return a}(B);g.Tile=db;c.Enhancement.registerEnhancement(db,".tile");var V=function(){function a(a,c){b.assertParamIsObject(a,"container");this._$rootElement=$(a);this._options=c||{};this._initialize()}a.prototype.beginOperation=function(c){var a=new f.Cancelable(this);this._cancelable=a;b.assertParamIsFunction(c,"operationCallback");$.isFunction(this._options.beginOperationCallback)&&this._options.beginOperationCallback();this._waitControl.startWait(a);f.delay(this,100,function(){c(a)})};a.prototype.endOperation=function(){this._waitControl.endWait();$.isFunction(this._options.endOperationCallback)&&this._options.endOperationCallback()};a.prototype.isCancelled=function(){return this._cancelled};a.prototype.cancelOperation=function(){if(this._options&&this._options.cancellable)this._cancelled=true;this.endOperation()};a.prototype._initialize=function(){this._state={message:this._options&&this._options.message?this._options.message:e.DefaultWaitMessage,target:this._$rootElement[0]._element,cancellable:this._options&&this._options.cancellable,showDelay:this._options&&this._options.showDelay!==null?this._options.showDelay:null};this._waitControl=new A(this._state)};return a}();g.LongRunningOperation=V;h.initClassPrototype(V,{_cancelable:null,_options:null,_$rootElement:null,_waitControl:null,_state:null,_cancelled:false});var rb=function(){function a(){}a._nativeCopy=function(b){b&&window.clipboardData.setData(a.FORMAT_TEXT,b)};a._copyUsingNewWindow=function(b,a){a={data:b};C.show(H,a)};a.FORMAT_TEXT="text";a.copyToClipboard=function(b,c){if(typeof b==="string")if(a.supportsNativeCopy())a._nativeCopy(b,c);else a._copyUsingNewWindow(b,c)};a.supportsNativeCopy=function(){return window.clipboardData};return a}();g.Clipboard=rb;var H=function(d){__extends(c,d);function c(a){d.call(this,a)}c._typeName="CopyContentDialog";c.prototype.initializeOptions=function(b){d.prototype.initializeOptions.call(this,$.extend({width:600,minWidth:450,height:450,minHeight:450,attachResize:true,defaultButton:"close",buttons:[{id:"close",text:e.CloseButtonLabelText,click:a(this,this.close)}]},b))};c.prototype.initialize=function(){d.prototype.initialize.call(this);this.setTitle(e.CopyContentDialogTitle);this._decorate()};c.prototype._decorate=function(){var d=this._element,b=$("<div>").text(e.CopyContentHelpText),a=$("<div>"),c=$("<div>").append(b).append($("<p>")).append(a);this._initializeTextPanel(a);d.append(c);f.delay(this,100,function(){this._$textArea.focus();this._$textArea.select()})};c.prototype._initializeTextPanel=function(d){b.assertParamIsObject(d,"$container");var c=$("<div>");this._$textArea=$("<textarea/>").addClass("copy-content-textarea").text(this._options.data).appendTo(c);this._$textArea[0].oncopy=a(this,function(){f.delay(this,0,function(){this.close()})});d.append(c)};return c}(L);g.CopyContentDialog=H;h.initClassPrototype(H,{_$textArea:null});var A=function(){function c(a){b.assertParamIsObject(a,"options");this._options=$.extend({image:p.TfsContext.getDefault().configuration.getResourcesFile("big-progress.gif")},a)}c._instanceIdSeed=1;c.DefaultShowDelay=250;c.MinLifeTime=100;c.WaitingState={Unstarted:0,Waiting:1,Ending:2,Ended:3,Cancelling:4,Cancelled:5};c.prototype.startWait=function(a){if(this._canStartWait()){this._waitContext={instanceId:"waitControl_"+c._instanceIdSeed++,cancelable:a,options:{wait:this._options}};this._startWait()}};c.prototype.endWait=function(){if(this._canEndWait()){this._waitingState=c.WaitingState.Ending;this._tryEndWait()}};c.prototype.cancelWait=function(){if(this._canCancelWait()){this._waitingState=c.WaitingState.Cancelling;this._tryCancelWait()}};c.prototype._canStartWait=function(){return this._waitingState===c.WaitingState.Unstarted};c.prototype._canEndWait=function(){return this._waitContext&&(this._waitingState===c.WaitingState.Waiting||this._waitingState===c.WaitingState.Ending)};c.prototype._canCancelWait=function(){return this._waitContext&&this._waitContext.options.wait.cancellable&&(this._waitingState===c.WaitingState.Waiting||this._waitingState===c.WaitingState.Cancelling)};c.prototype._startWait=function(){var a=this._waitContext.options.wait;this._waitingState=c.WaitingState.Waiting;if(a.showDelay===null)a.showDelay=c.DefaultShowDelay;if(!a.target){a.entireWindow=true;a.target=$("body");a.extraStyles="height:100%; width:100%;"}a.target.children(".wait-element").hide();a.target.children(".wait-box").hide();if(!a.showDelay)this._showWait();else this._waitContext.showTimer=f.delay(this,a.showDelay,this._showWait)};c.prototype._tryEndWait=function(){b.assertIsObject(this._waitContext,"this._waitContext is not an object");var a=this._waitContext.options.wait;if(this._waitingState===c.WaitingState.Ending&&!a.minLifeSpanBlocking){this._waitingState=c.WaitingState.Ended;this._reset()}};c.prototype._tryCancelWait=function(){b.assertIsObject(this._waitContext,"this._waitContext is not an object");var e=this._waitContext.options.wait,d=e.cancelCallback,a=this._waitContext.cancelable;if(this._waitingState===c.WaitingState.Cancelling&&!e.minLifeSpanBlocking){this._waitingState=c.WaitingState.Cancelled;this._reset();d&&d();a&&a.cancel&&$.isFunction(a.cancel)&&a.cancel()}};c.prototype._reset=function(){this._unbindKeydownEvent();this._removeWaitElement();this._removeShowTimer();this._waitContext=null;this._waitingState=c.WaitingState.Unstarted};c.prototype._showWait=function(){b.assertIsObject(this._waitContext,"this._waitContext is not an object");var e="",d=this._waitContext.options.wait,i=d.extraStyles||"",g=this,h;if(d.image)e+=f.StringUtils.format('<img class="wait-image" src="{0}" />',d.image);h=this._getWaitMessage(d);if(h)e+=f.StringUtils.format('<div class="wait-message">{0}</div>',h);if(e.length>0){d.target.prepend(f.StringUtils.format('<div class="wait-box">{0}</div>',e));d.msgElement=d.target.children(".wait-box").first()}if(d.backgroundcolor)i+=f.StringUtils.format("background-color:{0};",d.backgroundcolor);d.target.prepend(f.StringUtils.format('<div class="wait-element" style="{0}"></div>',i));d.element=d.target.children(".wait-element").first();this._resizeWait();$(window).bind(this._getResizeEventId(this._waitContext.instanceId),a(this,this._resizeWait));if(d.cancellable){b.assertIsStringNotEmpty(d.cancelLinkId,"wait.cancelLinkId is empty");this._bindKeydownEvent(d.cancelLinkId);$("#"+d.cancelLinkId).click(a(this,this._handleCancelEvent));$("#"+d.cancelLinkId).focus()}if(!d.minLifetime)d.minLifetime=c.MinLifeTime;d.minLifeSpanBlocking=true;f.delay(this,d.minLifetime,function(){d.minLifeSpanBlocking=false;if(g._waitingState===c.WaitingState.Ending)g._tryEndWait();else g._waitingState===c.WaitingState.Cancelling&&g._tryCancelWait()})};c.prototype._resizeWait=function(){b.assertIsObject(this._waitContext,"this._waitContext is not an object");var a=this._waitContext.options.wait,d,c;b.assertIsObject(a.element,"wait.element is not an object");if(!a.entireWindow){a.element.css("margin-top",-parseInt(a.target.css("padding-top"),10));a.element.css("margin-left",-parseInt(a.target.css("padding-left"),10));a.element.height(a.target.outerHeight());a.element.width(a.target.outerWidth())}if(a.msgElement){d=parseInt(a.element.css("margin-top"),10);c=parseInt(a.element.css("margin-left"),10);if(!d||isNaN(d))d=0;if(!c||isNaN(c))c=0;a.msgElement.css("top",a.element.position().top+(a.element.height()-a.msgElement.height())/2+d);a.msgElement.css("left",a.element.position().left+(a.element.width()-a.msgElement.width())/2+c)}};c.prototype._onKeyDown=function(b){var a=i.KeyCode;if(b.keyCode===a.ESCAPE){this._handleCancelEvent();return false}};c.prototype._handleCancelEvent=function(){this._unbindKeydownEvent();this.cancelWait();return false};c.prototype._bindKeydownEvent=function(c){b.assertParamIsString(c,"cancelLinkId");if(!this._keyDownEventHandler){this._keyDownEventHandler=a(this,this._onKeyDown);$("#"+c).keydown(this._keyDownEventHandler)}};c.prototype._unbindKeydownEvent=function(){var a;if(this._waitContext){a=this._waitContext.options.wait;if(this._keyDownEventHandler&&a.cancelLinkId){$("#"+a.cancelLinkId).unbind("keydown",this._keyDownEventHandler);this._keyDownEventHandler=null}}};c.prototype._removeWaitElement=function(){var a;function c(){if(a.element){a.element.remove();a.element=null}}function b(){if(a.msgElement){a.msgElement.remove();a.msgElement=null}}if(this._waitContext){a=this._waitContext.options.wait;if(a.element){if(a.fade!==false){a.element.fadeOut("fast",c);a.msgElement.fadeOut("fast",b)}else{c();b()}$(window).unbind(this._getResizeEventId(this._waitContext.instanceId))}}};c.prototype._removeShowTimer=function(){if(this._waitContext&&this._waitContext.showTimer){this._waitContext.showTimer.cancel();delete this._waitContext.showTimer}};c.prototype._getResizeEventId=function(a){b.assertParamIsString(a,"instanceId");return"resize."+a};c.prototype._getWaitMessage=function(a){b.assertParamIsObject(a,"wait is not an object");var d="",c="";if(a.cancellable){a.cancelLinkId="cancelLink_"+this._waitContext.instanceId;c=f.StringUtils.format(e.CancelWaitAdvice,f.StringUtils.format('<a href="" class="wait-link" tabindex="0" id="{0}">ESC</a>',a.cancelLinkId))}if(a.message)d=a.cancellable?f.StringUtils.format("{0} ({1})",a.message,c):a.message;else if(a.cancellable)d=c;return d};return c}();g.WaitControl=A;h.initClassPrototype(A,{_options:null,_waitContext:null,_waitingState:A.WaitingState.Unstarted,_keyDownEventHandler:null});(function(a){a._map=[];a.None=0;a.Info=1;a.Warning=2;a.Error=3})(g.MessageAreaType||(g.MessageAreaType={}));var l=g.MessageAreaType,v=function(g){__extends(c,g);function c(a){g.call(this,a)}c.EVENT_DISPLAY_COMPLETE="event-display-complete";c.EVENT_DISPLAY_CLEARED="event-display-cleared";c.EVENT_DISPLAY_HIDDEN="event-display-hidden";c.prototype.initializeOptions=function(a){g.prototype.initializeOptions.call(this,$.extend({closeable:true,expanded:false},a))};c.prototype.initialize=function(){var b,c=this;this._element.addClass("message-area-control");b=$(d("div")).appendTo(this._element).addClass("message-header");this._errorHeader=$(d("span")).appendTo(b);this._showErrorLink=$(d("a")).appendTo(b).addClass("linkAction show-details-action").attr("href","#").click(function(){c._toggle();return false});$(d("div")).appendTo(this._element).addClass("close-action icon icon-close-small").click(a(this,this.clear)).accessible();this._errorContent=$(d("div")).appendTo(this._element).addClass("error-content");this._element.hide();this._messageType=l.None;this._options.message&&this.setMessage(this._options.message);this._options.fillVertical&&this._element.css("height","100%")};c.prototype.setMessage=function(a,c){if(typeof a==="string"||a&&a.jquery)a={header:a};b.assertParamIsObject(a,"message");if(!a.type)a.type=c||l.Error;this._setDisplayMessage(a)};c.prototype.setError=function(a,c){if(typeof a==="string"||a&&a.jquery)a={header:a};b.assertParamIsObject(a,"message");a.type=l.Error;if(!a.click&&$.isFunction(c))a.click=c;this.setMessage(a)};c.prototype.getMessageType=function(){return this._messageType};c.prototype.clear=function(){this._clear(true);this._fire(c.EVENT_DISPLAY_HIDDEN)};c.prototype._setDisplayMessage=function(a){var d=this,c;b.assertParamIsObject(a,"message");if(this._options.closeable)this._element.addClass("closeable");else this._element.removeClass("closeable");this._clear(false);this._messageType=a.type;if(a.header&&a.header.jquery)this._errorHeader.append(a.header);else this._errorHeader.text(a.header);if(a.content){if(a.content.jquery)this._errorContent.append(a.content);else this._errorContent.text(a.content);this.setErrorDetailsVisibility(this._options.expanded);this._showErrorLink.show()}else{this._errorContent.hide();this._showErrorLink.hide()}this._element.show();switch(this._messageType){case l.Info:this._element.addClass("info-message");break;case l.Warning:this._element.addClass("warning-message");break;case l.Error:this._element.addClass("error-message");break;default:b.fail(f.StringUtils.format("Unexpected MessageAreaType {0}",this._messageType))}if(a.click){b.assertParamIsFunction(a.click,"message.click");c=function(){a.click();d.clear()};this._errorHeader.addClass("clickable");this._errorHeader.click(c);this._errorHeader.keydown(function(a){if(a.keyCode===i.KeyCode.ENTER){c();return false}})}this._raiseDisplayComplete()};c.prototype._toggle=function(){if(this._errorContent.is(":visible"))this.setErrorDetailsVisibility(false);else this.setErrorDetailsVisibility(true);this._raiseDisplayComplete()};c.prototype.setErrorDetailsVisibility=function(a){if(a){this._showErrorLink.text(e.HideDetails);this._errorContent.show()}else{this._showErrorLink.text(e.ShowDetails);this._errorContent.hide()}};c.prototype._clear=function(a){b.assertParamIsBool(a,"raiseDisplayCompleteEvent");if(this._errorHeader.text().length===0)return;switch(this._messageType){case l.Info:this._element.removeClass("info-message");break;case l.Warning:this._element.removeClass("warning-message");break;case l.Error:this._element.removeClass("error-message")}this._messageType=l.None;this._errorHeader.text("");this._errorContent.text("");this._errorHeader.unbind("click");this._errorHeader.removeClass("clickable");this._element.hide();a&&this._raiseDisplayComplete();this._fire(c.EVENT_DISPLAY_CLEARED)};c.prototype._raiseDisplayComplete=function(){this._fire(c.EVENT_DISPLAY_COMPLETE)};return c}(c.BaseControl);g.MessageAreaControl=v;h.initClassPrototype(v,{_errorHeader:null,_errorContent:null,_messageType:null,_showErrorLink:null});var T=function(e){__extends(b,e);function b(a){e.call(this,a)}b.prototype.initialize=function(){var b;e.prototype.initialize.call(this);b=$.extend({},this._options);if(b.message&&typeof b.message.header==="string")b.message.header=$(d("span")).html(b.message.header);if(b.message&&typeof b.message.content==="string")b.message.content=$(d("span")).html(b.message.content);this._messageArea=c.Enhancement.enhance(v,this.getElement(),b);this._bind(v.EVENT_DISPLAY_CLEARED,a(this,this._dismissMessage))};b.prototype._dismissMessage=function(){this._options&&this._options.message&&this._options.message.id&&n.fire("notification-dismissed",this._options.message.id,this._options.message.scope)};return b}(c.BaseControl);h.initClassPrototype(T,{_messageArea:null});var hb=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.initializeOptions=function(a){if(a)this._collapsed=!!a.collapsed;b.prototype.initializeOptions.call(this,$.extend({coreCssClass:"information-area-control",expandedIconClass:"content-expanded",collapsedIconClass:"content-collapsed"},a))};a.prototype.initialize=function(){var b=this,c=this,a=$(d("div","information-header")).appendTo(this._element).click(function(){b._updateCollapsedState(!b._collapsed)});this._$collapseIndicator=$(d("div","icon collapse-indicator")).appendTo(a);this._$caption=$(d("div","information-caption")).appendTo(a).text(this._options.caption);this._$content=$(d("div","information-content")).appendTo(this._element);this._updateCollapsedState(this._collapsed)};a.prototype.appendDetailHeaderContent=function(a){$(d("div","detail-header")).appendTo(this._$content).append(a)};a.prototype.appendDetailContent=function(a){$(d("div","detail-content")).appendTo(this._$content).append(a)};a.prototype.appendCodeContent=function(a){$(d("div","code-content")).appendTo(this._$content).append(a)};a.prototype.appendDetailHeaderHtml=function(a){$(d("div","detail-header")).appendTo(this._$content).html(a)};a.prototype.appendDetailHtml=function(a){$(d("div","detail-content")).appendTo(this._$content).html(a)};a.prototype.appendCodeHtml=function(a){$(d("div","code-content")).appendTo(this._$content).html(a)};a.prototype._updateCollapsedState=function(a){if(a){this._$collapseIndicator.removeClass(this._options.expandedIconClass);this._$collapseIndicator.addClass(this._options.collapsedIconClass);this._$content.hide()}else{this._$collapseIndicator.removeClass(this._options.collapsedIconClass);this._$collapseIndicator.addClass(this._options.expandedIconClass);this._$content.show()}this._collapsed=a};return a}(c.BaseControl);g.InformationAreaControl=hb;function mb(a,b){return a.keyCode===b.keyCode&&a.altKey===b.altKey&&a.ctrlKey===b.ctrlKey?true:false}function eb(){jQuery.fn.valWatermark=jQuery.fn.val;jQuery.fn.val=function(a){if(this.hasClass("watermark"))if(!a)return"";else this.removeClass("watermark");return jQuery.fn.valWatermark.apply(this,arguments)}}eb();$.widget("TFS.Watermark",{options:{watermarkText:null},_create:function(){this.element.bind("blur",this,this.blurHandler);this.element.bind("focus",this,this.focusHandler);$("form").bind("submit",this,function(a){a.data._removeStyle()});this._applyStyle()},blurHandler:function(b){var a=b.data;a._applyStyle();a.element.unbind("keydown mousedown",a.focusHandler)},focusHandler:function(b){var a=b.data;a._removeStyle();a.element.unbind("keydown mousedown",a.focusHandler)},isActive:function(){return this.element.hasClass("watermark")},preventKeyDown:function(){return false},focus:function(){this.element.unbind("focus",this.focusHandler);this.element.focus();this.element.bind("keydown",this.preventKeyDown);this._resetCaret();f.delay(this,$.browser.msie?50:0,function(){this.element.unbind("keydown",this.preventKeyDown);this.element.bind("focus keydown mousedown",this,this.focusHandler)})},_resetCaret:function(){if(this.element.get(0).setSelectionRange)try{this.element.get(0).setSelectionRange(0,0)}catch(a){}},reset:function(){this.element.addClass("watermark");this.element.valWatermark(this.options.watermarkText)},resetIfEmpty:function(){!this.element.val()&&this.reset()},_applyStyle:function(){var a=this.element.valWatermark();(a===""||a===this.options.watermarkText)&&this.reset()},_removeStyle:function(){if(this.isActive()){this.element.valWatermark("");this._resetCaret();this.element.removeClass("watermark")}}});$.widget("TFS.Dropdown",{options:{dynamicSearch:false,filterList:false,id:null,initialValue:"",listSize:8,showDelete:false,showListOnKeystroke:true,_elements:{_autoComplete:null,_container:null,_control:null,_input:null,_search:null,_list:null,_searching:null},_autoCompleteValue:null,_previousValue:null,_valueList:[],_searchActive:false,_searchResult:false,_stateIcon:null,_addStackDepth:0},_create:function(){this.options._control_id=Math.random();this.element.append('<div class="dropdown-input-control"><div class="dropdown-input-main"><div class="dropdown-input-inputarea"><input autocomplete="off" class="dropdown-input-text dropdown-input-autocomplete" readonly tabIndex="-1" type="text" /><div class="dropdown-input-blank"></div><input autocomplete="off" class="dropdown-input-text dropdown-input-name" spellcheck="false" type="text" /></div><div class="dropdown-input-search" tabindex="0"></div></div><div class="dropdown-popup"><div class="dropdown-input-list-container boxshadow"><ul class="dropdown-input-list"></ul><div class="dropdown-input-list-searching status-text"></div><div class="dropdown-input-list-no-results status-text"></div></div></div></div>');this.options._elements._control=this.element.find(".dropdown-input-main");this.options._elements._autoComplete=this.element.find(".dropdown-input-autocomplete");this.options._elements._input=this.element.find(".dropdown-input-name");this.options._elements._search=this.element.find(".dropdown-input-search");this.options._elements._container=this.element.find(".dropdown-input-list-container");this.options._elements._list=this.element.find(".dropdown-input-list");this.options._elements._searching=this.element.find(".dropdown-input-list-searching").text(e.Searching);this.options._elements._noResults=this.element.find(".dropdown-input-list-no-results").text(e.NoSearchResults);if(this.options.id){this.options._elements._input.attr("id",this.options.id);this.options._elements._input.attr("name",this.options.id)}this.options.initialValue&&this.setValue(this.options.initialValue);this.options.watermarkText&&this.options._elements._input.Watermark({watermarkText:this.options.watermarkText});this._updateControlState();this.options._elements._search.bind("click",this,function(a){a.data._handleClick()});this.options._elements._search.bind("keydown",this,function(a){(a.keyCode===$.ui.keyCode.SPACE||a.keyCode===$.ui.keyCode.ENTER)&&a.data._handleClick()});this.options._elements._input.bind("keydown",this,function(a){a.data._handleKeyDown(a)});this.options._elements._input.bind("keydown",this,function(a){a.data._alignValue()});this.options._elements._input.bind("keyup",this,function(a){a.data._handleTextChange()});this.options._elements._input.bind("focusin",this,function(a){a.data.options._elements._autoComplete.show()});this.options._elements._input.bind("focusout",this,function(a){a.data.options._elements._autoComplete.hide()});this.options._elements._input.bind("mousedown",this,function(a){$(document).bind("mousemove.Dropdown",a.data,function(a){a.data._alignValue()});$(document).bind("mouseup",a.data,function(a){a.data._alignValue();$(document).unbind("mousemove.Dropdown");$(document).unbind(a)})});this.element.bind("startSearch",this,function(a,b){a.data._startSearch(a,b)});this.element.bind("completeSearch",this,function(a,b){a.data._completeSearch(a,b)});this.element.bind("cancelSearch",this,function(a,b){a.data._cancelSearch(a,b)});this.options._elements._list.bind("mousemove",this,function(a){a.data._trackMousePosition(a)});this.element.bind("removeItem",this,function(a,b){a.data._removeItem(a,b)})},add:function(a,b){var b;this.options._addStackDepth++;if(jQuery.isArray(a))for(b=0;b<a.length;b++)this.add(a[b]);else if(jQuery.isFunction(a))this.add(a());else this._addItem(a,b);this.options._addStackDepth--;this.options._addStackDepth===0&&this._updateControlState()},clear:function(){this.options._elements._list.find(".dropdown-input-listitem").remove();this.options._valueList=[];this._updateControlState()},remove:function(a){this.element.trigger("removeItem",{value:a})},hideList:function(a){this.options._elements._control.removeClass("dropdown-active");this.options._elements._container.hide();if(a){this.options._elements._input.focus();this.options._elements._autoComplete.show()}$(document).unbind("mousedown.Dropdown"+this.options._control_id);this._updateStateIcon();this.element.trigger("listHidden")},showList:function(a){this.options._elements._container.width(this.element.outerWidth()-(this.options._elements._container.outerWidth(true)-this.options._elements._container.width())-parseInt(this.element.css("padding-left"),10)-parseInt(this.element.css("border-left-width"),10));this.options._elements._control.addClass("dropdown-active");this.options._elements._container.show();i.Positioning.position(this.options._elements._container,this.element,{elementAlign:"right-top",baseAlign:"right-bottom"});if(a){this.options._elements._input.focus();this.options._elements._autoComplete.show()}$(document).bind("mousedown.Dropdown"+this.options._control_id,this,function(a){$(a.target).parents(".dropdown-input-control").parent().get(0)!==a.data.element.get(0)&&a.data.hideList(false)});this._updateControlState();this.element.trigger("listShown")},ensureVisible:function(b){var a=this.getListItem(b);a&&this._ensureVisible(a)},getControlState:function(){return this.options._searchActive?"searching":this.options._elements._list.is(":visible")?"active":"inactive"},getListItem:function(g){var f,e,b,c,a,d;if(!isNaN(g))f=this.options._valueList[g];else{e=g.toLowerCase();c=0;d=this.options._valueList.length-1;while(c<=d){a=Math.round((c+d)/2);if(e<this.options._valueList[a].lowerValue){b=-1;d=a-1}else if(e>this.options._valueList[a].lowerValue){b=1;c=a+1}else{b=0;break}}if(b===0)f=this.options._valueList[a]}return f},highlight:function(c){var b,a=this.getListItem(c);if(a){if(a.value!==this.highlightedValue()){b=this.options._elements._list.find(".highlighted");b.removeClass("highlighted");a.element.addClass("highlighted")}this._ensureVisible(a)}},highlightedValue:function(){var a=this.options._elements._list.find(".dropdown-input-listitem.highlighted");return a.length>0?a.text():null},select:function(d,c){var a=this.getListItem(d),b;if(a){b={item:a.item,canceled:false};this.element.trigger("itemSelecting",b);if(!b.canceled){this.setValue(a.value);this.hideList(c);this.element.trigger("itemSelected",{item:a.item});return true}else{this.hideList(c);return false}}else return false},getValue:function(){return this.options._elements._input.attr("value")},setValue:function(a){this.options._elements._input.val(a);this._handleTextChange()},cancelSearch:function(a){this.element.trigger("cancelSearch",{focusControl:a})},completeSearch:function(){this.element.trigger("completeSearch")},startSearch:function(a){this.element.trigger("startSearch",{focusControl:a})},_addItem:function(e,h){var c="",b=null,f=null,d=e.text===undefined?e:e.text,i=d.toLowerCase(),g=0,k=0,a=0,l=this.options._valueList.length-1,j=d,m={deny:null,item:e};this.element.trigger("filterItem",m);if(!m.deny){if(h===undefined||h===null){while(k<=l){a=Math.round((k+l)/2);if(i<this.options._valueList[a].lowerValue){g=-1;l=a-1}else if(i>this.options._valueList[a].lowerValue){g=1;k=a+1}else{g=0;break}}if(g>0)a++}else{a=h;j=h}if(a<this.options._valueList.length)f=this.options._valueList[a].element;if(this.options.showDelete)c='<li class="dropdown-input-listitem deletable"><div class="dropdown-input-listitem-value" /><div class="dropdown-input-listitem-delete" /></li>';else c='<li class="dropdown-input-listitem"><div class="dropdown-input-listitem-value" /></li>';if(!f){this.options._elements._list.append(c);b=this.options._elements._list.children().last()}else{f.before(c);b=f.prev()}b.children(".dropdown-input-listitem-value").attr("title",d).text(d);this.options._valueList.splice(a,0,{element:b,lowerValue:i,markup:c,value:d,item:e,visible:true});b.bind("click",this,function(a){a.data.select(j,true)});b.bind("mousemove",this,function(a){!$(this).hasClass("highlighted")&&a.data._trackMousePosition(a)&&a.data.highlight(j)});this.options.showDelete&&b.find(".dropdown-input-listitem-delete").bind("click",this,function(a){a.data.element.trigger("removeItem",{value:$(this).parents(".dropdown-input-listitem").text()});a.preventDefault();a.stopPropagation()})}},_removeItem:function(c,b){var a=this.getListItem(b.value);if(a){this.options._valueList.splice(a.element.index(),1);a.element.remove();this.options._elements._list.find(".dropdown-input-listitem").length===0&&this.cancelSearch();this._updateControlState(true);this.element.trigger("itemRemoved",{value:b.value})}},_alignValue:function(){this.options._elements._autoComplete.scrollLeft(this.options._elements._input.scrollLeft())},_ensureVisible:function(h){for(var a,b,e,d,c,g=0,f=0;f<this.options._valueList.length;f++){c=this.options._valueList[f];if(c.visible){if(c.element===h.element){a=g;break}g++}}if(a===undefined)a=-1;d=h.element.outerHeight(true);b=a*d;e=b+d;if(b<this.options._elements._list.scrollTop())this.options._elements._list.scrollTop(b);else e-this.options._elements._list.height()>this.options._elements._list.scrollTop()&&this.options._elements._list.scrollTop(e-this.options._elements._list.height())},_trackMousePosition:function(a){if(this.options._lastMouseX!==a.pageX||this.options._lastMouseY!==a.pageY){this.options._lastMouseX=a.pageX;this.options._lastMouseY=a.pageY;return true}else return false},_updateControlState:function(i){var e,g,b=this.options._elements._input.val(),f,c=0,h=2048,d,a;this.options._autoCompleteValue=null;e=b.toLowerCase();for(d=0;d<this.options._valueList.length;d++){a=this.options._valueList[d];if((f=a.lowerValue.indexOf(e))===-1){a.element.hasClass("highlighted")&&a.element.removeClass("highlighted");if(this.options.filterList){a.element.hide();a.visible=false}else c++}else{if(f<h&&b.length>0){if(!i)this.options._autoCompleteValue=a.value;h=f}if(this.options.filterList){a.element.show();a.visible=true}c++}}if(this.options._autoCompleteValue&&this.options._autoCompleteValue.toLowerCase().indexOf(e)===0){g=b+this.options._autoCompleteValue.substring(b.length);this.options._elements._autoComplete.val(g)}else this.options._elements._autoComplete.val("");if(c>0){this.options._elements._noResults.hide();this.options._elements._list.show();if(c<=this.options.listSize){this.options._elements._list.removeClass("overflow");this.options._elements._list.height("")}else{this.options._elements._list.addClass("overflow");this.options._elements._list.height(Math.min(c,this.options.listSize)*this.options._elements._list.find(".dropdown-input-listitem").last().outerHeight(true))}}else{this.options._elements._list.height(Math.max(20,this.options._elements._list.find(".dropdown-input-listitem").first().outerHeight(true)));if(!this.options._elements._searching.is(":visible")){this.options._elements._noResults.show();this.options._elements._list.hide()}else{this.options._elements._noResults.hide();this.options._elements._list.show()}}if(this.options._autoCompleteValue)this.highlight(this.options._autoCompleteValue);else b.length===0&&this.highlight(0);this._updateStateIcon()},_updateStateIcon:function(){this.options._stateIcon&&this.options._elements._search.removeClass(this.options._stateIcon);if(this.options._searchActive)this.options._stateIcon="img_redx";else if(this.options._searchResult)this.options._stateIcon="img_grayx";else if(this.options.dynamicSearch)this.options._stateIcon="img_magnify";else if(this.options._elements._container.is(":visible"))this.options._stateIcon="img_collapse";else this.options._stateIcon="img_expand";this.options._elements._search.addClass(this.options._stateIcon)},_handleClick:function(){if(this.options._searchActive||this.options._searchResult)this.cancelSearch(true);else if(this.options._elements._list.is(":visible"))this.hideList(true);else this.startSearch(true)},_handleFocusOut:function(){this.getControlState()!=="inactive"&&this.hideList(false)},_handleKeyDown:function(b){var c=false,a;if(this.options.searchHotkey)if(mb(this.options.searchHotkey,b)){this.startSearch(true);c=true}if(b.keyCode===9){(this.getControlState()==="active"||this.options._elements._autoComplete.is(":visible")&&this.options._autoCompleteValue)&&this.select(this.options._autoCompleteValue,false);this.getControlState()!=="inactive"&&this.hideList(false)}else if(b.keyCode===13){if(this.getControlState()==="active")if(this.select(this.highlightedValue(),true))c=true}else if(b.keyCode===27){if(this.getControlState()!=="inactive"){this.hideList(true);c=true}}else if(b.keyCode===38){a=this.getListItem(this.highlightedValue());if(a){a=a.element.prevAll().filter(":visible").first();a.length>0&&this.highlight(a.text())}c=true}else if(b.keyCode===40){if(this.getControlState()==="inactive")if(this.options._searchResult)this.showList(true);else this.startSearch(true);else{a=this.getListItem(this.highlightedValue());if(a){a=a.element.nextAll().filter(":visible").first();a.length>0&&this.highlight(a.text())}else this.highlight(0)}c=true}else if(this.options.comboOnly)c=true;if(c){b.preventDefault();b.stopPropagation()}},_handleTextChange:function(){var a;a=this.options._elements._input.attr("value");if(a!==this.options._previousValue){a.length>0&&this.options.showListOnKeystroke&&this.options._valueList.length>0&&this.getControlState()==="inactive"&&this.showList(true);this._updateControlState();this.element.trigger("valueUpdated",{value:a});this.options._previousValue=a}this._alignValue()},_cancelSearch:function(b,a){this.options._searchActive=false;this.options._searchResult=false;this.options.dynamicSearch&&this.clear();this.hideList(a&&a.focusControl)},_completeSearch:function(b,a){this.options._searchActive=false;this.options._elements._searching.hide();if(this.options.dynamicSearch)this.options._searchResult=true;if(a&&a.focusControl){this.options._elements._input.focus();this.options._elements._autoComplete.show()}this._updateControlState()},_startSearch:function(b,a){if(this.getControlState()==="searching")return;this.options._searchActive=true;if(this.options.dynamicSearch){this.clear();this.options._elements._searching.show()}else this.completeSearch();this.showList(a&&a.focusControl);this.options.dynamicSearch&&b.data.element.trigger("querySearch",{value:b.data.getValue()})}});$.widget("TFS.DropdownList",{options:{items:[]},_create:function(){var a=$.extend({dynamicSearch:false,filterList:false},this.options);this.options._dropdownControl=this.element.Dropdown(a).data("Dropdown");this.options._dropdownControl.add(this.options.items)}});jQuery.fn.accessible=function(a){function c(f){var d,c,e;d=$(":tabbable");c=$(f.target);e=d.index(c);if(a){b.assertParamIsFunction(a,"handler");a.call(c,f)}else c.click();while(!c.is(":visible:tabbable")){c=d.eq(e++);if(c)if(c.is(":visible:tabbable")){c.focus();break}else continue;else break}return false}return this.addClass("propagate-keydown-event").attr("tabindex","0").keypress(function(a){if(a.keyCode===$.ui.keyCode.ENTER)return c(a)}).keyup(function(a){if(a.keyCode===$.ui.keyCode.SPACE)return c(a)})};c.Enhancement.registerEnhancement(T,".tfs-host-notifications");h.tfsModuleLoaded("TFS.UI.Controls.Common",g)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.OM",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/Generated/TFS.Common.Constants","Presentation/Scripts/TFS/Generated/TFS.Server.WebAccess.Constants","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/TFS.Core.Ajax","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/Resources/TFS.Resources.Common"],function(ib,b,fb,db,R,S,bb,cb,eb,Z,N){var d=fb,c=db,T=R,U=S,i=bb,f=cb,a=eb,e=Z,H=N,q=d.queueRequest,J=d.handleError,ab=e.TfsContext,y=e.ActionManager,Q=e.notificationService,w,v;(function(a){a.FavoriteItemAlreadyExist="TFS.OM.FavoriteItemAlreadyExist"})(v||(v={}));Error.favoriteItemAlreadyExist=function(b){var a=Error.create(c.StringUtils.format("Favorite item '{0}' already exist.",b),{name:v.FavoriteItemAlreadyExist});a.popStackFrame();return a};var M={},h=function(){function a(a){this.tfsContext=a;this.services={};this.httpClients={}}a._serviceHostKey="serviceHost";a.getConnection=function(d,b){var a,c;if(!b)throw Error.argumentNull("tfsContext");c=this.getConnectionLocation(d,b);a=M[c];if(!a){a=new d(b);M[c]=a}return a};a.getDefaultConnection=function(a){return this.getConnection(a,ab.getDefault())};a.getConnectionLocation=function(b,c){var a=this.getConnectionServiceHost(b,c);if(!a)throw Error.create("TfsContext is not supported");return a.relVDir.toUpperCase()};a.getConnectionServiceHost=function(a,b){return b.navigation[a._serviceHostKey]};a.prototype.getTfsContext=function(){return this.tfsContext};a.prototype.getCurrentUser=function(){return this.tfsContext.currentUser};a.prototype.getService=function(b){var a,c;if(!b)throw Error.argumentNull("serviceType");if(typeof b.prototype.initializeTfsObject!=="function")throw new Error("serviceType does not derive from TfsService");c=g.getServiceName(b);a=this.services[c];if(!a){a=new b;a.initializeTfsObject(this);this.services[c]=a}return a};a.prototype.getCurrentServiceHost=function(){return a.getConnectionServiceHost(this.constructor,this.tfsContext)};a.prototype.getLocation=function(){return a.getConnectionLocation(this.constructor,this.tfsContext)};a.prototype.getHttpClient=function(c){var a,b,e;if(!c)throw Error.argumentNull("httpClientType");b="tfsHttpClient."+d.getTypeName(c);a=this.httpClients[b];if(!a){e=this.tfsContext.navigation.serviceHost.vDir;a=new c(e);this.httpClients[b]=a}return a};return a}();b.TfsConnection=h;d.initClassPrototype(h,{tfsContext:null,services:null});var O=function(b){__extends(a,b);function a(a){b.call(this,a)}a._serviceHostKey="applicationServiceHost";a.getConnection=function(b){return h.getConnection(a,b)};a.getDefaultConnection=function(){return h.getDefaultConnection(a)};return a}(h);b.TfsConfigurationServer=O;var j=function(b){__extends(a,b);function a(a){b.call(this,a)}a._serviceHostKey="collection";a.getConnection=function(b){return h.getConnection(a,b)};a.getDefaultConnection=function(){return h.getDefaultConnection(a)};return a}(h);b.TfsTeamProjectCollection=j;var g=function(){function a(){}a._serviceName=null;a.getServiceName=function(a){return a._serviceName||"tfsService."+d.getTypeName(a)};a.prototype.getTfsContext=function(){return this.tfsConnection.tfsContext};a.prototype.getServiceName=function(){return a.getServiceName(this.constructor)};a.prototype.getLocation=function(){return this.tfsConnection.getLocation()};a.prototype.initializeTfsObject=function(a){this.tfsConnection=a};return a}();b.TfsService=g;d.initClassPrototype(g,{tfsConnection:null});var s=function(b){__extends(a,b);function a(){b.call(this)}return a}(g);b.CollectionLevelTfsService=s;var t=function(b){__extends(a,b);function a(){b.call(this)}return a}(g);b.InstanceLevelTfsService=t;(function(a){a._map=[];a.User=1;a.Team=2;a.UserAndTeam=3;a.Project=4})(b.WebSettingsScope||(b.WebSettingsScope={}));var k=b.WebSettingsScope,u=function(c){__extends(b,c);function b(){c.call(this)}b.prototype.canAccessTeamSettings=function(){var a=this.getTfsContext();return Boolean(a.currentTeam)};b.prototype.beginWriteSetting=function(e,a,c,h,d,g){var b;if(typeof a==="boolean")b="setBoolean";else if(typeof a==="number"){a=parseInt(a);b="setInteger"}else{b="setString";if(typeof a==="undefined")a=null;else if(a!==null&&typeof a!=="string")a=$.param(a)}if(typeof c==="undefined")c=k.User;return f.postMSJSON(this._getApiLocation(b,this._getContext(c)),{path:e,value:a,scope:c},h,d,g)};b.prototype.beginReadSetting=function(c,a,e,b,d){if(typeof a==="undefined")a=k.User;return f.getMSJSON(this._getApiLocation("readSetting",this._getContext(a)),{path:c,scope:a},e,b,d)};b.prototype._getApiLocation=function(b,a){return this.getTfsContext().getActionUrl(b,"webSettings",{area:"api",team:a.team,project:a.project,serviceHost:this.tfsConnection.getCurrentServiceHost()})};b.prototype._getContext=function(c){var b;if(c===k.User)b={team:"",project:""};else{a.assert(this.canAccessTeamSettings(),"team settings are inaccessible");b={team:this.getTfsContext().currentTeam.name}}return b};return b}(g);b.WebSettingsService=u;var B=function(){function b(b){a.assertParamIsObject(b,"tagData");if(b.hasOwnProperty("tagId"))this.id=b.tagId;if(b.hasOwnProperty("name"))this.name=b.name;if(b.hasOwnProperty("projectScope"))this.projectScope=b.projectScope}b.create=function(a){return new b(a||{})};b.prototype.update=function(b){a.assertParamIsObject(b,"tagDefinition");a.assert(b.id===this.id,"Invalid Tag definition provided for update");this.name=b.name;this.projectScope=b.projectScope};return b}();b.TagDefinition=B;d.initClassPrototype(B,{id:null,name:null});var L=function(d){__extends(b,d);function b(){d.call(this);this._tagDefinitionsCache={};this._allKnownTagDefinitions=[]}b.CONTROLLER_NAME="Tag";b.ACTION_QUERY_TAG_DEFINITIONS="QueryTagDefinitions";b.WORK_ITEM_ARTIFACT_KIND="E7626DBD-6075-416C-A31E-DFD48FE3CFDE";b.prototype.getKnownTagDefinitions=function(){return this._allKnownTagDefinitions.slice(0)};b.prototype.getKnownTagDefinition=function(f,e){var b,d,a;for(b=0,d=this._allKnownTagDefinitions.length;b<d;b++){a=this._allKnownTagDefinitions[b];if(c.StringUtils.localeIgnoreCaseComparer(a.name,f)===0&&c.StringUtils.localeIgnoreCaseComparer(a.projectScope,e)===0)return a}return null};b.prototype.beginQueryTagDefinitions=function(c,g,e,j){a.assertParamIsFunction(e,"callback");a.assertParamIsArray(c,"artifactApplicableKinds");var i=this,d=g+":"+c.join(";"),h;if(this._tagDefinitionsCache.hasOwnProperty(d)){a.logTracePoint("TagService.queryTagDefinitionsCached.start");h=this._tagDefinitionsCache[d];a.logTracePoint("TagService.queryTagDefinitionsCached.completed");e(h);return}a.logTracePoint("TagService.queryTagDefinitionsRoundtrip.start");f.getMSJSON(this._getApiLocation(b.ACTION_QUERY_TAG_DEFINITIONS),{artifactKinds:c,projectScope:g},function(j){var b,h,c,f=[],g=j||[];for(b=0,h=g.length;b<h;b++){c=new B(g[b]);f.push(c);i._addTagDefinition(c)}i._tagDefinitionsCache[d]=f;a.logTracePoint("TagService.queryTagDefinitionsRoundtrip.completed");e(f)},j,{cache:false})};b.prototype.invalidateCacheForArtifactKinds=function(b,c){var a=c+":"+b.join(";");if(this._tagDefinitionsCache.hasOwnProperty(a))delete this._tagDefinitionsCache[a]};b.prototype._getApiLocation=function(c){a.assertParamIsString(c,"action");return this.getTfsContext().getActionUrl(c,b.CONTROLLER_NAME,{area:"api"})};b.prototype._addTagDefinition=function(b){a.assertParamIsObject(b,"tagDefinition");var c,e,d;for(c=0,e=this._allKnownTagDefinitions.length;c<e;c++){d=this._allKnownTagDefinitions[c];if(d.id===b.id){d.update(b);return}}this._allKnownTagDefinitions.push(b)};return b}(g);b.TagService=L;d.initClassPrototype(L,{_tagDefinitionsCache:null,_allKnownTagDefinitions:null});var F=function(d){__extends(b,d);function b(){d.call(this);this._featureStatesCache={}}b.FA_RESOURCE_NAME="FeatureFlags";b.isFeatureEnabled=function(c){var a=j.getConnection(e.TfsContext.getDefault()).getService(b);return a.isFeatureEnabledLocal(c)};b.prototype.beginIsFeatureEnabled=function(b,d,e){a.assertParamIsString(b,"featureName");a.assertParamIsFunction(d,"callback");var g=this,c=this._readLocalState(b);if(c!==undefined&&c!==null){d(c);return}f.getMSJSON(this._getApiLocation(b),null,function(c){a.assertParamIsObject(c,"featureInfo");var e=c.EffectiveState==="On"||c.effectiveState==="On";g._featureStatesCache[b]=e;d(e)},e)};b.prototype.isFeatureEnabledLocal=function(d){a.assertParamIsString(d,"featureName");var b=this._readLocalState(d);(b===undefined||b===null)&&a.fail(c.StringUtils.format("Requested feature {0} could not be found in local data island.",d));return b};b.prototype._getApiLocation=function(d){a.assertParamIsString(d,"featureName");return c.StringUtils.format("/_apis/{0}/{1}",b.FA_RESOURCE_NAME,d)};b.prototype._readLocalState=function(b){a.assertParamIsString(b,"featureName");this._checkDataIsland();return this._featureStatesCache[b]};b.prototype._getDataIsland=function(){return $(".feature-availability-data")};b.prototype._checkDataIsland=function(){var a;if(!this._checkedForDataIsland){this._checkedForDataIsland=true;a=this._getDataIsland();if(a.length>0){this._featureStatesCache=i.parseMSJSON(a.eq(0).html(),false);a.eq(0).empty()}}};return b}(t);b.FeatureAvailabilityService=F;d.initClassPrototype(F,{_featureStatesCache:null,_checkedForDataIsland:false});var E=function(c){__extends(b,c);function b(){c.call(this)}b.TFS_ROOT_PATH_TOKEN="{TfsRootPath}";b.TFS_RESOURCES_PATH_TOKEN="{TfsResourcesPath}";b.prototype.beginGetIntegrations=function(c,b,d){a.assertParamIsString(c,"endPoint");a.assertParamIsFunction(b,"callback");var e=this;this._getAllIntegrations(function(d){var a=[];$.each(d,function(d,b){b.end_point===c&&a.push(b)});b.call(e,a)},d)};b.prototype._getApiLocation=function(b){a.assertParamIsString(b,"action");return this.getTfsContext().getActionUrl(b,"Extensions",{area:"api",team:"",project:""})};b.prototype._replaceUrlTokens=function(a){var c=null;if(!a)return a;c=this.getTfsContext().configuration;a=a.replace(b.TFS_ROOT_PATH_TOKEN,c.getRootPath());a=a.replace(b.TFS_RESOURCES_PATH_TOKEN,c.getResourcesPath());return a};b.prototype._getAllIntegrations=function(b,d){var c=this;a.assertParamIsFunction(b,"callback");q(this,this,"_integrations",b,d,function(a,b){f.getMSJSON(c._getApiLocation("Integrations"),{fallThrough:true},function(b){b=b||[];$.each(b,function(b,a){if(a.url!=="undefined")a.url=c._replaceUrlTokens(a.url);a.properties={};a._properties&&$.each(a._properties,function(c,b){if(b&&b.name)a.properties[b.name]=b.value})});a(b)},b)})};return b}(g);b.ExtensionManagementService=E;d.initClassPrototype(E,{_integrations:null});var l=function(){function a(b,a){this.favStore=b;if(a){this.id=a.id;this.name=a.name;this.parentId=a.parentId;this.type=a.type;this.data=a.data}}a.FAVITEM_TYPE_WIT_QUERYITEM="Microsoft.TeamFoundation.WorkItemTracking.QueryItem";a.FAVITEM_TYPE_VC_PATH="Microsoft.TeamFoundation.VersionControl.Path";a.FAVITEM_TYPE_BUILD_DEFINITION="Microsoft.TeamFoundation.Build.Definition";a.prototype.path=function(a){return i.calculateTreePath.call(this,a,"/","name","root")};a.prototype.beginRename=function(a,e,d){var b=this,c;if(this.parent&&this.parent._findChildItem(a,this.type,this.data))J(Error.favoriteItemAlreadyExist(a),d,this);else{c=$.extend({},this);c.name=a;this.favStore.beginUpdateItems([c],function(){b.name=a;$(window).trigger("favorite-item-renamed",b);$.isFunction(e)&&e.call(b,b)},d)}};a.prototype.beginDelete=function(b,a){this.favStore.beginDeleteItems([this],b,a)};a.prototype.onDelete=function(b,a){!a&&this.parent&&this.parent.remove(this);delete this.favStore.all[this.id];b&&$(window).trigger("favorite-item-removed",this)};return a}();b.FavoriteItem=l;d.initClassPrototype(l,{favStore:null,id:null,name:null,parentId:null,parent:null,type:null,data:null});var p=function(d){__extends(b,d);function b(a,b){d.call(this,a,b);this.children=[]}b.prototype.add=function(b,d){a.assertIsObject(b,"favItem");this.children.push(b);b.parent=this;d!==true&&this.children.sort(function(a,b){return c.StringUtils.localeIgnoreCaseComparer(a.name,b.name)})};b.prototype.remove=function(b){a.assertParamIsObject(b,"favItem");c.ArrayUtils.remove(this.children,b)};b.prototype.clear=function(){this.children=[]};b.prototype.findByPath=function(b){a.assertParamIsString(b,"path");return i.findTreeNode.call(this,b,"/",c.StringUtils.localeIgnoreCaseComparer,"name")};b.prototype.findByData=function(d){a.assertParamIsString(d,"data");var c,b,e;for(b=0,e=this.children.length;b<e;b++){c=this.children[b];if(c.data===d)return c}return null};b.prototype.beginCreateNewFolder=function(c,b,a){this.beginCreateNewItem(c,null,null,b,a)};b.prototype.beginCreateNewItem=function(d,f,i,h,g){var a,e=this,c;if(this._findChildItem(d,f,i))J(Error.favoriteItemAlreadyExist(d),g,this);else{c={id:undefined,parentId:this.id,name:d,type:f,data:i};if(f)a=new l(this.favStore,c);else a=new b(this.favStore,c);this.favStore.beginUpdateItems([a],function(){e.add(a);e.favStore.all[a.id]=a;$(window).trigger("favorite-item-created",a);$.isFunction(h)&&h.call(e,a)},g)}};b.prototype.onDelete=function(b,a){$.each(this.children,function(b,a){a.onDelete(false,true)});d.prototype.onDelete.call(this,b,a)};b.prototype._findChildItem=function(f,g,e){a.assertParamIsString(f,"name");a.assertParamIsString(g,"type");a.assertParamIsString(e,"data");var b,d,h;for(d=0,h=this.children.length;d<h;d++){b=this.children[d];if(c.StringUtils.localeIgnoreCaseComparer(f,b.name)===0&&b.type===g&&b.data===e)return b}return null};return b}(l);b.FavoriteFolder=p;d.initClassPrototype(p,{children:null});var gb={};function Y(c,b){var a;a={area:"api"};b=b||c.navigation.topMostLevel;if(b>=e.NavigationContextLevels.Application){if(b<e.NavigationContextLevels.Team){a.ignoreDefaultTeam=true;a.team=""}if(b<e.NavigationContextLevels.Project)a.project="";if(b<e.NavigationContextLevels.Collection)a.serviceHost=""}return a}var A=function(b){__extends(a,b);function a(a,c,d,e,g,f){b.call(this,null,{id:g,name:f});this.favStore=this;this._tfsContext=a;this._routeData=c;this._identity=d;this._scope=e;this.all={}}a.FAVORITE_STORE_SCOPE_FAVORITE_QUERIES="WorkItemTracking.Queries";a.FAVORITE_STORE_SCOPE_FAVORITE_BUILD_DEFINITIONS="Build.Definitions";a.FAVORITE_STORE_SCOPE_FAVORITE_PATHS="VersionControl.Paths";a.beginGetFavoriteStore=function(c,i,b,f,j,h,g){var d,e;if(b===null)b=undefined;d=Y(c,i);e=c.getActionUrl("list","favorites",$.extend({},d,{identityId:b,scope:f}));q(this,gb,e,h,g,function(h,i){var g=new a(c,d,b,f,e,j);g.beginRefresh(function(){h(g)},i)})};a.prototype.beginRefresh=function(b,d){var a,c=this;a=this._tfsContext.getActionUrl("list","favorites",this._routeData);f.getMSJSON(a,{identityId:this._identity,scope:this._scope},function(a){c._populateItems(a);$.isFunction(b)&&b.call(c)},d)};a.prototype.beginDeleteItems=function(a,d,e){var g=this,c,b;if(a&&a.length){b=this._tfsContext.getActionUrl("delete","favorites",this._routeData);c=$.map(a,function(a){return a.id});f.postMSJSON(b,{identityId:this._identity,scope:this._scope,favItemIds:c},function(){$.each(a,function(b,a){a.onDelete(true)});$.isFunction(d)&&d.call(g,a)},e)}};a.prototype.beginUpdateItems=function(a,d,g){var e=this,b,c;if(a&&a.length){c=this._tfsContext.getActionUrl("update","favorites",this._routeData);b=$.map(a,function(a){return i.stringifyMSJSON({id:a.id,parentId:a.parentId===e.id?undefined:a.parentId,name:a.name,type:a.type,data:a.data})});f.postMSJSON(c,{identityId:this._identity,scope:this._scope,favItemJsons:b},function(b){$.each(b,function(c,b){a[b.index].id=b.id});$.isFunction(d)&&d.call(e,a)},g)}};a.prototype._populateItems=function(e){var a={},f,b,d,g=this;this.clear();if(e){e.sort(function(a,b){return c.StringUtils.localeIgnoreCaseComparer(a.name,b.name)});$.each(e,function(d,c){var b;if(!c.type)b=new p(g,c);else b=new l(g,c);a[b.id]=b})}for(f in a)if(a.hasOwnProperty(f)){b=a[f];d=a[b.parentId];if(d)d.add(b,true);else this.add(b,true)}this.all=a};return a}(p);b.FavoriteStore=A;d.initClassPrototype(A,{root:true,all:null,_tfsContext:null,_identity:null,_routeData:null,_scope:null});var K=function(){function a(a){this.store=a.store;this.error=a.error}a.PREFERENCES_STORE_SCOPE="Preferences";a.PREFERENCES_ITEM_TYPE="Microsoft.TeamFoundation.Preference";a.beginGetPreferenceStore=function(c,e,f,d,b){A.beginGetFavoriteStore(c,e,null,a.PREFERENCES_STORE_SCOPE,f,function(b){d(new a({store:b}))},function(c){b(new a({error:c}))})};a.prototype.getValue=function(b){var a;if(this.store)a=this.store.findByPath(b);return a?a.data:null};a.prototype.setValue=function(f,e,d,c){var b;if(this.store){b=this.store.findByPath(f);if(b){b.data=e;this.store.beginUpdateItems([b],d,c)}else this.store.beginCreateNewItem(f,a.PREFERENCES_ITEM_TYPE,e,d,c)}};return a}();b.Preferences=K;d.initClassPrototype(K,{store:null,error:null});var C=function(c){__extends(b,c);function b(){c.call(this);this._teamMembers={}}b.prototype.beginGetTeamMembers=function(c,b,d,i,h){var g,e=this.getTfsContext();if(!c){a.assertIsNotNull(e.currentTeam,"Current context is not a team context.");c=e.currentTeam.identity.id}d=d||100;b=Boolean(b);g=c+"|"+d+"|"+b;q(this,this._teamMembers,g,i,h,function(a,g){var h=e.getActionUrl("members","teams",{area:"api"});f.getMSJSON(h,{teamId:c,maxResults:d,includeGroups:b},function(b){a(b.members)},g)})};return b}(t);b.TeamService=C;d.initClassPrototype(C,{_teamMembers:null});var o=function(){function b(){}b.VSTFS="vstfs:///";b.URI_SEPARATOR="/";b.encodeUri=function(c){a.assertIsNotNull(c,"Artifact should not be null");a.assertParamIsString(c.tool,"Artifact tool should be string");a.assertParamIsString(c.type,"Artifact type should be string");a.assertParamIsString(c.id,"Artifact ID should be string");return b.VSTFS+[encodeURIComponent(c.tool),encodeURIComponent(c.type),encodeURIComponent(c.id)].join(b.URI_SEPARATOR)};b.decodeUri=function(d){var f,e;a.assertParamIsString(d,"Artifact URI should be string");if(d.length>b.VSTFS.length){f=d.substr(0,b.VSTFS.length).toLowerCase();if(f===b.VSTFS){e=d.substr(b.VSTFS.length).split(b.URI_SEPARATOR);if(e.length===3)return{uri:d,tool:b.legacyDecodeURIComponent(e[0]),type:b.legacyDecodeURIComponent(e[1]),id:b.legacyDecodeURIComponent(e[2])}}}throw new Error(c.StringUtils.format(H.InvalidArtifactUri,d));};b.legacyDecodeURIComponent=function(c){var b;a.assertParamIsString(c,"encodedURIComponent should be string");b=c.replace(/\+/g," ");b=decodeURIComponent(b);return b};return b}();b.LinkingUtilities=o;var m=function(){function a(a){this._data=a;if(!this._data.uri)this._data.uri=o.encodeUri({tool:this.getTool(),type:this.getType(),id:this.getId()})}a._execute=function(a,d){var b=a.getUrl(d);if(b)y.performAction(e.CommonActions.ACTION_WINDOW_OPEN,{url:b,target:"_blank"});else alert(c.StringUtils.format(H.UnknownArtifactType,a.getType()))};a.ACTION_ARTIFACT_EXECUTE="artifact-execute";a.prototype.getUri=function(){return this._data.uri};a.prototype.getTool=function(){return this._data.tool};a.prototype.getType=function(){return this._data.type};a.prototype.getId=function(){return this._data.id};a.prototype.getTitle=function(){return this.getUri()};a.prototype.setError=function(a){this._error=a};a.prototype.getError=function(){return this._error};a.prototype.execute=function(b){return y.performAction(a.ACTION_ARTIFACT_EXECUTE,{artifact:this,tfsContext:b})};a.prototype.getUrl=function(){return null};return a}();b.Artifact=m;d.initClassPrototype(m,{_data:null,_error:null});y.registerActionWorker(m.ACTION_ARTIFACT_EXECUTE,function(a){return m._execute(a.artifact,a.tfsContext)});var W=function(){function b(){}b._combineUri=function(c,d){a.assertParamIsStringNotEmpty(c,"part1");a.assertParamIsStringNotEmpty(d,"part2");return b._ensureUriReadyForAppend(c)+d};b._ensureUriReadyForAppend=function(b){a.assertParamIsStringNotEmpty(b,"originalUri");return b.lastIndexOf("/")===b.length-1?b:b+"/"};b.ALM_SCHEME="tfs://";b.COLLECTION_PARAM_NAME="cn";b.PROJECT_PARAM_NAME="p";b.WORK_ITEM_ID_PARAM_NAME="wid";b.MFBCLIENT_SCHEME="mfbclient://";b.MFBCLIENTS_SCHEME="mfbclients://";b.FEEDBACK_REQUEST_IDS_PARAM_NAME="rid";b.ENCODED_PARAM_NAME="__params";b.browserRequiresParamEncoding=function(){return $.browser.msie&&parseInt($.browser.version,10)<10};b.beginBuildUri=function(l,k,j,c,g,n){a.assertParamIsString(l,"areaName");a.assertParamIsString(k,"actionName");a.assertParamIsBool(j,"includeTfsContext");a.assertParamIsFunction(g,"completionCallback");c&&a.assertParamIsArray(c,"parameters");var m=b.ALM_SCHEME+l+"/"+k,d,h,i=b.browserRequiresParamEncoding();c=c||[];if(j){d=e.TfsContext.getDefault();a.assert(d.navigation.collection&&d.navigation.collection.uri,"Collection uri not available in context");c.splice(0,0,{name:b.COLLECTION_PARAM_NAME,value:d.navigation.collection.uri})}h=b.buildQueryParameterString(c);if(i)f.getMSJSON(d.getActionUrl("Base64EncodeValue","common",{area:"api"}),{value:b.buildQueryParameterString(c,i)},function(a){g.call(this,m+h+"&"+b.ENCODED_PARAM_NAME+"="+a)},n);else g.call(this,m+h)};b.beginBuildCreateStoryboardUri=function(d,c,e){a.assertParamIsArray(d,"workItemIds");a.assertParamIsFunction(c,"completionCallback");b.beginBuildUri(T.ToolNames.Requirements,"CreateStoryboard",true,[{name:b.WORK_ITEM_ID_PARAM_NAME,value:d.join(",")}],c,e)};b.buildFeedbackClientUri=function(f){a.assertParamIsArray(f,"workItemIds");a.assert(f.length>0,"You must pass at least one work item id");var d,g=[],c=e.TfsContext.getDefault();d=c.navigation.publicAccessPoint.scheme==="https"?b.MFBCLIENTS_SCHEME:b.MFBCLIENT_SCHEME;d+=c.navigation.publicAccessPoint.authority+c.navigation.collection.vDir;d+=b.PROJECT_PARAM_NAME+":"+c.navigation.project;g.push({name:b.FEEDBACK_REQUEST_IDS_PARAM_NAME,value:f.join(",")});return d+b.buildQueryParameterString(g)};b.buildQueryParameterString=function(d,e){a.assertParamIsArray(d);var c="",b;$.each(d,function(a){b=d[a];c+=a===0?"?":"&";c+=encodeURIComponent(b.name)+"=";if(e||b.doNotEncode)c+=b.value;else c+=encodeURIComponent(b.value)});return c};return b}();b.AlmUriBuilder=W;var X=function(){function b(){}b.launchUri=function(b){a.assertParamIsString(b,"almUri");var c=$.browser.msie&&parseInt($.browser.version,10)>=10;if(c||window.navigate)e.ActionManager.performAction(e.CommonActions.ACTION_WINDOW_NAVIGATE,{url:b});else e.ActionManager.performAction(e.CommonActions.ACTION_WINDOW_OPEN,{url:b,target:"_blank"})};return b}();b.AlmUriManager=X;function x(a){return a.toLowerCase()}var I={};function P(e){var c,f,d,b,a={};for(c=0,f=e.length;c<f;c++){d=o.decodeUri(e[c]);b=x(d.tool);if(!a[b])a[b]=[];a[b].push(d)}return a}var z=function(b){__extends(a,b);function a(){b.call(this)}a.MODE_TRANSLATEURL="translateURL";a.registerArtifactResolver=function(b,a){I[x(b)]=a};a.getArtifactResolver=function(a){return I[x(a)]};a.prototype.beginResolveArtifacts=function(j,l,k){var o,f,n,d,b,c;o=this;f=this.getTfsContext();c=$.extend({tfsContext:f},l);n=c.mode;b={results:[],resolving:0};function h(e,d){var a,f,c=[],b;for(a=0,f=e.length;a<f;a++){b=new m(e[a]);d&&b.setError(d);c.push(b)}return c}function g(){b.resolving===0&&k(b.results)}function e(a,c){b.resolving-=1;b.results=b.results.concat(a.success?a.artifacts:h(c,a.error));g()}function i(f,b){var d=a.getArtifactResolver(f);if(d){d(b,c,function(a){e(a,b)},function(a){e({success:false,error:a},b)});return true}return false}d=P(j);$.each(d,function(){b.resolving+=1});$.each(d,function(b,a){!i(b,a)&&e({success:false,error:Error.create("NoResolver")},a)});g()};return a}(s);b.ClientLinking=z;e.urlHelper.registerUrlTranslator(function(b,f,h,g,d){var a;if(b&&c.StringUtils.startsWith(b,o.VSTFS,c.StringUtils.ignoreCaseComparer)){a=f&&f.tfsContext||e.TfsContext.getDefault();j.getConnection(a).getService(z).beginResolveArtifacts([b],{mode:z.MODE_TRANSLATEURL},function(b){if(b&&b.length===1&&!b[0].getError())h(b[0].getUrl(a));else d()},g)}else d()});var G=function(c){__extends(b,c);function b(){c.call(this)}b.contextSupports=function(a){return a.currentTeam};b.prototype.beginGetTeamMembers=function(b,c,d,e){a.assertParamIsBool(b,"includeGroups");a.assertParamIsNumber(c,"maxResults");a.assertParamIsFunction(d,"callback");this.tfsConnection.getService(C).beginGetTeamMembers(null,b,c,d,e)};b.prototype.beginGetTeamSettings=function(b,c){a.assertParamIsFunction(b,"callback");var d=this;this._checkDataIsland();q(this,this,"_teamSettings",b,c,function(a,b){var c=d.getTfsContext().getActionUrl("teamSettings","wit",{area:"api"});f.getMSJSON(c,null,function(b){a(b)},b)})};b.prototype.getTeamSettings=function(){this._checkDataIsland();return this._teamSettings};b.prototype._checkDataIsland=function(){var a;if(!this._checkedForDataIsland){this._checkedForDataIsland=true;a=$(".team-settings-data");if(a.length>0){this._teamSettings=i.parseMSJSON(a.eq(0).html(),false);a.eq(0).empty()}}};return b}(g);b.TeamAwarenessService=G;d.initClassPrototype(G,{_teamSettings:null,_checkedForDataIsland:false});var n=function(){function a(a){this.plural=a.plural;this.singular=a.singular;this.category=a.category;this.parentCategory=a.parentCategory;this.workItemCountLimit=a.workItemCountLimit;this.states=a.states}a.prototype.containsWorkItemType=function(a){return c.ArrayUtils.contains(this.workItemTypeNames,a,c.StringUtils.localeIgnoreCaseComparer)};a.prototype.getIntermediateBacklogs=function(b){var e=[];if(!b)return[];var d=this.compare(b);if(d===0)return[];var a=d===1?this:b,f=d===1?b:this;while(a){c.StringUtils.ignoreCaseComparer(a.category,this.category)!==0&&e.push(a);if(c.StringUtils.ignoreCaseComparer(a.category,f.category)===0)break;a=a.child}return e};a.prototype.getIntermediateBacklogNames=function(b){var a=this.getIntermediateBacklogs(b);return $.map(a,function(a){return a.plural})};a.prototype.compare=function(b){if(!b)return 1;var a=this.child;while(a){if(c.StringUtils.ignoreCaseComparer(a.category,b.category)===0)return 1;a=a.child}a=this.parent;while(a){if(c.StringUtils.ignoreCaseComparer(a.category,b.category)===0)return-1;a=a.parent}return 0};return a}();b.BacklogCategoryConfiguration=n;var r=function(){function b(a){var c=this;this.taskBacklog=new n(a.taskBacklog);this.requirementBacklog=new n(a.requirementBacklog);this.portfolioBacklogs=$.map(a.portfolioBacklogs,function(a){return new n(a)});this.allBacklogs=this.portfolioBacklogs.concat([this.requirementBacklog,this.taskBacklog]);this.workItemCategories=a.workItemCategories;this._workItemTypeCategoryMap={};this._backlogCategoryNameMap={};var b=null;$.each(this.allBacklogs,function(e,d){if(b!==null){b.child=d;d.parent=b}b=d;d.workItemTypeNames=a.workItemCategories[d.category];d.isRequirementCategory=d===c.requirementBacklog;d.defaultWorkItemType=a.defaultWorkItemTypes[d.category];$.each(d.workItemTypeNames,function(b,a){c._workItemTypeCategoryMap[a]=d.category});c._backlogCategoryNameMap[d.category]=d});this.bugWorkItems=a.bugWorkItems;this.feedbackWorkItems=a.feedbackWorkItems;this.feedbackRequestWorkItems=a.feedbackRequestWorkItems;this.feedbackResponseWorkItems=a.feedbackResponseWorkItems;this.releaseWorkItems=a.releaseWorkItems;this.signoffTaskWorkItems=a.signoffTaskWorkItems;this.stageWorkItems=a.stageWorkItems;this.typeFields=a.typeFields;this.weekends=a.weekends}b.StateType={Proposed:1,InProgress:2,Complete:3,Requested:4,Received:5,Reviewed:6,Declined:7,Resolved:8};b.FieldType={Effort:1,Order:2,RemainingWork:3,Team:4,Activity:5,Requestor:6,ApplicationType:7,ApplicationStartInformation:8,ApplicationLaunchInstructions:9,FeedbackNotes:10,ClosedDate:11};b.prototype.getCategoryForWorkItemType=function(a){return this._workItemTypeCategoryMap[a]};b.prototype.getCategoryForCategoryRefName=function(a){return this._backlogCategoryNameMap[a]};b.prototype.getTypeField=function(b){a.assertParamIsNumber(b,"fieldType");var c;$.each(this.typeFields,function(d,a){if(a.type===b){c=a;return false}});return c};return b}();b.ProjectProcessConfiguration=r;var D=function(b){__extends(a,b);function a(){b.call(this)}a.prototype.beginGetProcessSettings=function(b,c){var a=this,e=function(c){if(!a._processSettings)a._processSettings=new r(c);b.apply(a,[a._processSettings])};this._checkDataIsland();d.queueRequest(this,this,"_processSettingsInternal",e,c,function(a,b){var c=this.getTfsContext().getActionUrl("getProcessSettings","processConfiguration",{area:"api"});f.getMSJSON(c,null,a,b)})};a.prototype._checkDataIsland=function(){var a;if(!this._checkedForDataIsland){this._checkedForDataIsland=true;a=$(".process-settings-data");if(a.length>0){this._processSettingsInternal=i.parseMSJSON(a.eq(0).html(),false);a.eq(0).empty()}}};a.prototype.getProcessSettings=function(){this._checkDataIsland();if(!this._processSettings&&this._processSettingsInternal)this._processSettings=new r(this._processSettingsInternal);return this._processSettings};return a}(s);b.ProjectProcessConfigurationService=D;d.initClassPrototype(D,{_processSettingsInternal:null,_processSettings:null});Q.attachEvent("notification-dismissed",function(d,b){if(typeof b==="undefined")b=k.User;a.assertParamIsStringNotEmpty(d,"id");function c(){}j.getDefaultConnection().getService(u).beginWriteSetting(U.Messages.DismissNotificationRegistryPath+d,true,b,c,c)});var V=function(){function a(b){var a=this;this._witPrimaryColorsMap={};this._witSecondaryColorsMap={};this._witColorsDefined=false;b&&$.each(b,function(c,b){a._witPrimaryColorsMap[b.WorkItemTypeName.toLowerCase()]="#"+b.PrimaryColor.substring(2);a._witSecondaryColorsMap[b.WorkItemTypeName.toLowerCase()]="#"+b.SecondaryColor.substring(2);a._witColorsDefined=true})}a.DEFAULT_PRIMARY_WORKITEM_COLOR="#009CCC";a.DEFAULT_SECONDARY_WORKITEM_COLOR="#D6ECF2";a.getDefault=function(){if(!w){var b=i.parseJsonIsland($(document),".workitemype-colors");w=new a(b)}return w};a.prototype.isWorkItemColorsDefined=function(){return this._witColorsDefined};a.prototype.getPrimaryWorkItemTypeColor=function(c){var b=this._witPrimaryColorsMap[c.toLowerCase()];if(!b)b=a.DEFAULT_PRIMARY_WORKITEM_COLOR;return b};a.prototype.getSecondaryWorkItemTypeColor=function(c){var b=this._witSecondaryColorsMap[c.toLowerCase()];if(!b)b=a.DEFAULT_SECONDARY_WORKITEM_COLOR;return b};return a}();b.ColorsProvider=V;(function(c){function b(a,d,c){var b=e.TfsContext.getDefault();a=b.currentTeam.identity.id+a;j.getConnection(b).getService(u).beginWriteSetting("/"+a,d,k.User,c)}function f(d,c,e){a.assertParamIsString(d,"name");a.assertParamIsString(c,"value");b(d,c,e)}c.saveTeamUserStringSetting=f;function d(d,c,e){a.assertParamIsString(d,"name");a.assertParamIsNumber(c,"value");b(d,c,e)}c.saveTeamUserNumberSetting=d;function g(d,c,e){a.assertParamIsString(d,"name");a.assertParamIsBool(c,"value");b(d,c,e)}c.saveTeamUserBoolSetting=g})(b.ContextUtils||(b.ContextUtils={}));var hb=b.ContextUtils;d.tfsModuleLoaded("TFS.OM",b)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.Host.UI",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.UI.Controls","Presentation/Scripts/TFS/TFS.UI.Controls.Common","Presentation/Scripts/TFS/Resources/TFS.Resources.Common","Presentation/Scripts/TFS/TFS.UI.Controls.Menus","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/TFS.OM","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.Core.Ajax","Presentation/Scripts/TFS/TFS.UI","Presentation/Scripts/TFS/Generated/TFS.Server.WebAccess.Constants"],function(U,b,R,J,C,A,D,K,M,P,N,Q,O,L,B){var j=R,c=J,f=C,a=A,I=D,d=K,o=M,u=P,t=N,i=Q,S=O,g=L,G=B,e=u.delegate,m=d.TfsContext,h=g.domElem,x="App_Themes",r="HighContrast";d.ActionManager.registerActionWorker(d.CommonActions.ACTION_WINDOW_UNLOAD,function(){if(d.runningDocumentsTable.isModified())return d.runningDocumentsTable.getUnsavedItemsMessage()});(function(a){a.ACTION_MANAGE_TEAM_MEMBERS="manage-team-members";a.ACTION_MANAGE_AREAS="manage-areas";a.ACTION_MANAGE_ITERATIONS="manage-iterations";a.ACTION_REQUEST_FEEDBACK="request-feedback"})(b.HostActions||(b.HostActions={}));var T=b.HostActions;function w(){var b=$(window);function a(){try{return d.ActionManager.performAction(d.CommonActions.ACTION_WINDOW_UNLOAD,{})}catch(a){alert(a)}}b.bind("beforeunload",a).bind("unload",function(){b.unbind("beforeunload",a)})}w();var n=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.initialize=function(){this._element.addClass("noDrop");this._$inputLabel=$(h("label","searchbox-label hidden")).attr("for","searchbox").appendTo(this._element);this._input=$(h("input","search-text")).attr("type","text").attr("id","searchbox").attr("disabled","disabled").focus(function(){$(this).parent().addClass("input-focus")}).blur(function(){$(this).parent().removeClass("input-focus")}).keydown(e(this,this.onKeyDown)).appendTo(this._element);$(h("span","icon icon-search")).appendTo(this._element).click(e(this,this.doSearch));this._$dropIcon=$(h("span","icon icon-drop")).appendTo(this._element).click(e(this,this.showDropdownMenu));this._$popupElement=$(h("div","search-popup")).appendTo(this._element);b.prototype.initialize.call(this);i.logTracePoint("SearchBox.ctor.complete")};a.prototype.setAdapter=function(a){var b;this._searchAdapter=a;b=a.getWatermarkText();this._input.Watermark({watermarkText:b});this._$inputLabel.text(b);this._input.attr("title",a.getTooltip());this._input.removeAttr("disabled");this._element.toggleClass("noDrop",!a.hasDropdown());this.resetDropdownMenu()};a.prototype.resetDropdownMenu=function(){this._$popupElement.empty();this._popup=null};a.prototype.onKeyDown=function(a){if(a.keyCode===g.KeyCode.ENTER){this.doSearch();return false}else if(a.keyCode===g.KeyCode.DOWN||a.keyCode===g.KeyCode.PAGE_DOWN){this.showDropdownMenu();return false}};a.prototype.doSearch=function(){var a=$.trim(this._input.val());if(a&&this._searchAdapter){this._searchAdapter.performSearch(a);this.resetDropdownMenu()}};a.prototype.showDropdownMenu=function(){if(this._searchAdapter&&this._searchAdapter.hasDropdown()){if(!this._popup)this._popup=c.BaseControl.createIn(I.PopupMenu,this._$popupElement,{align:"right-bottom",items:[{childItems:this._searchAdapter.getDropdownMenuItems}],executeAction:e(this,this._onMenuItemClick)});this._popup.popup(this._input,this._element)}};a.prototype._onMenuItemClick=function(a){if(a.get_commandName()==="search-shortcut"){this._appendShortcut(a.get_commandArgument());return false}else{this._input.val(a.get_commandArgument().search);this.doSearch();return false}};a.prototype._appendShortcut=function(b){var a,d,c;a=this._input.val();a+=a.length>0?" ":"";a+=b.search||"";a+=b.operator||":";a+='"';c=a.length;a+=b.defaultValue||"";d=a.length;a+='"';this._input.val(a);this._selectDefaultValue(c,d)};a.prototype._selectDefaultValue=function(c,d){var a,b=this._input[0];if(b.setSelectionRange)b.setSelectionRange(c,d);else if(b.createTextRange){a=b.createTextRange();a.move("character",c);a.moveEnd("character",d-c);a.select()}};return a}(c.BaseControl);b.SearchBox=n;c.Enhancement.registerEnhancement(n,".search-box");var H=function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype._enhance=function(b){var a=c.Enhancement.ensureEnhancement(n,b);a&&a.setAdapter(this)};a.prototype.hasDropdown=function(){return false};a.prototype.getDropdownMenuItems=function(c,a){a([])};a.prototype.getWatermarkText=function(){return""};a.prototype.getTooltip=function(){return this.getWatermarkText()};a.prototype.performSearch=function(){i.fail("SearchAdapter must override performSearch.")};return a}(c.Enhancement);b.SearchAdapter=H;var k=function(c){__extends(b,c);function b(a){c.call(this,a)}b._typeName="tfs.sidebarSearch";b.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({coreCssClass:"sidebar-search"},a))};b.prototype.getSearchWaterMarkText=function(){return a.SidebarSearchWatermark};b.prototype.initialize=function(){var d=this.getSearchWaterMarkText(),a,b;a=this._element.find(".search-input-wrapper");if(a.length===0)a=$("<div class='search-input-wrapper' />").appendTo(this._element);b=$("<div class='search-input-container' />").appendTo(a);this._input=$("<input type='text' class='input' />").appendTo(b).attr("title",d).Watermark({watermarkText:d});this._button=$("<span class='icon icon-search button' />").appendTo(a);this._attachEvents();c.prototype.initialize.call(this)};b.prototype.focus=function(){this._input.Watermark("focus")};b.prototype._changeSearchIcon=function(a){this._button.addClass(a?"icon-search":"icon-delete");this._button.removeClass(a?"icon-delete":"icon-search")};b.prototype.clearSearch=function(){this._fire("clearSearch")};b.prototype.executeSearch=function(a){this._fire("executeSearch",{searchText:a})};b.prototype._attachEvents=function(){this._bind(this._input,"mouseup",e(this,this._onSearch));this._bind(this._input,"keyup",e(this,this._onSearch));this._bind(this._button,"click",e(this,this._onClearSearch))};b.prototype._onSearch=function(b){var a;a=$.trim(this._input.val());if(b.keyCode===g.KeyCode.ESCAPE){this._onClearSearch();return}this.cancelDelayedFunction("onSearch");if(a){this._changeSearchIcon(false);this.delayExecute("onSearch",this._options.eventTimeOut||250,true,function(){this.executeSearch(a)})}else this._clearSearch()};b.prototype._onClearSearch=function(){this._input.val("");this._input.blur();this._clearSearch()};b.prototype._clearSearch=function(){this._changeSearchIcon(true);this.clearSearch()};return b}(c.BaseControl);b.SidebarSearch=k;j.initClassPrototype(k,{_input:null,_button:null});j.classExtend(k,d.TfsContext.ControlExtensions);c.Enhancement.registerEnhancement(k,".sidebar-search.enhance");var E=function(){function b(){}b.ADD_TO_MY_FAVORITES_ACTION="add-to-my-favorites";b.ADD_TO_TEAM_FAVORITES_ACTION="add-to-team-favorites";b.REMOVE_FROM_MY_FAVORITES_ACTION="remove-from-my-favorites";b.REMOVE_FROM_TEAM_FAVORITES_ACTION="remove-from-team-favorites";b.ITEM_SECURITY_ACTION="item-security";b.addToMyFavs=function(){return{id:b.ADD_TO_MY_FAVORITES_ACTION,text:a.AddToMyFavoritesTitle,title:a.AddToMyFavoritesTooltipText,icon:"icon-favorite-in"}};b.addToTeamFavs=function(){return{id:b.ADD_TO_TEAM_FAVORITES_ACTION,text:a.AddToTeamFavoritesTitle,title:a.AddToTeamFavoritesTooltipText}};b.removeFromMyFavs=function(){return{id:b.REMOVE_FROM_MY_FAVORITES_ACTION,text:a.RemoveFromMyFavoritesTitle,title:a.RemoveFromMyFavoritesTooltipText,icon:"icon-favorite-out"}};b.removeFromTeamFavs=function(){return{id:b.REMOVE_FROM_TEAM_FAVORITES_ACTION,text:a.RemoveFromTeamFavoritesTitle,title:a.RemoveFromTeamFavoritesTooltipText}};b.security=function(){return{id:b.ITEM_SECURITY_ACTION,text:a.ItemSecurityTitle,title:a.ItemSecurityTooltipText,icon:"icon-admin"}};return b}();b.CommonMenuItems=E;var F=function(){function b(){}b._createContainerNode=function(b,d,e){var a=c.TreeNode.create(b);a.folder=true;a.type=d;a.noContextMenu=true;a.config={css:e+" folder",unselectable:true};return a};b.myFavorites=function(b){return this._createContainerNode(a.MyFavoritesText,"my",b)};b.teamFavorites=function(b){return this._createContainerNode(a.TeamFavoritesText,"team",b)};b.allItems=function(b,c){return this._createContainerNode(b||a.AllItemsText,"all",c)};return b}();b.CommonTreeNodes=F;function q(d){var c,b=$(d),a=b.data("entryHashCode");if(a){c=m.getDefault().getActionUrl("RemoveNavigationMRUEntry","common",{area:"api"});S.postHTML(c,{mruEntryHashCode:a},function(){b.closest("li").remove()})}}$(function(){$(".welcome-project-list .icon-delete").click(function(a){q(a.target);return false}).bind("keydown",function(a){if(a.keyCode===g.KeyCode.ENTER||a.keyCode===g.KeyCode.SPACE){q(a.target);return false}})});i.logTracePoint("Host.Navigation.initialization-complete");function z(c,b,g,e,d,f){var a;if(!c)c=m.getDefault();a=$(h("img","identity-picture"));d&&a.attr("title",d);e&&a.addClass(e);f&&a.attr("alt",f);a.attr("src",c.getIdentityImageUrl(b,g));b&&a.addClass("identity-"+b);return a}b.identityImageElement=z;var y=function(){function a(){}a.findRegex=/^.+\/App_Themes\/([^\/]+)\/([^\/]+)\.css$/i;a.replaceRegex=/\/App_Themes\/([^\/]+\/[^\/]+)\.css$/i;a.execute=function(){var d,b,c=false;b=$("<span class='high-contrast-test' style='width:0;height:0' />").appendTo(document.body);if(b.css("background-image")==="none")d=$("head > link").each(function(){var d,b=a.findRegex.exec(this.href);if(b&&b[1]!==r){c=true;d=b[2];this.href=this.href.replace(a.replaceRegex,"/"+x+"/"+r+"/"+d+".css")}});b.remove()};return a}();$(function(){y.execute()});(function(a){a._map=[];a.Unknown=0;a.Post=1;a.Navigate=2})(b.WebAccessExtensionFrameLoadBehavior||(b.WebAccessExtensionFrameLoadBehavior={}));var p=b.WebAccessExtensionFrameLoadBehavior;(function(a){a._map=[];a.None=0;a.Smart=1})(b.WebAccessExtensionFrameHandshakeBehavior||(b.WebAccessExtensionFrameHandshakeBehavior={}));var v=b.WebAccessExtensionFrameHandshakeBehavior,l=function(d){__extends(b,d);function b(a){d.call(this,a);this._queuedMessages=[];this._messageListeners=[]}b.Actions={SET_CONFIGURATION:"set-configuration",EXTENSION_LOADED:"extension-loaded",EXTENSION_READY:"extension-ready",EXTENSION_LOAD_ERROR:"extension-load-error"};b.Events={EXTENSION_LOAD_FAILED:"extension-host-load-failed",SLOW_LOAD_WARNING:"extension-host-slow-load-warning",EXTENSION_MESSAGE_RESIZED:"extension-message-resized"};b.MAX_WAIT_FOR_LOADED_EVENT=3e3;b.prototype.getIFrame=function(){return this._$iframe};b.prototype.getWindow=function(){return this._$iframe[0].contentWindow};b.prototype.getIntegrationUrl=function(){return this._integration.url};b.prototype.initializeOptions=function(a){d.prototype.initializeOptions.call(this,$.extend({integration:null,postData:null,messageListener:null,coreCssClass:"extension-host-control"},a,{errorOptions:$.extend({showSlowLoadWarningMessage:true,slowLoadWarningDuration:2e4,showLoadFailedMessage:true,formatErrorMessage:null},a&&a.errorOptions)}))};b.prototype.initialize=function(){var d=this,g;this._integration=this._options.integration;i.assertIsObject(this._integration,"_options.integration");i.assertIsString(this._integration.url,"_options.integration.url");this._$container=$("<div />").addClass("extension-host-container").appendTo(this._element);this._iframeId="extensionHost"+c.getId();if(this._integration.loadBehavior===p.Post){g=$("<form />").attr("method","post").attr("target",this._iframeId).attr("action",this._integration.url).appendTo(this._$container);$("<input />").attr("type","hidden").attr("name","requestJson").attr("value",t.stringifyMSJSON(this.createHostContext())).appendTo(g)}this._$iframe=$("<iframe frameborder='0' src=\"javascript:''\" />").addClass("extension-iframe").attr("id",this._iframeId).attr("name",this._iframeId).appendTo(this._$container);if(this._integration.handshake===v.Smart){this._$iframe.addClass("loading");this._$statusContainer=$("<div />").addClass("status-container").appendTo(this._$container);this._statusControl=c.BaseControl.createIn(f.StatusIndicator,this._$statusContainer,{center:true,imageClass:"big-status-progress",message:a.ExternalControlLoading});this._statusControl.start();$(window).bind("message."+this._iframeId,e(this,this._handleMessageReceived));$.isFunction(this._options.messageListener)&&this.addMessageListener(this._options.messageListener);this._$iframe.load(function(){d.cancelDelayedFunction("slowLoadTimeout");!d._receivedLoadedEvent&&!d._loadFailed&&d.delayExecute("waitForLoadedEvent",b.MAX_WAIT_FOR_LOADED_EVENT,true,function(){!d._receivedLoadedEvent&&!d._disposed&&!d._loadFailed&&d._handleLoadError(null)})});this.delayExecute("slowLoadTimeout",this._options.errorOptions.slowLoadWarningDuration,true,function(){if(!d._disposed&&!d._loadFailed){d._options.errorOptions.showSlowLoadWarningMessage&&d._showExtensionMessage(f.MessageAreaType.Warning,a.ExtensionSlowLoadWarningHeader,a.ExtensionSlowLoadWarningBody,false,false);d._fire(b.Events.SLOW_LOAD_WARNING,[d])}})}if(this._integration.loadBehavior===p.Post)g[0].submit();else this._$iframe.attr("src",this._integration.url)};b.prototype.createHostContext=function(){var b,a;b=this._options.tfsContext;a=this._options.postData||{};a.isHosted=b.isHosted;a.cssUrl=b.getHostUrl()+b.configuration.getThemedFile("Site.css");a.jsSDKUrl=b.getHostUrl()+__moduleManager.getConfig().options.baseUrl+"Presentation/Scripts/TFS/VS.SDK.js";a.locationHash=Sys.Application.get_stateString();a.currentCulture=Sys.CultureInfo.CurrentCulture.name;a.theme=b.configuration.getTheme();a.userContext=b.currentIdentity;a.navigationContext={};a.navigationContext.hostUrl=b.navigation.publicAccessPoint.uri;a.navigationContext.hostName=b.navigation.applicationServiceHost.name;a.navigationContext.collectionName=b.navigation.collection?b.navigation.collection.name:null;a.navigationContext.projectName=b.navigation.project;a.navigationContext.teamName=b.navigation.team;a.navigationContext.level=b.navigation.topMostLevel;return a};b.prototype.setConfiguration=function(a){this._configuration=a;this._receivedReadyEvent&&this.postMessage(b.Actions.SET_CONFIGURATION,a)};b.prototype.postMessage=function(d,b,c){var a={actionId:d||"",actionData:b||{},requestId:c};if(this._receivedReadyEvent)this._sendMessage(a);else this._queuedMessages.push(a)};b.prototype.addMessageListener=function(a){i.assertIsFunction(a,"listener");this._messageListeners.push(a)};b.prototype._dispose=function(){$(window).unbind("message."+this._iframeId);d.prototype._dispose.call(this)};b.prototype._showExtensionMessage=function(m,l,k,h,j){var d=this,e,i,g;if(this._options.errorOptions.showLoadFailedMessage!==false){e=$("<div />");i=$("<div />").html(k).appendTo(e);if(!h){i.find("a").text(this._integration.url).attr("href",this._integration.url).attr("target","blank");$("<br />").appendTo(e);$("<div />").html(a.ExtensionErrorAdditionalSteps).appendTo(e)}this._options.errorOptions&&$.isFunction(this._options.errorOptions.formatErrorMessage)&&this._options.errorOptions.formatErrorMessage.call(this,e,h)}g={type:m,header:l,content:e};if(!this._messageArea){this._messageArea=c.Enhancement.enhance(f.MessageAreaControl,$("<div />").prependTo(this._element),{closeable:true,expanded:j,message:g});this._$container.css("padding-top",this._messageArea._element.height()+20+"px");this._messageArea._bind(f.MessageAreaControl.EVENT_DISPLAY_COMPLETE,function(){d._$container.css("padding-top",d._messageArea._element.height()+20+"px");d._fire(b.Events.EXTENSION_MESSAGE_RESIZED,[d])});this._messageArea._bind(f.MessageAreaControl.EVENT_DISPLAY_CLEARED,function(){d._$container.css("padding-top","0");d._messageArea=null;d._fire(b.Events.EXTENSION_MESSAGE_RESIZED,[d])});this._fire(b.Events.EXTENSION_MESSAGE_RESIZED,[d])}else{this._messageArea.setMessage(g);j&&this._messageArea.setErrorDetailsVisibility(true)}};b.prototype._hideLoadingIndicator=function(){this._$iframe.removeClass("loading");if(this._statusControl){this._statusControl.dispose();this._$statusContainer.remove();this._statusControl=null;this._$statusContainer=null}};b.prototype._sendMessage=function(a){!this._disposed&&this._$iframe[0].contentWindow.postMessage(JSON.stringify(a),"*")};b.prototype._handleMessageReceived=function(f){var e=this,c=f&&f.originalEvent,d=c&&c.origin,a;if(!this._disposed&&c&&c.source===this._$iframe[0].contentWindow&&d)if(e._integration.url.toLowerCase().indexOf(d.toLowerCase())===0||d.toLowerCase().indexOf((window.location.protocol+"//"+window.location.host).toLowerCase())===0){a=t.parseMSJSON(c.data,false)||{};if(!this._receivedLoadedEvent&&a.actionId===b.Actions.EXTENSION_LOADED){this._receivedLoadedEvent=true;this._hideLoadingIndicator()}else if(!this._receivedReadyEvent&&a.actionId===b.Actions.EXTENSION_READY){this._receivedReadyEvent=true;this._configuration&&this.postMessage(b.Actions.SET_CONFIGURATION,this._configuration);$.each(this._queuedMessages,function(b,a){e._sendMessage(a)})}else a.actionId===b.Actions.EXTENSION_LOAD_ERROR&&this._handleLoadError(a.actionData&&a.actionData.errorMessage);$.each(this._messageListeners,function(c,b){b.call(e,a)})}};b.prototype._handleLoadError=function(e){var d=false,c;this._loadFailed=true;this._hideLoadingIndicator();if($.isFunction(this._options.errorOptions.getFallbackControl)){c=this._options.errorOptions.getFallbackControl.call(this);d=c!==null&&c.length;if(d){c.appendTo($("<div />").addClass("fallback-control").appendTo(this._$container));this._$iframe.hide()}}this._options.errorOptions.showLoadFailedMessage!==false&&this._showExtensionMessage(d?f.MessageAreaType.Warning:f.MessageAreaType.Error,a.ExtensionErrorHeader,e||a.ExtensionErrorBody,e?true:false,!d);this._fire(b.Events.EXTENSION_LOAD_FAILED,[this])};return b}(c.BaseControl);b.ExtensionHost=l;j.initClassPrototype(l,{_$container:null,_$iframe:null,_iframeId:null,_integration:null,_configuration:null,_queuedMessages:null,_receivedReadyEvent:false,_receivedLoadedEvent:false,_loadFailed:false,_messageListeners:null,_$statusContainer:null,_statusControl:null,_messageArea:null});j.classExtend(l,m.ControlExtensions);function s(){var a=d.TfsContext.getDefault(),b=$(".hub-groups-section li.selected:first"),c=b.data("hub-group"),e=b.data("hub-group-skip-mru-update");c!==undefined&&!e&&a.navigation.topMostLevel>=d.NavigationContextLevels.Project&&u.delay(this,2e3,function(){o.TfsTeamProjectCollection.getConnection(a).getService(o.WebSettingsService).beginWriteSetting(G.HubsConstants.MruHubPath+"/"+c,document.location.pathname,o.WebSettingsScope.UserAndTeam,null,null,{showGlobalProgressIndicator:false})})}b.setMruPage=s;$(function(){s()});$(window).bind("resize.tfs.event.subscription",function(a){a.target===window&&d.notificationService.fire("window-resize")});j.tfsModuleLoaded("TFS.Host.UI",b)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.UI.Controls.Data",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.UI"],function(p,d,o,m,l,k){var e=o,a=m,c=l,j=k,n=j.domElem,f=c.delegate,i=function(){function d(b,c){a.assertParamIsNotNull(b,"nodes");this._nodes=b;this._options=$.extend({allowEmpty:false,sort:null},c);this._isTree=b.length>0&&typeof b[0]==="object";this._events=new Sys.EventHandlerList;this._isTree&&this._sortChildren({children:this._nodes},true);this._populateNodeMappings()}d.TREE_PATH_SEPERATER_CHAR="\\";d.EVENT_NEW_ITEM="new-item-event";d.EVENT_REMOVED_ITEM="removed-item-event";d.EVENT_UPDATE_ITEM="updated-item-event";d.prototype.reparentNode=function(b,c){a.assertParamIsObject(b,"node");a.assertParamIsObject(c,"newParent");this.removeNode(b.id);this.addNode(b,c)};d.prototype.isValidValue=function(b){a.assertParamIsString(b,"value");if(b===""&&this._options.allowEmpty)return true;if(this._nodes.length===0)return b!=="";b=this._cleanupPath(b);return this._pathToNodeMap.hasOwnProperty(b)};d.prototype.isTree=function(){return this._isTree};d.prototype.getNodes=function(){return this._nodes};d.prototype.getNode=function(b){a.assertParamIsString(b,"nodeText");b=this._cleanupPath(b);return this._pathToNodeMap[b]||null};d.prototype.getNodeFromId=function(b){a.assertParamIsString(b,"nodeId");return this._idToNodeMap[b]||null};d.prototype.updateNode=function(c){a.assertParamIsObject(c,"node");var b=this.getNodeFromId(c.id);if(typeof b==="undefined"){a.fail("Expected to find the node in the tree when updating a node. ID: "+c.id);return null}if(b.parentId!==c.parentId){a.fail("Expected the parentId of the node to be the same. If you're re-parenting, remove the node, then re-add it. ID: "+c.id);return null}if(b.text!==c.text){this._clearCache(b);b.text=c.text;this._addNode(b.parent,b)}b.values=c.values.slice(0);b.parent&&this._sortChildren(b.parent);this._raiseUpdateItem({node:b});return b};d.prototype.getRootNode=function(){var a=this.getNodes(),b=null;if(a&&a.length>0)b=a[0];return b};d.prototype.getPreviousSiblingNode=function(f){a.assertParamIsString(f,"id");var b,g,e=null,d=this.getNodeFromId(f),c;if(d){c=d.parent?d.parent.children:this._nodes;for(b=0,g=c.length;b<g;b+=1){if(c[b]===d)break;e=c[b]}}return e};d.prototype.removeNode=function(e){a.assertParamIsString(e,"id");var b=this.getNodeFromId(e),d;if(b){d=this._getChildrenCount(b)+1;if(b.parent&&b.parent.children)b.parent.children=c.ArrayUtils.subtract(b.parent.children,[b]);this._clearCache(b);this._raiseRemovedItem({node:b,parent:b.parent,treeSize:d})}return b};d.prototype.addNode=function(b,d){a.assertParamIsObject(b,"node");a.assertParamIsObject(d,"parent");var e=d.children;if(this.getNodeFromId(b.id)){a.fail("Shouldn't be adding a node to the tree that already exists. Id: "+b.id);return null}if(!this.getNodeFromId(d.id)){a.fail(c.StringUtils.format("Couldn't find parent node in the tree when adding a child node. Parent Id: {0}; Child Id: {1}.",d.id,b.id));return null}e.push(b);b.parentId=d.id;this._sortChildren(d,false);this._sortChildren(b,true);this._addNode(d,b);this._raiseNewItem({node:b,parent:d});return b};d.prototype.cloneSource=function(){return[b.cloneNode(this.getRootNode())]};d.prototype.attachNewItem=function(b){a.assertParamIsFunction(b,"handler");this._events.addHandler(d.EVENT_NEW_ITEM,b)};d.prototype.detachNewItem=function(b){a.assertParamIsFunction(b,"handler");this._events.removeHandler(d.EVENT_NEW_ITEM,b)};d.prototype.attachRemovedItem=function(b){a.assertParamIsFunction(b,"handler");this._events.addHandler(d.EVENT_REMOVED_ITEM,b)};d.prototype.detachRemovedItem=function(b){a.assertParamIsFunction(b,"handler");this._events.removeHandler(d.EVENT_REMOVED_ITEM,b)};d.prototype.attachUpdateItem=function(b){a.assertParamIsFunction(b,"handler");this._events.addHandler(d.EVENT_UPDATE_ITEM,b)};d.prototype.detachUpdateItem=function(b){a.assertParamIsFunction(b,"handler");this._events.removeHandler(d.EVENT_UPDATE_ITEM,b)};d.prototype._populateNodeMappings=function(){var a,c,b=this._nodes;this._pathToNodeMap={};this._idToNodeMap={};if(this._isTree)for(a=0,c=b.length;a<c;a+=1)this._addNode(null,b[a]);else for(a=0,c=b.length;a<c;a+=1)this._pathToNodeMap[b[a]]=b[a]};d.prototype._sortChildren=function(e,f,b){a.assertParamIsObject(e,"node");var d=e.children||[],c=d.length;b=b||this._options.sort;if($.isFunction(b)){d.sort(b);if(f)while(c>0){c-=1;this._sortChildren(d[c],true,b)}}};d.prototype._addNode=function(e,b){var f,h,g=(e===null?"":e.path+d.TREE_PATH_SEPERATER_CHAR)+b.text;b.path=g;e&&a.assert(e.id===b.parentId,c.StringUtils.format("Expected the parent's id ({0}) to match the node's parentId ({1})",e.id,b.parentId));b.parent=e;this._pathToNodeMap[g]=b;this._idToNodeMap[b.id]=b;if(b.children)for(f=0,h=b.children.length;f<h;f+=1)this._addNode(b,b.children[f])};d.prototype._clearCache=function(a){var b,c;if(a){delete this._pathToNodeMap[a.path];delete this._idToNodeMap[a.id];if(a.children)for(b=0,c=a.children.length;b<c;b+=1)this._clearCache(a.children[b])}};d.prototype._cleanupPath=function(c){a.assertParamIsString(c,"path");var b=c;if(b.length>0&&this.isTree()&&b.charAt(b.length-1)===d.TREE_PATH_SEPERATER_CHAR)b=b.substr(0,b.length-1);return b};d.prototype._getChildrenCount=function(c){a.assertParamIsObject(c,"node");var d,e,b=0;if($.isArray(c.children)){b=c.children.length;for(d=0,e=b;d<e;d+=1)b+=this._getChildrenCount(c.children[d])}return b};d.prototype._raiseNewItem=function(c){a.assertParamIsObject(c,"args");var b=this._events.getHandler(d.EVENT_NEW_ITEM);b&&b(this,c)};d.prototype._raiseRemovedItem=function(c){a.assertParamIsObject(c,"args");var b=this._events.getHandler(d.EVENT_REMOVED_ITEM);b&&b(this,c)};d.prototype._raiseUpdateItem=function(c){a.assertParamIsObject(c,"args");var b=this._events.getHandler(d.EVENT_UPDATE_ITEM);b&&b(this,c)};return d}();d.FieldDataProvider=i;e.initClassPrototype(i,{_events:null,_nodes:null,_idToNodeMap:null,_pathToNodeMap:null,_isTree:false,_options:null});var b=function(){function b(b,c,d){a.assertParamIsObject(b,"fieldDataProvider");a.assertParamIsObject(c,"grid");this._grid=c;this._options=$.extend({},d);this.dataProvider=b;this.dataProvider.attachNewItem(f(this,function(b,a){this._addNewItem(a.node,a.parent)}));this.dataProvider.attachRemovedItem(f(this,function(b,a){this._removeItem(a.node,a.parent,a.treeSize)}));this.dataProvider.attachUpdateItem(f(this,function(b,a){this._updateItem(a.node)}))}b._ITEM_ID_DATA_SOURCE_INDEX=-1;b.bindAdapter=function(h,e,d,i){a.assertParamIsObject(e,"fieldDataProvider");a.assertParamIsObject(d,"grid");var b,g,c,f=new h(e,d,i);c=d._options.columns;for(b=0,g=c.length;b<g;b++)delete c[b].index;f.refresh();return f};b.cloneNode=function(d){var c=$.extend({},d),a,e;c.children=[];delete c.parent;for(a=0,e=d.children.length;a<e;a+=1)c.children[a]=b.cloneNode(d.children[a]);return c};b.prototype.getGrid=function(){return this._grid};b.prototype.refresh=function(d){var e=this.dataProvider.getNodes(),a=[],c=this._grid.getExpandStates(),b=[];if(c)a=c.slice(0);this._flattenedItems=[];this._createDataSource(e,this._flattenedItems,b,1);if(!d){this._expandStates=b;if(this._expandStates&&this._expandStates.length===a.length)this._expandStates=a;this._grid.setDataSource(this._flattenedItems,this._expandStates,this._grid._options.columns)}};b.prototype.getNodeForDataIndex=function(c){a.assertParamIsNumber(c,"dataIndex");var d=this._flattenedItems[c];return d?this.dataProvider.getNodeFromId(d[b._ITEM_ID_DATA_SOURCE_INDEX]):null};b.prototype.getParentNodeIndexForDataIndex=function(b){if(!b)return-1;a.assertParamIsNumber(b,"dataIndex");var d=this.getNodeForDataIndex(b),c=-1;if(d)c=this.getDataIndexFromNode(d.parent);return c};b.prototype.getDataIndexFromNode=function(b){a.assertParamIsObject(b,"node");return b.dataIndex};b.prototype.cloneSource=function(){return[b.cloneNode(this.fieldDataHelper.getNodes()[0])]};b.prototype._createDataSource=function(c,b,a,d){this._populateDataSource(c,b,a,d)};b.prototype._constructRow=function(c){var a=[].concat(c.values);a[b._ITEM_ID_DATA_SOURCE_INDEX]=c.id;return a};b.prototype._populateDataSource=function(c,e,d,h){var b,f=c.length,a,g;for(a=0,g=c.length;a<g;a+=1){b=e.length;c[a].dataIndex=b;e[b]=this._constructRow(c[a]);d[b]=0;if(typeof c[a].children!=="undefined"){d[b]=this._populateDataSource(c[a].children,e,d,h+1);f+=d[b]}}return f};b.prototype._addNewItem=function(d,c){this.refresh(true);var a=this.getDataIndexFromNode(d),b=this.getDataIndexFromNode(c);if(a===0)this._expandStates.splice(this._expandStates.length,0,0);else this._expandStates.splice(a,0,0);this._updateExpandStates(b,1)};b.prototype._removeItem=function(d,c,b){a.assertParamIsObject(d,"node");a.assertParamIsObject(c,"parent");a.assertParamIsNumber(b,"treeSize");var f=this.getDataIndexFromNode(d),e=this.getDataIndexFromNode(c);this._expandStates.splice(f,b);this._updateExpandStates(e,-b);this.refresh(true)};b.prototype._updateItem=function(b){a.assertParamIsObject(b,"node");var d=this.getDataIndexFromNode(b),c;this.refresh(true);c=this.getDataIndexFromNode(b);this._moveExpandStatesForNode(d,c)};b.prototype._updateExpandStates=function(e,d){a.assertParamIsNumber(e,"itemIndex");a.assertParamIsNumber(d,"increment");var b=e,c=this._expandStates;if(b>=0)do{if(c[b]<0)c[b]-=d;else c[b]+=d;b=this.getParentNodeIndexForDataIndex(b)}while(b>=0)};b.prototype._moveExpandStatesForNode=function(c,e){var f=Math.abs(this._expandStates[c])+1,b,a,d;b=this._expandStates.splice(c,f);for(d=b.length,a=d-1;a>=0;a-=1)this._expandStates.splice(e,0,b[a])};return b}();d.HierarchicalGridDataAdapter=b;e.initClassPrototype(b,{_flattenedItems:null,_grid:null,_expandStates:[],_options:{},_expandStatesManager:null,dataProvider:null,fieldDataHelper:null});var h=function(e){__extends(d,e);function d(g,c,b){e.call(this,g,c);a.assertParamIsObject(g,"fieldDataProvider");a.assertParamIsObject(c,"grid");a.assertParamIsObject(b,"options");this._events=new Sys.EventHandlerList;this._checkboxRangeRootId=b.rootNodeId||null;this._noCheckboxes=b.noCheckboxes;this._allEnabled=b.allEnabled===undefined?true:b.allEnabled;var f=this,i=c._options.columns,h={canSortBy:false,text:"",width:30,fixed:true,name:d.CHECK_COLUMN_NAME,getCellContents:function(g,a,c,h,b){return f._createCheckboxCell(a,b)}};if(!b.noColumn){i.splice(d._CHECKBOX_COLUMN_INDEX,0,h);c.getElement().keyup(function(d){var b,c,a;if(d.keyCode===j.KeyCode.SPACE){b=f._grid.getSelectedDataIndex();a=f._findCheckbox(b);if(a.length===1&&!a.attr("disabled")){c=!a.attr("checked");a.attr("checked",c);f._setCheckedState(a,b,c)}}})}this._disabledTooltip=b.disabledTooltip||"";if(b.disableChildren&&$.isFunction(b.disableChildren))this._disableChildren=b.disableChildren;else this._disableChildren=function(){return true};this._onBeforeCheckChanged=b.onBeforeCheckChanged;this.initialize(b.checkedItemIds||[])}d._CHECKBOX_COLUMN_INDEX=0;d._LABEL_COLUMN_INDEX=1;d._CHECK_CHANGED="checked-items-changed";d.CHECK_COLUMN_NAME="checks-column";d.prototype.initialize=function(b){var c,a,d;c={};for(a=0,d=b.length;a<d;a+=1)c[b[a]]=b[a];this._checkedItems=c;this._blockedCheckIds={}};d.prototype.hasCheckBox=function(b){a.assertParamIsNumber(b,"dataIndex");return b>=this._checkboxRangeBegin&&b<=this._checkboxRangeEnd};d.prototype.updateCheckboxesRange=function(c){a.assertParamIsArray(c,"expandStates",false);var b,e,d;if(this._checkboxRangeRootId){b=this.dataProvider.getNodeFromId(this._checkboxRangeRootId);if(b){d=this.getDataIndexFromNode(b);e=Math.abs(c[d]);this._checkboxRangeBegin=b.dataIndex+1;this._checkboxRangeEnd=b.dataIndex+e}}else if(this._noCheckboxes){this._checkboxRangeBegin=-1;this._checkboxRangeEnd=-1}else{this._checkboxRangeBegin=0;this._checkboxRangeEnd=this._flattenedItems.length-1}};d.prototype.isLeafNode=function(b){a.assertParamIsObject(b,"node");return this._expandStates[b.dataIndex]===0};d.prototype.blockCheck=function(b){a.assertParamIsString(b,"id");this._blockedCheckIds[b]=true;this._grid.updateRow(undefined,this._getDataIndexFromId(b))};d.prototype.unblockCheck=function(b){a.assertParamIsString(b,"id");if(this._blockedCheckIds.hasOwnProperty(b)){delete this._blockedCheckIds[b];this._grid.updateRow(undefined,this._getDataIndexFromId(b))}};d.prototype.setCheckboxRangeRoot=function(b){a.assertParamIsString(b,"id");this._checkboxRangeRootId=b;this.refresh()};d.prototype.getCheckboxRangeRoot=function(){return this._checkboxRangeRootId};d.prototype.attachCheckedItemsChanged=function(b){a.assertParamIsFunction(b,"handler");this._events.addHandler(d._CHECK_CHANGED,b)};d.prototype.detachCheckedItemsChanged=function(b){a.assertParamIsFunction(b,"handler");this._events.removeHandler(d._CHECK_CHANGED,b)};d.prototype._createDataSource=function(n,m,f,o){var a,l,h=[],c,k,g=d._CHECKBOX_COLUMN_INDEX,i=b._ITEM_ID_DATA_SOURCE_INDEX,j;e.prototype._createDataSource.call(this,n,m,f,o);c=this._flattenedItems;this.updateCheckboxesRange(f);for(a=0,l=f.length;a<l;a++)if(this.hasCheckBox(a)){k=Math.abs(f[a]);h[a]=true;if(this._disableChildren(c[a][i])&&c[a][g]){j=a;while(a<j+k){h[++a]=false;c[a][g]=false;delete this._checkedItems[c[a][i]]}}}else{delete this._checkedItems[c[a][i]];c[a][g]=false}this._itemStates=h};d.prototype.setItemState=function(b,c){a.assertIsNotNull(b,"id");a.assertParamIsBool(c,"enabled");if(c)this._checkedItems[b]=b;else delete this._checkedItems[b]};d.prototype.getItemChecked=function(a){return this._grid.getColumnValue(a,d._CHECKBOX_COLUMN_INDEX)};d.prototype.setItemTitle=function(c,b){a.assertParamIsString(c,"id");a.assertParamIsString(b,"title");var e=this._getDataIndexFromId(c),d=this._findCheckbox(e);d.attr("title",b)};d.prototype.resetItemTitle=function(b){a.assertParamIsString(b,"id");var d=this._getDataIndexFromId(b),c=this._findCheckbox(d);this._setCheckboxDefaultTitle(c)};d.prototype.getCheckedItemIds=function(){var a,j,i=[],k=d._CHECKBOX_COLUMN_INDEX,h=b._ITEM_ID_DATA_SOURCE_INDEX,c,e=this._flattenedItems,g=this._itemStates,f;c={};for(a=0,j=g.length;a<j;a++)if(g[a]&&e[a][k])c[e[a][h]]=e[a][h];this._checkedItems=c;for(f in c)c.hasOwnProperty(f)&&i.push(c[f]);return i};d.prototype.setCheckboxStateData=function(c,g){a.assert(typeof c==="number","Expected to be a number");a.assert(typeof g==="boolean","Expected to be a number");var e,i=Math.abs(this._expandStates[c]),f=this._grid._dataSource,h=f[c][b._ITEM_ID_DATA_SOURCE_INDEX];f[c][d._CHECKBOX_COLUMN_INDEX]=g;if(this._disableChildren(h))for(e=c+1;e<=c+i;e++){f[e][d._CHECKBOX_COLUMN_INDEX]=false;this.setItemState(f[e][b._ITEM_ID_DATA_SOURCE_INDEX],false);this._itemStates[e]=!g;this._grid.updateRow(undefined,e)}this.setItemState(h,g);this._grid.updateRow(undefined,c)};d.prototype.getCheckboxState=function(b){a.assertParamIsNumber(b,"dataIndex");var c=this._grid._dataSource;return b>=0?c[b][d._CHECKBOX_COLUMN_INDEX]:false};d.prototype.getItemEnabled=function(a){return this._allEnabled&&this._itemStates[a]&&!this._blockedCheckIds[this._getIdFromDataIndex(a)]};d.prototype.getBranchCheckedState=function(){var b=true,g=this._grid._dataSource,e=this.dataProvider.getRootNode(),a=[],c,f;if(e)a=e.children;if(!a||a.length===0)b=false;else for(c=0,f=a.length;c<f&&b;c+=1)b=g[a[c].dataIndex][d._CHECKBOX_COLUMN_INDEX];return b};d.prototype._constructRow=function(b){a.assertParamIsObject(b,"sourceRow");var c=e.prototype._constructRow.call(this,b),f=this._checkedItems.hasOwnProperty(b.id);c.splice(d._CHECKBOX_COLUMN_INDEX,0,f);return c};d.prototype._getCheckboxCellId=function(b){a.assertParamIsNumber(b,"dataIndex");var d=this._grid._getId()||"";return c.StringUtils.format("checkbox-{0}-{1}",d,b)};d.prototype._findCheckbox=function(d){a.assertParamIsNumber(d,"dataIndex");var c=this._getCheckboxCellId(d),b=$("#"+c);a.assert(b.length<=1,"Expected there to be at most one checkbox with the given ID: "+c+", instead saw: "+b.length);return b};d.prototype._createCheckboxCell=function(b,h){a.assertParamIsNumber(b,"dataIndex");a.assertParamIsObject(h,"column");a.assert(d._CHECKBOX_COLUMN_INDEX===h.index,c.StringUtils.format("Expected that the checkbox column is in position {0}. Actual index is {1}",d._CHECKBOX_COLUMN_INDEX,h.index));var e,i=this._getCheckboxCellId(b),g,l,k,j;e=$(n("div","grid-cell"));e.width(h.width||20);if(this.hasCheckBox(b)){k=this.getItemEnabled(b);j=this.getItemChecked(b);l=$("<label class='hidden' for='"+i+"'/>").text(this._grid.getColumnValue(b,d._LABEL_COLUMN_INDEX));e.append(l);g=$("<input type='checkbox' tabindex='-1' id='"+i+"'>").data("checkbox-data-index",b).attr("checked",j).attr("disabled",!k);this._setCheckboxDefaultTitle(g);g.click(f(this,this._onCheckboxClicked));e.append(g)}return e};d.prototype._onCheckboxClicked=function(e){a.logTracePoint("TFS.UI.Controls.Data.ChecklistDataAdapter._onCheckboxClicked.start");var b=$(e.currentTarget),c,d;c=b.data("checkbox-data-index");d=b.is(":checked");this._setCheckedState(b,c,d)};d.prototype._setCheckedState=function(d,a,b){var c=true;if($.isFunction(this._onBeforeCheckChanged))c=this._onBeforeCheckChanged(a,b);if(c){this.setCheckboxStateData(a,b);this._raiseCheckedItemsChanged({id:this._getIdFromDataIndex(a)})}else d.attr("checked",!b)};d.prototype._raiseCheckedItemsChanged=function(c){a.assertParamIsObject(c,"args");var b=this._events.getHandler(d._CHECK_CHANGED);b&&b(this,c)};d.prototype._setCheckboxDefaultTitle=function(b){a.assertParamIsJQueryObject(b,"$checkbox");a.assert(b.length<=1,"Expected at most one checkbox to be passed in. Got: "+b.length);b.attr("title",b.attr("disabled")?this._disabledTooltip:"")};d.prototype._getIdFromDataIndex=function(c){a.assertParamIsNumber(c,"dataIndex");return this._flattenedItems[c][b._ITEM_ID_DATA_SOURCE_INDEX]};d.prototype._getDataIndexFromId=function(c){a.assertParamIsString(c,"id");var b=this.dataProvider.getNodeFromId(c);a.assert(Boolean(b),"Expected to find a node for id: "+c);return b?b.dataIndex:undefined};return d}(b);d.ChecklistDataAdapter=h;e.initClassPrototype(h,{_checkedItems:null,_itemStates:null,_events:null,_disabledTooltip:null,_checkboxRangeRootId:null,_checkboxRangeBegin:null,_checkboxRangeEnd:null,_allEnabled:true,_blockedCheckIds:null,_disableChildren:null,_noCheckboxes:null});var g=function(){function b(b,c){a.assertParamIsObject(b,"grid");this._options=c;this._grid=b}b.prototype.getTableFromSelectedItems=function(){a.logTracePoint("TFS.UI.Controls.Data.TabDelimitedTableFormatter.getTableFromSelectedItems.start");var e=this._grid,f=e.getSelectedDataIndices(),b=new c.StringBuilder,d;d=e.getColumns();if(f.length===0||d.length===0)return"";$.each(d,function(d,a){d>0&&b.append(c.StringUtils.tab);b.append(a.text)});b.appendNewLine();$.each(f,function(a,f){a>0&&b.appendNewLine();b.append($.map(d,function(a){return e.getColumnText(f,a)}).join(c.StringUtils.tab))});a.logTracePoint("TFS.UI.Controls.Data.TabDelimitedTableFormatter.getTableFromSelectedItems.complete");return b.toString()};return b}();d.TabDelimitedTableFormatter=g;e.initClassPrototype(g,{_options:null,_grid:null});e.tfsModuleLoaded("TFS.UI.Controls.Data",d)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.UI.Controls.Grids",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.UI.Controls","Presentation/Scripts/TFS/TFS.UI.Controls.Menus","Presentation/Scripts/TFS/Resources/TFS.Resources.Platform","Presentation/Scripts/TFS/TFS.UI.Controls.Common","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/TFS.UI.Controls.Data","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/TFS.UI"],function(G,i,F,C,E,y,w,t,u,z,D,x,A){var n=F,f=C,a=E,h=y,q=w,v=t,o=u,j=z,d=D,B=x,e=A,m=a.log,l=a.LogVerbosity.Verbose,c=f.delegate,b=e.domElem,p;function s(a,f,e,d,c){var b;while(a<f){c[a]=e;b=Math.abs(d[a++])+a;if(b>a){s(a,b,e+1,d,c);a=b}}}var g=function(i){__extends(g,i);function g(a){i.call(this,a);this._rows={}}g._typeName="tfs.grid";g.MAX_COPY_SIZE=1e3;g.PAYLOAD_SIZE=200;g.EVENT_ROW_UPDATED="rowupdated";g.EVENT_SELECTED_INDEX_CHANGED="selectedIndexChanged";g.DATA_DRAGGING_ROWINFO="draggingRowInfo";g.DATA_DROPPING_ROWINFO="droppingRowInfo";g.prototype.initializeOptions=function(a){i.prototype.initializeOptions.call(this,$.extend({autoSort:true,payloadSize:g.PAYLOAD_SIZE,extendViewportBy:3,gutter:{contextMenu:false,icon:false,checkbox:false},header:true,allowMoveColumns:true,draggable:null,droppable:null,asyncInit:true,sharedMeasurements:true,coreCssClass:"grid"},a))};g.prototype.getSelectionCount=function(){return this._selectionCount};g.prototype._enhance=function(a){i.prototype._enhance.call(this,a);this._buildDom()};g.prototype.initialize=function(){i.prototype.initialize.call(this);this._contentSize={width:300,height:400};this._takeMeasurements();if(this._options.asyncInit)f.delay(this,10,function(){this._attachEvents()});else this._attachEvents();this.initializeDataSource(this._options.suppressRedraw);a.logTracePoint("Grid.initialize.complete")};g.prototype.getDraggingRowInfo=function(){return this._draggingRowInfo};g.prototype._getDragOverRows=function(){return this._ddRowOverStatus};g.prototype._getAcceptStatus=function(a){return this._ddRowAcceptStatus[a]};g.prototype._resetRowAcceptStatus=function(){this._ddRowAcceptStatus={}};g.prototype._rowDropTryActivate=function(a,d,c){var b=this._rowDropAccept(a,c.draggable);b&&this._rowDropActivate(a,d,c);return b};g.prototype._rowIntersect=function(d,c){var b=this._rows[c.dataIndex],a;if(b){a=b.row;return $.ui.intersect(d,{offset:a.offset(),proportions:{width:a[0].offsetWidth,height:a[0].offsetHeight}},this._droppable.tolerance)}return false};g.prototype.initializeDataSource=function(b){var a;if(this._resetScroll){this._ignoreScroll=true;try{a=this._canvas[0];a.scrollTop=0;a.scrollLeft=0;this._scrollLeft=0;this._scrollTop=0;this._resetScroll=false}finally{this._ignoreScroll=false}}this.setDataSource(this._options.source,this._options.expandStates,this._options.columns,this._options.sortOrder,undefined,b);if(!b)if(this._expandedCount>0)if(this._options.keepSelection&&this._selectedIndex>=0)this._selectRow(Math.min(this._selectedIndex,this._expandedCount-1));else this._selectRow(this._options.initialSelection!==false?0:-1);else this.setSelectedRowIndex(-1)};g.prototype.setDataSource=function(n,e,h,g,m,l){var b,d,i,c,j=this;this._dataSource=n||[];this._count=i=this._dataSource.length;if(e){this._expandStates=e;this._indentLevels=[];s(0,i,1,e,this._indentLevels)}else{this._indentLevels=null;this._expandStates=null}this._expandedCount=i;this._updateRanges();this._columns=[];if(h)for(b=0,d=h.length;b<d;b++){c=h[b];this._setColumnInfo(c,b);this._columns.push(c)}this._sortOrder=[];if(g)for(b=0,d=g.length;b<d;b++){c=g[b];if(c.order!=="desc")c.order="asc";this._sortOrder.push(c)}this._clearSelection();this._determineIndentIndex();function k(){if(!j.isDisposed()){j.layout();j._ensureSelectedIndex(m)}else a.logWarning("Layout called (in setDataSource) after grid was disposed.")}if(!l)if(this._options.asyncInit)f.delay(this,0,k);else k()};g.prototype._setColumnInfo=function(a,b){a.index=typeof a.index!=="undefined"?a.index:b;a.canSortBy=a.canSortBy!==false;a.canMove=a.canMove!==false;a.width=typeof a.width!=="undefined"?a.width:100;a.getCellContents=a.getCellContents||this._drawCell;a.getHeaderCellContents=a.getHeaderCellContents||this._drawHeaderCellValue;a.getColumnValue=a.getColumnValue||this.getColumnValue};g.prototype.getRowInfo=function(b){a.assertParamIsNumber(b,"dataIndex");return this._rows[b]};g.prototype.getRowData=function(b){a.assertParamIsNumber(b,"dataIndex");return this._dataSource[b]};g.prototype.getColumns=function(){return this._columns||[]};g.prototype.getSortOrder=function(){return this._sortOrder||[]};g.prototype.setColumnOptions=function(d,e){a.assertParamIsString(d,"columnName");a.assertParamIsObject(e,"options");var b,f,c=this._columns;for(b=0,f=c.length;b<f;b++)if(c[b].name===d){c[b]=$.extend(c[b],e);break}};g.prototype._getDataIndex=function(a){var c,f,d=-1,e=this._visibleRange,b;if(a<0)return-1;for(c=0,f=e.length;c<f;c++){b=e[c];d+=b[1]-b[0]+1;if(a<=d)return b[1]-d+a}return a};g.prototype._getRowIndex=function(c){var b,f,d=0,e=this._visibleRange,a;for(b=0,f=e.length;b<f;b++){a=e[b];if(c>=a[0]){if(c<=a[1])return d+c-a[0]}else break;d+=a[1]-a[0]+1}return-Math.max(0,d-1)};g.prototype.expandNode=function(a){var b,c;if(this._expandStates){b=this._expandStates[a];if(b<0){this._expandStates[a]=-b;this._updateRanges();c=this._rows[a];if(c)c.dirty=true}}};g.prototype.collapseNode=function(a){var b,c;if(this._expandStates){b=this._expandStates[a];if(b>0){this._expandStates[a]=-b;this._updateRanges();c=this._rows[a];if(c)c.dirty=true}}};g.prototype.expandAllNodes=function(){var a=0,g=this._count,c=this._expandStates,d,b=false,e,f=this._rows;if(c){while(a<g){d=c[a];if(d<0){c[a]=-d;b=true;e=f[a];if(e)e.dirty=true}a++}b&&this._updateRanges()}return b};g.prototype.collapseAllNodes=function(){var a=0,g=this._count,c=this._expandStates,d,b=false,e,f=this._rows;if(c){while(a<g){d=c[a];if(d>0){c[a]=-d;b=true;e=f[a];if(e)e.dirty=true}a++}b&&this._updateRanges()}return b};g.prototype.expandAll=function(){a.logTracePoint("Grid.expandAll.start");this._updateExpansionStateAndRedraw.call(this,this.expandAllNodes);a.logTracePoint("Grid.expandAll.complete")};g.prototype.collapseAll=function(){a.logTracePoint("Grid.collapseAll.start");this._updateExpansionStateAndRedraw.call(this,this.collapseAllNodes);a.logTracePoint("Grid.collapseAll.complete")};g.prototype.tryToggle=function(c,e){var d,a,b;if(!this._expandStates||this._selectedIndex<0||this._expandedCount<=0)return false;a=this._getDataIndex(this._selectedIndex);d=this._rows[a];if(!d)return false;if(e){if(c){if(!this.expandAllNodes())return false}else if(!this.collapseAllNodes())return false;this._clearSelection();this._addSelection(Math.abs(this._getRowIndex(a)));this._layoutContentSpacer();this._redraw();return true}else{b=this._expandStates[a];if(b!==0){if(c)if(b<0)this.expandNode(a);else return false;else if(b>0)this.collapseNode(a);else return false;this._clearSelection();this._addSelection(this._getRowIndex(a));this._layoutContentSpacer();this._redraw();return true}}return false};g.prototype._getVisibleRowIndices=function(){var b=this._scrollTop,d=b+this._canvasHeight,a=this._expandedCount-1,c=this._rowHeight;return{first:Math.min(a,Math.max(0,Math.ceil(b/c))),last:Math.min(a,Math.floor(d/c)-1)}};g.prototype._getRowIntoView=function(b,f){var d,a,e,c;if(f){this._canvas[0].scrollTop=Math.max(0,Math.min(b||0,this._expandedCount-1))*this._rowHeight;return true}d=this._getVisibleRowIndices();a=d.first;e=d.last;c=e-a;if(b<a||b>e){if(this._selectedIndex>a)a=Math.max(b-c,0);else a=Math.max(0,Math.min(b+c,this._expandedCount-1)-c);this._canvas[0].scrollTop=a*this._rowHeight;return true}return false};g.prototype.getSelectedRowIntoView=function(a){return this._getRowIntoView(this._selectedIndex,a)};g.prototype.cacheRows=function(){};g.prototype._drawRowsInternal=function(o,u){var h,t,m,f=this._rows,a,e,c,p={},q=this._expandStates,n=0,x=this._indentLevels,r=0,k=this._gutter,y=this._canvas[0],v,g,j,d,l,i;l=document.createDocumentFragment();if(k){v=this._gutter[0];i=document.createDocumentFragment()}this._rows=p;function w(a){a.hover(function(){a.addClass("grid-row-hover")},function(){a.removeClass("grid-row-hover")})}for(h=0,t=o.length;h<t;h++){m=o[h];e=m[0];c=m[1];a=f[c];if(a){d=a.rowIndex!==e;if(d)a.rowIndex=e;else{d=a.dirty;delete a.dirty}if(u)d=true;delete f[c]}else{d=true;a={rowIndex:e,dataIndex:c};g=b("div","grid-row grid-row-normal");g.id="row_"+this._getId()+"_"+e;l.appendChild(g);var s=$(g);a.row=s.data("grid-row-info",a);w(s);if(k){j=b("div","grid-gutter-row grid-gutter-row-normal");i.appendChild(j);a.gutterRow=$(j).data("grid-row-info",a)}}p[c]=a;if(d){if(q){n=q[c];r=x[c]}this._updateRow(a,e,c,n,r)}}for(c in f)if(f.hasOwnProperty(c)){a=f[c];a.row.remove();k&&a.gutterRow.remove()}return{rowsFragment:l,gutterFragment:i}};g.prototype._drawRows=function(d,c){var a=this._drawRowsInternal(d,c),e=this._canvas[0],b;e.appendChild(a.rowsFragment);if(a.gutterFragment){b=this._gutter[0];b.appendChild(a.gutterFragment)}};g.prototype.updateRow=function(b,a){var c,d=0,e=0;if(typeof a==="undefined"||a<0)a=this._getDataIndex(b);else if(typeof b==="undefined"||b<0)b=this._getRowIndex(a);c=this._rows[a];if(c){if(this._expandStates){d=this._expandStates[a];e=this._indentLevels[a]}this._updateRow(c,b,a,d,e)}};g.prototype._updateRow=function(h,j,d,n,s){var x,r,a,p,c,m,u,f,l,t,v,i,w,q,k,o;v=this._indentIndex;if(this._gutter){a=this._options.gutter;p=h.gutterRow;c=p[0];c.style.top=j*this._rowHeight+"px";c.style.left="0px";c.style.width=this._gutterWidth+"px";c.style.height=this._rowHeight+"px";if(a.contextMenu){m=b("div","grid-gutter-cell grid-gutter-drop grid-gutter-menu");this._options.source&&this._options.source[d]&&this._options.source[d].noContextMenu&&$(m).removeClass("grid-gutter-drop");p.append(m)}if(a.checkbox){t=$(b("input","checkbox "+(a.checkbox.cssClass||""))).attr("type","checkbox");l=b("div","grid-gutter-cell grid-gutter-checkbox");l.appendChild(t[0]);c.appendChild(l)}if(a.icon){f="grid-gutter-cell grid-gutter-icon ";if(typeof a.icon.cssClass!=="undefined")f+=a.icon.cssClass+" ";if(typeof a.icon.index!=="undefined")f+=(this.getColumnValue(d,a.icon.index,-1)||"")+" ";if($.isFunction(a.icon.getIconClass))f+=(a.icon.getIconClass(this._dataSource[d])||"")+" ";if(a.icon.ownerDraw!==false)f+=this._getGutterIconClass(j,d,n,s)||"";u=b("div",f);c.appendChild(u)}this._drawGutterCell(h,j,d,n,s)}r=this._updateRowSize(j,h.row);q=this._columns;for(i=0,w=q.length;i<w;i++){k=q[i];if(k.hidden)continue;o=k.getCellContents.apply(this,[h,d,n,s,k,v,i]);o&&r.appendChild(o[0])}e.makeElementUnselectable(r);this._gutter&&e.makeElementUnselectable(c);this._updateRowSelectionStyle(h,this._selectedRows,this._selectedIndex);this._options.enabledEvents&&g.EVENT_ROW_UPDATED in this._options.enabledEvents&&this._element.triggerHandler(g.EVENT_ROW_UPDATED,[h])};g.prototype._updateRowSize=function(c,b){var a;b.empty();a=b[0];a.style.top=c*this._rowHeight+"px";a.style.left=this._gutterWidth+"px";a.style.height=this._rowHeight+"px";if(isNaN(this._contentSize.width))a.style.width="";else a.style.width=Math.max(this._contentSize.width+2,this._canvasWidth-this._gutterWidth)+"px";return a};g.prototype._drawCell=function(o,m,k,h,c,n,l){var d,e,g,a,f,i=c.width||20,j;f=b("div","grid-cell");f.style.width=isNaN(i)?i:i+"px";a=$(f);if(typeof c.hrefIndex!=="undefined")j=this.getColumnValue(m,c.hrefIndex,-1);d=this.getColumnText(m,c,l);a.attr("title",d||null);if(j)a.append($("<a/>").attr("href",j).text(d));else if(d)a.text(d);else a.html("&nbsp;");if(l===n&&h>0){g=h*16-13;c.indentOffset=g;if(k!==0){e=$(b("div","icon grid-tree-icon")).appendTo(a).css("left",g);if(k>0)e.addClass("icon-tree-expanded");else e.addClass("icon-tree-collapsed")}a.css("textIndent",h*16+"px")}c.rowCss&&a.addClass(c.rowCss);return a};g.prototype._drawHeaderCellValue=function(a){var b=$("<div/>").text(a.text||"").addClass("title");a.index===this._indentIndex&&!(this._indentLevels==="undefined"||this._indentLevels===null)&&b.addClass("indented-title");return b};g.prototype._layoutHeader=function(){this._header&&this._headerCanvas.css("left",this._gutterWidth-this._scrollLeft);this._gutter&&this._gutter.css("left",this._scrollLeft)};g.prototype.layout=function(){a.logTracePoint("Grid.layout.start");this._measureCanvasSize();this._cleanUpRows();this._fixScrollPos();this._layoutContentSpacer();this._updateViewport();this._layoutHeader();this._drawHeader();a.logTracePoint("Grid.layout.complete")};g.prototype.redraw=function(){this._fixScrollPos();this._redraw(true)};g.prototype.getColumnValue=function(b,a){return this._dataSource[b][a]};g.prototype.getColumnText=function(e,a,d){var b,c;b=a.getColumnValue.call(this,e,a.index,d);if(typeof b!=="string")c=B.convertValueToDisplayString(b,a.format);else c=b;a.maxLength=Math.max(a.maxLength||0,c.length);return c};g.prototype._getExpandState=function(a){var b=0;if(this._expandStates)if(typeof(this._expandStates[a]==="number"))b=this._expandStates[a];return b};g.prototype._selectRow=function(a,c,b){var f=b&&b.ctrl,e=b&&b.shift,d=b&&b.rightClick;if(f)this._addSelection(a,c,{toggle:true});else if(e){this._clearSelection();this._addSelectionRange(a,c)}else if(d)if(!this._selectedRows||!(a+""in this._selectedRows)){this._clearSelection();this._addSelection(a,c)}else{this._selectedIndex=a;this._updateAriaAttribute()}else{this._clearSelection();this._addSelection(a,c)}};g.prototype.getSelectedRowIndex=function(){return this._selectedIndex};g.prototype.setSelectedRowIndex=function(a){this._clearSelection();this._addSelection(a)};g.prototype.getSelectedDataIndex=function(){return this._getDataIndex(this._selectedIndex)};g.prototype.getSelectedDataIndices=function(){var c,a=this._selectedRows,b=[];if(a)for(c in a)if(a.hasOwnProperty(c))b[b.length]=a[c];return b};g.prototype.ensureDataIndexExpanded=function(c){a.assertParamIsNumber(c,"dataIndex");var b=this._getRowIndex(c);while(b<0||c>0&&b===0){this.expandNode(this._getDataIndex(-b));b=this._getRowIndex(c)}return b};g.prototype.setSelectedDataIndex=function(b,c){a.assertParamIsNumber(b,"dataIndex");var d=c?this.ensureDataIndexExpanded(b):this._getRowIndex(b);this.setSelectedRowIndex(d)};g.prototype.selectionChanged=function(){};g.prototype.selectedIndexChanged=function(){};g.prototype._updateRowSelectionStyle=function(d,e,g){var c,b,a,f;c=d.rowIndex;b=d.row;a=d.gutterRow;f=this._active;b.removeClass("grid-row-selected grid-row-selected-blur grid-row-current");if(a){a.removeClass("grid-gutter-row-selected grid-gutter-row-selected-blur grid-gutter-row-current");a.find("input.checkbox").attr("checked",false)}if(e&&c in e){a&&a.find("input.checkbox").attr("checked",true);if(f){b.addClass("grid-row-selected");a&&a.addClass("grid-gutter-row-selected")}else{b.addClass("grid-row-selected-blur");a&&a.addClass("grid-gutter-row-selected-blur")}}if(c===g){b.addClass("grid-row-current");a&&a.addClass("grid-gutter-row-current")}};g.prototype.focus=function(a){e.tryFocus(this._focus,a)};g.prototype._createContextMenu=function(c,b){a.assertParamIsObject(c,"rowInfo");a.assertParamIsObject(b,"menuOptions");return this._createContextPopupMenuControl(b)};g.prototype._createContextPopupMenuControl=function(b){a.assertParamIsObject(b,"menuOptions");var c=$.map(b.items||[],function(a){return a});return h.BaseControl.createIn(q.PopupMenu,this._element,$.extend({align:"left-bottom"},b,{items:[{childItems:q.sortMenuItems(c)}]}))};g.prototype._onContainerResize=function(){this._measureCanvasSize();if(this._canvasHeight!==this._previousCanvasHeight||this._canvasWidth!==this._previousCanvasWidth){this._previousCanvasHeight=this._canvasHeight;this._previousCanvasWidth=this._canvasWidth;this.layout()}};g.prototype._onColumnResize=function(a){this._fire("columnresize",[a])};g.prototype._onColumnMove=function(a,b){this._fire("columnmove",[a,b])};g.prototype._sortBy=function(d,h){var a=this._sortOrder.slice(0),c,g,b,f=false,e;if(d){for(c=0,g=a.length;c<g;c++){b=a[c];if(b.index===d.index){a.splice(c,1);f=true;break}}if(f)b.order=b.order==="asc"?"desc":"asc";else b={index:d.index,order:"asc"};if(h)a.push(b);else a=[b]}e=this._getSortColumns(a);this._onSort(a,e)};g.prototype.onSort=function(b,c){if(this._options.autoSort){this._trySorting(b,c);this._sortOrder=b;this.layout()}a.logTracePoint("Grid.OnSort.Complete")};g.prototype._trySorting=function(b,a){var d=this;function c(c,g,d,e){var a=d[c.index],b=e[c.index];return typeof a==="undefined"||a===null?typeof b==="undefined"||b===null?0:-1:f.StringUtils.localeIgnoreCaseComparer(a,b)}if(!a)a=this._getSortColumns(b);this._dataSource.sort(function(j,k){for(var h,e,g,i,f=0;f<b.length;f++){h=b[f];g=a[f];i=g.comparer||c;e=i.call(d,g,h.order,j,k);if(e===0)continue;else return h.order==="desc"?-e:e}return 0})};g.prototype._getRowInfoFromEvent=function(b,a){return $(b.target).closest(a).data("grid-row-info")};g.prototype._onRowMouseDown=function(b){var a=this._getRowInfoFromEvent(b,".grid-row");if(a)if($(b.target).hasClass("grid-tree-icon")&&b.which===1)this._onToggle(a);else{this._selectRow(a.rowIndex,a.dataIndex,{ctrl:b.ctrlKey,shift:b.shiftKey,rightClick:b.which===3});return this._handleEvent(b,this.onRowMouseDown,"rowmousedown",{row:a.row,rowInfo:a,rowIndex:a.rowIndex,dataIndex:a.dataIndex})}};g.prototype.onRowMouseDown=function(){};g.prototype.onRowClick=function(){};g.prototype.onRowDoubleClick=function(){};g.prototype.onGutterClick=function(a){this._options.gutter.contextMenu&&this._showContextMenu(a)};g.prototype.onEnterKey=function(a){if(a.event.altKey){this._showContextMenu(a);return false}};g.prototype.onDeleteKey=function(){};g.prototype._onOpenRowDetail=function(e,d){var a,b,c;if(this._handleEvent(e,this.onOpenRowDetail,"openRowDetail",d)!==false){a=this._options.openRowDetail;if(a){if($.isFunction(a))a=a.call(this,this._selectedIndex);if(a){if(typeof a!=="string"){b=this.getColumnValue(this._selectedIndex,a.hrefIndex,-1);c=a.target}else b=a;if(b)if(c)j.ActionManager.performAction(j.CommonActions.ACTION_WINDOW_OPEN,{url:b,target:c,features:this._options.openRowDetail.targetFeatures});else j.ActionManager.performAction(j.CommonActions.ACTION_WINDOW_NAVIGATE,{url:b})}return false}}else return false};g.prototype.onOpenRowDetail=function(){};g.prototype.onContextMenu=function(a){this._showContextMenu(a)};g.prototype._onBlur=function(){m(l,"(grid) focus out");this._active=false;this._updateSelectionStyles()};g.prototype._onFocus=function(){m(l,"(grid) focus in");this._active=true;this._updateSelectionStyles();this._updateAriaAttribute()};g.prototype._onKeyPress=function(){};g.prototype._onKeyDown=function(a){var c={lo:-1,hi:-1},b=e.KeyCode,f=this._canvas,g,d;m(l,"(grid) key down");if(this._copyInProgress){if(a.keyCode===b.ESCAPE)this._cancelable&&this._cancelable.cancel();return false}if(this._count>0)c={lo:0,hi:this._expandedCount-1};this._selectedIndex<0&&this._addSelection(c.lo);switch(a.keyCode){case 65:if(a.ctrlKey)this._selectAll();else return;break;case 67:if(a.ctrlKey)this._copySelectedItems();else return;break;case 121:if(a.shiftKey)return this._onContextMenu();else return;break;case b.DOWN:this._onDownKey(a,c);break;case b.UP:this._onUpKey(a,c);break;case b.PAGE_DOWN:case b.PAGE_UP:this._onPageUpPageDownKey(a,c);break;case b.RIGHT:this._onRightKey(a);break;case b.LEFT:this._onLeftKey(a);break;case b.ENTER:return this._onEnterKey(a,c);case b.DELETE:return this._onDeleteKey(a);case b.HOME:this._onHomeKey(a,c);break;case b.END:this._onEndKey(a,c);break;case b.ESCAPE:this._onEscapeKey(a);break;case b.TAB:this._onTabKey(a);return;case b.BACKSPACE:this._onBackSpaceKey(a);return;default:return}this.getSelectedRowIntoView();this._fire("keydown",[a.keyCode,a.ctrlKey,a.shiftKey,a.altKey]);a.preventDefault()};g.prototype._onBackSpaceKey=function(){};g.prototype._onUpKey=function(b,a){this._clearSelection();if(b.ctrlKey)if(b.shiftKey)this._addSelectionRange(a.lo);else this._addSelection(a.lo);else if(b.shiftKey)this._addSelectionRange(Math.max(this._selectedIndex-1,a.lo));else this._addSelection(Math.max(this._selectedIndex-1,a.lo))};g.prototype._onDownKey=function(b,a){this._clearSelection();if(b.ctrlKey)if(b.shiftKey)this._addSelectionRange(a.hi);else this._addSelection(a.hi);else if(b.shiftKey)this._addSelectionRange(Math.min(this._selectedIndex+1,a.hi));else this._addSelection(Math.min(this._selectedIndex+1,a.hi))};g.prototype._onRightKey=function(b){var a=this._canvas;if(!this.tryToggle(true,b.shiftKey))a.scrollLeft(a.scrollLeft()+50);else{this._clearSelection();this._addSelection(this._selectedIndex)}};g.prototype._onLeftKey=function(b){var a=this._canvas;if(!this.tryToggle(false,b.shiftKey))a.scrollLeft(a.scrollLeft()-50);else{this._clearSelection();this._addSelection(this._selectedIndex)}};g.prototype._onPageUpPageDownKey=function(c,b){var a=this._getRowsPerPage(c),d=e.KeyCode;this._clearSelection();if(c.keyCode===d.PAGE_DOWN)if(c.shiftKey)this._addSelectionRange(Math.min(this._selectedIndex+a,b.hi));else this._addSelection(Math.min(this._selectedIndex+a,b.hi));else if(c.shiftKey)this._addSelectionRange(Math.max(this._selectedIndex-a,b.lo));else this._addSelection(Math.max(this._selectedIndex-a,b.lo))};g.prototype._getRowsPerPage=function(){var b=this._canvas[0].clientHeight,a=Math.floor(b/this._rowHeight);return a};g.prototype._onHomeKey=function(b,a){this._clearSelection();if(b.shiftKey)this._addSelectionRange(a.lo);else this._addSelection(a.lo)};g.prototype._onEndKey=function(b,a){this._clearSelection();if(b.shiftKey)this._addSelectionRange(a.hi);else this._addSelection(a.hi)};g.prototype._onTabKey=function(){};g.prototype._onEscapeKey=function(){this._tryFinishColumnMoving(true)};g.prototype._onKeyUp=function(){return};g.prototype.enableEvent=function(c){a.assertParamIsStringNotEmpty(c,"eventName");var b=this._options.enabledEvents;if(!b){b={};this._options.enabledEvents=b}b[c]=true};g.prototype.disableEvent=function(c){a.assertParamIsStringNotEmpty(c,"eventName");var b=this._options.enabledEvents;if(b)delete b[c]};g.prototype.getExpandStates=function(){return this._expandStates};g.prototype.beginFormatTable=function(b,e){a.assertParamIsFunction(b,"operationCompleteCallback");this._beginEnsureSelectionIsAvailable(c(this,function(){var a=this,e,c;if(!(a._cancelable&&a._cancelable.canceled)){e=new d.TabDelimitedTableFormatter(a);c=e.getTableFromSelectedItems()}$.isFunction(b)&&b(c)},e))};g.prototype._createElement=function(){i.prototype._createElement.call(this);this._buildDom()};g.prototype._addSpacingElements=function(){};g.prototype._buildDom=function(){var c=document.createDocumentFragment(),a,d;a=this._options.gutter;d=!this._options.noGutter&&a&&(a.contextMenu||a.icon||a.checkbox);this._focus=$(b("div","grid-focus")).attr("tabIndex",0).attr("role","grid");c.appendChild(this._focus[0]);this._canvas=$(b("div","grid-canvas"));this._contentSpacer=$(b("div","grid-content-spacer"));this._canvas.append(this._contentSpacer);this._addSpacingElements();if(this._options.header){this._element.addClass("has-header");this._header=$(b("div","grid-header"));this._header.bind("contextmenu",function(a){a.preventDefault();a.stopPropagation();return false});this._headerCanvas=$(b("div","grid-header-canvas"));this._header.append(this._headerCanvas);c.appendChild(this._header[0])}if(d){this._element.addClass("has-gutter");this._gutter=$(b("div","grid-gutter"));this._canvas.append(this._gutter);if(this._header){this._gutterHeader=$(b("div","grid-gutter-header"));this._header.append(this._gutterHeader)}}c.appendChild(this._canvas[0]);this._canvasDroppable=$(b("div","grid-canvas grid-canvas-droppable"));c.appendChild(this._canvasDroppable[0]);this._element.append(c)};g.prototype._shouldAttachContextMenuEvents=function(){return this._gutter&&this._options.gutter&&this._options.gutter.contextMenu};g.prototype._attachEvents=function(){var b=this;e.attachResize(this._element,c(this,this._onContainerResize));this._bind("mousedown",c(this,this._onContainerMouseDown));this._bind(this._focus,"keydown",c(this,this._onKeyDown));this._bind(this._focus,"keyup",c(this,this._onKeyUp));this._bind(this._focus,"keypress",c(this,this._onKeyPress));this._bind(this._focus,"focus",c(this,this._onFocus));this._bind(this._focus,"blur",c(this,this._onBlur));if(this._shouldAttachContextMenuEvents()){this._bind(this._focus,"contextmenu",c(this,this._onContextMenu));this._bind("contextmenu",c(this,this._onContextMenu))}this._bind(this._canvas,"click",c(this,this._onRowClick));this._bind(this._canvas,"dblclick",c(this,this._onRowDoubleClick));this._bind(this._canvas,"mousedown",c(this,this._onRowMouseDown));this._bind(this._canvas,"scroll",c(this,this._onCanvasScroll));this._bind(this._canvas,"selectstart",c(this,this._onSelectStart));if(this._header){this._bind(this._header,"mousedown",c(this,this._onHeaderMouseDown));this._bind(this._header,"mouseup",c(this,this._onHeaderMouseUp));this._bind(this._header,"click",c(this,this._onHeaderClick));this._bind(this._header,"dblclick",c(this,this._onHeaderDblClick))}if(this._gutter){this._bind(this._gutter,"click",c(this,this._onGutterClick));this._bind(this._gutter,"mousedown",c(this,this._onGutterClick));this._gutter.hover(function(a){$(a.target).closest(".grid-gutter-row").addClass("grid-gutter-row-hover")},function(a){$(a.target).closest(".grid-gutter-row").removeClass("grid-gutter-row-hover")})}this._setupDragDrop();this._element.parents(".ui-tabs").bind("tabsshow",function(){b._element.is(":visible")&&b.layout()});a.logTracePoint("Grid._attachEvents.complete")};g.prototype._getDraggedRowsInfo=function(e){var d=$(e.target),b,a,c=null;b=d.closest(".grid-row");if(b.length){a=b.data("grid-row-info");c={dataIndex:+a.dataIndex,rowIndex:+a.rowIndex}}return c};g.prototype._setupDragDrop=function(){this.setupDragDrop(this._options.draggable,this._options.droppable)};g.prototype.setupDragDrop=function(e,b){var a=this,f,c,d=function(b){if(!b.draggable)b.draggable=a._canvas;b.draggingRowInfo=c};if(e){f={axis:"y",helperClass:"grid-row-dragging",zIndex:1e3,appendTo:this._canvas,handle:".grid-row",opacity:.7,scope:this.getTypeName(),cursorAt:{top:this._rowHeight/2}};if(typeof e!=="object")e={};this._draggable=$.extend({},f,e);e=$.extend(f,e,{helper:function(e){c=a._getDraggedRowsInfo(e);if(c){a._cleanupDragDropState();var b=a._getDraggable(a._canvas);d(b);return a._rowDragCreateHelper(c,e,b)}else{c=null;return $("<div />")}},drag:function(c,b){d(b);return a._invokeDragHandler(c,b,a._draggable.drag)},start:function(e,b){if(c){d(b);a._canvas.data(g.DATA_DRAGGING_ROWINFO,c);a._draggingRowInfo=c;return a._invokeDragHandler(e,b,a._draggable.start)}else return false},stop:function(e,b){d(b);var c=a._invokeDragHandler(e,b,a._draggable.stop);a._draggingRowInfo=null;a._canvas.data(g.DATA_DRAGGING_ROWINFO,null);return c}});this._canvas.draggable(e)}if(b){var h={tolerance:"intersect",hoverClass:"grid-row-drop-active",scope:this.getTypeName()};if(b.accept)if(!$.isFunction(b.accept))b.acceptSelector=b.accept;this._droppable=$.extend({},h,b);b=$.extend({},this._droppable,{accept:function(b){!a._ddDropStarted&&a._droppableAcceptHandler(b,c);return true},activate:function(c,b){d(b);a._droppableActivateHandler(c,b)},deactivate:function(c,b){d(b);a._droppableDeactivateHandler(c,b)},over:function(c,b){d(b);a._droppableOverHandler(c,b)},out:function(c,b){d(b);a._droppableOutHandler(c,b)},drop:function(c,b){a._ddDropStarted=true;d(b);a._droppableDropHandler(c,b)}});this._canvasDroppable.droppable(b)}(e||b)&&this._cleanupDragDropState()};g.prototype._droppableAcceptHandler=function(b,c){var e=this,d=this._droppable.accept;if(d){var a;b.data(g.DATA_DRAGGING_ROWINFO,c);$.each(this._rows,function(c,d){a={dataIndex:Number(c),rowIndex:d.rowIndex};e._rowDropAccept(a,b)})}};g.prototype._droppableDropHandler=function(g,c){var f=this;a.logTracePoint("Grid._drop.start");var d=this._droppable.drop;if(d){var b,e=this._getDraggable(c.draggable);$.each(this._rows,function(c,d){var a={dataIndex:Number(c),rowIndex:d.rowIndex};if(f._rowIntersect(e,a)){b=a;return false}});if(b&&this._getAcceptStatus(b.dataIndex)){c.droppingRowInfo=b;d.call(this,g,c)}}};g.prototype._droppableActivateHandler=function(d,a){var c=this,b=a.draggingRowInfo?Number(a.draggingRowInfo.dataIndex):-1;$.each(this._rows,function(e,f){e!==b&&c._rowDropTryActivate({dataIndex:Number(e),rowIndex:f.rowIndex},d,a)})};g.prototype._droppableDeactivateHandler=function(d,a){var c=this,b=a.draggingRowInfo?a.draggingRowInfo.dataIndex:-1;$.each(this._rows,function(e,f){e!==b&&c._rowDropDeactivate({dataIndex:Number(e),rowIndex:f.rowIndex},d,a)});this._cleanupDragDropState()};g.prototype._droppableOverHandler=function(c,b){var a=this;this._draggableOverGrid=true;this._bind(window.document,"mousemove",function(c){a._draggableOverGrid&&a._droppableOverMoveHandler(c,b)});this._droppableOverMoveHandler(c,b)};g.prototype._droppableOutHandler=function(b,a){this._unregisterDragMouseMove();this._droppableOverMoveHandler(b,a)};g.prototype._droppableOverMoveHandler=function(d,b){var a=this,c=this._getDragOverRows(),f=this._getDraggable(b.draggable),e=b.draggingRowInfo?Number(b.draggingRowInfo.dataIndex):-1;$.each(this._rows,function(g,i){var h;if(g!==e){h={dataIndex:+g,rowIndex:+i.rowIndex};if(a._getAcceptStatus(g))if(a._draggableOverGrid&&a._rowIntersect(f,h)){if(!c[g]){c[g]=true;a._rowDropOver(h,d,b)}}else if(c[g]){delete c[g];a._rowDropOut(h,d,b)}}})};g.prototype._getDraggable=function(a){return a.data("draggable")};g.prototype._cleanupDragDropState=function(){this._resetRowAcceptStatus();this._resetRowOverStatus();this._unregisterDragMouseMove();this._ddDropStarted=false};g.prototype._unregisterDragMouseMove=function(){this._draggableOverGrid=false;this._unbind(window.document,"mousemove")};g.prototype._resetRowOverStatus=function(){this._ddRowOverStatus={}};g.prototype._rowDropAccept=function(b,c){var d=this._rows[b.dataIndex],e=this._droppable.accept,f;if(d){var a=this._ddRowAcceptStatus[b.dataIndex];if(typeof a==="undefined"){if(e){c.data(g.DATA_DROPPING_ROWINFO,b);a=e.call(this,c)}else if(this._droppable.acceptSelector)a=d.row.is(this._droppable.acceptSelector);else a=true;this._ddRowAcceptStatus[b.dataIndex]=a}return a}else return false};g.prototype._rowDropActivate=function(c,e,d){var a=this._rows[c.dataIndex],b=this._droppable.activate;if(a){this._droppable.activeClass&&a.row.addClass(this._droppable.activeClass);if(b)return b.call(this,e,$.extend({},d,{droppingRowInfo:a}))}};g.prototype._rowDropDeactivate=function(b,f,e){var d=this._getAcceptStatus(b.dataIndex);if(d){var a=this._rows[b.dataIndex],c=this._droppable.deactivate;if(a){this._droppable.activeClass&&a.row.removeClass(this._droppable.activeClass);this._droppable.hoverClass&&a.row.removeClass(this._droppable.hoverClass);if(c)return c.call(this,f,$.extend({},e,{droppingRowInfo:a}))}}};g.prototype._rowDropOver=function(e,g,d){var a=this._rows[e.dataIndex],b=this._droppable,c=this._droppable.over,f=this._getDraggable(d.draggable);if(a){f.dropped=true;b.hoverClass&&a.row.addClass(b.hoverClass);c&&c.call(this,g,$.extend({},d,{droppingRowInfo:a}))}};g.prototype._rowDropOut=function(e,g,d){var a=this._rows[e.dataIndex],b=this._droppable,c=this._droppable.out,f=this._getDraggable(d.draggable);if(a){f.dropped=false;b.hoverClass&&a.row.removeClass(b.hoverClass);c&&c.call(this,g,$.extend({},d,{droppingRowInfo:a}))}};g.prototype._rowDrop=function(c,f,e,d){var b=this._rows[c.dataIndex],a=this._droppable;if(b){a.hoverClass&&b.row.removeClass(a.hoverClass);a.activeClass&&b.row.removeClass(a.activeClass);a.drop&&a.drop.call(this,e,$.extend({},d,{droppingRowInfo:b}))}};g.prototype._rowDragCreateHelper=function(b,d,c){var a;if($.isFunction(this._draggable.helper))return this._draggable.helper.call(this,d,$.extend({},c,{draggingRowInfo:b}));a=this._rows[b.dataIndex].row.clone();a.removeClass("grid-row-selected grid-row-selected-blur grid-row-current");a.addClass(this._draggable.helperClass);a.css("position","absolute");return a};g.prototype._invokeDragHandler=function(c,b,a){if(a)return a.call(this,c,b)};g.prototype._takeMeasurements=function(){var c,g,f,h,d,a,e;if(this._options.sharedMeasurements)a=p;if(!a){a={};e=this._options.coreCssClass;if(this._options.cssClass)e+=" "+this._options.cssClass;c=$(b("div",e)).appendTo(document.body).css("position","absolute").css("left",-5e3).css("top",-5e3).width(1e3).height(500);g=$(b("div","grid-row grid-row-normal")).appendTo(c);f=$(b("div","grid-cell")).width(100).appendTo(g).text("1");a.rowHeight=g.outerHeight();a.cellOffset=f.outerWidth()-100;h=$(b("div")).appendTo(f).css("overflow","hidden").css("width","1em").css("height","1ex");a.unitEx=h.outerHeight();d=$(b("div","grid-gutter"));d.append(b("div","grid-gutter-row grid-gutter-row-selected"));d.appendTo(c);a.gutterWidth=d[0].clientWidth;c.remove();if(this._options.sharedMeasurements)p=a}this._unitEx=a.unitEx;this._rowHeight=a.rowHeight;this._cellOffset=a.cellOffset;if(this._gutter)this._gutterWidth=a.gutterWidth;else this._gutterWidth=0};g.prototype._ensureSelectedIndex=function(a){var b=this._selectedIndex;if(typeof a==="number")this._selectedIndex=a;if(this._selectedIndex>=0){if(this._count<=this._selectedIndex)this._selectedIndex=this._count-1;this._selectedIndex!==b&&this._addSelection(this._selectedIndex)}};g.prototype._determineIndentIndex=function(){var b=this._columns,a,c;for(a=0,c=b.length;a<c;a++)if(b[a].indent){this._indentIndex=a;return}this._indentIndex=0};g.prototype._updateRanges=function(){var b=0,c=0,e=this._count,a=[],d=0,f;if(this._expandStates){while(b<e){f=this._expandStates[b];if(f<0){a[a.length]=[c,b];d+=b-c+1;b+=1-f;c=b}else b++}if(c<e){a[a.length]=[c,e-1];d+=e-c}}else{d=e;a[a.length]=[0,d]}this._expandedCount=d;this._visibleRange=a};g.prototype._updateExpansionStateAndRedraw=function(d){a.assertParamIsFunction(d,"action");var c,b=this._selectedIndex;if(b>=0)c=this._getDataIndex(b);d.call(this);if(b>=0){this._clearSelection();this._addSelection(Math.abs(this._getRowIndex(c)))}this._layoutContentSpacer();this._redraw()};g.prototype._updateViewport=function(n){var f,c,d,g,l,o=this._count,a,b,h,k,i=[],j=[],e=[],p=this._expandStates||[],m=this._expandedCount-1;f=this._getVisibleRowIndices();c=f.first;d=f.last;c=Math.max(0,c-this._options.extendViewportBy);d=Math.min(m,d+this._options.extendViewportBy);g=Math.max(0,c-this._options.payloadSize);l=Math.min(m,d+this._options.payloadSize);b=this._getDataIndex(g);k=c;for(a=g;a<=l&&b<o;a++){if(a<c)i[i.length]=[a,b];else if(a>d)j[j.length]=[a,b];else{e[e.length]=[a,b];k=a}h=p[b];if(h<0)b+=1-h;else b++}this.cacheRows(i,e,j);this._drawRows(e,n)};g.prototype._cleanUpRows=function(){var f=this._rows,g,e,d=this._gutter,b=this.getElement(),c=$(".grid-row",b);$.each(c,function(b,a){a.outerHTML=""});if(d){var a=$(".grid-gutter",b);if(a.length>0)a[0].innerHTML=""}this._rows={}};g.prototype._getGutterIconClass=function(){return""};g.prototype._drawGutterCell=function(){};g.prototype._drawHeader=function(){var d,p,a,o=this._columns,l,c,f,k,h,q,r,n=this._sortOrder,j,i,m,g;if(this._header){j=document.createDocumentFragment();for(d=0,p=o.length;d<p;d++){a=o[d];if(a.hidden)continue;c=b("div","grid-header-column");l=$(c).attr("title",a.text);c.style.width=(a.width||20)+"px";c._data={columnIndex:d,header:true};f=b("div","separator");if(a.fixed)f.style.cursor="auto";q=$(f);f._data={columnIndex:d,separator:true};c.appendChild(f);h=a.getHeaderCellContents.apply(this,[a]);a.headerCss&&h.addClass(a.headerCss);c.appendChild(h&&h[0]);k=b("div","sort-handle");r=$(k);for(i=0,m=n.length;i<m;i++){g=n[i];if(g.index===a.index){if(g.order==="asc")l.addClass("ascending");else g.order==="desc"&&l.addClass("descending");break}}c.appendChild(k);j.appendChild(c)}this._headerCanvas.empty();this._columnMovingElement=null;this._headerCanvas[0].appendChild(j);e.makeElementUnselectable(this._header[0])}};g.prototype._layoutContentSpacer=function(){var a=0,b,c,g,f=this._columns,e,d;for(c=0,g=f.length;c<g;c++){if(f[c].hidden)continue;a+=(f[c].width||20)+this._cellOffset}a=a+2;b=Math.max(1,this._expandedCount*this._rowHeight);this._contentSpacer.width(a);this._contentSpacer.height(b);this._gutter&&this._gutter.height(b);this._ignoreScroll=true;try{e=Math.max(0,Math.min(this._scrollTop,b-this._canvasHeight));if(e!==this._scrollTop){this._scrollTop=e;this._canvas[0].scrollTop=e}d=Math.max(0,Math.min(this._scrollLeft,a-this._canvasWidth));if(d!==this._scrollLeft){this._scrollLeft=d;this._canvas[0].scrollLeft=d}}finally{this._ignoreScroll=false}this._contentSize.width=a;this._contentSize.height=b};g.prototype._fixScrollPos=function(){var a=this._ignoreScroll;this._ignoreScroll=true;try{this._canvas[0].scrollLeft=this._scrollLeft;this._canvas[0].scrollTop=this._scrollTop}finally{this._ignoreScroll=a}};g.prototype._redraw=function(a){this._layoutHeader();this._updateViewport(a)};g.prototype._selectAll=function(){if(this._count>0&&this._options.allowMultiSelect!==false){this._clearSelection();this._selectionStart=0;var a=Math.max(0,this._selectedIndex);this._addSelectionRange(this._count-1,undefined,{doNotFireEvent:true});this._selectedIndex=a;this._updateSelectionStyles();this._selectionChanged()}};g.prototype._clearSelection=function(){this._selectionCount=0;this._selectedRows=null};g.prototype._addSelection=function(a,c,b){var d,e=b&&b.keepSelectionStart,f=b&&b.doNotFireEvent,g=b&&b.toggle;if(this._options.allowMultiSelect===false){e=false;this._clearSelection()}if(!this._selectedRows)this._selectedRows={};if(a>=0){d=true;if(!(a+""in this._selectedRows))this._selectionCount++;else if(g){d=false;this._selectionCount=Math.max(0,this._selectionCount-1);delete this._selectedRows[a]}if(typeof c!=="number")c=this._getDataIndex(a);if(d)this._selectedRows[a]=c;this._selectedIndex=a;this._updateAriaAttribute();if(this._selectionStart<0||!e)this._selectionStart=a}else{c=-1;this._selectedIndex=-1}if(!f){this._updateSelectionStyles();this._selectionChanged();this._selectedIndexChanged(this._selectedIndex,c)}};g.prototype._addSelectionRange=function(b,a,h){var d,i,c,f,j=h&&h.doNotFireEvent,g=-1,e;if(this._options.allowMultiSelect===false)this._addSelection(b,a);else{if(this._selectedRows)g=this._selectedRows[this._selectedIndex];if(this._selectionStart<0)this._selectionStart=b;d=Math.min(this._selectionStart,b);i=Math.max(this._selectionStart,b);if(typeof a!=="number"||d!==b)a=this._getDataIndex(d);for(c=d;c<=i;c++){this._addSelection(c,a,{keepSelectionStart:true,doNotFireEvent:true});if(c===b)e=a;f=this._getExpandState(a);if(f<0)a+=1-f;else a++}this._selectedIndex=b;this._updateAriaAttribute();if(!j){this._updateSelectionStyles();this._selectionChanged();g!==e&&this._selectedIndexChanged(this._selectedIndex,e)}}};g.prototype._updateAriaAttribute=function(){var a,c,b;if(this._active){c=this._getDataIndex(this._selectedIndex);if(c>=0){a=this.getRowInfo(c);if(a&&a.row){b=a.row.attr("id");if(b!==this._activeAriaId){this._focus.attr("aria-activedescendant",b);this._activeAriaId=b}}}}};g.prototype._updateSelectionStyles=function(){this.delayExecute("updateSelectionStyles",10,true,function(){var a,d=this._selectedRows,e=this._selectedIndex,b=this._rows,c;for(a in b)if(b.hasOwnProperty(a)){c=b[a];this._updateRowSelectionStyle(c,d,e)}})};g.prototype._selectionChanged=function(){this.selectionChanged(this._selectedIndex,this._selectionCount,this._selectedRows);this._fire("selectionchanged",{selectedIndex:this._selectedIndex,selectedCount:this._selectionCount,selectedRows:this._selectedRows})};g.prototype._selectedIndexChanged=function(b,a){this.selectedIndexChanged(b,a);this._fire(g.EVENT_SELECTED_INDEX_CHANGED,[b,a])};g.prototype._showContextMenu=function(d){var e,c=d?d.rowInfo:null,h,b,g,a;a=this._options.contextMenu;if(!a)return;if(c){e=this._dataSource[c.dataIndex];a=$.extend({},a,{contextInfo:{rowInfo:c,item:e}});if(!e.root){if(a.items)if($.isFunction(a.items))a.items=a.items.call(this,a.contextInfo);else a.items=a.items.slice(0);else a.items=[];if(this._popupMenu){this._popupMenu.dispose();this._popupMenu=null}this._popupMenu=this._createContextMenu(c,a);b=this.getPinAndFocusElementForContextMenu(d);if(b){h=b.pinElement;g=b.focusElement[0];f.delay(this,10,function(){this._popupMenu.popup(g,h)})}}}};g.prototype.getPinAndFocusElementForContextMenu=function(a){return{pinElement:a.rowInfo.gutterRow,focusElement:this._focus}};g.prototype._onContainerMouseDown=function(){this.focus(10)};g.prototype._measureCanvasSize=function(){this._canvasHeight=this._canvas[0].clientHeight;this._canvasWidth=this._canvas[0].clientWidth};g.prototype._setupDragEvents=function(){this._bind(window.document,"mousemove",c(this,this._onDocumentMouseMove),true);this._bind(window.document,"mouseup",c(this,this._onDocumentMouseUp),true)};g.prototype._clearDragEvents=function(){this._unbind(window.document,"mousemove",null,true);this._unbind(window.document,"mouseup",null,true)};g.prototype._onDocumentMouseMove=function(f){var c,e,d,a=this._columnSizing,b=this._columnMoving;if(a&&a.active===true){c=f.pageX-a.origin;d=Math.max(this._cellMinWidth,a.originalWidth+c);e=this._columns[a.index];e.width=d;this._applyColumnSizing(a.index);this._moveSizingElement(a.index)}if(b&&b.state>0){c=f.pageX-b.origin;if(c!==0){b.state=2;this._moveColumnMovingElement(b.index,b.left+c)}}};g.prototype._onDocumentMouseUp=function(){f.delay(this,0,function(){this._tryFinishColumnSizing(false);this._tryFinishColumnMoving(false);this._clearDragEvents()});return false};g.prototype._onHeaderMouseDown=function(c){var b,a,f,g,e,d;if(c.which!==1)return;e=$(c.target).closest(".separator");if(e.length>0){b=e[0]._data.columnIndex;a=this._columns[b];if(!a.fixed){this._columnSizing={active:true,index:b,originalWidth:a.width,origin:c.pageX};this._moveSizingElement(b);this._setupDragEvents();return false}}else{d=$(c.target).closest(".grid-header-column");if(d.length>0){b=d[0]._data.columnIndex;a=this._columns[b];if(this._options.allowMoveColumns&&!a.fixed&&a.canMove){this._columnMoving={state:1,index:b,width:a.width,origin:c.pageX};f=0;g=0;while(g<b){a=this._columns[g++];if(!a.hidden)f+=a.width}this._columnMoving.left=f;this._setupDragEvents();return false}}}};g.prototype._onHeaderMouseUp=function(){return};g.prototype._onHeaderClick=function(c){var d,a,b,e;b=$(c.target).closest(".grid-header-column");if(b.length>0)if(!this._columnSizing){e=$(c.target).closest(".separator");if(e.length>0)return false;else{d=b[0]._data.columnIndex;a=this._columns[d];a.canSortBy&&!a.fixed&&this._sortBy(a,c.shiftKey)}}};g.prototype._onHeaderDblClick=function(g){var d,b,a,c,f,e;d=$(g.target).closest(".separator");if(d.length>0){this._tryFinishColumnSizing(true);this._tryFinishColumnMoving(true);b=d[0]._data.columnIndex;a=this._columns[b];c=Math.max(a.maxLength||0,3);f=1.1+.7*Math.exp(-c/20);e=a.width;a.width=(a.indentOffset||0)+Math.round(c*f*this._unitEx);this._applyColumnSizing(b,e,true);return false}};g.prototype._moveSizingElement=function(c){var e=this._canvas,h=e[0],a=this._sizingElement,d,g=0,f=this._gutterWidth;if(!a){if(c<0)return;a=$(b("div","grid-column-sizing")).appendTo(e);this._sizingElement=a}a.height(h.clientHeight-1);a.css("top",this._scrollTop);if(c<0)a.css("left",-5e3).css("top",-5e3).height(0);else{while(g<=c){d=this._columns[g++];if(!d.hidden)f+=d.width}a.css("left",f-1)}};g.prototype._getVisibleColumnIndex=function(b){a.assertParamIsNumber(b,"columnIndex");var c=0,d=0,e=this._columns.length;a.assert(b<e,"Index out of array bounds");if(this._columns[b].hidden)return-1;while(c<b){if(!this._columns[c].hidden)d++;c++}return d};g.prototype._applyColumnSizing=function(d,b,f){var e=this._getVisibleColumnIndex(d)+1,a=this._columns[d],c=false;b=b||-1;if(a){c=a.width!==b;$(".grid-header-column:nth-child("+e+")",this._headerCanvas).width(a.width)}if(f===true){c&&this.layout();this._onColumnResize(a)}};g.prototype._tryFinishColumnSizing=function(b){var a=this._columnSizing;if(a){if(a.active===true){!b&&this._applyColumnSizing(a.index,a.originalWidth,true);this._moveSizingElement(-1)}this._columnSizing=null}};g.prototype._moveColumnMovingElement=function(e,i){var k=this._headerCanvas,l=this._canvas,d=this._columnMovingElement,c=this._columnMovingPinElement,a,m=this._columns.length,h=this._gutterWidth,g=0,f=0,j;if(!d){if(e<0)return;d=$(b("div","grid-column-moving")).appendTo(k);this._columnMovingElement=d;c=$(b("div","grid-column-moving-placer")).appendTo(l).height(4).css("left",-500).css("top",-500);this._columnMovingPinElement=c}if(e<0){d.css("left",-5e5);c.css("left",-500).css("top",-500)}else{a=this._columns[e];d.width(a.width).css("left",i).css("top",0).text(a.text);j=i+(a.width>>1);while(g<m){a=this._columns[g];if(!a.hidden){if(j-h>a.width/2)f=g+1;else break;h+=a.width}g++}if(f<e||f>e+1){this._columnInsert=f;c.css("left",h-4).css("top",this._scrollTop)}else{this._columnInsert=-1;c.css("left",-500).css("top",-500)}}};g.prototype._applyColumnMoving=function(b,a){var e,d,c=this._columns;if(a>=0){if(a>b)a--;e=c[b];d=c[a];if(this._options.allowMoveColumns&&!d.fixed&&d.canMove){c.splice(b,1);c.splice(a,0,e);this._determineIndentIndex();this.layout();this._onColumnMove(b,a)}}};g.prototype._tryFinishColumnMoving=function(b){var a=this._columnMoving;if(a){if(a.state>1){this._moveColumnMovingElement(-1);!b&&this._applyColumnMoving(a.index,this._columnInsert)}this._columnMoving=null}};g.prototype._getSortColumns=function(g){var h=this._columns,e,a,j,i,f=[],b,d,c;for(a=0,j=g.length;a<j;a++){i=g[a];for(b=0,d=h.length;b<d;b++){c=h[b];if(c.index===i.index){e=c;break}}f.push(e)}return f};g.prototype._onSort=function(b,a){this.onSort(b,a)!==false&&this._fire("sort",[{sortOrder:b,sortColumns:a}])};g.prototype._onSelectStart=function(){return false};g.prototype._onCanvasScroll=function(){var a=this._canvas[0];this._resetScroll=true;this._scrollLeft=a.scrollLeft;this._scrollTop=a.scrollTop;!this._ignoreScroll&&this._redraw();return false};g.prototype._handleEvent=function(g,d,f,e){var b,c=this._selectedIndex,a;b=this._getDataIndex(c);a={rowIndex:c,dataIndex:b,rowInfo:this._rows[b],event:g};e&&$.extend(a,e);return!d||d.call(this,a)!==false?this._fire(f,a):false};g.prototype._onRowClick=function(b){var a=this._getRowInfoFromEvent(b,".grid-row");if(a)return this._handleEvent(b,this.onRowClick,"rowclicked",{row:a.row,rowInfo:a,rowIndex:a.rowIndex,dataIndex:a.dataIndex})};g.prototype._onRowDoubleClick=function(b){var a=this._getRowInfoFromEvent(b,".grid-row");if(a)if(!$(b.target).hasClass("grid-tree-icon"))return this._handleEvent(b,this.onRowDoubleClick,"rowdblclick",{row:a.row,rowInfo:a,rowIndex:a.rowIndex,dataIndex:a.dataIndex})!==false?this._onOpenRowDetail(b,{rowIndex:a.rowIndex,dataIndex:a.dataIndex}):false};g.prototype._onGutterClick=function(b){var a=this._getRowInfoFromEvent(b,".grid-gutter-row"),c;if(a){if(this._options.gutter.checkbox){c=$(b.target);c.hasClass("checkbox")&&this._addSelection(a.rowIndex,a.dataIndex,{toggle:true})}else(!this._selectedRows||typeof this._selectedRows[a.rowIndex]!=="number")&&this._selectRow(a.rowIndex,a.dataIndex);return this._handleEvent(b,this.onGutterClick,"gutterclick",{gutterRow:a.gutterRow,rowInfo:a,rowIndex:a.rowIndex,dataIndex:a.dataIndex})}};g.prototype._onEnterKey=function(a){return this._handleEvent(a,this.onEnterKey,"enterkey")!==false?this._onOpenRowDetail(a):false};g.prototype._onDeleteKey=function(a){return this._handleEvent(a,this.onDeleteKey,"deletekey")};g.prototype._onContextMenu=function(b,a){this._handleEvent(b,this.onContextMenu,"contextMenu",a);return false};g.prototype._onToggle=function(a){var b;if(this._expandStates){b=this._expandStates[a.dataIndex];if(b!==0){if(b>0)this.collapseNode(a.dataIndex);else b<0&&this.expandNode(a.dataIndex);this._clearSelection();this._addSelection(Math.min(a.rowIndex,this._expandedCount-1),a.dataIndex);this._layoutContentSpacer();this._redraw()}}};g.prototype._copySelectedItems=function(){var b=this,e={cancellable:true,message:v.CopyProgressPleaseWait,cancelCallback:c(this,function(){})},d=new o.LongRunningOperation(b._element,e);a.logTracePoint("TFS.UI.Controls.Grids._copySelectedItems.start");d.beginOperation(c(b,function(c){b._cancelable=c;b._beginCopySelection(function(){d.endOperation();a.logTracePoint("TFS.UI.Controls.Grids._copySelectedItems.complete")})}))};g.prototype._ensureRowDrawn=function(){return true};g.prototype._beginEnsureSelectionIsAvailable=function(b){a.assertParamIsFunction(b,"itemsAvailableCallback");b()};g.prototype._beginCopySelection=function(a,b){if(this._copyInProgress)return;this.getSelectionCount()<=0&&$.isFunction(a)&&a();this._copyInProgress=true;this.beginFormatTable(c(this,function(b){!(this._cancelable&&this._cancelable.canceled)&&o.Clipboard.copyToClipboard(b);this._copyInProgress=false;$.isFunction(a)&&a()}),b)};g.prototype._dispose=function(){i.prototype._dispose.call(this);e.detachResize(this._element)};return g}(h.BaseControl);i.Grid=g;n.initClassPrototype(g,{_dataSource:[],_expandStates:null,_indentLevels:null,_columns:[],_sortOrder:[],_visibleRange:[],_count:0,_expandedCount:0,_selectedIndex:-1,_indentIndex:0,_selectionStart:-1,_selectionCount:0,_selectedRows:null,_rowHeight:20,_cellOffset:0,_gutterWidth:30,_contentSize:null,_rows:{},_focus:null,_scroller:null,_canvas:null,_canvasHeight:300,_canvasWidth:300,_contentSpacer:null,_header:null,_headerCanvas:null,_gutter:null,_gutterHeader:null,_popupMenu:null,_columnSizing:null,_columnMoving:null,_columnMovingElement:null,_columnMovingPinElement:null,_columnInsert:null,_unitEx:null,_sizingElement:null,_resetScroll:false,_ignoreScroll:false,_scrollTop:0,_scrollLeft:0,_ddRowAcceptStatus:null,_ddRowOverStatus:null,_droppable:null,_draggable:null,_draggingRowInfo:null,_cancelable:null,_active:false,_activeAriaId:null,_cellMinWidth:15,_copyInProgress:false});h.Enhancement.registerJQueryWidget(g,"grid");var k=function(h){__extends(g,h);function g(a){h.call(this,a)}g._typeName="tfs.checkboxselectiongrid";g._DEFAULT_LABEL_COLUMN=1;g._HEADER_CHECKBOX_ID="header-checkbox";g.prototype.initializeOptions=function(b){a.assert(Boolean(b),"Expected options argument");a.assert(Boolean(b.columns),"Expected columns information in the options");h.prototype.initializeOptions.call(this,$.extend({asyncInit:false},b));this._selectAllLabel=b.selectAllLabel||"";this._labelColumnIndex=b.labelColumnIndex||g._DEFAULT_LABEL_COLUMN;this._updateOptions(b)};g.prototype.setGridItems=function(c,b){a.assert(Boolean(c),"Expected gridItems argument");a.assert(Boolean(b),"Expected checkedItemIds argument");this.dataProvider=new d.FieldDataProvider(c,{sort:this._options.sort});this.gridAdapter=d.HierarchicalGridDataAdapter.bindAdapter(d.ChecklistDataAdapter,this.dataProvider,this,{noColumn:true,checkedItemIds:b})};g.prototype.getCheckedItemIds=function(){var a=[];if(this.gridAdapter)a=this.gridAdapter.getCheckedItemIds();return a};g.prototype._drawHeaderCellValue=function(a){var f=$("<div/>"),b,e;if(a.index!==d.ChecklistDataAdapter._CHECKBOX_COLUMN_INDEX)return h.prototype._drawHeaderCellValue.call(this,a);e=false;if(a.hasOwnProperty("checked"))e=a.checked;b=$("<input type='checkbox' id='"+g._HEADER_CHECKBOX_ID+"'>").attr("checked",e);this._bind(b,"click",c(this,this._onHeaderCheckboxClicked));f.append(b);f.append(this._createLabel(g._HEADER_CHECKBOX_ID,this._selectAllLabel));return f};g.prototype.setCheckboxState=function(b,c){a.assert(typeof b==="number","Expected to be a number");a.assert(typeof c==="boolean","Expected to be a number");var f,g,e;f=this.gridAdapter.getCheckboxState(b);if(f!==c){g=this._createCheckboxId(b,d.ChecklistDataAdapter._CHECKBOX_COLUMN_INDEX);e=$("#"+g,this._canvas);e.length>0&&e.attr("checked",c);this._setCheckboxStateData(b,c)}};g.prototype._setCheckboxStateData=function(a,b){this.gridAdapter.setCheckboxStateData(a,b)};g.prototype._updateOptions=function(b){var a={canSortBy:false,text:"",width:30,fixed:true};b.columns.splice(d.ChecklistDataAdapter._CHECKBOX_COLUMN_INDEX,0,a)};g.prototype._determineIndentIndex=function(){this._indentIndex=d.ChecklistDataAdapter._CHECKBOX_COLUMN_INDEX+1};g.prototype._createLabel=function(b,c){a.assertParamIsString(b,"controlId");a.assertParamIsString(c,"text");return $("<label/>").attr("For",b).addClass("hidden").text(c)};g.prototype._drawCell=function(o,e,l,p,k,n,m){var f,i,g,j;if(k.index!==d.ChecklistDataAdapter._CHECKBOX_COLUMN_INDEX)return h.prototype._drawCell.call(this,o,e,l,p,k,n,m);f=$(b("div","grid-cell"));f.width(k.width||20);j=this.getColumnValue(e,d.ChecklistDataAdapter._CHECKBOX_COLUMN_INDEX);a.assert(typeof j==="boolean","Checkbox state must be a numeric value");g=this._createCheckboxId(e,d.ChecklistDataAdapter._CHECKBOX_COLUMN_INDEX);i=$("<input type='checkbox' tabindex='-1' id='"+g+"'>").data("checkbox-data-index",e).attr("checked",j);this._bind(i,"click",c(this,this._onCheckboxClicked));f.append(i);f.append(this._createLabel(g,this.getColumnValue(e,this._labelColumnIndex)));return f};g.prototype._onHeaderCheckboxClicked=function(b){var a;a=$(b.currentTarget).is(":checked");this._setHeaderCheckboxState(a)};g.prototype._onCheckboxClicked=function(d){var a=$(d.currentTarget),b,c;b=a.data("checkbox-data-index");c=a.is(":checked");this.setCheckboxState(b,c)};g.prototype._createCheckboxId=function(c,b){a.assert(typeof c==="number","Expected to be a number");a.assert(typeof b==="number","Expected to be a number");return f.StringUtils.format("checkbox-{0}-{1}",c,b)};g.prototype._setHeaderCheckboxState=function(h){var c,e=this._options.columns,f,b,i;for(b=0,i=e.length;b<i;b+=1)if(e[b].index===d.ChecklistDataAdapter._CHECKBOX_COLUMN_INDEX){f=e[b];break}a.assert(typeof f!=="undefined","Expected to find the checkbox column");c=$("#"+g._HEADER_CHECKBOX_ID,this._headerCanvas);a.assert(Boolean(c.length===1),"Expected to find the header checkbox");c.attr("checked",h);f.checked=h};g.prototype._onKeyDown=function(b){a.assertParamIsObject(b,"e");var c=h.prototype._onKeyDown.call(this,b);if(b.keyCode===e.KeyCode.SPACE){this._onSpaceKey(b);c=false}return c};g.prototype._onSpaceKey=function(c){a.assertParamIsObject(c,"e");var b=this.getSelectedDataIndex();b>=0&&this.setCheckboxState(b,!this.gridAdapter.getCheckboxState(b))};return g}(g);i.CheckboxSelectionGrid=k;n.initClassPrototype(k,{_labelColumnIndex:k._DEFAULT_LABEL_COLUMN,_selectAllLabel:null,dataProvider:null,gridAdapter:null});var r=function(b){__extends(a,b);function a(a){b.call(this,a)}a._typeName="tfs.listview";return a}(g);i.ListView=r;h.Enhancement.registerJQueryWidget(r,"listView");$(function(){function a(){var a;a=$(document.body).children(".main-container")[0];function b(){if(a)a.style.overflowX=a.clientWidth!==a.scrollWidth?"scroll":"auto"}e.attachResize(a,b);b()}$.browser.msie&&a()});n.tfsModuleLoaded("TFS.UI.Controls.Grids",i)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.UI.Controls.Accessories",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.OM","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.Core.Utils","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/TFS.UI.Controls","Presentation/Scripts/TFS/TFS.UI.Controls.Grids","Presentation/Scripts/TFS/Resources/TFS.Resources.Presentation","Presentation/Scripts/TFS/Resources/TFS.Resources.Platform","Presentation/Scripts/TFS/TFS.UI.Controls.Common","Presentation/Scripts/TFS/TFS.UI.Controls.Data","Presentation/Scripts/TFS/TFS.UI"],function(Q,d,O,J,M,L,K,N,G,I,F,A,D,z,H){var i=O,j=J,a=M,f=L,P=K,k=N,e=G,w=I,h=F,E=A,q=D,B=z,c=H,b=c.domElem,g=f.delegate,t=function(){function b(c,b,d){a.assertParamIsObject(c,"rootElement");a.assertParamIsObject(b,"fieldDataProvider");this._$rootElement=$(c);this._dataProvider=b;this._events=new Sys.EventHandlerList;this._options=d;this._createControl()}b.EVENT_FIELD_CHANGED="field-changed";b.createIn=function(f,h){a.assertParamIsObject(f,"container");var c=$(f),g=$("script",c).eq(0).html(),d=null,e=null;if(g){c.empty();d=P.parseMSJSON(g,false);e=new b(c,new B.FieldDataProvider(d.treeValues||d.listValues,{sort:h}))}return e};b.prototype.setText=function(a){this._control.setText(a);this._validate();this._raiseFieldChanged()};b.prototype.getText=function(){return $.trim(this._control.getText())};b.prototype.setSelectedNodeById=function(b){a.assertParamIsString(b,"nodeId");var c=this._dataProvider.getNodeFromId(b);c&&this.setText(c.path)};b.prototype.getSelectedNode=function(){return this._dataProvider.getNode(this.getText())};b.prototype.setInvalid=function(b){a.assertIsBool(b,"invalid is required bool");this._control.setInvalid(b)};b.prototype.focus=function(){this._control.focus()};b.prototype.attachFieldChanged=function(c){a.assertParamIsFunction(c,"handler");this._events.addHandler(b.EVENT_FIELD_CHANGED,c)};b.prototype.detachFieldChanged=function(c){a.assertParamIsFunction(c,"handler");this._events.removeHandler(b.EVENT_FIELD_CHANGED,c)};b.prototype._createControl=function(){var c=this,b=null,a;a={};a.change=g(this,function(){c._validate();c._raiseFieldChanged()});b=this._dataProvider.getNodes();if(this._dataProvider.isTree())a.type="tree";else a.mode=b&&b.length>0?"drop":"text";a.source=b;this._control=e.BaseControl.createIn(q.Combo,this._$rootElement,$.extend(a,this._options));this._validate()};b.prototype._validate=function(){this._control.setInvalid(!this._dataProvider.isValidValue(this.getText()))};b.prototype._raiseFieldChanged=function(){var a=this._events.getHandler(b.EVENT_FIELD_CHANGED),d=this.getText(),c={textValue:d,node:this.getSelectedNode()};a&&a(this,c)};return b}();d.SimpleFieldControl=t;i.initClassPrototype(t,{_$rootElement:null,_events:null,_control:null,_dataProvider:null,_options:null});$(function(){$.ui.plugin.add("draggable","scrollables",{start:function(){var b,g,f=[],c=null,j=null,a=null,i=$(this).data("draggable"),d=i.options;function h(a){return a.closest("body").length?true:false}var e=0;for(b=0,g=d.scrollables.length;b<g;b++,e++){c=$(d.scrollables[b]);if(!h(c))continue;c.each(function(d,c){var b=$(c);a=b.offset();a.bottom=a.top+b.height();a.right=a.left+b.width();f[e++]={element:c,rect:a}})}d.scrollableElements=f},drag:function(e){var f,l,j=$(this).data("draggable"),a=j.options,h=a.cursorAt||{left:0,top:0},k=false,c=null,g=false,i=a.scrollableElements,d={left:e.pageX-h.left,top:e.pageY-h.top,right:e.pageX-h.left+j.helperProportions.width,bottom:e.pageY-h.top+j.helperProportions.height},b=null,m;for(f=0,l=i.length;f<l;f+=1){if(typeof i[f]==="undefined")continue;c=i[f].element;b=i[f].rect;k=(d.left>=b.left&&d.left<=b.right||d.right>=b.left&&d.right<=b.right)&&(d.top>=b.top&&d.top<=b.bottom||d.bottom>=b.top&&d.bottom<=b.bottom);if(k){if((!a.axis||a.axis==="y")&&(!a.scrollablesAxis||a.scrollablesAxis==="y"))if(b.bottom-e.pageY<a.scrollSensitivity){c.scrollTop=c.scrollTop+a.scrollSpeed;g=true}else if(e.pageY-b.top<a.scrollSensitivity){c.scrollTop=c.scrollTop-a.scrollSpeed;g=true}if((!a.axis||a.axis==="x")&&(!a.scrollablesAxis||a.scrollablesAxis==="x"))if(b.right-e.pageX<a.scrollSensitivity){c.scrollLeft=c.scrollLeft+a.scrollSpeed;g=true}else if(e.pageX-b.left<a.scrollSensitivity){c.scrollLeft=c.scrollLeft-a.scrollSpeed;g=true}}}if(g!==false)m=c.offsetHeight},stop:function(){var a=$(this).data("draggable"),b=a.options;delete b.scrollableElements}})});var u=function(){function b(d,c,b){a.assertParamIsObject(d,"grid");a.assertParamIsFunction(c,"idToDataIndex");a.assertParamIsFunction(b,"dataIndexToId");this._grid=d;this._idToDataIndex=c;this._dataIndexToId=b;this._savingRows={};this._disabledRows={};this._delayedSaveRows={};this._callsForRowDisableMap={};this._grid.enableEvent(w.Grid.EVENT_ROW_UPDATED);this._grid.getElement().bind(w.Grid.EVENT_ROW_UPDATED,g(this,this._updateRowHandler))}b.SAVING_ROW_CLASS="saving-row";b.SAVING_GUTTER_CLASS="saving-row-gutter";b.prototype.isRowSaving=function(b){a.assertParamIsNotNull(b,"id");return b in this._savingRows||b in this._callsForRowDisableMap||b in this._disabledRows};b.prototype.changeId=function(b,c){a.assertParamIsNumber(b,"oldId");a.assertParamIsNumber(c,"newId");var d;if(this._savingRows.hasOwnProperty(b)){d=this._savingRows[b];delete this._savingRows[b];this._savingRows[c]=d}if(this._delayedSaveRows.hasOwnProperty(b)){delete this._delayedSaveRows[b];this._delayedSaveRows[c]=c}n.clearOperation(b.toString());n.addOperation(c.toString())};b.prototype.markRowAsProcessing=function(b,a){this._disableRow(b,a,false)};b.prototype.clearRowProcessing=function(a){this._enableRow(a,false)};b.prototype.markRowAsSaving=function(b,a){this._disableRow(b,a,true)};b.prototype.clearRowSaving=function(a){this._enableRow(a,true)};b.prototype._disableRow=function(c,b,e){a.assertParamIsNotNull(c,"id");var d,f;b=b||[];if(e===true)this._savingRows[c]=b;else this._disabledRows[c]=b;for(d=0,f=b.length;d<f;d++){this._incrementDisableCalls(b[d]);this._updateRow(b[d])}this._updateRow(c);e===true&&n.addOperation(c.toString())};b.prototype._enableRow=function(b,e){a.assertParamIsNotNull(b,"id");var d,f,c;if(e===true)c=this._savingRows[b];else c=this._disabledRows[b];if(typeof c!=="undefined"){if(e===true)delete this._savingRows[b];else delete this._disabledRows[b];for(d=0,f=c.length;d<f;d++){this._decrementDisableCalls(c[d]);this._updateRow(c[d])}this._updateRow(b)}e===true&&n.clearOperation(b.toString())};b.prototype._updateRowHandler=function(d,b){a.assertParamIsObject(d,"event");a.assertParamIsObject(b,"rowInfo");var c=this._dataIndexToId(b.dataIndex);typeof c!=="undefined"&&this._updateRow(c,b)};b.prototype._updateRow=function(c,e){a.assertParamIsNotNull(c,"id");var i;if(!e){i=this._idToDataIndex(c);if(typeof i==="undefined")return;e=this._grid.getRowInfo(i)}if(e){var g=e.row,d=e.gutterRow;if(this._savingRows.hasOwnProperty(c)||this._disabledRows.hasOwnProperty(c)){g.addClass(b.SAVING_ROW_CLASS);if(!this._delayedSaveRows.hasOwnProperty(c))f.delay(this,500,function(){if((this._savingRows.hasOwnProperty(c)||this._disabledRows.hasOwnProperty(c))&&!this._delayedSaveRows.hasOwnProperty(c)){this._delayedSaveRows[c]=c;this._updateRow(c)}});else if(d){d.addClass(b.SAVING_GUTTER_CLASS);d.attr("title",this._savingRows.hasOwnProperty(c)?h.Saving:"")}}else if(this._callsForRowDisableMap.hasOwnProperty(c))g.addClass(b.SAVING_ROW_CLASS);else{g.hasClass(b.SAVING_ROW_CLASS)&&g.removeClass(b.SAVING_ROW_CLASS);if(d){d.hasClass(b.SAVING_GUTTER_CLASS)&&d.removeClass(b.SAVING_GUTTER_CLASS);d.attr("title","")}if(this._delayedSaveRows[c])delete this._delayedSaveRows[c]}}};b.prototype._incrementDisableCalls=function(b){a.assertParamIsNumber(b,"id");var c=this._callsForRowDisableMap[b]||0;c++;this._callsForRowDisableMap[b]=c};b.prototype._decrementDisableCalls=function(b){a.assertParamIsNumber(b,"id");var c=this._callsForRowDisableMap[b]||0;c--;if(c<=0)delete this._callsForRowDisableMap[b];else this._callsForRowDisableMap[b]=c};return b}();d.RowSavingManager=u;i.initClassPrototype(u,{_grid:null,_idToDataIndex:null,_dataIndexToId:null,_savingRows:null,_disabledRows:null,_delayedSaveRows:null,_callsForRowDisableMap:null});(function(b){b._operationsCounter=0;b._operations={};b._isInit=false;function h(){if(!this._isInit){k.runningDocumentsTable.add("PendingOperationHelper",this);this._isInit=true}}b._init=h;function g(){this._operationsCounter=0;this._operations={};this._isInit=false}b.reset=g;function e(b){a.assertParamIsString(b,"operationId");this._init();if(!this._operations.hasOwnProperty(b)){this._operations[b]=1;this._operationsCounter+=1}else this._operations[b]=this._operations[b]+1}b.addOperation=e;function c(b){a.assertParamIsString(b,"operationId");var c;if(this._operations.hasOwnProperty(b)){c=this._operations[b];if(c>1)this._operations[b]=c-1;else this.clearOperation(b)}}b.removeOperation=c;function d(b){a.assertParamIsString(b,"operationId");if(this._operations.hasOwnProperty(b)){delete this._operations[b];this._operationsCounter-=1}}b.clearOperation=d;function f(){return this._operationsCounter>0}b.isDirty=f})(d.PendingOperationHelper||(d.PendingOperationHelper={}));var n=d.PendingOperationHelper,p=function(e){__extends(d,e);function d(){e.apply(this,arguments)}d.prototype.initialize=function(){e.prototype.initialize.call(this);this._element.addClass("popup-content-control");this.hide()};d.prototype.setContent=function(a){this._$contentContainer.html(a);this._contentSet=true};d.prototype.show=function(){this._onShow()};d.prototype.hide=function(){this._onHide()};d.prototype.toggle=function(){if(this._element.is(":visible"))this.hide();else this.show()};d.prototype._enhance=function(c){var d=this;a.assertParamIsObject(c,"$dropElement");this._createElement();this._$dropElement=c;this._element.appendTo($(document.body));this._element.css("position","fixed");this._$contentContainer=$(b("div","popup-content-container")).appendTo(this._element);this._decorate();c.bind("remove.removePopupDropElement",function(){d.dispose()})};d.prototype._decorate=function(){var a=this;if(!this._options.openCloseOnHover){this._documentEventDelegate=g(this,this._handleDocumentMouseDown);this._bind(this._$dropElement,"click",function(){if(!a._element.is(":visible"))a._onShow();else a._onHide()})}else{this._bind(this._$dropElement,"mouseover",g(this,this._onShow));this._bind(this._$dropElement,"mouseout",g(this,this._onHide))}c.attachResize(this._element,g(this,this._setPosition))};d.prototype._handleDocumentMouseDown=function(a){var b=$(a.target);!(this._$dropElement.has(a.target).length>0||this._$dropElement[0]===a.target)&&!(this._$contentContainer.has(a.target).length>0||this._$contentContainer[0]===a.target)&&!(this._element.has(a.target).length>0||this._element[0]===a.target)&&this._onHide()};d.prototype._setPosition=function(){this._element.css({top:0,left:0});c.Positioning.position(this._element,this._$dropElement,{elementAlign:this._options.elementAlign||"left-top",baseAlign:this._options.baseAlign||"left-bottom"})};d.prototype._getDropElement=function(){return this._$dropElement};d.prototype._onShow=function(){if(!this._contentSet&&this._options.content){if($.isFunction(this._options.content))this.setContent(this._options.content.call(this));else this.setContent(this._options.content);this._contentSet=true}this._setPosition();this._element.show();this._fire("popup-opened");this._documentEventDelegate&&$(document).bind("mousedown",this._documentEventDelegate)};d.prototype._onHide=function(){this._documentEventDelegate&&$(document).unbind("mousedown",this._documentEventDelegate);this._element.hide();this._fire("popup-closed")};d.prototype._dispose=function(){e.prototype._dispose.call(this);c.detachResize(this._element)};return d}(e.BaseControl);d.PopupContentControl=p;var C=function(d){__extends(a,d);function a(){d.apply(this,arguments)}a.prototype.initializeOptions=function(a){d.prototype.initializeOptions.call(this,$.extend({coreCssClass:"rich-content-tooltip",openCloseOnHover:true},a))};a.prototype.initialize=function(){this._$popupTag=$(b("div","popup-tag")).appendTo(this._element);d.prototype.initialize.call(this)};a.prototype._setPosition=function(){d.prototype._setPosition.call(this);this._$popupTag.css({top:0,left:0});c.Positioning.position(this._$popupTag,this._getDropElement(),{elementAlign:"left-top",baseAlign:"left-bottom"})};return a}(p);d.RichContentTooltip=C;var r=function(d){__extends(a,d);function a(){d.apply(this,arguments)}a.prototype.initializeOptions=function(a){d.prototype.initializeOptions.call(this,$.extend({coreCssClass:"filtered-list-dropdown-menu"},a))};a.prototype.initialize=function(){var a=this;d.prototype.initialize.call(this);this._$icon=$(b("span","icon")).appendTo(this._element);this._$label=$(b("span","selected-item-text")).appendTo(this._element);$(b("span","icon drop-icon")).appendTo(this._element);this._popupEnhancement=e.Enhancement.enhance(p,this._element,$.extend({cssClass:"filtered-list-popup",content:function(){var d=$(b("div"));a._filteredList=a._createFilteredList(d);a._selectedItem&&a._filteredList.setSelectedItem(a._selectedItem);d.bind("selected-item-changed",g(a,a.onItemSelected));d.bind("escape-key-pressed",function(){a._hidePopup();c.tryFocus(a._element)});return d}},this._options.popupOptions));this._popupEnhancement._element.bind("popup-opened",function(){a._element.addClass("menu-opened");a._filteredList.setFocus()});this._popupEnhancement._element.bind("popup-closed",function(){a._element.removeClass("menu-opened");a._filteredList.clearInput()});this._element.attr("tabIndex","0").bind("keydown",function(b){switch(b.keyCode){case c.KeyCode.DOWN:a._popupEnhancement.show();return false;case c.KeyCode.UP:case c.KeyCode.ESCAPE:a._hidePopup();return false;case c.KeyCode.ENTER:case c.KeyCode.SPACE:a._showPopup();return false}});this.setSelectedItem(this._options.initialSelectedItem)};a.prototype.setSelectedItem=function(a){var b;this._selectedItem=a;this._$icon.removeClass();this._$icon.addClass("icon");b=this._getItemIconClass(a);b&&this._$icon.addClass(b);this._$label.text(this._getItemDisplayText(a));this._element.attr("title",this._getItemTooltip(a));this._filteredList&&this._filteredList.setSelectedItem(a)};a.prototype._getPopupEnhancement=function(){return this._popupEnhancement};a.prototype._hidePopup=function(){this._popupEnhancement.hide()};a.prototype._showPopup=function(){this._popupEnhancement.show()};a.prototype.getFilteredList=function(){return this._filteredList};a.prototype._createFilteredList=function(a){return e.Enhancement.enhance(this._options.filteredListType,a,this._options.filteredListOptions||{})};a.prototype._getItemIconClass=function(){return""};a.prototype._getItemDisplayText=function(a){return a?a.toString():""};a.prototype._getItemTooltip=function(a){return this._getItemDisplayText(a)};a.prototype._getSelectedItem=function(){return this._selectedItem};a.prototype.onItemSelected=function(b,a){this.setSelectedItem(a.selectedItem);this._hidePopup();c.tryFocus(this._element);$.isFunction(this._options.onItemChanged)&&this._options.onItemChanged.call(this,this._selectedItem)};return a}(e.BaseControl);d.FilteredListDropdownMenu=r;i.classExtend(r,k.TfsContext.ControlExtensions);var s=function(d){__extends(a,d);function a(){d.apply(this,arguments)}a.prototype.initializeOptions=function(a){d.prototype.initializeOptions.call(this,$.extend({coreCssClass:"filtered-list-control"},a))};a.prototype.initialize=function(){var a=this,c;d.prototype.initialize.call(this);this._selectedItem=this._selectedItem||this._options.selectedItem||null;this._contentByTabId={};this._listsByTabId={};this._searchBoxByTabId={};this._itemsByTabId={};if(this._options.tabNames){c=$(b("ul","pivot-view")).appendTo($(b("div","views")).appendTo(this._element));this._tabsById={};this._contentByTabId={};this._selectedTab=this._options.defaultTabId;$.each(this._options.tabNames,function(d,e){a._tabsById[d]=$(b("li","filtered-list-tab")).addClass(d).data("tabId",d).appendTo(c);$(b("a")).attr("href","#").text(e).click(g(a,a.onTabClick)).appendTo(a._tabsById[d]);if(!a._selectedTab)a._selectedTab=d})}this._$tabContentContainer=$(b("div","tab-content-container")).appendTo(this._element);if(this._options.tabNames&&this._selectedTab)this.onTabSelected(this._selectedTab);else this.onTabSelected(null)};a.prototype.onTabClick=function(b){var a=$(b.target).closest(".filtered-list-tab").data("tabId");if(a){this._selectedTab=a;this.onTabSelected(this._selectedTab)}return false};a.prototype.setFocus=function(){var a=this._searchBoxByTabId[this._selectedTab||""];a&&a.focus()};a.prototype.clearInput=function(){$.each(this._searchBoxByTabId,function(b,a){a.val("")})};a.prototype._clearCachedItems=function(){this._itemsByTabId={}};a.prototype.onTabSelected=function(a){var h,c,d,e;if(!a)a="";if(this._tabsById){this._element.find(".filtered-list-tab").removeClass("selected");h=this._tabsById[a];h&&h.addClass("selected");$.each(this._contentByTabId,function(c,b){c!==a&&b.hide()})}c=this._contentByTabId[a||""];if(!c){c=$(b("div","filtered-list-tab-content")).appendTo(this._$tabContentContainer);d=$(b("input","filtered-list-search")).attr("type","text").bind("input keyup change",f.throttledDelegate(this,100,this.updateFilteredList)).appendTo($(b("div","filter-container")).appendTo(c));d.attr("placeholder",this._getWaterMarkText(a));e=$(b("ul","filtered-list")).click(g(this,this.onItemClicked)).appendTo(c);if(a){c.addClass(a+"-tab-content");d.addClass(a+"-search");e.addClass(a+"-list")}this._contentByTabId[a]=c;this._searchBoxByTabId[a]=d;this._listsByTabId[a]=e;this.bindTabEvents(c,e);this.updateFilteredList()}c.show();this.setFocus()};a.prototype.bindTabEvents=function(d,a){var b=this;d.bind("keydown",function(d){switch(d.keyCode){case c.KeyCode.DOWN:b.selectNextItem(a,1);return false;case c.KeyCode.UP:b.selectNextItem(a,-1);return false;case c.KeyCode.ESCAPE:b._fire("escape-key-pressed");return false;case c.KeyCode.ENTER:b.onItemSelected(a.children(".new-selection"));return false}});a.bind("mouseover",function(c){var b=$(c.target).closest(".filtered-list-item");if(b.length){a.children(".filtered-list-item").removeClass("new-selection");b.addClass("new-selection")}})};a.prototype.selectNextItem=function(g,f){var b,a,d,e;b=g.children(".filtered-list-item");a=b.index(b.filter(".new-selection"));b.eq(a).removeClass("new-selection");if(f<0){a=Math.max(a+f,0);d=c.Positioning.VerticalScrollBehavior.Bottom}else{a=Math.min(a+f,b.length-1);d=c.Positioning.VerticalScrollBehavior.Top}e=b.eq(a);e.addClass("new-selection");c.Positioning.scrollIntoViewVertical(e,d)};a.prototype._setItemsForTabId=function(b,a){this._itemsByTabId[b]=a};a.prototype._getCurrentItemsForTabId=function(a){return this._itemsByTabId[a]};a.prototype.updateFilteredList=function(){var d=this,a,c,f,h,e,i=false,g=null,j=false;c=this._selectedTab||"";a=this._listsByTabId[c];if(!a)return;g=a.children(".filtered-list-item.new-selection").data("item");a.empty();f=this._itemsByTabId[c];if(!f){$(b("li","message")).text(E.Loading).appendTo(a);this._beginGetListItems(c,function(a){d._setItemsForTabId(c,a);d.updateFilteredList()});return}h=this._searchBoxByTabId[c];if(h)e=h.val().trim().toLowerCase();else e="";if(f.length===0)$(b("li","message")).text(this._getNoItemsText(c)).appendTo(a);else{$.each(f,function(k,c){var h,f=d._getItemName(c)||"";if(!e||f.toLowerCase().indexOf(e)>=0){h=$(b("li","filtered-list-item")).text(f).attr("title",f).data("item",c).appendTo(a);d._selectedItem&&d._isSelectedItem(c,d._selectedItem)&&h.addClass("current-item");if(g&&c===g){j=true;h.addClass("new-selection")}i=true}});if(i)!j&&a.children(".filtered-list-item").eq(0).addClass("new-selection");else $(b("li","message")).text(this._getNoMatchesText(c)).appendTo(a)}};a.prototype._beginGetListItems=function(b,a){if($.isFunction(this._options.beginGetListItems))this._options.beginGetListItems.call(b,a);else a.call(this,[])};a.prototype._getWaterMarkText=function(b){var a;if(this._options.waterMarks&&this._options.waterMarks[b])a=this._options.waterMarks[b];else if(this._options.waterMark)a=this._options.waterMark;else a=h.FilteredListWatermark;return a};a.prototype._getNoItemsText=function(b){var a;if(this._options.noItemsMessages&&this._options.noItemsMessages[b])a=this._options.noItemsMessages[b];else if(this._options.noItemsMessage)a=this._options.noItemsMessage;else a=h.FilteredListNoItems;return a};a.prototype._getNoMatchesText=function(b){var a;if(this._options.noMatchesMessages&&this._options.noMatchesMessages[b])a=this._options.noMatchesMessages[b];else if(this._options.noMatchesMessage)a=this._options.noMatchesMessage;else a=h.FilteredListNoMatches;return a};a.prototype._isSelectedItem=function(b,a){return $.isFunction(this._options.isSelectedItem)?this._options.isSelectedItem(b,a):this._getItemName(b)===this._getItemName(a)};a.prototype._getItemName=function(a){return $.isFunction(this._options.getItemName)?this._options.getItemName(a):a?a.toString():""};a.prototype._getSelectedItem=function(){return this._selectedItem};a.prototype.setSelectedItem=function(b,a){this._selectedItem=b;a!==true&&this.updateFilteredList()};a.prototype.onItemClicked=function(a){this.onItemSelected($(a.target).closest("li.filtered-list-item"));return false};a.prototype.onItemSelected=function(b){var a;if(b.length===1){a=b.data("item");a&&this._onItemSelected(a)}};a.prototype._onItemSelected=function(a){this._selectedItem=a;this._fire("selected-item-changed",{selectedItem:a})};return a}(e.BaseControl);d.FilteredListControl=s;i.classExtend(s,k.TfsContext.ControlExtensions);var x=function(c){__extends(b,c);function b(a){c.call(this,a)}b.prototype.initialize=function(){var a=this,c=this.getElement(),d=this._options.text,b=this._options.fieldName;c.droppable({scope:this._options.scope,hoverClass:this._options.hoverClass,tolerance:this._options.tolerance,drop:function(){a._dropHandler(d,b)},accept:function(){var c=a._options.getDraggedWorkItemId();return c?a._options.isValidDropTarget(c,b):false}})};b.prototype._dropHandler=function(f,c){a.assertParamIsString(f,"text");a.assertParamIsString(c,"fieldToBeUpdated");var g=this,b,e=false,d=g._options.getDraggedWorkItemId();d&&this._options.beginGetWorkItem(d,function(a){b=a.getField(c);if(b){b.setValue(f);e=true}g._options.workItemUpdate({success:e,workItem:a})})};return b}(e.Enhancement);d.DroppableWorkItemChangeEnhancement=x;var y=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.initialize=function(){var a=this,b=this.getElement();b.droppable({scope:this._options.scope,hoverClass:this._options.hoverClass,tolerance:this._options.tolerance,over:function(){$.isFunction(a._options.onOverCallback)&&a._options.onOverCallback()},out:function(){$.isFunction(a._options.onOutCallBack)&&a._options.onOutCallBack()}})};return a}(e.Enhancement);d.UpdateControlOnHoverEnhancement=y;var v=function(c){__extends(b,c);function b(b){c.call(this,b);a.assertParamIsNumber(b.current,"options.current");a.assertParamIsNumber(b.total,"options.total");a.assertParamIsNumber(b.maxTotal,"options.maxTotal");a.assertParamIsString(b.text,"options.text");this._text=b.text}b._typeName="tfs-ui-controls-accessories-progresscontrol";b.DECIMAL_PRECISION=2;b.CSSCLASS_CONTAINER="visual-progress-container";b.CSSCLASS_NOTOTAL="visual-progress-no-total";b.CSSCLASS_TOTAL="visual-progress-total";b.CSSCLASS_CURRENT="visual-progress-current";b.CSSCLASS_UNDERALLOCATED="visual-progress-underallocated";b.CSSCLASS_OVERALLOCATED="visual-progress-overallocated";b.CSSCLASS_UNALLOCATED="visual-progress-total-unallocated";b.CSSCLASS_SUMMARY_CURRENT="visual-progress-summary-current";b.MINIMUM_PERCENTAGE_FOR_DISPLAY=.001;b.prototype.initialize=function(){this._draw(this._options.current,this._options.total,this._options.maxTotal,this._options.text,this._options)};b.prototype.getText=function(){return this._text};b.prototype._draw=function(d,e,o,m,c){a.assertParamIsNumber(d,"current");a.assertParamIsNumber(e,"total");a.assertParamIsNumber(o,"maxTotal");a.assertParamIsString(m,"text");a.assertParamIsObject(c,"options");if(c.summary)this._drawSummaryStyle(d,e,o,m,c);else{var k=this.getElement(),i=$("<div/>"),n=$("<div/>"),j,g,p=c.inline||false;c.cssClass&&k.addClass(c.cssClass);c.cssLabelClass&&i.addClass(c.cssLabelClass);if(p){i.css("display","inline").css("padding-right","3px");n.css("display","inline")}i.text(m).attr("title",m);if(e===0){g=f.StringUtils.format(h.ProgressControl_NoCurrentValue,c.suffixFormat);j=f.StringUtils.format(g,l.formatNumberForDisplay(d,b.DECIMAL_PRECISION))}else{g=f.StringUtils.format(c.suffixFormat,l.formatNumberForDisplay(e,b.DECIMAL_PRECISION));j=f.StringUtils.format(h.ProgressControl_DefaultProgressText,l.formatNumberForDisplay(d,b.DECIMAL_PRECISION),g)}n.text(j).attr("title",j);k.append(i);this._drawVisualProgress(k,d,e,o,p);k.append(n)}};b.prototype._drawSummaryStyle=function(k,m,q,t,e){a.assertParamIsNumber(k,"current");a.assertParamIsNumber(m,"total");a.assertParamIsNumber(q,"maxTotal");a.assertParamIsString(t,"text");a.assertParamIsObject(e,"options");var d=this.getElement(),p=d.parent(),o=$("<div/>"),c=$("<div/>").css("display","inline-block"),r=$("<div/>"),j,n,i,s=true,g;e.cssClass&&d.addClass(e.cssClass);i=f.StringUtils.format(e.suffixFormat,l.formatNumberForDisplay(m,b.DECIMAL_PRECISION));j=l.formatNumberForDisplay(k,b.DECIMAL_PRECISION);n=f.StringUtils.format(h.ProgressControl_SummaryProgressText,i);g=f.StringUtils.format(h.ProgressControl_SummaryProgressToolTip,j,i);o.addClass(b.CSSCLASS_SUMMARY_CURRENT).attr("title",g).text(j).appendTo(d);a.assert(p.width()>0,"Container element does not have a width which usually indicates this control was initialized before adding to the DOM.");c.attr("title",g).css("width",p.width()-o.width());this._drawVisualProgress(c,k,m,q,s);r.text(n).attr("id","progress-chart-remaining-time-id").attr("title",g).appendTo(c);c.appendTo(d)};b.prototype._getVisualPercentageValue=function(d){a.assertParamIsNumber(d,"value");var c=d;if(c<b.MINIMUM_PERCENTAGE_FOR_DISPLAY)c=0;return c};b.prototype._drawVisualProgress=function(k,d,e,i,l){a.assertParamIsObject(k,"$container");a.assertParamIsNumber(d,"current");a.assertParamIsNumber(e,"total");a.assertParamIsNumber(i,"maxTotal");a.assertParamIsBool(l,"inline");var h,c,f,j,g;if(e<0||d<0||e===0&&d===0)return;h=$("<div/>").addClass(b.CSSCLASS_CONTAINER);c=$("<div/>").addClass(b.CSSCLASS_CURRENT);if(e===0){c.addClass(b.CSSCLASS_NOTOTAL);g=d/i*100;c.css("width",this._getVisualPercentageValue(g)+"%");h.append(c)}else{f=$("<div/>").addClass(b.CSSCLASS_TOTAL);if(d<=e){j=e/i*100;g=d/e*100;f.addClass(b.CSSCLASS_UNALLOCATED);c.addClass(b.CSSCLASS_UNDERALLOCATED);f.append(c);h.append(f)}else{j=e/d*100;g=d/i*100;c.addClass(b.CSSCLASS_OVERALLOCATED);f.addClass(b.CSSCLASS_OVERALLOCATED);c.append(f);h.append(c)}c.css("width",this._getVisualPercentageValue(g)+"%");f.css("width",this._getVisualPercentageValue(j)+"%")}k.append(h)};return b}(e.BaseControl);d.ProgressControl=v;i.initClassPrototype(v,{_text:null});(function(b){b._numberFormatRegexp=new RegExp("(\\"+Sys.CultureInfo.CurrentCulture.numberFormat.NumberDecimalSeparator+"0*|0+)$");b.REMAINING_WORK_PRECISION=2;function d(d,c){a.assertParamIsNumber(d,"value");a.assertParamIsNumber(c,"precision");var e=f.StringUtils.localeFormat("{0:n"+c+"}",d);return e.replace(b._numberFormatRegexp,"")}b.formatNumberForDisplay=d;function c(c){var a,d=Number(c);if(!c||isNaN(d))a="";else{a=b.formatNumberForDisplay(d,b.REMAINING_WORK_PRECISION);if(a==="0")a=""}return a}b.formatRemainingWorkForDisplay=c})(d.FormatUtils||(d.FormatUtils={}));var l=d.FormatUtils,o=function(c){__extends(b,c);function b(a){c.call(this,a)}b._typeName="tfs.control.state";b._defaultAjaxOptions={showGlobalProgressIndicator:false};b.THROTTLE_DELAY_MILLISECS=500;b.prototype.initialize=function(){c.prototype.initialize.call(this)};b.prototype.beginGetState=function(d,e,f){a.assertParamIsStringNotEmpty(d,"key");var g=k.TfsContext.getDefault(),c=j.TfsTeamProjectCollection.getConnection(g).getService(j.WebSettingsService),h=this._getSettingsScope(c);c.beginReadSetting(d,h,e,f,b._defaultAjaxOptions)};b.prototype.beginSaveState=function(h,e,a,c){var g=this;function d(){var f=k.TfsContext.getDefault(),d=j.TfsTeamProjectCollection.getConnection(f).getService(j.WebSettingsService),i=g._getSettingsScope(d);d.beginWriteSetting(h,e,i,a,c,b._defaultAjaxOptions)}f.delay(this,b.THROTTLE_DELAY_MILLISECS,d)};b.prototype._getSettingsScope=function(b){a.assertIsType(b,j.WebSettingsService,"webSettingsService is not of the expected type");return b.canAccessTeamSettings()?j.WebSettingsScope.UserAndTeam:j.WebSettingsScope.User};return b}(e.Enhancement);d.ControlStateEnhancement=o;i.initClassPrototype(o,{_saveStateThrottledDelegate:null});var m=function(c){__extends(b,c);function b(b){c.call(this,b);this._splitter=null;this._isExpanded=null;this._isExpandedSettingPath=null;this._controlState=null;if(this._canSaveState()){a.assertIsStringNotEmpty(b.isExpandedSettingPath,"options.isExpandedSettingPath is empty");this._isExpandedSettingPath=b.isExpandedSettingPath;this._sizeSettingPath=b.sizeSettingPath}}b.DEFAULT_ENHANCEMENT_SELECTOR=".stateful";b.prototype._canSaveState=function(){return k.TfsContext.getDefault().navigation.topMostLevel>=k.NavigationContextLevels.Collection};b.prototype.initialize=function(){c.prototype.initialize.call(this);this._splitter=e.Enhancement.ensureEnhancement(q.Splitter,this._element);if(this._canSaveState()){this._controlState=e.Enhancement.enhance(o,this._element);this._bind("changed",g(this,this._onSplitterChanged))}};b.prototype._onSplitterChanged=function(){var a=this._splitter.isExpanded(),b=this._splitter.getFixedSidePixels(),c=this._isExpanded===null||a!==this._isExpanded,d=this._size===null||this._size!==b;if(c){this._isExpanded=a;this._controlState.beginSaveState(this._isExpandedSettingPath,a)}if(d){this._size=b;this._controlState.beginSaveState(this._sizeSettingPath,b)}};return b}(e.Enhancement);d.StatefulSplitterEnhancement=m;i.initClassPrototype(m,{_splitter:null,_isExpanded:null,_isExpandedSettingPath:null,_controlState:null});e.Enhancement.registerEnhancement(m,"."+q.Splitter.CORE_CSS_CLASS+m.DEFAULT_ENHANCEMENT_SELECTOR);i.tfsModuleLoaded("TFS.UI.Controls.Accessories",d)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
var __extends=this.__extends||function(b,c){function a(){this.constructor=b}a.prototype=c.prototype;b.prototype=new a};define("Presentation/Scripts/TFS/TFS.UI.Controls.Navigation",["require","exports","Presentation/Scripts/TFS/TFS","Presentation/Scripts/TFS/TFS.Diag","Presentation/Scripts/TFS/TFS.Core","Presentation/Scripts/TFS/TFS.UI.Controls","Presentation/Scripts/TFS/TFS.UI.Controls.Common","Presentation/Scripts/TFS/Resources/TFS.Resources.Common","Presentation/Scripts/TFS/TFS.UI.Controls.Menus","Presentation/Scripts/TFS/TFS.Host","Presentation/Scripts/TFS/TFS.UI"],function(J,e,H,G,F,B,x,w,y,C,E){var k=H,j=G,i=F,a=B,f=x,q=w,A=y,c=C,I=E,h=i.delegate,b=I.domElem,r=function(d){__extends(b,d);function b(a){d.call(this,a)}b.prototype.initializeOptions=function(a){d.prototype.initializeOptions.call(this,$.extend({attachNavigate:false,titleElementSelector:".hub-title",hubSplitterSelector:".hub-content > .splitter"},a))};b.prototype.initialize=function(){d.prototype.initialize.call(this);this._options.attachNavigate===true&&this._attachNavigate()};b.prototype.onNavigate=function(){};b.prototype._getViewTitle=function(){return this._element.find(".hub-title").eq(0)};b.prototype.setViewTitle=function(a,b){this._element.find(this._options.titleElementSelector).text(a||"").attr("title",b||a||"");this.setWindowTitle(a)};b.prototype.setViewTitleContent=function(a,b){this._element.find(this._options.titleElementSelector).html(b||"").attr("title",a||"");this.setWindowTitle(a)};b.prototype.setWindowTitle=function(a){document.title=i.StringUtils.format(q.PageTitleWithContent,a||"")};b.prototype.setLeftHubPaneVisibility=function(b){var d=this._element.find(this._options.hubSplitterSelector),c=a.Enhancement.getInstance(f.Splitter,d);if(c&&b!==this._leftPaneVisible){this._leftPaneVisible=b;c.toggleSplit(b)}};b.prototype.setFullScreenMode=function(b,a){if(typeof a==="undefined")a=false;var c=$(document.body);c.toggleClass("no-chrome",b);c.toggleClass("full-screen-mode",b);this.setLeftHubPaneVisibility(!b||a)};b.prototype._attachNavigate=function(){var b=this,a=false;c.history.attachNavigate(function(d,c){a=true;b._onNavigate(c||{})});!a&&this._onNavigate(c.history.getCurrentState()||{})};b.prototype._onNavigate=function(a){this.onNavigate(a)};return b}(a.BaseControl);e.NavigationView=r;var d=function(){function a(a){this._options=a||{};this._items=this._options.items||[]}a.toItem=function(a){var b;if(a&&a.length===1){b=a.data("item");if(!b){b={text:a.find("a:first").text(),title:a.attr("title")||null,value:a.data("value"),selected:a.hasClass("selected"),encoded:a.data("encoded")||false};a.data("item",b)}}return b};a.domToItems=function(c,d){var b=[];c.children("li.pivot-filter-item"+(d||"")).each(function(){b.push(a.toItem($(this)))});return b};a.setElementContent=function(d,b){var a,c,e;a=b.selectedTitle||b.title;c=b.selectedText||b.text;e=b.encoded;if(!a)if(!e)a=c;a&&d.attr("title",a);if(c)if(e)d.html(c);else d.text(c)};a.prototype.getTypeName=function(){return this.constructor.typeName||"select"};a.prototype._getItems=function(b){return a.domToItems(this._element,b)};a.prototype._toItem=function(b){return a.toItem(b)};a.prototype._updateItem=function(a,b){b=b||this._toItem(a);if(b)if(b.disabled){a.attr("disabled","disabled");a.addClass("disabled");a.removeClass("selected")}else{a.removeAttr("disabled");a.removeClass("disabled");a.toggleClass("selected",b.selected)}};a.prototype._toggleItem=function(c,b){var a=this._toItem(c);if(a){if(typeof b==="undefined")b=!a.selected;a.selected=b;this._updateItem(c,a)}return a};a.prototype._selectFirstEnabledItem=function(c){var a,b;$.each(c,function(){if(!this.disabled){if(!a)a=this;if(this.selected){b=this;return false}}});if(!b&&a){a.selected=true;b=a}return b};a.prototype._fireChange=function(a,b){a.trigger("filter-changed",[b])};a.prototype._selectItem=function(b){var c,a=b.next("li:not([disabled])");if(a.length===0)a=b.siblings("li:not([disabled])").first();if(a.length>0){this._toggleItem(b,false);c=this._toggleItem(a,true)}return c};a.prototype._onChange=function(e){var c=$(e.target),b,d,a;b=c.closest("li");d=c.closest("a");if(b.length>0){a=this._selectItem(b);a&&this._fireChange(this._element,a)}d.length>0&&e.preventDefault()};a.prototype.enhance=function(){this._element=this._options.filterContainer.find("ul.pivot-filter-items");this._items=this._getItems();this._attachChange(this._element)};a.prototype.populate=function(){var a=this._items,c=this._ensureElement();c.children().remove();if(a&&a.length>0){this._selectFirstEnabledItem(a);$.each(a,function(){var a=$(b("li","pivot-filter-item")),f,d,e;a.data("item",this);if(this.disabled){a.attr("disabled","disabled");a.addClass("disabled")}else this.selected&&a.addClass("selected");f=this.title;if(!f&&!this.encoded)f=this.text;f&&a.attr("title",f);this.value&&a.data("value",this.value);d=$(b("a"));d.attr("href","#");e=d;if(this.icon){$("<span />").addClass(this.icon).appendTo(d);e=$("<span />").appendTo(d)}e.addClass("text");if(this.encoded)e.html(this.text);else e.text(this.text);a.append(d);c.append(a)});this._attachChange(c)}};a.prototype.updateItems=function(a){this._items=a;this.populate()};a.prototype.getItem=function(a){var b,c=this._items;if(typeof a==="number")b=c[a];else $.each(c,function(){if(this.value==a||this.text==a){b=this;return false}});return b};a.prototype.getSelectedItems=function(){return this._getItems(".selected")};a.prototype.getSelectedItem=function(){var a=this._getItems(".selected");return a&&a[0]};a.prototype.setSelectedItem=function(a){var c=this,b=this._items;if(typeof a!=="object")a=this.getItem(a);if(a){$.each(b,function(){this.selected=false});a.selected=true;this._element.children("li").each(function(){c._updateItem($(this))})}};a.prototype._ensureElement=function(){if(!this._element){this._element=$(b("ul","pivot-filter-items"));this._element.appendTo(this._options.filterContainer)}return this._element};a.prototype._attachChange=function(a){a.children().bind("click",h(this,this._onChange))};return a}();k.initClassPrototype(d,{_options:null,_items:null,_element:null});var g=function(c){__extends(a,c);function a(a){c.call(this,a)}a._typeName="tfs.ui.pivotFilter";a._behaviors={};a.registerBehavior=function(b){j.assertParamIsNotNull(b,"behaviorType");a._behaviors[b.typeName]=b};a.createBehavior=function(f,e){var b,c;$.each(f||[],function(d,c){b=a._behaviors[c];if(b)return false});if(!b)b=d;c=new b(e);return c};a.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({coreCssClass:"pivot-filter",behavior:"select"},a))};a.prototype._enhance=function(d){var b,a;c.prototype._enhance.call(this,d);a=d[0];b=a&&typeof a.className==="string"?a.className.split(" "):[];this._initBehavior(b);this._behavior.enhance()};a.prototype.initialize=function(){c.prototype.initialize.call(this);this._attachEvents()};a.prototype.getSelectedItems=function(){return this._behavior.getSelectedItems()};a.prototype.getSelectedItem=function(){return this._behavior.getSelectedItem()};a.prototype.getItem=function(a){return this._behavior.getItem(a)};a.prototype.setSelectedItem=function(b,a){if(typeof a==="undefined")a=true;this._behavior.setSelectedItem(b,a)};a.prototype.updateItems=function(a){this._behavior.updateItems(a)};a.prototype._initBehavior=function(b){this._behavior=a.createBehavior(b,{items:this._options.items,filterContainer:this._element})};a.prototype._createElement=function(){c.prototype._createElement.call(this);this._initBehavior([this._options.behavior]);this._buildDom()};a.prototype._buildDom=function(){var e=this._element,h=this._behavior,g=this._options,d,a,c,f;e.addClass(h.getTypeName());d=$(b("span","title"));a=g.title;c=g.text;f=g.encoded;if(!a)if(!f){a=c;a&&e.attr("title",a)}if(c)if(f)d.html(c);else d.text(c);e.append(d);this._behavior.populate()};a.prototype._attachEvents=function(){this._bind(this._element,"filter-changed",h(this,this._onFilterChanged))};a.prototype._onFilterChanged=function(b,a){this._fire("changed",[a]);if($.isFunction(this._options.change))return this._options.change.call(this,a)};return a}(a.BaseControl);e.PivotFilter=g;k.initClassPrototype(g,{_behavior:null});var v=function(b){__extends(a,b);function a(a){b.call(this,a)}a.typeName="radio";a.prototype._selectFirstEnabledItem=function(){};a.prototype._selectItem=function(a){var d=this,b,c=this._toItem(a);if(!c.selected){a.siblings("li").each(function(){d._toggleItem($(this),false)});b=this._toggleItem(a,true)}return b};return a}(d);g.registerBehavior(v);var s=function(b){__extends(a,b);function a(a){b.call(this,a)}a.typeName="checkbox";a.prototype._selectFirstEnabledItem=function(){};a.prototype._selectItem=function(a){return this._toggleItem(a,true)};return a}(d);g.registerBehavior(s);var t=function(c){__extends(b,c);function b(a){c.call(this,a)}b.typeName="dropdown";b.prototype._getItems=function(a){return this._addCommandIdToItems(c.prototype._getItems.call(this,a))};b.prototype.populate=function(){var a=this._selectFirstEnabledItem(this._items);if(a){this._element&&this._element.remove();this._disposeExistingPopup();this._element=$("<a href=# class='selected'/>").appendTo(this._options.filterContainer);d.setElementContent(this._element,a);this._element.bind("click",h(this,this._onDrop))}};b.prototype.enhance=function(){this._element=this._options.filterContainer.find("ul.pivot-filter-items");this._items=this._getItems();this._element.remove();this.populate()};b.prototype.updateItems=function(a){c.prototype.updateItems.call(this,this._addCommandIdToItems(a))};b.prototype.getSelectedItems=function(){return[this.getSelectedItem()]};b.prototype.getSelectedItem=function(){var a;$.each(this._items,function(){if(this.selected===true){a=this;return false}});return a};b.prototype.setSelectedItem=function(a,b){if(typeof b==="undefined")b=true;var c=this._items;if(a&&a!==this.getSelectedItem()){$.each(c,function(){this.selected=false});a.selected=true;d.setElementContent(this._element,a);b&&this._fireChange(this._element,a)}};b.prototype._addCommandIdToItems=function(a){return $.map(a,function(a){if(!a.id)a.id=a.text;return a})};b.prototype._onDrop=function(f){var d=$(f.target),b=this._options.filterContainer,e=this._items,c;this._disposeExistingPopup();c=a.BaseControl.createIn(A.PopupMenu,b,{align:"left-bottom",showIcon:false,items:[{childItems:e}],onDeactivate:function(){b.removeClass("active");b.children("ul.menu-popup").hide()},executeAction:h(this,this._onExecute)});i.delay(this,10,function(){b.addClass("active");c.popup(d,b)});this._popupMenu=c;return false};b.prototype._onExecute=function(a){this._options.filterContainer.removeClass("active");this.setSelectedItem(a.get_commandSource()._item)};b.prototype._disposeExistingPopup=function(){if(this._popupMenu){this._popupMenu.dispose();delete this._popupMenu}};return b}(d);g.registerBehavior(t);a.Enhancement.registerEnhancement(g,".pivot-filter.enhance");function n(a){var b;if(a&&a.length===1){b=a.data("item");if(!b){b={text:a.find("a:first").html(),title:a.attr("title")||null,id:a.data("id"),link:a.find("a:first").attr("href"),selected:a.hasClass("selected"),encoded:a.data("encoded")||false,disabled:a.hasClass("disabled")};a.data("item",b)}}return b}function D(a,b){b=b||n(a);if(b)if(b.disabled){a.attr("disabled","disabled");a.addClass("disabled");a.removeClass("selected")}else{a.removeAttr("disabled");a.removeClass("disabled");a.toggleClass("selected",b.selected)}}var m=function(c){__extends(a,c);function a(a){c.call(this,a)}a._typeName="tfs.ui.pivotView";a.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({coreCssClass:"pivot-view",tagName:"ul"},a))};a.prototype._enhance=function(a){c.prototype._enhance.call(this,a);this._options.items=this._getItems()};a.prototype._getItems=function(b){var a=[];this._element.children("li"+(b||"")).each(function(){a.push(n($(this)))});return a};a.prototype.initialize=function(){c.prototype.initialize.call(this);this._attachEvents()};a.prototype.updateItems=function(){var a=this._element;a.empty();this._populateItems(a)};a.prototype.getSelectedView=function(){var a=this._getItems(".selected");return a&&a[0]};a.prototype.setViewEnabled=function(c,a){j.assertParamIsBool(a,"isEnabled");var b=this.getView(c);if(b)b.disabled=!a};a.prototype.getView=function(b){var a;if(typeof b==="number")a=this._options.items[b];else $.each(this._options.items,function(){if(this.id==b){a=this;return false}});return a};a.prototype.setSelectedView=function(a){var b=this._options.items;if(typeof a!=="object")a=this.getView(a);if(a){$.each(b,function(){this.selected=false});a.selected=true;this._element.find("li").each(function(){D($(this),null)});this.onChanged(a)}};a.prototype.onChanged=function(a){this._fire("changed",[a])};a.prototype._createElement=function(){c.prototype._createElement.call(this);this._buildDom()};a.prototype._buildDom=function(){this._populateItems(this._element)};a.prototype._populateItems=function(e){var d,c=this._options.items,a;if(c){$.each(c,function(){if(!this.disabled){if(!a)a=this;if(this.selected){d=this;return false}}});if(!d&&a)a.selected=true;$.each(c,function(){var a=$(b("li")),d,c;a.data("item",this);if(this.disabled){a.attr("disabled","disabled");a.addClass("disabled")}else this.selected&&a.addClass("selected");d=this.title;if(!d&&!this.encoded)d=this.text;d&&a.attr("title",d);this.id&&a.data("id",this.id);c=$(b("a"));if(this.link)c.attr("href",this.link);else c.attr("href","#");if(this.encoded)c.html(this.text);else c.text(this.text);a.append(c);e.append(a)})}};a.prototype._attachEvents=function(){this._bind("click",h(this,this._onClick))};a.prototype._onClick=function(e){var d=$(e.target),b,c,a;b=d.closest("li");c=d.closest("a");if(b.length>0)a=n(b);if(c.length>0&&(c.attr("href")==="#"||a&&a.disabled)){a&&!a.disabled&&this.setSelectedView(a);e.preventDefault()}};return a}(a.BaseControl);e.PivotView=m;a.Enhancement.registerEnhancement(m,".pivot-view.enhance");var l=function(b){__extends(a,b);function a(a){b.call(this,a)}a.prototype.onNavigate=function(){};a.prototype.onNavigateAway=function(){};return a}(a.BaseControl);e.NavigationViewTab=l;var o=function(c){__extends(b,c);function b(){c.apply(this,arguments)}b.TAB_ID="error";b.prototype.initializeOptions=function(a){c.prototype.initializeOptions.call(this,$.extend({cssClass:"error-tab"},a))};b.prototype.initialize=function(){c.prototype.initialize.call(this);this._messageControl=a.BaseControl.createIn(f.MessageAreaControl,$("<div class='tabbed-navigation-error' />").appendTo(this._element),{closeable:false})};b.prototype.setContent=function(b,a,c,d){this._messageControl.setMessage({type:c,header:b,content:a});this._messageControl.setErrorDetailsVisibility(d)};return b}(l),p=function(d){__extends(c,d);function c(){d.apply(this,arguments)}c.TAB_ID="info";c.prototype.initializeOptions=function(a){d.prototype.initializeOptions.call(this,$.extend({cssClass:"info-tab"},a))};c.prototype.initialize=function(){d.prototype.initialize.call(this);this._$title=$(b("div","information-title")).appendTo(this._element);this._$description=$(b("div","information-summary")).appendTo(this._element)};c.prototype.setHeader=function(b,a){this._$title.text(b);this._$description.html(a)};c.prototype.appendInformation=function(d,c){return a.BaseControl.createIn(f.InformationAreaControl,$(b("div")).appendTo(this._element),{caption:d,collapsed:c})};return c}(l),u=function(e){__extends(d,e);function d(a){e.call(this,a);this._currentNavigationContextId=0;this._lastParsedNavigationContextId=0;this._showingError=false}d.prototype.initializeOptions=function(a){e.prototype.initializeOptions.call(this,$.extend({tabs:null,tabOptions:null,attachNavigate:true,hubContentSelector:".right-hub-content .hub-pivot-content",pivotTabsSelector:".right-hub-content .hub-pivot .views .pivot-view",hubSplitterSelector:".hub-splitter"},a))};d.prototype.initialize=function(){var b=this;this._hubContent=this._element.find(this._options.hubContentSelector);j.assert(this._hubContent.length>0,"Unable to find right hub content element");if(this._options.tabs){this._tabsControl=a.Enhancement.ensureEnhancement(m,this._element.find(this._options.pivotTabsSelector));j.assertIsObject(this._tabsControl,"Unable to find pivotview tabs control.");this._tabsMap={};$.each(this._options.tabs,function(c,a){b._tabsMap[(""+c).toUpperCase()]=a});this._tabOptionsMap={};this._options.tabOptions&&$.each(this._options.tabOptions,function(c,a){b._tabOptionsMap[(""+c).toUpperCase()]=a});this._tabs={}}e.prototype.initialize.call(this)};d.prototype.showError=function(a){var c=k.getErrorMessage(a),b="";if(a.stack)b=$("<div />").text(a.stack);this.showErrorContent(c,b,f.MessageAreaType.Error,false)};d.prototype.showErrorContent=function(i,e,g,h){var c;if(this._tabs){this._updateTabsControl(o.TAB_ID,this.getRawState(),this._currentParsedState);this._showingError=true;c=this._getErrorTab();c.setContent(i,e,g,h);this._showTab(c);this._hubContent.show();this.onNavigate(this.getState())}else{var d=a.BaseControl.createIn(f.MessageAreaControl,$(b("div","tabbed-navigation-error")).appendTo(this._hubContent),{closeable:false});d.setMessage({type:g,header:i,content:e});d.setErrorDetailsVisibility(h)}};d.prototype.showInformationTab=function(d,a){if(this._tabs){this._updateTabsControl(p.TAB_ID,this.getRawState(),this._currentParsedState);this._showingInfo=true;var c=this._getInfoTab();c.setHeader(d,a);this._showTab(c);this._hubContent.show();this.onNavigate(this.getState())}else{this._$infoContent=$(b("div","information-section")).appendTo(this._hubContent);$(b("div","information-title")).appendTo(this._$infoContent).text(d||"");$(b("div","information-summary")).text(a||"").appendTo(this._$infoContent)}};d.prototype.appendInformationContent=function(d,c){var b;if(this._tabs){var e=this._getInfoTab();b=e.appendInformation(d,c)}else if(this._$infoContent)b=a.BaseControl.createIn(f.InformationAreaControl,this._$infoContent,{caption:d,collapsed:c});return b};d.prototype.refreshCurrentTab=function(){this._onNavigate(this._currentRawState)};d.prototype.getCurrentAction=function(){return this._currentTabId};d.prototype.getState=function(){return this._currentParsedState||{}};d.prototype.setState=function(a){this._currentParsedState=a};d.prototype.getEmptyState=function(){var a={};$.each(c.history.getCurrentState(),function(b){a[b]=null});return a};d.prototype.getRawState=function(){return this._currentRawState||{}};d.prototype.parseStateInfo=function(c,b,a){a(c,b)};d.prototype.getTabVisibility=function(){return true};d.prototype.getTabLabel=function(){};d.prototype.setHubPivotVisibility=function(a){this._tabsControl.getElement().parents(".hub-pivot:first").toggleClass("hidden",!a)};d.prototype._getErrorTab=function(){if(!this._errorTab)this._errorTab=this._createTab(o);return this._errorTab};d.prototype._getInfoTab=function(){if(!this._infoTab)this._infoTab=this._createTab(p);return this._infoTab};d.prototype._onNavigate=function(a){var c=this,b;this._currentRawState=a;b=++this._currentNavigationContextId;this.parseStateInfo(a.action,a,function(e,d){c._onParseStateInfoSuccess(e,a,d,b)});this._lastParsedNavigationContextId!==b&&!(this._showingError||this._showingInfo)&&this._hubContent.hide()};d.prototype._onParseStateInfoSuccess=function(c,d,a,e){var b;this._currentParsedState=a||{};this._lastParsedNavigationContextId=e;this._hubContent.show();if(this._tabs){this._updateTabsControl(c,d,a);b=this._getTab(c);if(b){this._showTab(b);this._showingError=false;this._currentTabId=c;if($.isFunction(b.onNavigate))b.onNavigate(d,a);this.onNavigate(a)}else this.showError(i.StringUtils.format(q.NavigationViewUnknownTabErrorFormat,c))}else this.onNavigate(a)};d.prototype._updateTabsControl=function(a,b,e){var d=this;$.each(this._options.tabs,function(g){var h,f;f=d._tabsControl.getView(g);if(f){f.link=c.urlHelper.getFragmentActionLink(g,b);f.selected=(""+g).toUpperCase()===(""+a).toUpperCase();f.disabled=!d.getTabVisibility(g,a,b,e);h=d.getTabLabel(g,a,b,e);if(h)f.text=h}});this._tabsControl.updateItems()};d.prototype._showTab=function(a){if(this._currentTab!==a){if(this._currentTab){this._currentTab.onNavigateAway();this._currentTab.hideElement()}a&&a.showElement();this._currentTab=a}};d.prototype._getTab=function(a){var b,c;a=(""+a).toUpperCase();b=this._tabs[a];if(!b){c=this._tabsMap[a];if(c){b=this._createTab(c,this._tabOptionsMap[a]);this._tabs[a]=b}}return b};d.prototype._createTab=function(b,d){var c=$("<div />").addClass("navigation-view-tab").appendTo(this._hubContent);return a.Enhancement.enhance(b,c,$.extend({navigationView:this},d))};return d}(r);e.TabbedNavigationView=u;var z=function(b){__extends(a,b);function a(a){this._navigationLinkOptions=a||{};b.call(this,a)}a.prototype.initializeOptions=function(a){b.prototype.initializeOptions.call(this,$.extend({tagName:"a"},a))};a.prototype.initialize=function(){b.prototype.initialize.call(this);this._navigateHandler=h(this,this.onNavigate);c.history.attachNavigate(this._navigateHandler);if(this._navigationLinkOptions.text)this._element.text(this._navigationLinkOptions.text);else this._navigationLinkOptions.$content&&this._navigationLinkOptions.$content.appendTo(this._element);this._navigationLinkOptions.target&&this._element.attr("target",this._navigationLinkOptions.target);this._navigationLinkOptions.title&&this._element.attr("title",this._navigationLinkOptions.title);this.updateLink(this._navigationLinkOptions.initialState||c.history.getCurrentState())};a.prototype.dispose=function(){b.prototype.dispose.call(this);c.history.detachNavigate(this._navigateHandler)};a.prototype.onNavigate=function(b,a){this.updateLink(a)};a.prototype.updateLink=function(a){this._element.attr("href",this.getLocation(a))};a.prototype.getLocation=function(a){if(this._navigationLinkOptions.getUrl)return this._navigationLinkOptions.getUrl.call(this,a);else{a=$.extend({},a,this._navigationLinkOptions.state);return c.urlHelper.getFragmentActionLink(null,a)}};return a}(a.BaseControl);e.NavigationLink=z;k.tfsModuleLoaded("TFS.UI.Controls.Navigation",e)});
//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
define("Presentation/Scripts/TFS/TFS.WebApi",["require","exports","Presentation/Scripts/TFS/TFS.Core.Ajax","Presentation/Scripts/TFS/TFS"],function(g,a,e,f){var b=e,c=f,d=function(){function a(a){this._rootRequestPath=a;this._locationsByArea={}}a.APIS_RELATIVE_PATH="_apis";a.prototype._beginRequest=function(a,e,d){var c=this;this._beginGetLocation(a.area,a.locationId,function(h){var j=c.getRequestUrl(h,a.routeValues),f,g,i;f={type:a.httpMethod||"GET",dataType:a.httpResponseType||"json"};if(a.data&&f.type.toUpperCase()!=="GET"){i=JSON.stringify(a.data);f.jsonp=false}else i=a.data;if(!a.httpResponseType||a.httpResponseType.toLowerCase()==="json")g="application/json";else{g="*/*";f.converters={}}f.headers={Accept:g+";api-version="+h.maxVersion+";res-version:"+h.resourceVersion,"Content-Type":"application/json"};b.getMSJSON(j,i,function(b,d,f){if(a.responseIsCollection&&$.isArray(b.value)){b=b.value;a.responseType&&$.each(b,function(d,b){c._processDeserializedType(b,a.responseType)})}else a.responseType&&c._processDeserializedType(b,a.responseType);$.isFunction(e)&&e.call(c,b,d,f)},d,f)},d)};a.prototype._beginGetLocation=function(e,h,i,g){var d=this,f=function(a){var b=a[(h||"").toLowerCase()];i.call(d,b)};c.queueRequest(this,this._locationsByArea,e,f,g,function(f,g){var c=d._rootRequestPath+a.APIS_RELATIVE_PATH+"/"+e;b.getMSJSON(c,{},function(b){var a={};$.each(b.value,function(c,b){a[b.id.toLowerCase()]=b});f(a)},g,{type:"OPTIONS"})})};a.prototype.getRequestUrl=function(b,a){a=a||{};if(!a.area)a.area=b.area;if(!a.resource)a.resource=b.resourceName;return this._rootRequestPath+this.replaceRouteValues(b.routeTemplate,a)};a.prototype.replaceRouteValues=function(e,i){for(var d="",a="",f="",h=false,g=e.length,c,b=0;b<g;b++){c=e[b];if(h)if(c=="}"){h=false;if(i[f])a+=i[f];f=""}else f+=c;else if(c=="/"){if(a){if(d)d+="/";d+=a;a=""}}else if(c=="{")if(b+1<g&&e[b+1]=="{"){a+=c;b++}else h=true;else if(c=="}"){a+=c;if(b+1<g&&e[b+1]=="}")b++}else a+=c}if(a){if(d)d+="/";d+=a}return d};a.prototype._processDeserializedType=function(b,c){var a=this;b&&c.fields&&$.each(c.fields,function(e,c){var d=b[e];if(d)if(c.isArray)$.isArray(d)&&$.each(d,function(e,b){if(c.isDate&&typeof b==="string")d[e]=a._getDateValueFromISOString(b);else if(c.enumType&&typeof b==="string")d[e]=a._getValueFromEnumString(c.enumType,b);else c.typeInfo&&a._processDeserializedType(b,c.typeInfo)});else if(c.isDictionary){var f={};$.each(d,function(d,b){var g=d,e=b;if(c.dictionaryKeyIsDate&&typeof d==="string")g=a._getDateValueFromISOString(d);else if(c.dictionaryKeyEnumType&&typeof d==="string")g=a._getValueFromEnumString(c.dictionaryKeyEnumType,d);if(c.dictionaryValueIsDate&&typeof b==="string")e=a._getDateValueFromISOString(b);else if(c.dictionaryValueEnumType&&typeof b==="string")e=a._getValueFromEnumString(c.dictionaryValueEnumType,b);else c.dictionaryValueTypeInfo&&a._processDeserializedType(e,c.dictionaryValueTypeInfo);f[g]=e});b[e]=f}else if(c.isDate&&typeof d==="string")b[e]=a._getDateValueFromISOString(d);else if(c.enumType&&typeof d==="string")b[e]=a._getValueFromEnumString(c.enumType,d);else c.typeInfo&&a._processDeserializedType(d,c.typeInfo)})};a.prototype._getValueFromEnumString=function(c,a){var b=0;a&&$.each(a.split(","),function(e,d){var a=c.enumValues[$.trim(d)];if(a)b|=a});return b};a.prototype._getDateValueFromISOString=function(b){var a=new Date(b);if($.browser.msie&&isNaN(a))a=this._convertLegacyIEDate(b);return a};a.prototype._convertLegacyIEDate=function(c){var b;if(!a._legacyDateRegExp)a._legacyDateRegExp=new RegExp("(\\d+)-(\\d+)-(\\d+)T(\\d+):(\\d+):(\\d+).(\\d+)Z");b=a._legacyDateRegExp.exec(c);return b?new Date(Date.UTC(parseInt(b[1]),parseInt(b[2])-1,parseInt(b[3]),parseInt(b[4]),parseInt(b[5]),parseInt(b[6]),parseInt(b[7]))):null};return a}();a.VssHttpClient=d;c.tfsModuleLoaded("TFS.HttpClient",a)});
